<!DOCTYPE html>
<html class="theme-light" lang="zh-cn">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Virtualization software allows multiple operating systems to run simultaneously on the same computer"/>
  <meta name="keywords" content="91, 34, 118, 105, 114, 116, 117, 97, 108, 105, 122, 97, 116, 105, 111, 110, 34, 44, 32, 34, 80, 97, 114, 97, 108, 108, 101, 108, 115, 34, 44, 32, 34, 86, 77, 119, 97, 114, 101, 34, 44, 32, 34, 86, 105, 114, 116, 117, 97, 108, 66, 111, 120, 34, 44, 32, 34, 98, 104, 121, 118, 101, 34, 44, 32, 34, 88, 69, 78, 34, 93"/>
  <meta name="copyright" content="1995-2024 The FreeBSD Foundation" />
  <link rel="canonical" href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/" />

  <title>Chapter 24. Virtualization |  FreeBSD 中文文档</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

    <link rel="shortcut icon" href="https://free.bsd-doc.org/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="https://free.bsd-doc.org/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>

  
  
    
    <meta property="og:title" content="Chapter 24. Virtualization" />
    <meta property="og:description" content="Virtualization software allows multiple operating systems to run simultaneously on the same computer" />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://free.bsd-doc.orgfavicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="zh-cn" />
    <meta property="og:url" content="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/" />
    <meta property="og:site_name" content="FreeBSD 中文文档" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "https:\/\/free.bsd-doc.org\/zh-cn\/books\/handbook\/virtualization\/",
        "name": "FreeBSD 中文文档",
        "headline": "FreeBSD 中文文档",
        "description": "FreeBSD 中文文档"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="https://free.bsd-doc.org" class="logo">
        <img src="https://free.bsd-doc.org/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      <div class="donate">
        <a href="https://github.com/fierceX/freebsd-doc-cn" target="_blank">
          <span class="heart">♥</span>
          GitHub
        </a>
      </div>
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="Search" aria-label="Search" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/">
              前言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-audience">预期读者</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from4">第四版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from3">第三版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from2">第二版（2004 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes">第一版（2001 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-overview">本书的组织结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-conv">本书中使用的约定</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-acknowledgements">致谢</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/parti/">
              第一部分：入门指南
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/">
              第一章 引言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#introduction-synopsis">1.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#nutshell">1.2. 欢迎来到 FreeBSD ！</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#history">1.3. 关于 FreeBSD 项目</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/">
              第二章 安装 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-synopsis">2.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-hardware">2.2. 最低硬件要求</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-pre">2.3. 安装前的任务</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-start">2.4. 开始安装</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#using-bsdinstall">2.5. 使用 bsdinstall</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-partitioning">2.6. 分配磁盘空间</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-fetching-distribution">2.7. 获取分发文件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-post">2.8. 网络接口，账户，时区，服务和加固</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-install-trouble">2.9. 故障排除</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#using-live-cd">2.10. 使用 Live CD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/">
              第三章. FreeBSD 基础知识
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-synopsis">3.1. 概要</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#consoles">3.2. 虚拟控制台和终端</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#users-synopsis">3.3. 用户和基本账户管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#permissions">3.4. 权限</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#dirstructure">3.5. 目录结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#disk-organization">3.6. 磁盘组织</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#mount-unmount">3.7. 挂载和卸载文件系统</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-processes">3.8. 进程和守护进程</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#shells">3.9. Shells</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#editors">3.10. 文本编辑器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-devices">3.11. 设备和设备节点</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-more-information">3.12. 手册页</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/">
              第四章 安装应用程序：软件包和 Ports
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-synopsis">4.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-overview">4.2. 软件安装概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-finding-applications">4.3. 寻找软件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#pkgng-intro">4.4. 使用 pkg 进行二进制包管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-using">4.5. 使用 Ports 集合</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-poudriere">4.6. 使用 poudriere 构建软件包</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-nextsteps">4.7. 安装后的考虑事项</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-broken">4.8. 处理损坏的 ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/">
              第五章 X Window 系统
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x11-synopsis">5.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-install">5.2. 安装 Xorg</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-graphic-card-drivers">5.3. 显卡驱动程序</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-config">5.4. Xorg 配置</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-fonts">5.5. 在 Xorg 中使用字体</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-235af08fb87fd7a58003348706d2111d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-235af08fb87fd7a58003348706d2111d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/">
              第六章 Wayland
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-synopsis">6.1. Wayland 概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-wayfire">6.2. Wayfire 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-hikari">6.3. Hikari 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-sway">6.4. Sway 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-xwayland">6.5. 使用 Xwayland</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-remotedesktop">6.6. 使用 VNC 进行远程桌面访问</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-ly">6.7. Wayland 登录管理器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-utilities">6.8. 有用的工具</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4de18483dde20bf9ed0024176afd09da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4de18483dde20bf9ed0024176afd09da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/">
              第 7 章 网络
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#network-synopsis">7.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#config-network-setup">7.2. 设置网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#config-network-connection">7.3. 有线网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#network-wireless">7.4. 无线网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#hostname">7.5. 主机名</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#dns">7.6. DNS</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#troubleshooting">7.7. 故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partii/">
              第二部分：常见任务
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/">
              Chapter 8. Desktop Environments
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-synopsis">8.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-environments">8.2. Desktop Environments</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-browsers">8.3. Browsers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-development">8.4. Development tools</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-productivity">8.5. Desktop office productivity</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-viewers">8.6. Document Viewers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-finance">8.7. Finance</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/">
              Chapter 9. Multimedia
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#multimedia-synopsis">9.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#sound-setup">9.2. Setting Up the Sound Card</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#audio-ports">9.3. Audio players</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#video-ports">9.4. Video players</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#conferencing-meetings">9.5. Conferencing and Meetings</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#scanners">9.6. Image Scanners</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/">
              Chapter 10. Configuring the FreeBSD Kernel
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-synopsis">10.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-custom-kernel">10.2. Why Build a Custom Kernel?</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-devices">10.3. Finding the System Hardware</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-config">10.4. The Configuration File</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-building">10.5. Building and Installing a Custom Kernel</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-trouble">10.6. If Something Goes Wrong</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/">
              Chapter 11. Printing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-quick-start">11.1. Quick Start</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-connections">11.2. Printer Connections</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-pdls">11.3. Common Page Description Languages</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-direct">11.4. Direct Printing</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-lpd">11.5. LPD (Line Printer Daemon)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-other">11.6. Other Printing Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/">
              Chapter 12. Linux Binary Compatibility
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-synopsis">12.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-lbc-install">12.2. Configuring Linux Binary Compatibility</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linux-userlands">12.3. Linux userlands</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-advanced">12.4. Advanced Topics</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-af234c193ce95c480af0ff5ec3f32f5c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-af234c193ce95c480af0ff5ec3f32f5c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/">
              Chapter 13. WINE
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-synopsis">13.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-overview-concepts">13.2. WINE Overview & Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#installing-wine-on-freebsd">13.3. Installing WINE on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#running-first-wine-program">13.4. Running a First WINE Program on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#configuring-wine-installation">13.5. Configuring WINE Installation</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-management-guis">13.6. WINE Management GUIs</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-in-multi-user-os-installations">13.7. WINE in Multi-User FreeBSD Installations</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-on-os-faq">13.8. WINE on FreeBSD FAQ</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partiii/">
              第三部分：系统管理
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/">
              Chapter 14. Configuration, Services, Logging and Power Management
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#config-synopsis">14.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-configfiles">14.2. Configuration Files</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-rcd">14.3. Managing Services in FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#cron-periodic">14.4. Cron and Periodic</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-syslog">14.5. Configuring System Logging</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#acpi-overview">14.6. Power and Resource Management</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#adding-swap-space">14.7. Adding Swap Space</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/">
              Chapter 15. The FreeBSD Booting Process
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-synopsis">15.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-introduction">15.2. FreeBSD Boot Process</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#device-hints">15.3. Device Hints</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-shutdown">15.4. Shutdown Sequence</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/">
              Chapter 16. Security
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-synopsis">16.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-intro">16.2. Introduction</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#sec-accounts">16.3. Securing Accounts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-ids">16.4. Intrusion Detection System (IDS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-secure-levels">16.5. Secure levels</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-file-flags">16.6. File flags</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#openssh">16.7. OpenSSH</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#openssl">16.8. OpenSSL</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#kerberos5">16.9. Kerberos</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#tcpwrappers">16.10. TCP Wrappers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#fs-acl">16.11. Access Control Lists</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#capsicum">16.12. Capsicum</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-accounting">16.13. Process Accounting</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-resourcelimits">16.14. Resource Limits</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-pkg">16.15. Monitoring Third Party Security Issues</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-advisories">16.16. FreeBSD Security Advisories</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/">
              Chapter 17. Jails and Containers
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jails-synopsis">17.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-types">17.2. Jail Types</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#host-configuration">17.3. Host Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#classic-jail">17.4. Classic Jail (Thick Jail)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#thin-jail">17.5. Thin Jails</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-management">17.6. Jail Management</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-upgrading">17.7. Jail Upgrading</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-resource-limits">17.8. Jail Resource Limits</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-managers-and-containers">17.9. Jail Managers and Containers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/">
              Chapter 18. Mandatory Access Control
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-synopsis">18.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-inline-glossary">18.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-understandlabel">18.3. Understanding MAC Labels</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-planning">18.4. Planning the Security Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-policies">18.5. Available MAC Policies</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-userlocked">18.6. User Lock Down</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-implementing">18.7. Nagios in a MAC Jail</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-troubleshoot">18.8. Troubleshooting the MAC Framework</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/">
              Chapter 19. Security Event Auditing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-synopsis">19.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-inline-glossary">19.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-config">19.3. Audit Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-administration">19.4. Working with Audit Trails</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/">
              Chapter 20. Storage
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-synopsis">20.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-adding">20.2. Adding Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-growing">20.3. Resizing and Growing Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#usb-disks">20.4. USB Storage Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#creating-cds">20.5. Creating and Using CD Media</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#creating-dvds">20.6. Creating and Using DVD Media</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#floppies">20.7. Creating and Using Floppy Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#using-ntfs">20.8. Using NTFS Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#backup-basics">20.9. Backup Basics</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-virtual">20.10. Memory Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#snapshots">20.11. File System Snapshots</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#quotas">20.12. Disk Quotas</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-encrypting">20.13. Encrypting Disk Partitions</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#swap-encrypting">20.14. Encrypting Swap</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-hast">20.15. Highly Available Storage (HAST)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/">
              Chapter 21. GEOM: Modular Disk Transformation Framework
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-synopsis">21.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-striping">21.2. RAID0 - Striping</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-mirror">21.3. RAID1 - Mirroring</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-raid3">21.4. RAID3 - Byte-level Striping with Dedicated Parity</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-graid">21.5. Software RAID Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-ggate">21.6. GEOM Gate Network</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-glabel">21.7. Labeling Disk Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-gjournal">21.8. UFS Journaling Through GEOM</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f1657a05627dd16bad31d4c7f675604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f1657a05627dd16bad31d4c7f675604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/">
              第 22 章 Z 文件系统（ZFS）
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-differences">22.1. ZFS 有何不同之处</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-quickstart">22.2. 快速入门指南</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zpool">22.3. <code>zpool</code> 管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zfs">22.4. <code>zfs</code> 管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zfs-allow">22.5. 委派管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-advanced">22.6. 高级主题</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-links">22.7. 进一步资源</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-term">22.8. ZFS 功能和术语</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/">
              Chapter 23. Other File Systems
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/#filesystems-synopsis">23.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/#filesystems-linux">23.2. Linux® File Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/">
              Chapter 24. Virtualization
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-synopsis">24.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-xen">24.7. FreeBSD as a Xen™-Host</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/">
              Chapter 25. Localization - i18n/L10n Usage and Setup
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#l10n-synopsis">25.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#using-localization">25.2. Using Localization</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#l10n-compiling">25.3. Finding i18n Applications</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#lang-setup">25.4. Locale Configuration for Specific Languages</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/">
              Chapter 26. Updating and Upgrading FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-synopsis">26.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">26.2. FreeBSD Update</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-bootcode">26.3. Updating Bootcode</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-documentation">26.4. Updating the Documentation Set</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#current-stable">26.5. Tracking a Development Branch</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#makeworld">26.6. Updating FreeBSD from Source</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#small-lan">26.7. Tracking for Multiple Machines</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#building-on-non-freebsd-hosts">26.8. Building on non-FreeBSD Hosts</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/">
              Chapter 27. DTrace
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-synopsis">27.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-implementation">27.2. Implementation Differences</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-enable">27.3. Enabling DTrace Support</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-using">27.4. Using DTrace</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bdb217202a0a3eef4571dd1fcd50863c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bdb217202a0a3eef4571dd1fcd50863c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/">
              Chapter 28. USB Device Mode / USB OTG
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-synopsis">28.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-terminals">28.2. USB Virtual Serial Ports</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-network">28.3. USB Device Mode Network Interfaces</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-storage">28.4. USB Virtual Storage Device</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partiv/">
              第四部分：网络通信
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/">
              Chapter 29. Serial Communications
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serial-synopsis">29.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serial">29.2. Serial Terminology and Hardware</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#term">29.3. Terminals</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#dialup">29.4. Dial-in Service</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#dialout">29.5. Dial-out Service</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serialconsole-setup">29.6. Setting Up the Serial Console</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/">
              Chapter 30. PPP
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">30.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#userppp">30.2. Configuring PPP</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#ppp-troubleshoot">30.3. Troubleshooting PPP Connections</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#pppoe">30.4. Using PPP over Ethernet (PPPoE)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#pppoa">30.5. Using PPP over ATM (PPPoA)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/">
              Chapter 31. Electronic Mail
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-synopsis">31.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-using">31.2. Mail Components</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#dragonFly-mail-agent">31.3. DragonFly Mail Agent (DMA)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#sendmail">31.4. Sendmail</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-changingmta">31.5. Changing the Mail Transfer Agent</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-agents">31.6. Mail User Agents</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-advanced">31.7. Advanced Topics</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/">
              Chapter 32. Network Servers
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-servers-synopsis">32.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-inetd">32.2. The inetd Super-Server</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-nfs">32.3. Network File System (NFS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-nis">32.4. Network Information System (NIS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ldap">32.5. Lightweight Directory Access Protocol (LDAP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-dhcp">32.6. Dynamic Host Configuration Protocol (DHCP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-dns">32.7. Domain Name System (DNS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-apache">32.8. Apache HTTP Server</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ftp">32.9. File Transfer Protocol (FTP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-samba">32.10. File and Print Services for Microsoft® Windows® Clients (Samba)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ntp">32.11. Clock Synchronization with NTP</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-iscsi">32.12. iSCSI Initiator and Target Configuration</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/">
              Chapter 33. Firewalls
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-intro">33.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-concepts">33.2. Firewall Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-pf">33.3. PF</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-ipfw">33.4. IPFW</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-ipf">33.5. IPFILTER (IPF)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-blacklistd">33.6. Blacklistd</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/">
              Chapter 34. Advanced Networking
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#advanced-networking-synopsis">34.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-routing">34.2. Gateways and Routes</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#configtuning-virtual-hosts">34.3. Virtual Hosts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-advanced-wireless">34.4. Wireless Advanced Authentication</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#wireless-ad-hoc-mode">34.5. Wireless Ad-hoc Mode</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-usb-tethering">34.6. USB Tethering</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-bluetooth">34.7. Bluetooth</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-bridging">34.8. Bridging</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-aggregation">34.9. Link Aggregation and Failover</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-diskless">34.10. Diskless Operation with PXE</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#carp">34.11. Common Address Redundancy Protocol (CARP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-vlan">34.12. VLANs</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partv/">
              第五部分. 附录
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/">
              Appendix A. Obtaining FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#mirrors">A.1. Mirrors</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#git">A.2. Using Git</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#svn">A.3. Using Subversion</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#mirrors-cdrom">A.4. CD and DVD Sets</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/">
              Appendix B. Bibliography
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-freebsd">B.1. FreeBSD Bibliography</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-security">B.2. Security Reference</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-history">B.3. UNIX® History</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-journals">B.4. Periodicals, Journals, and Magazines</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/">
              Appendix C. Resources on the Internet
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-www">C.1. Websites</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-mail">C.2. Mailing Lists</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-news">C.3. Usenet Newsgroups</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/pgpkeys/">
              Appendix D. OpenPGP Keys
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/pgpkeys/#pgpkeys-officers">D.1. Officers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-2a8deedf14429128049622ec007c9d3f" class="toggle"  />
          <label  for="chapter-2a8deedf14429128049622ec007c9d3f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/glossary/">
              FreeBSD Glossary
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-110dbb242491bf200e51e76db171f670" class="toggle"  />
          <label  for="chapter-110dbb242491bf200e51e76db171f670"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/colophon/">
              后记
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-caffbcba74982e4b26b9263ac0232bc3" class="toggle"  />
          <label  for="chapter-caffbcba74982e4b26b9263ac0232bc3"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/">
              
            </a>
            
            
          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">Chapter 24. Virtualization</h1>
    
    
      <div class="admonitionblock note">
        <p>
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          如果发现翻译错误，请直接 <a href="https://github.com/fierceX/freebsd-doc-cn/pulls" target="_blank">发起PR修改</a>。
        </p>
      </div>
    
    
    
    <div class="toc-mobile">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#virtualization-synopsis">24.1. Synopsis</a></li>
    <li><a href="#virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®</a></li>
    <li><a href="#virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®</a></li>
    <li><a href="#virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™</a></li>
    <li><a href="#virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™</a></li>
    <li><a href="#virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve</a></li>
    <li><a href="#virtualization-host-xen">24.7. FreeBSD as a Xen™-Host</a></li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="virtualization-synopsis">24.1. Synopsis<a class="anchor" href="#virtualization-synopsis"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtualization software allows multiple operating systems to run simultaneously on the same computer. Such software systems for PCs often involve a host operating system which runs the virtualization software and supports any number of guest operating systems.</p>
</div>
<div class="paragraph">
<p>After reading this chapter, you will know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The difference between a host operating system and a guest operating system.</p>
</li>
<li>
<p>How to install FreeBSD on the following virtualization platforms:</p>
<div class="ulist">
<ul>
<li>
<p>Parallels Desktop(Apple® macOS®)</p>
</li>
<li>
<p>VMware Fusion(Apple® macOS®)</p>
</li>
<li>
<p>VirtualBox™(Microsoft® Windows®, Intel®-based Apple® macOS®, Linux)</p>
</li>
<li>
<p>bhyve(FreeBSD)</p>
</li>
</ul>
</div>
</li>
<li>
<p>How to tune a FreeBSD system for best performance under virtualization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before reading this chapter, you should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Understand the <a href="../basics/#basics">basics of UNIX® and FreeBSD</a>.</p>
</li>
<li>
<p>Know how to <a href="../bsdinstall/#bsdinstall">install FreeBSD</a>.</p>
</li>
<li>
<p>Know how to <a href="../advanced-networking/#advanced-networking">set up a network connection</a>.</p>
</li>
<li>
<p>Know how to <a href="../ports/#ports">install additional third-party software</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®<a class="anchor" href="#virtualization-guest-parallelsdesktop"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Parallels Desktop for Mac® is a commercial software product available for Apple® Mac® computers running macOS® 10.14.6 or higher. FreeBSD is a fully supported guest operating system. Once Parallels has been installed on macOS®, the user must configure a virtual machine and then install the desired guest operating system.</p>
</div>
<div class="sect2">
<h3 id="virtualization-guest-parallelsdesktop-install">24.2.1. Installing FreeBSD on Parallels Desktop on Mac®<a class="anchor" href="#virtualization-guest-parallelsdesktop-install"></a></h3>
<div class="paragraph">
<p>The first step in installing FreeBSD on Parallels is to create a new virtual machine for installing FreeBSD.</p>
</div>
<div class="paragraph">
<p>Choose <b class="menuref">Install Windows or another OS from a DVD or image file</b> and proceed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd1.png" alt="Parallels setup wizard showing Install Windows or another OS from a DVD or image file chosen"/>
</div>
</div>
<div class="paragraph">
<p>Select the FreeBSD image file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd2.png" alt="Parallels setup wizard showing FreeBSD image file selected"/>
</div>
</div>
<div class="paragraph">
<p>Choose <b class="menuref">Other as operating system</b>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Choosing FreeBSD will cause boot error on startup.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd3.png" alt="Parallels setup wizard showing Other selected as operating system"/>
</div>
</div>
<div class="paragraph">
<p>Name the virtual machine and check <b class="menuref">Customize settings before installation</b></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd4.png" alt="Parallels setup wizard showing the checkbox checked for customizing settings before installation"/>
</div>
</div>
<div class="paragraph">
<p>When the configuration window pops up, go to <b class="menuref">Hardware</b> tab, choose <b class="menuref">Boot order</b>, and click <b class="menuref">Advanced</b>. Then, choose <strong>EFI 64-bit</strong> as <b class="menuref">BIOS</b>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd5.png" alt="Parallels setup wizard showing EFI 64-bit chosen as BIOS"/>
</div>
</div>
<div class="paragraph">
<p>Click <b class="menuref">OK</b>, close the configuration window, and click <b class="menuref">Continue</b>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd6.png" alt="Parallels setup wizard showing the summary of the new virtual machine"/>
</div>
</div>
<div class="paragraph">
<p>The virtual machine will automatically boot. Install FreeBSD following the general steps.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/parallels-freebsd7.png" alt="FreeBSD booted on Parallels"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-guest-parallels-configure">24.2.2. Configuring FreeBSD on Parallels<a class="anchor" href="#virtualization-guest-parallels-configure"></a></h3>
<div class="paragraph">
<p>After FreeBSD has been successfully installed on macOS® X with Parallels, there are a number of configuration steps that can be taken to optimize the system for virtualized operation.</p>
</div>
<div class="olist arabic procedure">
<ol class="arabic">
<li>
<p>Set Boot Loader Variables</p>
<div class="paragraph">
<p>The most important step is to reduce the <code>kern.hz</code> tunable to reduce the CPU utilization of FreeBSD under the Parallels environment. This is accomplished by adding the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>kern.hz=100</pre>
</div>
</div>
<div class="paragraph">
<p>Without this setting, an idle FreeBSD Parallels guest will use roughly 15% of the CPU of a single processor iMac®. After this change the usage will be closer to 5%.</p>
</div>
</li>
<li>
<p>Create a New Kernel Configuration File</p>
<div class="paragraph">
<p>All of the SCSI, FireWire, and USB device drivers can be removed from a custom kernel configuration file. Parallels provides a virtual network adapter used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;format=html">ed(4)</a> driver, so all network devices except for <a href="https://man.freebsd.org/cgi/man.cgi?query=ed&amp;sektion=4&amp;format=html">ed(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=miibus&amp;sektion=4&amp;format=html">miibus(4)</a> can be removed from the kernel.</p>
</div>
</li>
<li>
<p>Configure Networking</p>
<div class="paragraph">
<p>The most basic networking setup uses DHCP to connect the virtual machine to the same local area network as the host Mac®. This can be accomplished by adding <code>ifconfig_ed0=&#34;DHCP&#34;</code> to <span class="filename">/etc/rc.conf</span>. More advanced networking setups are described in <a href="../advanced-networking/#advanced-networking">Advanced Networking</a>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®<a class="anchor" href="#virtualization-guest-vmware"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>VMware Fusion for Mac® is a commercial software product available for Apple® Mac® computers running macOS® 12 or higher. FreeBSD is a fully supported guest operating system. Once VMware Fusion has been installed on macOS®, the user can configure a virtual machine and then install the desired guest operating system.</p>
</div>
<div class="sect2">
<h3 id="virtualization-guest-vmware-install">24.3.1. Installing FreeBSD on VMware Fusion<a class="anchor" href="#virtualization-guest-vmware-install"></a></h3>
<div class="paragraph">
<p>The first step is to start VMware Fusion which will load the Virtual Machine Library. Click <span class="guimenuitem">+→New</span> to create the virtual machine:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd01.png" alt="vmware freebsd01"/>
</div>
</div>
<div class="paragraph">
<p>This will load the New Virtual Machine Assistant. Choose <span class="guimenuitem">Create a custom virtual machine</span> and click <span class="guimenuitem">Continue</span> to proceed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd02.png" alt="vmware freebsd02"/>
</div>
</div>
<div class="paragraph">
<p>Select <span class="guimenuitem">Other</span> as the <span class="guimenuitem">Operating System</span> and either <span class="guimenuitem">FreeBSD X</span> or <span class="guimenuitem">FreeBSD X 64-bit</span>, as the <b class="menuref">Version</b> when prompted:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd03.png" alt="vmware freebsd03"/>
</div>
</div>
<div class="paragraph">
<p>Choose the firmware(UEFI is recommended):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd04.png" alt="vmware freebsd04"/>
</div>
</div>
<div class="paragraph">
<p>Choose <span class="guimenuitem">Create a new virtual disk</span> and click <span class="guimenuitem">Continue</span>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd05.png" alt="vmware freebsd05"/>
</div>
</div>
<div class="paragraph">
<p>Check the configuration and click <span class="guimenuitem">Finish</span>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd06.png" alt="vmware freebsd06"/>
</div>
</div>
<div class="paragraph">
<p>Choose the name of the virtual machine and the directory where it should be saved:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd07.png" alt="vmware freebsd07"/>
</div>
</div>
<div class="paragraph">
<p>Press command+E to open virtual machine settings and click <span class="guimenuitem">CD/DVD</span>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd08.png" alt="vmware freebsd08"/>
</div>
</div>
<div class="paragraph">
<p>Choose FreeBSD ISO image or from a CD/DVD:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd09.png" alt="vmware freebsd09"/>
</div>
</div>
<div class="paragraph">
<p>Start the virtual machine:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd10.png" alt="vmware freebsd10"/>
</div>
</div>
<div class="paragraph">
<p>Install FreeBSD as usual:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd11.png" alt="vmware freebsd11"/>
</div>
</div>
<div class="paragraph">
<p>Once the install is complete, the settings of the virtual machine can be modified, such as memory usage and the number of CPUs the virtual machine will have access to:</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The System Hardware settings of the virtual machine cannot be modified while the virtual machine is running.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd12.png" alt="vmware freebsd12"/>
</div>
</div>
<div class="paragraph">
<p>The status of the CD-ROM device. Normally the CD/DVD/ISO is disconnected from the virtual machine when it is no longer needed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd09.png" alt="vmware freebsd09"/>
</div>
</div>
<div class="paragraph">
<p>The last thing to change is how the virtual machine will connect to the network. To allow connections to the virtual machine from other machines besides the host, choose <span class="guimenuitem">Connect directly to the physical network (Bridged)</span>. Otherwise, <span class="guimenuitem">Share the host’s internet connection (NAT)</span> is preferred so that the virtual machine can have access to the Internet, but the network cannot access the virtual machine.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../../images/books/handbook/virtualization/vmware-freebsd13.png" alt="vmware freebsd13"/>
</div>
</div>
<div class="paragraph">
<p>After modifying the settings, boot the newly installed FreeBSD virtual machine.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-guest-vmware-configure">24.3.2. Configuring FreeBSD on VMware Fusion<a class="anchor" href="#virtualization-guest-vmware-configure"></a></h3>
<div class="paragraph">
<p>After FreeBSD has been successfully installed on macOS® X with VMware Fusion, there are a number of configuration steps that can be taken to optimize the system for virtualized operation.</p>
</div>
<div class="olist arabic procedure">
<ol class="arabic">
<li>
<p>Set Boot Loader Variables</p>
<div class="paragraph">
<p>The most important step is to reduce the <code>kern.hz</code> tunable to reduce the CPU utilization of FreeBSD under the VMware Fusion environment. This is accomplished by adding the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>kern.hz=100</pre>
</div>
</div>
<div class="paragraph">
<p>Without this setting, an idle FreeBSD VMware Fusion guest will use roughly 15% of the CPU of a single processor iMac®. After this change, the usage will be closer to 5%.</p>
</div>
</li>
<li>
<p>Create a New Kernel Configuration File</p>
<div class="paragraph">
<p>All of the FireWire, and USB device drivers can be removed from a custom kernel configuration file. VMware Fusion provides a virtual network adapter used by the <a href="https://man.freebsd.org/cgi/man.cgi?query=em&amp;sektion=4&amp;format=html">em(4)</a> driver, so all network devices except for <a href="https://man.freebsd.org/cgi/man.cgi?query=em&amp;sektion=4&amp;format=html">em(4)</a> can be removed from the kernel.</p>
</div>
</li>
<li>
<p>Configure Networking</p>
<div class="paragraph">
<p>The most basic networking setup uses DHCP to connect the virtual machine to the same local area network as the host Mac®. This can be accomplished by adding <code>ifconfig_em0=&#34;DHCP&#34;</code> to <span class="filename">/etc/rc.conf</span>. More advanced networking setups are described in <a href="../advanced-networking/#advanced-networking">Advanced Networking</a>.</p>
</div>
</li>
<li>
<p>Install drivers and open-vm-tools</p>
<div class="paragraph">
<p>To run FreeBSD smoothly on VMWare, drivers should be installed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg install xf86-video-vmware xf86-input-vmmouse open-vm-tools</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™<a class="anchor" href="#virtualization-guest-virtualbox"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD works well as a guest in VirtualBox™. The virtualization software is available for most common operating systems, including FreeBSD itself.</p>
</div>
<div class="paragraph">
<p>The VirtualBox™ guest additions provide support for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clipboard sharing.</p>
</li>
<li>
<p>Mouse pointer integration.</p>
</li>
<li>
<p>Host time synchronization.</p>
</li>
<li>
<p>Window scaling.</p>
</li>
<li>
<p>Seamless mode.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These commands are run in the FreeBSD guest.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>First, install the <a class="package" href="https://cgit.freebsd.org/ports/tree/emulators/virtualbox-ose-additions/">emulators/virtualbox-ose-additions</a> package or port in the FreeBSD guest. This will install the port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/ports/emulators/virtualbox-ose-additions &amp;&amp; make install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add these lines to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vboxguest_enable=&#34;YES&#34;
vboxservice_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpd&amp;sektion=8&amp;format=html">ntpd(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=ntpdate&amp;sektion=8&amp;format=html">ntpdate(8)</a> is used, disable host time synchronization:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vboxservice_flags=&#34;--disable-timesync&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Xorg will automatically recognize the <code>vboxvideo</code> driver. It can also be manually entered in <span class="filename">/etc/X11/xorg.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Section &#34;Device&#34;
	Identifier &#34;Card0&#34;
	Driver &#34;vboxvideo&#34;
	VendorName &#34;InnoTek Systemberatung GmbH&#34;
	BoardName &#34;VirtualBox Graphics Adapter&#34;
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>To use the <code>vboxmouse</code> driver, adjust the mouse section in <span class="filename">/etc/X11/xorg.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Section &#34;InputDevice&#34;
	Identifier &#34;Mouse0&#34;
	Driver &#34;vboxmouse&#34;
EndSection</pre>
</div>
</div>
<div class="paragraph">
<p>Shared folders for file transfers between host and VM are accessible by mounting them using <code>mount_vboxvfs</code>. A shared folder can be created on the host using the VirtualBox GUI or via <code>vboxmanage</code>. For example, to create a shared folder called <em>myshare</em> under <span class="filename">/mnt/bsdboxshare</span> for the VM named <em>BSDBox</em>, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># vboxmanage sharedfolder add &#39;BSDBox&#39; --name myshare --hostpath /mnt/bsdboxshare</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the shared folder name must not contain spaces. Mount the shared folder from within the guest system like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount_vboxvfs -w myshare /mnt</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™<a class="anchor" href="#virtualization-host-virtualbox"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>VirtualBox™ is an actively developed, complete virtualization package, that is available for most operating systems including Windows®, macOS®, Linux® and FreeBSD. It is equally capable of running Windows® or UNIX®-like guests. It is released as open source software, but with closed-source components available in a separate extension pack. These components include support for USB 2.0 devices. More information may be found on the <a href="http://www.virtualbox.org/wiki/Downloads">Downloads page of the VirtualBox™ wiki</a>. Currently, these extensions are not available for FreeBSD.</p>
</div>
<div class="sect2">
<h3 id="virtualization-virtualbox-install">24.5.1. Installing VirtualBox™<a class="anchor" href="#virtualization-virtualbox-install"></a></h3>
<div class="paragraph">
<p>VirtualBox™ is available as a FreeBSD package or port in <a class="package" href="https://cgit.freebsd.org/ports/tree/emulators/virtualbox-ose/">emulators/virtualbox-ose</a>. The port can be installed using these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/ports/emulators/virtualbox-ose</span>
<span class="c"># make install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One useful option in the port’s configuration menu is the <code>GuestAdditions</code> suite of programs. These provide a number of useful features in guest operating systems, like mouse pointer integration (allowing the mouse to be shared between host and guest without the need to press a special keyboard shortcut to switch) and faster video rendering, especially in Windows® guests. The guest additions are available in the <b class="menuref">Devices</b> menu, after the installation of the guest is finished.</p>
</div>
<div class="paragraph">
<p>A few configuration changes are needed before VirtualBox™ is started for the first time. The port installs a kernel module in <span class="filename">/boot/modules</span> which must be loaded into the running kernel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload vboxdrv</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To ensure the module is always loaded after a reboot, add this line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vboxdrv_load=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>To use the kernel modules that allow bridged or host-only networking, add this line to <span class="filename">/etc/rc.conf</span> and reboot the computer:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vboxnet_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>vboxusers</code> group is created during installation of VirtualBox™. All users that need access to VirtualBox™ will have to be added as members of this group. <code>pw</code> can be used to add new members:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw groupmod vboxusers -m yourusername</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default permissions for <span class="filename">/dev/vboxnetctl</span> are restrictive and need to be changed for bridged networking:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chown root:vboxusers /dev/vboxnetctl</span>
<span class="c"># chmod 0660 /dev/vboxnetctl</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this permissions change permanent, add these lines to <span class="filename">/etc/devfs.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>own     vboxnetctl root:vboxusers
perm    vboxnetctl 0660</pre>
</div>
</div>
<div class="paragraph">
<p>To launch VirtualBox™, type from an Xorg session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>VirtualBox</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on configuring and using VirtualBox™, refer to the <a href="http://www.virtualbox.org">official website</a>. For FreeBSD-specific information and troubleshooting instructions, refer to the <a href="http://wiki.FreeBSD.org/VirtualBox">relevant page in the FreeBSD wiki</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-virtualbox-usb-support">24.5.2. VirtualBox™ USB Support<a class="anchor" href="#virtualization-virtualbox-usb-support"></a></h3>
<div class="paragraph">
<p>VirtualBox™ can be configured to pass USB devices through to the guest operating system. The host controller of the OSE version is limited to emulating USB 1.1 devices until the extension pack supporting USB 2.0 and 3.0 devices becomes available on FreeBSD.</p>
</div>
<div class="paragraph">
<p>For VirtualBox™ to be aware of USB devices attached to the machine, the user needs to be a member of the <code>operator</code> group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw groupmod operator -m yourusername</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, add the following to <span class="filename">/etc/devfs.rules</span>, or create this file if it does not exist yet:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[system=10]
add path &#39;usb/*&#39; mode 0660 group operator</pre>
</div>
</div>
<div class="paragraph">
<p>To load these new rules, add the following to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>devfs_system_ruleset=&#34;system&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Then, restart devfs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service devfs restart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the login session and VirtualBox™ for these changes to take effect, and create USB filters as necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-virtualbox-host-dvd-cd-access">24.5.3. VirtualBox™ Host DVD/CD Access<a class="anchor" href="#virtualization-virtualbox-host-dvd-cd-access"></a></h3>
<div class="paragraph">
<p>Access to the host DVD/CD drives from guests is achieved through the sharing of the physical drives. Within VirtualBox™, this is set up from the Storage window in the Settings of the virtual machine. If needed, create an empty IDECD/DVD device first. Then choose the Host Drive from the popup menu for the virtual CD/DVD drive selection. A checkbox labeled <code>Passthrough</code> will appear. This allows the virtual machine to use the hardware directly. For example, audio CDs or the burner will only function if this option is selected.</p>
</div>
<div class="paragraph">
<p>In order for users to be able to use VirtualBox™DVD/CD functions, they need access to <span class="filename">/dev/xpt0</span>, <span class="filename">/dev/cdN</span>, and <span class="filename">/dev/passN</span>. This is usually achieved by making the user a member of <code>operator</code>. Permissions to these devices have to be corrected by adding these lines to <span class="filename">/etc/devfs.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>perm cd* 0660
perm xpt0 0660
perm pass* 0660</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service devfs restart</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve<a class="anchor" href="#virtualization-host-bhyve"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The bhyve BSD-licensed hypervisor became part of the base system with FreeBSD 10.0-RELEASE. This hypervisor supports a number of guests, including FreeBSD, OpenBSD, and many Linux® distributions. By default, bhyve provides access to serial console and does not emulate a graphical console. Virtualization offload features of newer CPUs are used to avoid the legacy methods of translating instructions and manually managing memory mappings.</p>
</div>
<div class="paragraph">
<p>The bhyve design requires a processor that supports Intel® Extended Page Tables (EPT) or AMD® Rapid Virtualization Indexing (RVI) or Nested Page Tables (NPT). Hosting Linux® guests or FreeBSD guests with more than one vCPU requires VMX unrestricted mode support (UG). Most newer processors, specifically the Intel® Core™ i3/i5/i7 and Intel® Xeon™ E3/E5/E7, support these features. UG support was introduced with Intel’s Westmere micro-architecture. For a complete list of Intel® processors that support EPT, refer to <a href="https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True" class="bare">https://ark.intel.com/content/www/us/en/ark/search/featurefilter.html?productType=873&amp;0_ExtendedPageTables=True</a>. RVI is found on the third generation and later of the AMD Opteron™ (Barcelona) processors. The easiest way to tell if a processor supports bhyve is to run <code>dmesg</code> or look in <span class="filename">/var/run/dmesg.boot</span> for the <code>POPCNT</code> processor feature flag on the <code>Features2</code> line for AMD® processors or <code>EPT</code> and <code>UG</code> on the <code>VT-x</code> line for Intel® processors.</p>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-prep">24.6.1. Preparing the Host<a class="anchor" href="#virtualization-bhyve-prep"></a></h3>
<div class="paragraph">
<p>The first step to creating a virtual machine in bhyve is configuring the host system. First, load the bhyve kernel module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload vmm</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create a <span class="filename">tap</span> interface for the network device in the virtual machine to attach to. In order for the network device to participate in the network, also create a bridge interface containing the <span class="filename">tap</span> interface and the physical interface as members. In this example, the physical interface is <em>igb0</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ifconfig tap0 create</span>
<span class="c"># sysctl net.link.tap.up_on_open=1</span>
net.link.tap.up_on_open: 0 -&gt; 1
<span class="c"># ifconfig bridge0 create</span>
<span class="c"># ifconfig bridge0 addm igb0 addm tap0</span>
<span class="c"># ifconfig bridge0 up</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-freebsd">24.6.2. Creating a FreeBSD Guest<a class="anchor" href="#virtualization-bhyve-freebsd"></a></h3>
<div class="paragraph">
<p>Create a file to use as the virtual disk for the guest machine. Specify the size and name of the virtual disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># truncate -s 16G guest.img</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Download an installation image of FreeBSD to install:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># fetch https://download.freebsd.org/releases/ISO-IMAGES/13.1/FreeBSD-13.1-RELEASE-amd64-bootonly.iso</span>
FreeBSD-13.1-RELEASE-amd64-bootonly.iso                366 MB   16 MBps    22s</code></pre>
</div>
</div>
<div class="paragraph">
<p>FreeBSD comes with an example script for running a virtual machine in bhyve. The script will start the virtual machine and run it in a loop, so it will automatically restart if it crashes. The script takes a number of options to control the configuration of the machine: <code>-c</code> controls the number of virtual CPUs, <code>-m</code> limits the amount of memory available to the guest, <code>-t</code> defines which <span class="filename">tap</span> device to use, <code>-d</code> indicates which disk image to use, <code>-i</code> tells bhyve to boot from the CD image instead of the disk, and <code>-I</code> defines which CD image to use. The last parameter is the name of the virtual machine, used to track the running machines. This example starts the virtual machine in installation mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sh /usr/share/examples/bhyve/vmrun.sh -c 1 -m 1024M -t tap0 -d guest.img -i -I FreeBSD-13.1-RELEASE-amd64-bootonly.iso guestname</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The virtual machine will boot and start the installer. After installing a system in the virtual machine, when the system asks about dropping in to a shell at the end of the installation, choose <b class="button">Yes</b>.</p>
</div>
<div class="paragraph">
<p>Reboot the virtual machine. While rebooting the virtual machine causes bhyve to exit, the <span class="filename">vmrun.sh</span> script runs <code>bhyve</code> in a loop and will automatically restart it. When this happens, choose the reboot option from the boot loader menu in order to escape the loop. Now the guest can be started from the virtual disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sh /usr/share/examples/bhyve/vmrun.sh -c 4 -m 1024M -t tap0 -d guest.img guestname</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-linux">24.6.3. Creating a Linux® Guest<a class="anchor" href="#virtualization-bhyve-linux"></a></h3>
<div class="paragraph">
<p>In order to boot operating systems other than FreeBSD, the <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/">sysutils/grub2-bhyve</a> port must be first installed.</p>
</div>
<div class="paragraph">
<p>Next, create a file to use as the virtual disk for the guest machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># truncate -s 16G linux.img</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Starting a virtual machine with bhyve is a two step process. First a kernel must be loaded, then the guest can be started. The Linux® kernel is loaded with <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/">sysutils/grub2-bhyve</a>. Create a <span class="filename">device.map</span> that grub will use to map the virtual devices to the files on the host system:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>(hd0) ./linux.img
(cd0) ./somelinux.iso</pre>
</div>
</div>
<div class="paragraph">
<p>Use <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/grub2-bhyve/">sysutils/grub2-bhyve</a> to load the Linux® kernel from the ISO image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># grub-bhyve -m device.map -r cd0 -M 1024M linuxguest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will start grub. If the installation CD contains a <span class="filename">grub.cfg</span>, a menu will be displayed. If not, the <code>vmlinuz</code> and <code>initrd</code> files must be located and loaded manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">grub&gt; </span>ls
<span class="o">(</span>hd0<span class="o">)</span> <span class="o">(</span>cd0<span class="o">)</span> <span class="o">(</span>cd0,msdos1<span class="o">)</span> <span class="o">(</span>host<span class="o">)</span>
<span class="gp">grub&gt; </span>ls <span class="o">(</span>cd0<span class="o">)</span>/isolinux
boot.cat boot.msg grub.conf initrd.img isolinux.bin isolinux.cfg memtest
splash.jpg TRANS.TBL vesamenu.c32 vmlinuz
<span class="gp">grub&gt; </span>linux <span class="o">(</span>cd0<span class="o">)</span>/isolinux/vmlinuz
<span class="gp">grub&gt; </span>initrd <span class="o">(</span>cd0<span class="o">)</span>/isolinux/initrd.img
<span class="gp">grub&gt; </span>boot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that the Linux® kernel is loaded, the guest can be started:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s 3:0,virtio-blk,./linux.img \</span>
    -s 4:0,ahci-cd,./somelinux.iso -l com1,stdio -c 4 -m 1024M linuxguest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The system will boot and start the installer. After installing a system in the virtual machine, reboot the virtual machine. This will cause bhyve to exit. The instance of the virtual machine needs to be destroyed before it can be started again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyvectl --destroy --vm=linuxguest</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the guest can be started directly from the virtual disk. Load the kernel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># grub-bhyve -m device.map -r hd0,msdos1 -M 1024M linuxguest</span>
<span class="gp">grub&gt; </span>ls
<span class="o">(</span>hd0<span class="o">)</span> <span class="o">(</span>hd0,msdos2<span class="o">)</span> <span class="o">(</span>hd0,msdos1<span class="o">)</span> <span class="o">(</span>cd0<span class="o">)</span> <span class="o">(</span>cd0,msdos1<span class="o">)</span> <span class="o">(</span>host<span class="o">)</span>
<span class="o">(</span>lvm/VolGroup-lv_swap<span class="o">)</span> <span class="o">(</span>lvm/VolGroup-lv_root<span class="o">)</span>
<span class="gp">grub&gt; </span>ls <span class="o">(</span>hd0,msdos1<span class="o">)</span>/
lost+found/ grub/ efi/ System.map-2.6.32-431.el6.x86_64 config-2.6.32-431.el6.x
86_64 symvers-2.6.32-431.el6.x86_64.gz vmlinuz-2.6.32-431.el6.x86_64
initramfs-2.6.32-431.el6.x86_64.img
<span class="gp">grub&gt; </span>linux <span class="o">(</span>hd0,msdos1<span class="o">)</span>/vmlinuz-2.6.32-431.el6.x86_64 <span class="nv">root</span><span class="o">=</span>/dev/mapper/VolGroup-lv_root
<span class="gp">grub&gt; </span>initrd <span class="o">(</span>hd0,msdos1<span class="o">)</span>/initramfs-2.6.32-431.el6.x86_64.img
<span class="gp">grub&gt; </span>boot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Boot the virtual machine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 \</span>
    -s 3:0,virtio-blk,./linux.img -l com1,stdio -c 4 -m 1024M linuxguest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Linux® will now boot in the virtual machine and eventually present you with the login prompt. Login and use the virtual machine. When you are finished, reboot the virtual machine to exit bhyve. Destroy the virtual machine instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyvectl --destroy --vm=linuxguest</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-uefi">24.6.4. Booting bhyve Virtual Machines with UEFI Firmware<a class="anchor" href="#virtualization-bhyve-uefi"></a></h3>
<div class="paragraph">
<p>In addition to bhyveload and grub-bhyve, the bhyve hypervisor can also boot virtual machines using the UEFI userspace firmware. This option may support guest operating systems that are not supported by the other loaders.</p>
</div>
<div class="paragraph">
<p>In order to make use of the UEFI support in bhyve, first obtain the UEFI firmware images. This can be done by installing <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/bhyve-firmware/">sysutils/bhyve-firmware</a> port or package.</p>
</div>
<div class="paragraph">
<p>With the firmware in place, add the flags <code>-l bootrom,<em>/path/to/firmware</em></code> to your bhyve command line. The actual bhyve command may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \</span>
-s 2:0,virtio-net,tap1 -s 3:0,virtio-blk,./disk.img <span class="se">\</span>
-s 4:0,ahci-cd,./install.iso -c 4 -m 1024M <span class="se">\</span>
-l bootrom,/usr/local/share/uefi-firmware/BHYVE_UEFI.fd <span class="se">\</span>
guest</code></pre>
</div>
</div>
<div class="paragraph">
<p><a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/bhyve-firmware/">sysutils/bhyve-firmware</a> also contains a CSM-enabled firmware, to boot guests with no UEFI support in legacy BIOS mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -AHP -s 0:0,hostbridge -s 1:0,lpc \</span>
-s 2:0,virtio-net,tap1 -s 3:0,virtio-blk,./disk.img <span class="se">\</span>
-s 4:0,ahci-cd,./install.iso -c 4 -m 1024M <span class="se">\</span>
-l bootrom,/usr/local/share/uefi-firmware/BHYVE_UEFI_CSM.fd <span class="se">\</span>
guest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-framebuffer">24.6.5. Graphical UEFI Framebuffer for bhyve Guests<a class="anchor" href="#virtualization-bhyve-framebuffer"></a></h3>
<div class="paragraph">
<p>The UEFI firmware support is particularly useful with predominantly graphical guest operating systems such as Microsoft Windows®.</p>
</div>
<div class="paragraph">
<p>Support for the UEFI-GOP framebuffer may also be enabled with the <code>-s 29,fbuf,tcp=<em>0.0.0.0:5900</em></code> flags. The framebuffer resolution may be configured with <code>w=<em>800</em></code> and <code>h=<em>600</em></code>, and bhyve can be instructed to wait for a VNC connection before booting the guest by adding <code>wait</code>. The framebuffer may be accessed from the host or over the network via the VNC protocol. Additionally, <code>-s 30,xhci,tablet</code> can be added to achieve precise mouse cursor synchronization with the host.</p>
</div>
<div class="paragraph">
<p>The resulting bhyve command would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -AHP -s 0:0,hostbridge -s 31:0,lpc \</span>
-s 2:0,virtio-net,tap1 -s 3:0,virtio-blk,./disk.img <span class="se">\</span>
-s 4:0,ahci-cd,./install.iso -c 4 -m 1024M <span class="se">\</span>
-s 29,fbuf,tcp<span class="o">=</span>0.0.0.0:5900,w<span class="o">=</span>800,h<span class="o">=</span>600,wait <span class="se">\</span>
-s 30,xhci,tablet <span class="se">\</span>
-l bootrom,/usr/local/share/uefi-firmware/BHYVE_UEFI.fd <span class="se">\</span>
guest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note, in BIOS emulation mode, the framebuffer will cease receiving updates once control is passed from firmware to guest operating system.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-zfs">24.6.6. Using ZFS with bhyve Guests<a class="anchor" href="#virtualization-bhyve-zfs"></a></h3>
<div class="paragraph">
<p>If ZFS is available on the host machine, using ZFS volumes instead of disk image files can provide significant performance benefits for the guest VMs. A ZFS volume can be created by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># zfs create -V16G -o volmode=dev zroot/linuxdisk0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When starting the VM, specify the ZFS volume as the disk drive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s3:0,virtio-blk,/dev/zvol/zroot/linuxdisk0 \</span>
    -l com1,stdio -c 4 -m 1024M linuxguest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-nmdm">24.6.7. Virtual Machine Consoles<a class="anchor" href="#virtualization-bhyve-nmdm"></a></h3>
<div class="paragraph">
<p>It is advantageous to wrap the bhyve console in a session management tool such as <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/tmux/">sysutils/tmux</a> or <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/screen/">sysutils/screen</a> in order to detach and reattach to the console. It is also possible to have the console of bhyve be a null modem device that can be accessed with <code>cu</code>. To do this, load the <span class="filename">nmdm</span> kernel module and replace <code>-l com1,stdio</code> with <code>-l com1,/dev/nmdm0A</code>. The <span class="filename">/dev/nmdm</span> devices are created automatically as needed, where each is a pair, corresponding to the two ends of the null modem cable (<span class="filename">/dev/nmdm0A</span> and <span class="filename">/dev/nmdm0B</span>). See <a href="https://man.freebsd.org/cgi/man.cgi?query=nmdm&amp;sektion=4&amp;format=html">nmdm(4)</a> for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload nmdm</span>
<span class="c"># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap0 -s 3:0,virtio-blk,./linux.img \</span>
    -l com1,/dev/nmdm0A -c 4 -m 1024M linuxguest
<span class="c"># cu -l /dev/nmdm0B</span>
Connected

Ubuntu 13.10 handbook ttyS0

handbook login:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-managing">24.6.8. Managing Virtual Machines<a class="anchor" href="#virtualization-bhyve-managing"></a></h3>
<div class="paragraph">
<p>A device node is created in <span class="filename">/dev/vmm</span> for each virtual machine. This allows the administrator to easily see a list of the running virtual machines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ls -al /dev/vmm</span>
total 1
dr-xr-xr-x   2 root  wheel    512 Mar 17 12:19 ./
dr-xr-xr-x  14 root  wheel    512 Mar 17 06:38 ../
crw-------   1 root  wheel  0x1a2 Mar 17 12:20 guestname
crw-------   1 root  wheel  0x19f Mar 17 12:19 linuxguest
crw-------   1 root  wheel  0x1a1 Mar 17 12:19 otherguest</code></pre>
</div>
</div>
<div class="paragraph">
<p>A specified virtual machine can be destroyed using <code>bhyvectl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># bhyvectl --destroy --vm=guestname</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-bhyve-onboot">24.6.9. Persistent Configuration<a class="anchor" href="#virtualization-bhyve-onboot"></a></h3>
<div class="paragraph">
<p>In order to configure the system to start bhyve guests at boot time, the following configurations must be made in the specified files:</p>
</div>
<div class="olist arabic procedure">
<ol class="arabic">
<li>
<p><span class="filename">/etc/sysctl.conf</span></p>
<div class="literalblock programlisting">
<div class="content">
<pre>net.link.tap.up_on_open=1</pre>
</div>
</div>
</li>
<li>
<p><span class="filename">/etc/rc.conf</span></p>
<div class="literalblock programlisting">
<div class="content">
<pre>cloned_interfaces=&#34;bridge0 tap0&#34;
ifconfig_bridge0=&#34;addm igb0 addm tap0&#34;
kld_list=&#34;nmdm vmm&#34;</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtualization-host-xen">24.7. FreeBSD as a Xen™-Host<a class="anchor" href="#virtualization-host-xen"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xen is a GPLv2-licensed <a href="https://en.wikipedia.org/wiki/Hypervisor#Classification">type 1 hypervisor</a> for Intel® and ARM® architectures. FreeBSD has included i386™ and AMD® 64-Bit <a href="https://wiki.xenproject.org/wiki/DomU">DomU</a> and <a href="https://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud">Amazon EC2</a> unprivileged domain (virtual machine) support since FreeBSD 8.0 and includes Dom0 control domain (host) support in FreeBSD 11.0. Support for para-virtualized (PV) domains has been removed from FreeBSD 11 in favor of hardware virtualized (HVM) domains, which provides better performance.</p>
</div>
<div class="paragraph">
<p>Xen™ is a bare-metal hypervisor, which means that it is the first program loaded after the BIOS. A special privileged guest called the Domain-0 (<code>Dom0</code> for short) is then started. The Dom0 uses its special privileges to directly access the underlying physical hardware, making it a high-performance solution. It is able to access the disk controllers and network adapters directly. The Xen™ management tools to manage and control the Xen™ hypervisor are also used by the Dom0 to create, list, and destroy VMs. Dom0 provides virtual disks and networking for unprivileged domains, often called <code>DomU</code>. Xen™ Dom0 can be compared to the service console of other hypervisor solutions, while the DomU is where individual guest VMs are run.</p>
</div>
<div class="paragraph">
<p>Xen™ can migrate VMs between different Xen™ servers. When the two xen hosts share the same underlying storage, the migration can be done without having to shut the VM down first. Instead, the migration is performed live while the DomU is running and there is no need to restart it or plan a downtime. This is useful in maintenance scenarios or upgrade windows to ensure that the services provided by the DomU are still provided. Many more features of Xen™ are listed on the <a href="https://wiki.xenproject.org/wiki/Category:Overview">Xen Wiki Overview page</a>. Note that not all features are supported on FreeBSD yet.</p>
</div>
<div class="sect2">
<h3 id="virtualization-host-xen-requirements">24.7.1. Hardware Requirements for Xen™ Dom0<a class="anchor" href="#virtualization-host-xen-requirements"></a></h3>
<div class="paragraph">
<p>To run the Xen™ hypervisor on a host, certain hardware functionality is required. Hardware virtualized domains require Extended Page Table (<a href="http://en.wikipedia.org/wiki/Extended_Page_Table">EPT</a>) and Input/Output Memory Management Unit (<a href="http://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware">IOMMU</a>) support in the host processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to run a FreeBSD Xen™ Dom0 the box must be booted using legacy boot (BIOS).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-host-xen-dom0-setup">24.7.2. Xen™ Dom0 Control Domain Setup<a class="anchor" href="#virtualization-host-xen-dom0-setup"></a></h3>
<div class="paragraph">
<p>Users of FreeBSD 11 should install the <a class="package" href="https://cgit.freebsd.org/ports/tree/emulators/xen-kernel47/">emulators/xen-kernel47</a> and <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/xen-tools47/">sysutils/xen-tools47</a> packages that are based on Xen version 4.7. Systems running on FreeBSD-12.0 or newer can use Xen 4.11 provided by <a class="package" href="https://cgit.freebsd.org/ports/tree/emulators/xen-kernel411/">emulators/xen-kernel411</a> and <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/xen-tools411/">sysutils/xen-tools411</a>, respectively.</p>
</div>
<div class="paragraph">
<p>Configuration files must be edited to prepare the host for the Dom0 integration after the Xen packages are installed. An entry to <span class="filename">/etc/sysctl.conf</span> disables the limit on how many pages of memory are allowed to be wired. Otherwise, DomU VMs with higher memory requirements will not run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;vm.max_wired=-1&#39; &gt;&gt; /etc/sysctl.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another memory-related setting involves changing <span class="filename">/etc/login.conf</span>, setting the <code>memorylocked</code> option to <code>unlimited</code>. Otherwise, creating DomU domains may fail with <code>Cannot allocate memory</code> errors. After making the change to <span class="filename">/etc/login.conf</span>, run <code>cap_mkdb</code> to update the capability database. See <a href="../security/#security-resourcelimits">Resource Limits</a> for details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sed -i &#39;&#39; -e &#39;s/memorylocked=64K/memorylocked=unlimited/&#39; /etc/login.conf</span>
<span class="c"># cap_mkdb /etc/login.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add an entry for the Xen™ console to <span class="filename">/etc/ttys</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;xc0     &#34;/usr/libexec/getty Pc&#34;         xterm   onifconsole  secure&#39; &gt;&gt; /etc/ttys</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Selecting a Xen™ kernel in <span class="filename">/boot/loader.conf</span> activates the Dom0. Xen™ also requires resources like CPU and memory from the host machine for itself and other DomU domains. How much CPU and memory depends on the individual requirements and hardware capabilities. In this example, 8 GB of memory and 4 virtual CPUs are made available for the Dom0. The serial console is also activated and logging options are defined.</p>
</div>
<div class="paragraph">
<p>The following command is used for Xen 4.7 packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;hw.pci.mcfg=0&#39; &gt;&gt; /boot/loader.conf</span>
<span class="c"># echo &#39;if_tap_load=&#34;YES&#34;&#39; &gt;&gt; /boot/loader.conf</span>
<span class="c"># echo &#39;xen_kernel=&#34;/boot/xen&#34;&#39; &gt;&gt; /boot/loader.conf</span>
<span class="c"># echo &#39;xen_cmdline=&#34;dom0_mem=8192M dom0_max_vcpus=4 dom0pvh=1 console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all&#34;&#39; &gt;&gt; /boot/loader.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For Xen versions 4.11 and higher, the following command should be used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;if_tap_load=&#34;YES&#34;&#39; &gt;&gt; /boot/loader.conf</span>
<span class="c"># echo &#39;xen_kernel=&#34;/boot/xen&#34;&#39; &gt;&gt; /boot/loader.conf</span>
<span class="c"># echo &#39;xen_cmdline=&#34;dom0_mem=8192M dom0_max_vcpus=4 dom0=pvh console=com1,vga com1=115200,8n1 guest_loglvl=all loglvl=all&#34;&#39; &gt;&gt; /boot/loader.conf</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Log files that Xen™ creates for the DomU VMs are stored in <span class="filename">/var/log/xen</span>. Please be sure to check the contents of that directory if experiencing issues.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Activate the xencommons service during system startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc xencommons_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These settings are enough to start a Dom0-enabled system. However, it lacks network functionality for the DomU machines. To fix that, define a bridged interface with the main NIC of the system which the DomU VMs can use to connect to the network. Replace <em>em0</em> with the host network interface name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc cloned_interfaces=&#34;bridge0&#34;</span>
<span class="c"># sysrc ifconfig_bridge0=&#34;addm em0 SYNCDHCP&#34;</span>
<span class="c"># sysrc ifconfig_em0=&#34;up&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the host to load the Xen™ kernel and start the Dom0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># reboot</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After successfully booting the Xen™ kernel and logging into the system again, the Xen™ management tool <code>xl</code> is used to show information about the domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># xl list</span>
Name                                        ID   Mem VCPUs      State   Time<span class="o">(</span>s<span class="o">)</span>
Domain-0                                     0  8192     4     r-----     962.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output confirms that the Dom0 (called <code>Domain-0</code>) has the ID <code>0</code> and is running. It also has the memory and virtual CPUs that were defined in <span class="filename">/boot/loader.conf</span> earlier. More information can be found in the <a href="https://www.xenproject.org/help/documentation.html">Xen™ Documentation</a>. DomU guest VMs can now be created.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-host-xen-domu-setup">24.7.3. Xen™ DomU Guest VM Configuration<a class="anchor" href="#virtualization-host-xen-domu-setup"></a></h3>
<div class="paragraph">
<p>Unprivileged domains consist of a configuration file and virtual or physical hard disks. Virtual disk storage for the DomU can be files created by <a href="https://man.freebsd.org/cgi/man.cgi?query=truncate&amp;sektion=1&amp;format=html">truncate(1)</a> or ZFS volumes as described in <a href="../zfs/#zfs-zfs-volume">“Creating and Destroying Volumes”</a>. In this example, a 20 GB volume is used. A VM is created with the ZFS volume, a FreeBSD ISO image, 1 GB of RAM and two virtual CPUs. The ISO installation file is retrieved with <a href="https://man.freebsd.org/cgi/man.cgi?query=fetch&amp;sektion=1&amp;format=html">fetch(1)</a> and saved locally in a file called <span class="filename">freebsd.iso</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># fetch https://download.freebsd.org/releases/ISO-IMAGES/13.1/FreeBSD-13.1-RELEASE-amd64-bootonly.iso -o freebsd.iso</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A ZFS volume of 20 GB called <span class="filename">xendisk0</span> is created to serve as the disk space for the VM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># zfs create -V20G -o volmode=dev zroot/xendisk0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The new DomU guest VM is defined in a file. Some specific definitions like name, keymap, and VNC connection details are also defined. The following <span class="filename">freebsd.cfg</span> contains a minimum DomU configuration for this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cat freebsd.cfg</span>
builder <span class="o">=</span> <span class="s2">&#34;hvm&#34;</span> <i class="conum" data-value="1"></i><b>(1)</b>
name <span class="o">=</span> <span class="s2">&#34;freebsd&#34;</span> <i class="conum" data-value="2"></i><b>(2)</b>
memory <span class="o">=</span> 1024 <i class="conum" data-value="3"></i><b>(3)</b>
vcpus <span class="o">=</span> 2 <i class="conum" data-value="4"></i><b>(4)</b>
vif <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;mac=00:16:3E:74:34:32,bridge=bridge0&#39;</span> <span class="o">]</span> <i class="conum" data-value="5"></i><b>(5)</b>
disk <span class="o">=</span> <span class="o">[</span>
<span class="s1">&#39;/dev/zvol/tank/xendisk0,raw,hda,rw&#39;</span>, <i class="conum" data-value="6"></i><b>(6)</b>
<span class="s1">&#39;/root/freebsd.iso,raw,hdc:cdrom,r&#39;</span> <i class="conum" data-value="7"></i><b>(7)</b>
  <span class="o">]</span>
vnc <span class="o">=</span> 1 <i class="conum" data-value="8"></i><b>(8)</b>
vnclisten <span class="o">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>
serial <span class="o">=</span> <span class="s2">&#34;pty&#34;</span>
usbdevice <span class="o">=</span> <span class="s2">&#34;tablet&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These lines are explained in more detail:</p>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This defines what kind of virtualization to use. <code>hvm</code> refers to hardware-assisted virtualization or hardware virtual machine. Guest operating systems can run unmodified on CPUs with virtualization extensions, providing nearly the same performance as running on physical hardware. <code>generic</code> is the default value and creates a PV domain. &lt;.&gt; Name of this virtual machine to distinguish it from others running on the same Dom0. Required. &lt;.&gt; Quantity of RAM in megabytes to make available to the VM. This amount is subtracted from the hypervisor’s total available memory, not the memory of the Dom0. &lt;.&gt; Number of virtual CPUs available to the guest VM. For best performance, do not create guests with more virtual CPUs than the number of physical CPUs on the host. &lt;.&gt; Virtual network adapter. This is the bridge connected to the network interface of the host. The <code>mac</code> parameter is the MAC address set on the virtual network interface. This parameter is optional, if no MAC is provided Xen™ will generate a random one. &lt;.&gt; Full path to the disk, file, or ZFS volume of the disk storage for this VM. Options and multiple disk definitions are separated by commas. &lt;.&gt; Defines the Boot medium from which the initial operating system is installed. In this example, it is the ISO image downloaded earlier. Consult the Xen™ documentation for other kinds of devices and options to set. &lt;.&gt; Options controlling VNC connectivity to the serial console of the DomU. In order, these are: active VNC support, define IP address on which to listen, device node for the serial console, and the input method for precise positioning of the mouse and other input methods. <code>keymap</code> defines which keymap to use, and is <code>english</code> by default.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>After the file has been created with all the necessary options, the DomU is created by passing it to <code>xl create</code> as a parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># xl create freebsd.cfg</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Each time the Dom0 is restarted, the configuration file must be passed to <code>xl create</code> again to re-create the DomU. By default, only the Dom0 is created after a reboot, not the individual VMs. The VMs can continue where they left off as they stored the operating system on the virtual disk. The virtual machine configuration can change over time (for example, when adding more memory). The virtual machine configuration files must be properly backed up and kept available to be able to re-create the guest VM when needed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The output of <code>xl list</code> confirms that the DomU has been created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># xl list</span>
Name                                        ID   Mem VCPUs      State   Time<span class="o">(</span>s<span class="o">)</span>
Domain-0                                     0  8192     4     r-----  1653.4
freebsd                                      1  1024     1     -b----   663.9</code></pre>
</div>
</div>
<div class="paragraph">
<p>To begin the installation of the base operating system, start the VNC client, directing it to the main network address of the host or to the IP address defined on the <code>vnclisten</code> line of <span class="filename">freebsd.cfg</span>. After the operating system has been installed, shut down the DomU and disconnect the VNC viewer. Edit <span class="filename">freebsd.cfg</span>, removing the line with the <code>cdrom</code> definition or commenting it out by inserting a <code>#</code> character at the beginning of the line. To load this new configuration, it is necessary to remove the old DomU with <code>xl destroy</code>, passing either the name or the id as the parameter. Afterwards, recreate it using the modified <strong class="filename">freebsd.cfg</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># xl destroy freebsd</span>
<span class="c"># xl create freebsd.cfg</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The machine can then be accessed again using the VNC viewer. This time, it will boot from the virtual disk where the operating system has been installed and can be used as a virtual machine.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtualization-host-xen-troubleshooting">24.7.4. Troubleshooting<a class="anchor" href="#virtualization-host-xen-troubleshooting"></a></h3>
<div class="paragraph">
<p>This section contains basic information in order to help troubleshoot issues found when using FreeBSD as a Xen™ host or guest.</p>
</div>
<div class="sect3">
<h4 id="virtualization-host-xen-troubleshooting-host">24.7.4.1. Host Boot Troubleshooting<a class="anchor" href="#virtualization-host-xen-troubleshooting-host"></a></h4>
<div class="paragraph">
<p>Please note that the following troubleshooting tips are intended for Xen™ 4.11 or newer. If you are still using Xen™ 4.7 and having issues consider migrating to a newer version of Xen™.</p>
</div>
<div class="paragraph">
<p>In order to troubleshoot host boot issues you will likely need a serial cable, or a debug USB cable. Verbose Xen™ boot output can be obtained by adding options to the <code>xen_cmdline</code> option found in <span class="filename">loader.conf</span>. A couple of relevant debug options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>iommu=debug</code>: can be used to print additional diagnostic information about the iommu.</p>
</li>
<li>
<p><code>dom0=verbose</code>: can be used to print additional diagnostic information about the dom0 build process.</p>
</li>
<li>
<p><code>sync_console</code>: flag to force synchronous console output. Useful for debugging to avoid losing messages due to rate limiting. Never use this option in production environments since it can allow malicious guests to perform DoS attacks against Xen™ using the console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FreeBSD should also be booted in verbose mode in order to identify any issues. To activate verbose booting, run this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;boot_verbose=&#34;YES&#34;&#39; &gt;&gt; /boot/loader.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If none of these options help solving the problem, please send the serial boot log to <a href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a> and <a href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a> for further analysis.</p>
</div>
</div>
<div class="sect3">
<h4 id="virtualization-host-xen-troubleshooting-guest">24.7.4.2. Guest Creation Troubleshooting<a class="anchor" href="#virtualization-host-xen-troubleshooting-guest"></a></h4>
<div class="paragraph">
<p>Issues can also arise when creating guests, the following attempts to provide some help for those trying to diagnose guest creation issues.</p>
</div>
<div class="paragraph">
<p>The most common cause of guest creation failures is the <code>xl</code> command spitting some error and exiting with a return code different than 0. If the error provided is not enough to help identify the issue, more verbose output can also be obtained from <code>xl</code> by using the <code>v</code> option repeatedly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># xl -vvv create freebsd.cfg</span>
Parsing config from freebsd.cfg
libxl: debug: libxl_create.c:1693:do_domain_create: Domain 0:ao 0x800d750a0: create: <span class="nv">how</span><span class="o">=</span>0x0 <span class="nv">callback</span><span class="o">=</span>0x0 <span class="nv">poller</span><span class="o">=</span>0x800d6f0f0
libxl: debug: libxl_device.c:397:libxl__device_disk_set_backend: Disk <span class="nv">vdev</span><span class="o">=</span>xvda spec.backend<span class="o">=</span>unknown
libxl: debug: libxl_device.c:432:libxl__device_disk_set_backend: Disk <span class="nv">vdev</span><span class="o">=</span>xvda, using backend phy
libxl: debug: libxl_create.c:1018:initiate_domain_create: Domain 1:running bootloader
libxl: debug: libxl_bootloader.c:328:libxl__bootloader_run: Domain 1:not a PV/PVH domain, skipping bootloader
libxl: debug: libxl_event.c:689:libxl__ev_xswatch_deregister: watch <span class="nv">w</span><span class="o">=</span>0x800d96b98: deregister unregistered
domainbuilder: detail: xc_dom_allocate: <span class="nv">cmdline</span><span class="o">=</span><span class="s2">&#34;&#34;</span>, <span class="nv">features</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
domainbuilder: detail: xc_dom_kernel_file: <span class="nv">filename</span><span class="o">=</span><span class="s2">&#34;/usr/local/lib/xen/boot/hvmloader&#34;</span>
domainbuilder: detail: xc_dom_malloc_filemap    : 326 kB
libxl: debug: libxl_dom.c:988:libxl__load_hvm_firmware_module: Loading BIOS: /usr/local/share/seabios/bios.bin
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the verbose output does not help diagnose the issue there are also QEMU and Xen™ toolstack logs in <span class="filename">/var/log/xen</span>. Note that the name of the domain is appended to the log name, so if the domain is named <code>freebsd</code> you should find a <span class="filename">/var/log/xen/xl-freebsd.log</span> and likely a <span class="filename">/var/log/xen/qemu-dm-freebsd.log</span>. Both log files can contain useful information for debugging. If none of this helps solve the issue, please send the description of the issue you are facing and as much information as possible to <a href="mailto:freebsd-xen@FreeBSD.org">freebsd-xen@FreeBSD.org</a> and <a href="mailto:xen-devel@lists.xenproject.org">xen-devel@lists.xenproject.org</a> in order to get help.</p>
</div>
</div>
</div>
</div>
</div>

    </div>
    
    <hr />
    <div class="last-modified">
      <p><strong>Last modified on</strong>: January 4, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=f0af0e3" target="_blank">fiercex</a></p>
    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn/books/handbook/filesystems class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn/books/handbook/l10n  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#virtualization-synopsis">24.1. Synopsis</a></li>
    <li><a href="#virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®</a></li>
    <li><a href="#virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®</a></li>
    <li><a href="#virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™</a></li>
    <li><a href="#virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™</a></li>
    <li><a href="#virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve</a></li>
    <li><a href="#virtualization-host-xen">24.7. FreeBSD as a Xen™-Host</a></li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="https://free.bsd-doc.org/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="https://free.bsd-doc.org/zh-cn/languages">
                
                <img src="https://free.bsd-doc.org/images/language.png" class="language-image" alt="Choose language">
                <span>简体中文</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
