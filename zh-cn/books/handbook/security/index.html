<!DOCTYPE html>
<html class="theme-light" lang="zh-cn">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must"/>
  <meta name="keywords" content="security, TCP Wrappers, Kerberos, OpenSSL, OpenSSH, ACL, NFSv4 ACLs, advisories, sudo, doas, capsicum, monitoring"/>
  <meta name="copyright" content="1995-2024 The FreeBSD Foundation" />
  <link rel="canonical" href="https://free.bsd-doc.org/zh-cn/books/handbook/security/" />

  <title>Chapter 16. Security |  FreeBSD 中文文档</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>


    <link rel="shortcut icon" href="https://free.bsd-doc.org/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="https://free.bsd-doc.org/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>
    <script defer src="/js/fssearch.min.js"></script>

  
  
    
    <meta property="og:title" content="Chapter 16. Security" />
    <meta property="og:description" content="Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must" />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://free.bsd-doc.orgfavicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="zh-cn" />
    <meta property="og:url" content="https://free.bsd-doc.org/zh-cn/books/handbook/security/" />
    <meta property="og:site_name" content="FreeBSD 中文文档" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "https:\/\/free.bsd-doc.org\/zh-cn\/books\/handbook\/security\/",
        "name": "FreeBSD 中文文档",
        "headline": "FreeBSD 中文文档",
        "description": "FreeBSD 中文文档"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="https://free.bsd-doc.org" class="logo">
        <img src="https://free.bsd-doc.org/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      <form class="search" method="get" id="search-header-form" action="https://free.bsd-doc.org/zh-cn/search" name="search-header-form">
        <input id="search-query" name="s" type="text" size="20" maxlength="255" value="" />
        <button>
          <i class="fa fa-search" aria-hidden="true"></i>
        </button>
      </form>
      <div class="donate">
        <a href="https://github.com/fierceX/freebsd-doc-cn" target="_blank">
          <span class="heart">♥</span>
          GitHub
        </a>
      </div>
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="Search" aria-label="Search" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/">
              前言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-audience">预期读者</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from4">第四版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from3">第三版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes-from2">第二版（2004 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-changes">第一版（2001 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-overview">本书的组织结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-conv">本书中使用的约定</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/preface/#preface-acknowledgements">致谢</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/parti/">
              第一部分：入门指南
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/">
              第 1 章 引言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#introduction-synopsis">1.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#nutshell">1.2. 欢迎来到 FreeBSD ！</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/#history">1.3. 关于 FreeBSD 项目</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/">
              第 2 章 安装 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-synopsis">2.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-hardware">2.2. 最低硬件要求</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-pre">2.3. 安装前的任务</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-start">2.4. 开始安装</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#using-bsdinstall">2.5. 使用 bsdinstall</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-partitioning">2.6. 分配磁盘空间</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-fetching-distribution">2.7. 获取分发文件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-post">2.8. 网络接口，账户，时区，服务和加固</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#bsdinstall-install-trouble">2.9. 故障排除</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bsdinstall/#using-live-cd">2.10. 使用 Live CD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/">
              第 3 章 FreeBSD 基础知识
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-synopsis">3.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#consoles">3.2. 虚拟控制台和终端</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#users-synopsis">3.3. 用户和基本账户管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#permissions">3.4. 权限</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#dirstructure">3.5. 目录结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#disk-organization">3.6. 磁盘组织</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#mount-unmount">3.7. 挂载和卸载文件系统</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-processes">3.8. 进程和守护进程</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#shells">3.9. Shells</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#editors">3.10. 文本编辑器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-devices">3.11. 设备和设备节点</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/basics/#basics-more-information">3.12. 手册页</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/">
              第 4 章 安装应用程序：软件包和 Ports
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-synopsis">4.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-overview">4.2. 软件安装概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-finding-applications">4.3. 寻找软件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#pkgng-intro">4.4. 使用 pkg 进行二进制包管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-using">4.5. 使用 Ports 集合</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-poudriere">4.6. 使用 poudriere 构建软件包</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-nextsteps">4.7. 安装后的考虑事项</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ports/#ports-broken">4.8. 处理损坏的 ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/">
              第 5 章 X Window 系统
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x11-synopsis">5.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-install">5.2. 安装 Xorg</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-graphic-card-drivers">5.3. 显卡驱动程序</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-config">5.4. Xorg 配置</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/x11/#x-fonts">5.5. 在 Xorg 中使用字体</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-235af08fb87fd7a58003348706d2111d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-235af08fb87fd7a58003348706d2111d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/">
              第 6 章 Wayland
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-synopsis">6.1. Wayland 概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-wayfire">6.2. Wayfire 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-hikari">6.3. Hikari 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-sway">6.4. Sway 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-xwayland">6.5. 使用 Xwayland</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-remotedesktop">6.6. 使用 VNC 进行远程桌面访问</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-ly">6.7. Wayland 登录管理器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wayland/#wayland-utilities">6.8. 有用的工具</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4de18483dde20bf9ed0024176afd09da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4de18483dde20bf9ed0024176afd09da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/">
              第 7 章 网络
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#network-synopsis">7.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#config-network-setup">7.2. 设置网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#config-network-connection">7.3. 有线网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#network-wireless">7.4. 无线网络</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#hostname">7.5. 主机名</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#dns">7.6. DNS</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network/#troubleshooting">7.7. 故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partii/">
              第二部分：常见任务
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/">
              Chapter 8. Desktop Environments
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-synopsis">8.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-environments">8.2. Desktop Environments</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-browsers">8.3. Browsers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-development">8.4. Development tools</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-productivity">8.5. Desktop office productivity</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-viewers">8.6. Document Viewers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/desktop/#desktop-finance">8.7. Finance</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/">
              Chapter 9. Multimedia
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#multimedia-synopsis">9.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#sound-setup">9.2. Setting Up the Sound Card</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#audio-ports">9.3. Audio players</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#video-ports">9.4. Video players</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#conferencing-meetings">9.5. Conferencing and Meetings</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/multimedia/#scanners">9.6. Image Scanners</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/">
              第 10 章 配置 FreeBSD 内核
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-synopsis">10.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-custom-kernel">10.2. 为什么要构建自定义内核？</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-devices">10.3. 查找系统硬件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-config">10.4. 配置文件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-building">10.5. 构建和安装自定义内核</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/kernelconfig/#kernelconfig-trouble">10.6. 如果出现问题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/">
              Chapter 11. Printing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-quick-start">11.1. Quick Start</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-connections">11.2. Printer Connections</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-pdls">11.3. Common Page Description Languages</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-direct">11.4. Direct Printing</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-lpd">11.5. LPD (Line Printer Daemon)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/printing/#printing-other">11.6. Other Printing Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/">
              第 12 章 Linux 二进制兼容性
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-synopsis">12.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-lbc-install">12.2. 配置 Linux 二进制兼容性</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linux-userlands">12.3. Linux 用户空间</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/linuxemu/#linuxemu-advanced">12.4. 高级主题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-af234c193ce95c480af0ff5ec3f32f5c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-af234c193ce95c480af0ff5ec3f32f5c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/">
              Chapter 13. WINE
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-synopsis">13.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-overview-concepts">13.2. WINE Overview & Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#installing-wine-on-freebsd">13.3. Installing WINE on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#running-first-wine-program">13.4. Running a First WINE Program on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#configuring-wine-installation">13.5. Configuring WINE Installation</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-management-guis">13.6. WINE Management GUIs</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-in-multi-user-os-installations">13.7. WINE in Multi-User FreeBSD Installations</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/wine/#wine-on-os-faq">13.8. WINE on FreeBSD FAQ</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partiii/">
              第三部分：系统管理
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/">
              Chapter 14. Configuration, Services, Logging and Power Management
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#config-synopsis">14.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-configfiles">14.2. Configuration Files</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-rcd">14.3. Managing Services in FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#cron-periodic">14.4. Cron and Periodic</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#configtuning-syslog">14.5. Configuring System Logging</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#acpi-overview">14.6. Power and Resource Management</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/config/#adding-swap-space">14.7. Adding Swap Space</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/">
              第 15 章 FreeBSD 的引导过程
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-synopsis">15.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-introduction">15.2. FreeBSD 引导过程</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#device-hints">15.3. 设备提示</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/boot/#boot-shutdown">15.4. 关机序列</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/">
              Chapter 16. Security
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-synopsis">16.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-intro">16.2. Introduction</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#sec-accounts">16.3. Securing Accounts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-ids">16.4. Intrusion Detection System (IDS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-secure-levels">16.5. Secure levels</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-file-flags">16.6. File flags</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#openssh">16.7. OpenSSH</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#openssl">16.8. OpenSSL</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#kerberos5">16.9. Kerberos</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#tcpwrappers">16.10. TCP Wrappers</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#fs-acl">16.11. Access Control Lists</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#capsicum">16.12. Capsicum</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-accounting">16.13. Process Accounting</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-resourcelimits">16.14. Resource Limits</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-pkg">16.15. Monitoring Third Party Security Issues</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/security/#security-advisories">16.16. FreeBSD Security Advisories</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/">
              第 17 章 Jails 和容器
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jails-synopsis">17.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-types">17.2. Jail 类型</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#host-configuration">17.3. 主机配置</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#classic-jail">17.4. 经典 Jail（厚 Jail ）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#thin-jail">17.5. 薄（Thin）Jails</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-management">17.6. Jail 管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-upgrading">17.7. Jail 升级</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-resource-limits">17.8. Jail 资源限制</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/jails/#jail-managers-and-containers">17.9. Jail 管理器和容器</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/">
              Chapter 18. Mandatory Access Control
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-synopsis">18.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-inline-glossary">18.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-understandlabel">18.3. Understanding MAC Labels</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-planning">18.4. Planning the Security Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-policies">18.5. Available MAC Policies</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-userlocked">18.6. User Lock Down</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-implementing">18.7. Nagios in a MAC Jail</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mac/#mac-troubleshoot">18.8. Troubleshooting the MAC Framework</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/">
              Chapter 19. Security Event Auditing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-synopsis">19.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-inline-glossary">19.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-config">19.3. Audit Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/audit/#audit-administration">19.4. Working with Audit Trails</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/">
              Chapter 20. Storage
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-synopsis">20.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-adding">20.2. Adding Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-growing">20.3. Resizing and Growing Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#usb-disks">20.4. USB Storage Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#creating-cds">20.5. Creating and Using CD Media</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#creating-dvds">20.6. Creating and Using DVD Media</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#floppies">20.7. Creating and Using Floppy Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#using-ntfs">20.8. Using NTFS Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#backup-basics">20.9. Backup Basics</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-virtual">20.10. Memory Disks</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#snapshots">20.11. File System Snapshots</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#quotas">20.12. Disk Quotas</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-encrypting">20.13. Encrypting Disk Partitions</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#swap-encrypting">20.14. Encrypting Swap</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/disks/#disks-hast">20.15. Highly Available Storage (HAST)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/">
              Chapter 21. GEOM: Modular Disk Transformation Framework
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-synopsis">21.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-striping">21.2. RAID0 - Striping</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-mirror">21.3. RAID1 - Mirroring</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-raid3">21.4. RAID3 - Byte-level Striping with Dedicated Parity</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-graid">21.5. Software RAID Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-ggate">21.6. GEOM Gate Network</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-glabel">21.7. Labeling Disk Devices</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/geom/#geom-gjournal">21.8. UFS Journaling Through GEOM</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f1657a05627dd16bad31d4c7f675604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f1657a05627dd16bad31d4c7f675604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/">
              第 22 章 Z 文件系统（ZFS）
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-differences">22.1. ZFS 有何不同之处</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-quickstart">22.2. 快速入门指南</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zpool">22.3. <code>zpool</code> 管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zfs">22.4. <code>zfs</code> 管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-zfs-allow">22.5. 委派管理</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-advanced">22.6. 高级主题</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-links">22.7. 进一步资源</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/zfs/#zfs-term">22.8. ZFS 功能和术语</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/">
              Chapter 23. Other File Systems
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/#filesystems-synopsis">23.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/filesystems/#filesystems-linux">23.2. Linux® File Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/">
              Chapter 24. Virtualization
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-synopsis">24.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/virtualization/#virtualization-host-xen">24.7. FreeBSD as a Xen™-Host</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/">
              Chapter 25. Localization - i18n/L10n Usage and Setup
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#l10n-synopsis">25.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#using-localization">25.2. Using Localization</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#l10n-compiling">25.3. Finding i18n Applications</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/l10n/#lang-setup">25.4. Locale Configuration for Specific Languages</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/">
              Chapter 26. Updating and Upgrading FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-synopsis">26.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">26.2. FreeBSD Update</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-bootcode">26.3. Updating Bootcode</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#updating-upgrading-documentation">26.4. Updating the Documentation Set</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#current-stable">26.5. Tracking a Development Branch</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#makeworld">26.6. Updating FreeBSD from Source</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#small-lan">26.7. Tracking for Multiple Machines</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/cutting-edge/#building-on-non-freebsd-hosts">26.8. Building on non-FreeBSD Hosts</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/">
              Chapter 27. DTrace
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-synopsis">27.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-implementation">27.2. Implementation Differences</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-enable">27.3. Enabling DTrace Support</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/dtrace/#dtrace-using">27.4. Using DTrace</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bdb217202a0a3eef4571dd1fcd50863c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bdb217202a0a3eef4571dd1fcd50863c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/">
              Chapter 28. USB Device Mode / USB OTG
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-synopsis">28.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-terminals">28.2. USB Virtual Serial Ports</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-network">28.3. USB Device Mode Network Interfaces</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/usb-device-mode/#usb-device-mode-storage">28.4. USB Virtual Storage Device</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partiv/">
              第四部分：网络通信
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/">
              Chapter 29. Serial Communications
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serial-synopsis">29.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serial">29.2. Serial Terminology and Hardware</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#term">29.3. Terminals</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#dialup">29.4. Dial-in Service</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#dialout">29.5. Dial-out Service</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/serialcomms/#serialconsole-setup">29.6. Setting Up the Serial Console</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/">
              Chapter 30. PPP
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">30.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#userppp">30.2. Configuring PPP</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#ppp-troubleshoot">30.3. Troubleshooting PPP Connections</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#pppoe">30.4. Using PPP over Ethernet (PPPoE)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/ppp-and-slip/#pppoa">30.5. Using PPP over ATM (PPPoA)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/">
              Chapter 31. Electronic Mail
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-synopsis">31.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-using">31.2. Mail Components</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#dragonFly-mail-agent">31.3. DragonFly Mail Agent (DMA)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#sendmail">31.4. Sendmail</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-changingmta">31.5. Changing the Mail Transfer Agent</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-agents">31.6. Mail User Agents</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mail/#mail-advanced">31.7. Advanced Topics</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/">
              Chapter 32. Network Servers
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-servers-synopsis">32.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-inetd">32.2. The inetd Super-Server</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-nfs">32.3. Network File System (NFS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-nis">32.4. Network Information System (NIS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ldap">32.5. Lightweight Directory Access Protocol (LDAP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-dhcp">32.6. Dynamic Host Configuration Protocol (DHCP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-dns">32.7. Domain Name System (DNS)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-apache">32.8. Apache HTTP Server</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ftp">32.9. File Transfer Protocol (FTP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-samba">32.10. File and Print Services for Microsoft® Windows® Clients (Samba)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-ntp">32.11. Clock Synchronization with NTP</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/network-servers/#network-iscsi">32.12. iSCSI Initiator and Target Configuration</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/">
              Chapter 33. Firewalls
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-intro">33.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-concepts">33.2. Firewall Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-pf">33.3. PF</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-ipfw">33.4. IPFW</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-ipf">33.5. IPFILTER (IPF)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/firewalls/#firewalls-blacklistd">33.6. Blacklistd</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/">
              Chapter 34. Advanced Networking
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#advanced-networking-synopsis">34.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-routing">34.2. Gateways and Routes</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#configtuning-virtual-hosts">34.3. Virtual Hosts</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-advanced-wireless">34.4. Wireless Advanced Authentication</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#wireless-ad-hoc-mode">34.5. Wireless Ad-hoc Mode</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-usb-tethering">34.6. USB Tethering</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-bluetooth">34.7. Bluetooth</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-bridging">34.8. Bridging</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-aggregation">34.9. Link Aggregation and Failover</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-diskless">34.10. Diskless Operation with PXE</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#carp">34.11. Common Address Redundancy Protocol (CARP)</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/advanced-networking/#network-vlan">34.12. VLANs</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/partv/">
              第五部分. 附录
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/">
              Appendix A. Obtaining FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#mirrors">A.1. Mirrors</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#git">A.2. Using Git</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#svn">A.3. Using Subversion</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/mirrors/#mirrors-cdrom">A.4. CD and DVD Sets</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/">
              Appendix B. Bibliography
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-freebsd">B.1. FreeBSD Bibliography</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-security">B.2. Security Reference</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-history">B.3. UNIX® History</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/bibliography/#bibliography-journals">B.4. Periodicals, Journals, and Magazines</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/">
              Appendix C. Resources on the Internet
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-www">C.1. Websites</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-mail">C.2. Mailing Lists</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/eresources/#eresources-news">C.3. Usenet Newsgroups</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/pgpkeys/">
              Appendix D. OpenPGP Keys
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn/books/handbook/pgpkeys/#pgpkeys-officers">D.1. Officers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-2a8deedf14429128049622ec007c9d3f" class="toggle"  />
          <label  for="chapter-2a8deedf14429128049622ec007c9d3f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/glossary/">
              FreeBSD Glossary
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-110dbb242491bf200e51e76db171f670" class="toggle"  />
          <label  for="chapter-110dbb242491bf200e51e76db171f670"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/colophon/">
              后记
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-caffbcba74982e4b26b9263ac0232bc3" class="toggle"  />
          <label  for="chapter-caffbcba74982e4b26b9263ac0232bc3"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn/books/handbook/introduction/">
              
            </a>
            
            
          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">Chapter 16. Security</h1>
    
    
      <div class="admonitionblock note">
        <p>
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          如果发现翻译错误，请直接 <a href="https://github.com/fierceX/freebsd-doc-cn/pulls" target="_blank">发起PR修改</a>。
        </p>
      </div>
    
    
    
    <div class="toc-mobile">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#security-synopsis">16.1. Synopsis</a></li>
    <li><a href="#security-intro">16.2. Introduction</a></li>
    <li><a href="#sec-accounts">16.3. Securing Accounts</a></li>
    <li><a href="#security-ids">16.4. Intrusion Detection System (IDS)</a></li>
    <li><a href="#security-secure-levels">16.5. Secure levels</a></li>
    <li><a href="#security-file-flags">16.6. File flags</a></li>
    <li><a href="#openssh">16.7. OpenSSH</a></li>
    <li><a href="#openssl">16.8. OpenSSL</a></li>
    <li><a href="#kerberos5">16.9. Kerberos</a></li>
    <li><a href="#tcpwrappers">16.10. TCP Wrappers</a></li>
    <li><a href="#fs-acl">16.11. Access Control Lists</a></li>
    <li><a href="#capsicum">16.12. Capsicum</a></li>
    <li><a href="#security-accounting">16.13. Process Accounting</a></li>
    <li><a href="#security-resourcelimits">16.14. Resource Limits</a></li>
    <li><a href="#security-pkg">16.15. Monitoring Third Party Security Issues</a></li>
    <li><a href="#security-advisories">16.16. FreeBSD Security Advisories</a></li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="security-synopsis">16.1. Synopsis<a class="anchor" href="#security-synopsis"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hundreds of standard practices have been authored about how to secure systems and networks, and as a user of FreeBSD, understanding how to protect against attacks and intruders is a must.</p>
</div>
<div class="paragraph">
<p>In this chapter, several fundamentals and techniques will be discussed. The FreeBSD system comes with multiple layers of security, and many more third party utilities may be added to enhance security.</p>
</div>
<div class="paragraph">
<p>This chapter covers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic FreeBSD system security concepts.</p>
</li>
<li>
<p>The various crypt mechanisms available in FreeBSD.</p>
</li>
<li>
<p>How to configure TCP Wrappers for use with <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>.</p>
</li>
<li>
<p>How to set up Kerberos on FreeBSD.</p>
</li>
<li>
<p>How to configure and use OpenSSH on FreeBSD.</p>
</li>
<li>
<p>How to use OpenSSL on FreeBSD.</p>
</li>
<li>
<p>How to use file system ACLs.</p>
</li>
<li>
<p>How to use pkg to audit third party software packages installed from the Ports Collection.</p>
</li>
<li>
<p>How to utilize FreeBSD security advisories.</p>
</li>
<li>
<p>What Process Accounting is and how to enable it on FreeBSD.</p>
</li>
<li>
<p>How to control user resources using login classes or the resource limits database.</p>
</li>
<li>
<p>What is Capsicum and a basic example.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Certain topics due to their complexity are found in dedicated chapters such as <a href="../firewalls/#firewalls">Firewalls</a>, <a href="../mac/#mac">Mandatory Access Control</a> and articles like <a href="{vpn-ipsec}">VPN over IPsec</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-intro">16.2. Introduction<a class="anchor" href="#security-intro"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security is everyone’s responsibility. A weak entry point in any system could allow intruders to gain access to critical information and cause havoc on an entire network. One of the core principles of information security is the CIA triad, which stands for the Confidentiality, Integrity, and Availability of information systems.</p>
</div>
<div class="paragraph">
<p>The CIA triad is a bedrock concept of computer security as customers and users expect their data to be protected. For example, a customer expects that their credit card information is securely stored (confidentiality), that their orders are not changed behind the scenes (integrity), and that they have access to their order information at all times (availability).</p>
</div>
<div class="paragraph">
<p>To provide CIA, security professionals apply a defense in depth strategy. The idea of defense in depth is to add several layers of security to prevent one single layer failing and the entire security system collapsing. For example, a system administrator cannot simply turn on a firewall and consider the network or system secure. One must also audit accounts, check the integrity of binaries, and ensure malicious tools are not installed. To implement an effective security strategy, one must understand threats and how to defend against them.</p>
</div>
<div class="paragraph">
<p>What is a threat as it pertains to computer security? Threats are not limited to remote attackers who attempt to access a system without permission from a remote location. Threats also include employees, malicious software, unauthorized network devices, natural disasters, security vulnerabilities, and even competing corporations.</p>
</div>
<div class="paragraph">
<p>Systems and networks can be accessed without permission, sometimes by accident, or by remote attackers, and in some cases, via corporate espionage or former employees. As a user, it is important to prepare for and admit when a mistake has led to a security breach and report possible issues to the security team. As an administrator, it is important to know of the threats and be prepared to mitigate them.</p>
</div>
<div class="paragraph">
<p>When applying security to systems, it is recommended to start by securing the basic accounts and system configuration, and then to secure the network layer so that it adheres to the system policy and the organization’s security procedures. Many organizations already have a security policy that covers the configuration of technology devices. The policy should include the security configuration of workstations, desktops, mobile devices, phones, production servers, and development servers. In many cases, standard operating procedures (SOPs) already exist. When in doubt, ask the security team.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sec-accounts">16.3. Securing Accounts<a class="anchor" href="#sec-accounts"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maintaining secure accounts in FreeBSD is crucial for data confidentiality, system integrity, and privilege separation, as it prevents unauthorized access, malware, and data breaches while ensuring compliance and protecting an organization’s reputation.</p>
</div>
<div class="sect2">
<h3 id="security-accounts">16.3.1. Preventing Logins<a class="anchor" href="#security-accounts"></a></h3>
<div class="paragraph">
<p>In securing a system, a good starting point is an audit of accounts. Disable any accounts that do not need login access.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that <code>root</code> has a strong password and that this password is not shared.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To deny login access to accounts, two methods exist.</p>
</div>
<div class="paragraph">
<p>The first is to lock the account, this example shows how to lock the <code>imani</code> account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw lock imani</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second method is to prevent login access by changing the shell to <span class="filename">/usr/sbin/nologin</span>. The <a href="https://man.freebsd.org/cgi/man.cgi?query=nologin&amp;sektion=8&amp;format=html">nologin(8)</a> shell prevents the system from assigning a shell to the user when they attempt to login.</p>
</div>
<div class="paragraph">
<p>Only the superuser can change the shell for other users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chsh -s /usr/sbin/nologin imani</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-passwords">16.3.2. Password Hashes<a class="anchor" href="#security-passwords"></a></h3>
<div class="paragraph">
<p>Passwords are a necessary evil of technology. When they must be used, they should be complex and a powerful hash mechanism should be used to encrypt the version that is stored in the password database. FreeBSD supports several algorithms, including SHA256, SHA512 and Blowfish hash algorithms in its <code>crypt()</code> library, see <a href="https://man.freebsd.org/cgi/man.cgi?query=crypt&amp;sektion=3&amp;format=html">crypt(3)</a> for details.</p>
</div>
<div class="paragraph">
<p>The default of SHA512 should not be changed to a less secure hashing algorithm, but can be changed to the more secure Blowfish algorithm.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Blowfish is not part of AES and is not considered compliant with any Federal Information Processing Standards (FIPS). Its use may not be permitted in some environments.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To determine which hash algorithm is used to encrypt a user’s password, the superuser can view the hash for the user in the FreeBSD password database. Each hash starts with a symbol which indicates the type of hash mechanism used to encrypt the password.</p>
</div>
<div class="paragraph">
<p>If DES is used, there is no beginning symbol. For MD5, the symbol is <code>$</code>. For SHA256 and SHA512, the symbol is <code>$6$</code>. For Blowfish, the symbol is <code>$2a$</code>. In this example, the password for <code>imani</code> is hashed using the default SHA512 algorithm as the hash starts with <code>$6$</code>. Note that the encrypted hash, not the password itself, is stored in the password database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># grep imani /etc/master.passwd</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>imani:$6$pzIjSvCAn.PBYQBA$PXpSeWPx3g5kscj3IMiM7tUEUSPmGexxta.8Lt9TGSi2lNQqYGKszsBPuGME0:1001:1001::0:0:imani:/usr/home/imani:/bin/sh</pre>
</div>
</div>
<div class="paragraph">
<p>The hash mechanism is set in the user’s login class.</p>
</div>
<div class="paragraph">
<p>The following command can be run to check which hash mechanism is currently being used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># grep user /etc/master.passwd</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>:passwd_format=sha512:\</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to change the algorithm to Blowfish, modify that line to look like this:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>:passwd_format=blf:\</pre>
</div>
</div>
<div class="paragraph">
<p>Then, <a href="https://man.freebsd.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1&amp;format=html">cap_mkdb(1)</a> must be executed to upgrade the login.conf database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cap_mkdb /etc/login.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this change will not affect any existing password hashes. This means that all passwords should be re-hashed by asking users to run <code>passwd</code> in order to change their password.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-pwpolicy">16.3.3. Password Policy Enforcement<a class="anchor" href="#security-pwpolicy"></a></h3>
<div class="paragraph">
<p>Enforcing a strong password policy for local accounts is a fundamental aspect of system security. In FreeBSD, password length, password strength, and password complexity can be implemented using built-in Pluggable Authentication Modules (PAM).</p>
</div>
<div class="paragraph">
<p>This section demonstrates how to configure the minimum and maximum password length and the enforcement of mixed characters using the <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a> module. This module is enforced when a user changes their password.</p>
</div>
<div class="paragraph">
<p>To configure this module, become the superuser and uncomment the line containing <code>pam_passwdqc.so</code> in <span class="filename">/etc/pam.d/passwd</span>.</p>
</div>
<div class="paragraph">
<p>Then, edit that line to match the password policy:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>password        requisite       pam_passwdqc.so         min=disabled,disabled,disabled,12,10 similar=deny retry=3 enforce=users</pre>
</div>
</div>
<div class="paragraph">
<p>The explanation of the parameters can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=pam_passwdqc&amp;sektion=8&amp;format=html">pam_passwdqc(8)</a>.</p>
</div>
<div class="paragraph">
<p>Once this file is saved, a user changing their password will see a message similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>passwd</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Changing local password for user
Old Password:

You can now choose the new password.
A valid password should be a mix of upper and lower case letters,
digits and other characters.  You can use a 12 character long
password with characters from at least 3 of these 4 classes, or
a 10 character long password containing characters from all the
classes.  Characters that form a common pattern are discarded by
the check.
Alternatively, if no one else can see your terminal now, you can
pick this as your password: &#34;trait-useful&amp;knob&#34;.
Enter new password:</pre>
</div>
</div>
<div class="paragraph">
<p>If a password that does not match the policy is entered, it will be rejected with a warning and the user will have an opportunity to try again, up to the configured number of retries.</p>
</div>
<div class="paragraph">
<p>If your organization’s policy requires passwords to expire, FreeBSD supports the <code>passwordtime</code> in the user’s login class in <span class="filename">/etc/login.conf</span></p>
</div>
<div class="paragraph">
<p>The <code>default</code> login class contains an example:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#       :passwordtime=90d:\</pre>
</div>
</div>
<div class="paragraph">
<p>So, to set an expiry of 90 days for this login class, remove the comment symbol (#), save the edit, and execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cap_mkdb /etc/login.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To set the expiration on individual users, pass an expiration date or the number of days to expiry and a username to <code>pw</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw usermod -p 30-apr-2025 -n user</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen here, an expiration date is set in the form of day, month, and year. For more information, see <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-sudo">16.3.4. Shared Administration with sudo<a class="anchor" href="#security-sudo"></a></h3>
<div class="paragraph">
<p>System administrators often need the ability to grant enhanced permissions to users so they may perform privileged tasks. The idea that team members are provided access to a FreeBSD system to perform their specific tasks opens up unique challenges to every administrator. These team members only need a subset of access beyond normal end user levels; however, they almost always tell management they are unable to perform their tasks without superuser access. Thankfully, there is no reason to provide such access to end users because tools exist to manage this exact requirement.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even administrators should limit their privileges when not needed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Up to this point, the security chapter has covered permitting access to authorized users and attempting to prevent unauthorized access. Another problem arises once authorized users have access to the system resources. In many cases, some users may need access to application startup scripts, or a team of administrators need to maintain the system. Traditionally, the standard users and groups, file permissions, and even the <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a> command would manage this access. And as applications required more access, as more users needed to use system resources, a better solution was required. The most used application is currently Sudo.</p>
</div>
<div class="paragraph">
<p>Sudo allows administrators to configure more rigid access to system commands and provide for some advanced logging features. As a tool, it is available from the Ports Collection as <a class="package" href="https://cgit.freebsd.org/ports/tree/security/sudo/">security/sudo</a> or by use of the <a href="https://man.freebsd.org/cgi/man.cgi?query=pkg&amp;sektion=8&amp;format=html">pkg(8)</a> utility.</p>
</div>
<div class="paragraph">
<p>Execute the following command to install it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg install sudo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the installation is complete, the installed <code>visudo</code> will open the configuration file with a text editor. Using <code>visudo</code> is highly recommended as it comes with a built in syntax checker to verify there are no errors before the file is saved.</p>
</div>
<div class="paragraph">
<p>The configuration file is made up of several small sections which allow for extensive configuration. In the following example, web application maintainer, user1, needs to start, stop, and restart the web application known as <em>webservice</em>. To grant this user permission to perform these tasks, add this line to the end of <span class="filename">/usr/local/etc/sudoers</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>user1   ALL=(ALL)       /usr/sbin/service webservice *</pre>
</div>
</div>
<div class="paragraph">
<p>The user may now start <em>webservice</em> using this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>sudo /usr/sbin/service webservice start</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this configuration allows a single user access to the webservice service; however, in most organizations, there is an entire web team in charge of managing the service. A single line can also give access to an entire group. These steps will create a web group, add a user to this group, and allow all members of the group to manage the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw groupadd -g 6001 -n webteam</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the same <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a> command, the user is added to the webteam group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pw groupmod -m user1 -n webteam</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, this line in <span class="filename">/usr/local/etc/sudoers</span> allows any member of the webteam group to manage <em>webservice</em>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>%webteam   ALL=(ALL)       /usr/sbin/service webservice *</pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;format=html">sudo(8)</a> only requires the end user password. This avoids sharing passwords, which is a poor practice.</p>
</div>
<div class="paragraph">
<p>Users permitted to run applications with <a href="https://man.freebsd.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;format=html">sudo(8)</a> only enter their own passwords. This is more secure and gives better control than <a href="https://man.freebsd.org/cgi/man.cgi?query=su&amp;sektion=1&amp;format=html">su(1)</a>, where the <code>root</code> password is entered and the user acquires all <code>root</code> permissions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most organizations are moving or have moved toward a two factor authentication model. In these cases, the user may not have a password to enter.</p>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;format=html">sudo(8)</a> can be configured to permit two factor authentication model by using the <code>NOPASSWD</code> variable. Adding it to the configuration above will allow all members of the <em>webteam</em> group to manage the service without the password requirement:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>%webteam   ALL=(ALL)       NOPASSWD: /usr/sbin/service webservice *</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="security-doas">16.3.5. Shared Administration with Doas<a class="anchor" href="#security-doas"></a></h3>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=doas&amp;sektion=1&amp;format=html">doas(1)</a> is a command-line utility ported from OpenBSD. It serves as an alternative to the widely used <a href="https://man.freebsd.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;format=html">sudo(8)</a> command in Unix-like systems.</p>
</div>
<div class="paragraph">
<p>With doas, users can execute commands with elevated privileges, typically as the root user, while maintaining a simplified and security-conscious approach. Unlike <a href="https://man.freebsd.org/cgi/man.cgi?query=sudo&amp;sektion=8&amp;format=html">sudo(8)</a>, doas emphasizes simplicity and minimalism, focusing on streamlined privilege delegation without an overwhelming array of configuration options.</p>
</div>
<div class="paragraph">
<p>Execute the following command to install it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg install doas</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the installation <span class="filename">/usr/local/etc/doas.conf</span> must be configured to grant access for users for specific commands, or roles.</p>
</div>
<div class="paragraph">
<p>The simpliest entry could be the following, which grants the user <code>local_user</code> with <code>root</code> permissions without asking for its password when executing the doas command.</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>permit nopass local_user as root</pre>
</div>
</div>
<div class="paragraph">
<p>After the installation and configuration of the <code>doas</code> utility, a command can now be executed with enhanced privileges, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">$ </span>doas vi /etc/rc.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more configuration examples, please read <a href="https://man.freebsd.org/cgi/man.cgi?query=doas.conf&amp;sektion=5&amp;format=html">doas.conf(5)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-ids">16.4. Intrusion Detection System (IDS)<a class="anchor" href="#security-ids"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Verification of system files and binaries is important because it provides the system administration and security teams information about system changes. A software application that monitors the system for changes is called an Intrusion Detection System (IDS).</p>
</div>
<div class="paragraph">
<p>FreeBSD provides native support for a basic IDS system called <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a>. While the nightly security emails will notify an administrator of changes, the information is stored locally and there is a chance that a malicious user could modify this information in order to hide their changes to the system. As such, it is recommended to create a separate set of binary signatures and store them on a read-only, root-owned directory or, preferably, on a removable USB disk or remote server.</p>
</div>
<div class="paragraph">
<p>It is also recommended to run <code>freebsd-update IDS</code> after each update.</p>
</div>
<div class="sect2">
<h3 id="security-ids-generate-spec-file">16.4.1. Generating the Specification File<a class="anchor" href="#security-ids-generate-spec-file"></a></h3>
<div class="paragraph">
<p>The built-in <a href="https://man.freebsd.org/cgi/man.cgi?query=mtree&amp;sektion=8&amp;format=html">mtree(8)</a> utility can be used to generate a specification of the contents of a directory. A seed, or a numeric constant, is used to generate the specification and is required to check that the specification has not changed. This makes it possible to determine if a file or binary has been modified. Since the seed value is unknown by an attacker, faking or checking the checksum values of files will be difficult to impossible.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is recommended to create specifications for the directories which contain binaries and configuration files, as well as any directories containing sensitive data. Typically, specifications are created for <span class="filename">/bin</span>, <span class="filename">/sbin</span>, <span class="filename">/usr/bin</span>, <span class="filename">/usr/sbin</span>, <span class="filename">/usr/local/bin</span>, <span class="filename">/etc</span>, and <span class="filename">/usr/local/etc</span>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following example generates a set of <code>sha512</code> hashes, one for each system binary in <span class="filename">/bin</span>, and saves those values to a hidden file in user’s home directory, <span class="filename">/home/user/.bin_chksum_mtree</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mtree -s 123456789 -c -K cksum,sha512 -p /bin &gt; /home/user/.bin_chksum_mtree</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>mtree: /bin checksum: 3427012225</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>123456789</code> value represents the seed, and should be chosen randomly. This value should be remembered, <strong>but not shared</strong>.</p>
</div>
<div class="paragraph">
<p>It is important to keep the seed value and the checksum output hidden from malicious users.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="security-ids-spec-file-structure">16.4.2. The Specification File Structure<a class="anchor" href="#security-ids-spec-file-structure"></a></h3>
<div class="paragraph">
<p>The mtree format is a textual format that describes a collection of filesystem objects. Such files are typically used to create or verify directory hierarchies.</p>
</div>
<div class="paragraph">
<p>An mtree file consists of a series of lines, each providing information about a single filesystem object. Leading whitespace is always ignored.</p>
</div>
<div class="paragraph">
<p>The specification file created above will be used to explain the format and content:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#          user: root <i class="conum" data-value="1"></i><b>(1)</b>
#       machine: machinename <i class="conum" data-value="2"></i><b>(2)</b>
#          tree: /bin <i class="conum" data-value="3"></i><b>(3)</b>
#          date: Thu Aug  24 21:58:37 2023 <i class="conum" data-value="4"></i><b>(4)</b>

# .
/set type=file uid=0 gid=0 mode=0555 nlink=1 flags=uarch <i class="conum" data-value="5"></i><b>(5)</b>
.               type=dir mode=0755 nlink=2 time=1681388848.239523000 <i class="conum" data-value="6"></i><b>(6)</b>
    \133        nlink=2 size=12520 time=1685991378.688509000 \
                cksum=520880818 \
                sha512=5c1374ce0e2ba1b3bc5a41b23f4bbdc1ec89ae82fa01237f376a5eeef41822e68f1d8f75ec46b7bceb65396c122a9d837d692740fdebdcc376a05275adbd3471
    cat         size=14600 time=1685991378.694601000 cksum=3672531848 \ <i class="conum" data-value="7"></i><b>(7)</b>
                sha512=b30b96d155fdc4795432b523989a6581d71cdf69ba5f0ccb45d9b9e354b55a665899b16aee21982fffe20c4680d11da4e3ed9611232a775c69f926e5385d53a2
    chflags     size=8920 time=1685991378.700385000 cksum=1629328991 \
                sha512=289a088cbbcbeb436dd9c1f74521a89b66643976abda696b99b9cc1fbfe8b76107c5b54d4a6a9b65332386ada73fc1bbb10e43c4e3065fa2161e7be269eaf86a
    chio        size=20720 time=1685991378.706095000 cksum=1948751604 \
                sha512=46f58277ff16c3495ea51e74129c73617f31351e250315c2b878a88708c2b8a7bb060e2dc8ff92f606450dbc7dd2816da4853e465ec61ee411723e8bf52709ee
    chmod       size=9616 time=1685991378.712546000 cksum=4244658911 \
                sha512=1769313ce08cba84ecdc2b9c07ef86d2b70a4206420dd71343867be7ab59659956f6f5a458c64e2531a1c736277a8e419c633a31a8d3c7ccc43e99dd4d71d630</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>User who created the specification. &lt;.&gt; Machine’s hostname. &lt;.&gt; Directory path. &lt;.&gt; The Date and time when the specification was created. &lt;.&gt; <code>/set</code> special commands, defines some settings obtained from the files analyzed. &lt;.&gt; Refers to the parsed directory and indicates things like what type it is, its mode, the number of hard links, and the time in UNIX format since it was modified. &lt;.&gt; Refers to the file and shows the size, time and a list of hashes to verify the integrity.</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="security-ids-verify-specification-file">16.4.3. Verify the Specification file<a class="anchor" href="#security-ids-verify-specification-file"></a></h3>
<div class="paragraph">
<p>To verify that the binary signatures have not changed, compare the current contents of the directory to the previously generated specification, and save the results to a file.</p>
</div>
<div class="paragraph">
<p>This command requires the seed that was used to generate the original specification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mtree -s 123456789 -p /bin &lt; /home/user/.bin_chksum_mtree &gt;&gt; /home/user/.bin_chksum_output</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This should produce the same checksum for <span class="filename">/bin</span> that was produced when the specification was created. If no changes have occurred to the binaries in this directory, the <span class="filename">/home/user/.bin_chksum_output</span> output file will be empty.</p>
</div>
<div class="paragraph">
<p>To simulate a change, change the date on <span class="filename">/bin/cat</span> using <a href="https://man.freebsd.org/cgi/man.cgi?query=touch&amp;sektion=1&amp;format=html">touch(1)</a> and run the verification command again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># touch /bin/cat</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the verification command again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mtree -s 123456789 -p /bin &lt; /home/user/.bin_chksum_mtree &gt;&gt; /home/user/.bin_chksum_output</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then check the content of the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cat /root/.bin_chksum_output</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>cat:    modification time (Fri Aug 25 13:30:17 2023, Fri Aug 25 13:34:20 2023)</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is just an example of what would be displayed when executing the command, to show the changes that would occur in the metadata.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-secure-levels">16.5. Secure levels<a class="anchor" href="#security-secure-levels"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>securelevel is a security mechanism implemented in the kernel. When the securelevel is positive, the kernel restricts certain tasks; not even the superuser (root) is allowed to do them.</p>
</div>
<div class="paragraph">
<p>The securelevel mechanism limits the ability to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unset certain file flags, such as <code>schg</code> (the system immutable flag).</p>
</li>
<li>
<p>Write to kernel memory via <span class="filename">/dev/mem</span> and <span class="filename">/dev/kmem</span>.</p>
</li>
<li>
<p>Load kernel modules.</p>
</li>
<li>
<p>Alter firewall rules.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="security-secure-levels-definitions">16.5.1. Secure Levels Definitions<a class="anchor" href="#security-secure-levels-definitions"></a></h3>
<div class="paragraph">
<p>The kernel runs with five different security levels. Any super-user process can raise the level, but no process can lower it.</p>
</div>
<div class="paragraph">
<p>The security definitions are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-1</dt>
<dd>
<p><strong>Permanently insecure mode</strong> - always run the system in insecure mode.
This is the default initial value.</p>
</dd>
<dt class="hdlist1">0</dt>
<dd>
<p><strong>Insecure mode</strong> - immutable and append-only flags may be turned off.
All devices may be read or written subject to their permissions.</p>
</dd>
<dt class="hdlist1">1</dt>
<dd>
<p><strong>Secure mode</strong> - the system immutable and system append-only flags may not be turned off;
disks for mounted file systems, <span class="filename">/dev/mem</span> and <span class="filename">/dev/kmem</span> may not be opened for writing;
<span class="filename">/dev/io</span> (if your platform has it) may not be opened at all; kernel modules (see <a href="https://man.freebsd.org/cgi/man.cgi?query=kld&amp;sektion=4&amp;format=html">kld(4)</a>) may not be loaded or unloaded.
The kernel debugger may not be entered using the debug.kdb.enter sysctl.
A panic or trap cannot be forced using the debug.kdb.panic, debug.kdb.panic_str and other sysctl’s.</p>
</dd>
<dt class="hdlist1">2</dt>
<dd>
<p><strong>Highly secure mode</strong> - same as secure mode, plus disks may not be opened for writing (except by <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=2&amp;format=html">mount(2)</a>) whether mounted or not.
This level precludes tampering with file systems by unmounting them, but also inhibits running <a href="https://man.freebsd.org/cgi/man.cgi?query=newfs&amp;sektion=8&amp;format=html">newfs(8)</a> while the system is multiuser.</p>
</dd>
<dt class="hdlist1">3</dt>
<dd>
<p><strong>Network secure mode</strong> - same as highly secure mode, plus IP packet filter rules (see <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfirewall&amp;sektion=4&amp;format=html">ipfirewall(4)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a>) cannot be changed and <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=pf&amp;sektion=4&amp;format=html">pf(4)</a> configuration cannot be adjusted.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In summary, the key difference between <code>Permanently Insecure Mode</code> and <code>Insecure Mode</code> in FreeBSD secure levels is the degree of security they provide. <code>Permanently Insecure Mode</code> completely lifts all security restrictions, while <code>Insecure Mode</code> relaxes some restrictions but still maintains a level of control and security.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="security-modify-secure-levels">16.5.2. Modify Secure Levels<a class="anchor" href="#security-modify-secure-levels"></a></h3>
<div class="paragraph">
<p>In order to change the securelevel of the system it is necessary to activate <code>kern_securelevel_enable</code> by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc kern_securelevel_enable=&#34;YES&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And set the value of <code>kern_securelevel</code> to the desired security level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc kern_securelevel=2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the status of the securelevel on a running system execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl -n kern.securelevel</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output contains the current value of the securelevel. If it is greater than 0, at least some of the securelevel’s protections are enabled.</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>-1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-file-flags">16.6. File flags<a class="anchor" href="#security-file-flags"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>File flags allow users to attach additional metadata or attributes to files and directories beyond basic permissions and ownership. These flags provide a way to control various behaviors and properties of files without needing to resort to creating special directories or using extended attributes.</p>
</div>
<div class="paragraph">
<p>File flags can be used to achieve different goals, such as preventing file deletion, making files append-only, synchronizing file updates, and more. Some commonly used file flags in FreeBSD include the &#34;immutable&#34; flag, which prevents modification or deletion of a file, and the &#34;append-only&#34; flag, which allows only data to be added to the end of a file but not modified or removed.</p>
</div>
<div class="paragraph">
<p>These flags can be managed using the <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a> command in FreeBSD, providing administrators and users with greater control over the behavior and characteristics of their files and directories. It is important to note that file flags are typically managed by root or users with appropriate privileges, as they can influence how files are accessed and manipulated. Some flags are available for the use of the file’s owner, as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a>.</p>
</div>
<div class="sect2">
<h3 id="security-work-file-flag">16.6.1. Work with File Flags<a class="anchor" href="#security-work-file-flag"></a></h3>
<div class="paragraph">
<p>In this example, a file named <span class="filename">~/important.txt</span> in user’s home directory want to be protected against deletions.</p>
</div>
<div class="paragraph">
<p>Execute the following command to set the <code>schg</code> file flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chflags schg ~/important.txt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When any user, including the <code>root</code> user, tries to delete the file, the system will display the message:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>rm: important.txt: Operation not permitted</pre>
</div>
</div>
<div class="paragraph">
<p>To delete the file, it will be necessary to delete the file flags of that file by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chflags noschg ~/important.txt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of supported file flags and their functionality can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=chflags&amp;sektion=1&amp;format=html">chflags(1)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openssh">16.7. OpenSSH<a class="anchor" href="#openssh"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenSSH is a set of network connectivity tools used to provide secure access to remote machines. Additionally, TCP/IP connections can be tunneled or forwarded securely through SSH connections. OpenSSH encrypts all traffic to eliminate eavesdropping, connection hijacking, and other network-level attacks.</p>
</div>
<div class="paragraph">
<p>OpenSSH is maintained by the OpenBSD project and is installed by default in FreeBSD.</p>
</div>
<div class="paragraph">
<p>When data is sent over the network in an unencrypted form, network sniffers anywhere in between the client and server can steal user/password information or data transferred during the session. OpenSSH offers a variety of authentication and encryption methods to prevent this from happening.</p>
</div>
<div class="paragraph">
<p>More information about OpenSSH is available in the <a href="https://www.openssh.com/">web page</a>.</p>
</div>
<div class="paragraph">
<p>This section provides an overview of the built-in client utilities to securely access other systems and securely transfer files from a FreeBSD system. It then describes how to configure a SSH server on a FreeBSD system.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As stated, this chapter will cover the base system version of OpenSSH. A version of OpenSSH is also available in the <a class="package" href="https://cgit.freebsd.org/ports/tree/security/openssh-portable/">security/openssh-portable</a>, which provides additional configuration options and is updated more regularly.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_using_the_ssh_client_utilities">16.7.1. Using the SSH Client Utilities<a class="anchor" href="#_using_the_ssh_client_utilities"></a></h3>
<div class="paragraph">
<p>To log into a SSH server, use <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> and specify a username that exists on that server and the IP address or hostname of the server. If this is the first time a connection has been made to the specified server, the user will be prompted to first verify the server’s fingerprint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ssh user@example.com</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>The authenticity of host &#39;example.com (10.0.0.1)&#39; can&#39;t be established.
ECDSA key fingerprint is 25:cc:73:b5:b3:96:75:3d:56:19:49:d2:5c:1f:91:3b.
Are you sure you want to continue connecting (yes/no)? yes
Permanently added &#39;example.com&#39; (ECDSA) to the list of known hosts.
Password for user@example.com: user_password</pre>
</div>
</div>
<div class="paragraph">
<p>SSH utilizes a key fingerprint system to verify the authenticity of the server when the client connects. When the user accepts the key’s fingerprint by typing <code>yes</code> when connecting for the first time, a copy of the key is saved to <span class="filename">~/.ssh/known_hosts</span> in the user’s home directory. Future attempts to login are verified against the saved key and <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> will display an alert if the server’s key does not match the saved key. If this occurs, the user should first verify why the key has changed before continuing with the connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>How to perform this check is outside the scope of this chapter.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> to securely copy a file to or from a remote machine.</p>
</div>
<div class="paragraph">
<p>This example copies <code>COPYRIGHT</code> on the remote system to a file of the same name in the current directory of the local system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># scp user@example.com:/COPYRIGHT COPYRIGHT</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Password for user@example.com: *******
COPYRIGHT            100% |*****************************|  4735</pre>
</div>
</div>
<div class="paragraph">
<p>Since the fingerprint was already verified for this host, the server’s key is automatically checked before prompting for the user’s password.</p>
</div>
<div class="paragraph">
<p>The arguments passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> are similar to <a href="https://man.freebsd.org/cgi/man.cgi?query=cp&amp;sektion=1&amp;format=html">cp(1)</a>. The file or files to copy is the first argument and the destination to copy to is the second. Since the file is fetched over the network, one or more of the file arguments takes the form <code>user@host:&lt;path_to_remote_file&gt;</code>. Be aware when copying directories recursively that <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> uses <code>-r</code>, whereas <a href="https://man.freebsd.org/cgi/man.cgi?query=cp&amp;sektion=1&amp;format=html">cp(1)</a> uses <code>-R</code>.</p>
</div>
<div class="paragraph">
<p>To open an interactive session for copying files, use <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a>.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> for a list of available commands while in an <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> session.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-ssh-keygen">16.7.2. Key-based Authentication<a class="anchor" href="#security-ssh-keygen"></a></h3>
<div class="paragraph">
<p>Instead of using passwords, a client can be configured to connect to the remote machine using keys. For security reasons, this is the preferred method.</p>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=ssh-keygen&amp;sektion=1&amp;format=html">ssh-keygen(1)</a> can be used to generate the authentication keys. To generate a public and private key pair, specify the type of key and follow the prompts. It is recommended to protect the keys with a memorable, but hard to guess passphrase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>ssh-keygen -t rsa -b 4096</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Generating public/private rsa key pair.
Enter file in which to save the key (/home/user/.ssh/id_rsa):
Created directory &#39;/home/user/.ssh/.ssh&#39;.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/user/.ssh/id_rsa.
Your public key has been saved in /home/user/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:54Xm9Uvtv6H4NOo6yjP/YCfODryvUU7yWHzMqeXwhq8 user@host.example.com
The key&#39;s randomart image is:
+---[RSA 2048]----+
|                 |
|                 |
|                 |
|        . o..    |
|       .S*+*o    |
|      . O=Oo . . |
|       = Oo= oo..|
|      .oB.* +.oo.|
|       =OE**.o..=|
+----[SHA256]-----+</pre>
</div>
</div>
<div class="paragraph">
<p>The private key is stored in <span class="filename">~/.ssh/id_rsa</span> and the public key is stored in <span class="filename">~/.ssh/id_rsa.pub</span>. The <em>public</em> key must be copied to <span class="filename">~/.ssh/authorized_keys</span> on the remote machine for key-based authentication to work.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Utilizing a passphrase for OpenSSH keys is a key security practice, providing an extra layer of protection against unauthorized access and enhancing overall cybersecurity.</p>
</div>
<div class="paragraph">
<p>In case of loss or theft, this adds another layer of security.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="security-ssh-tunneling">16.7.3. SSH Tunneling<a class="anchor" href="#security-ssh-tunneling"></a></h3>
<div class="paragraph">
<p>OpenSSH has the ability to create a tunnel to encapsulate another protocol in an encrypted session.</p>
</div>
<div class="paragraph">
<p>The following command tells <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a> to create a tunnel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>ssh -D 8080 user@example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-D</dt>
<dd>
<p>Specifies a local &#34;dynamic&#34; application-level port forwarding.</p>
</dd>
<dt class="hdlist1"><a href="mailto:user@foo.example.com">user@foo.example.com</a></dt>
<dd>
<p>The login name to use on the specified remote SSH server.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An SSH tunnel works by creating a listen socket on <code>localhost</code> on the specified <code>localport</code>.</p>
</div>
<div class="paragraph">
<p>This method can be used to wrap any number of insecure TCP protocols such as SMTP, POP3, and FTP.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_the_ssh_server">16.7.4. Enabling the SSH Server<a class="anchor" href="#_enabling_the_ssh_server"></a></h3>
<div class="paragraph">
<p>In addition to providing built-in SSH client utilities, a FreeBSD system can be configured as an SSH server, accepting connections from other SSH clients.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As stated, this chapter will cover the base system version of OpenSSH. Please <strong>not</strong> confuse with <a class="package" href="https://cgit.freebsd.org/ports/tree/security/openssh-portable/">security/openssh-portable</a>, the version of OpenSSH that ships with the FreeBSD ports.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order to have the SSH Server enabled across reboots execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc sshd_enable=&#34;YES&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then execute the following command to enable the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service sshd start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first time sshd starts on a FreeBSD system, the system’s host keys will be automatically created and the fingerprint will be displayed on the console. Provide users with the fingerprint so that they can verify it the first time they connect to the server.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> for the list of available options when starting sshd and a more complete discussion about authentication, the login process, and the various configuration files.</p>
</div>
<div class="paragraph">
<p>At this point, the sshd should be available to all users with a username and password on the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="config-publickey-auth">16.7.5. Configuring publickey auth method<a class="anchor" href="#config-publickey-auth"></a></h3>
<div class="paragraph">
<p>Configuring OpenSSH to use public key authentication enhances security by leveraging asymmetric cryptography for authentication. This method eliminates password-related risks, such as weak passwords or interception during transmission, while thwarting various password-based attacks. However, it’s vital to ensure the private keys are well-protected to prevent unauthorized access.</p>
</div>
<div class="paragraph">
<p>The first step will be to configure <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> to use the required authentication method.</p>
</div>
<div class="paragraph">
<p>Edit <span class="filename">/etc/ssh/sshd_config</span> and uncomment the following configuration:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>PubkeyAuthentication yes</pre>
</div>
</div>
<div class="paragraph">
<p>Once the configuration is done, the users will have to send the system administrator their <strong>public key</strong> and these keys will be added in <span class="filename">.ssh/authorized_keys</span>. The process for generating the keys is described in <a href="#security-ssh-keygen">Key-based Authentication</a>.</p>
</div>
<div class="paragraph">
<p>Then restart the server executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service sshd reload</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is strongly recommended to follow the security improvements indicated in <a href="#security-sshd-security-options">SSH Server Security Options</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-sshd-security-options">16.7.6. SSH Server Security Options<a class="anchor" href="#security-sshd-security-options"></a></h3>
<div class="paragraph">
<p>While sshd is the most widely used remote administration facility for FreeBSD, brute force and drive by attacks are common to any system exposed to public networks.</p>
</div>
<div class="paragraph">
<p>Several additional parameters are available to prevent the success of these attacks and will be described in this section. All configurations will be done in <span class="filename">/etc/ssh/sshd_config</span></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not confuse <span class="filename">/etc/ssh/sshd_config</span> with <span class="filename">/etc/ssh/ssh_config</span> (note the extra <code>d</code> in the first filename). The first file configures the server and the second file configures the client. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5&amp;format=html">ssh_config(5)</a> for a listing of the available client settings.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By default, authentication can be done with both pubkey and password. To allow <strong>only</strong> pubkey authentication, <strong>which is strongly recommended</strong>, change the variable:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>PasswordAuthentication no</pre>
</div>
</div>
<div class="paragraph">
<p>It is a good idea to limit which users can log into the SSH server and from where using the <code>AllowUsers</code> keyword in the OpenSSH server configuration file. For example, to only allow <code>user</code> to log in from <code>192.168.1.32</code>, add this line to <span class="filename">/etc/ssh/sshd_config</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>AllowUsers user@192.168.1.32</pre>
</div>
</div>
<div class="paragraph">
<p>To allow <code>user</code> to log in from anywhere, list that user without specifying an IP address:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>AllowUsers user</pre>
</div>
</div>
<div class="paragraph">
<p>Multiple users should be listed on the same line, like so:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>AllowUsers root@192.168.1.32 user</pre>
</div>
</div>
<div class="paragraph">
<p>After making all the changes, and before restarting the service, it is recommended to verify that the configuration made is correct by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sshd -t</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the configuration file is correct, no output will be shown. In case the configuration file is incorrect, it will show something like this:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/etc/ssh/sshd_config: line 3: Bad configuration option: sdadasdasdasads
/etc/ssh/sshd_config: terminating, 1 bad configuration options</pre>
</div>
</div>
<div class="paragraph">
<p>After making the changes and checking that the configuration file is correct, tell sshd to reload its configuration file by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service sshd reload</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="openssl">16.8. OpenSSL<a class="anchor" href="#openssl"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenSSL is a cryptography toolkit implementing the Secure Sockets Layer (SSL) and Transport Layer Security (TLS) network protocols and many cryptography routines.</p>
</div>
<div class="paragraph">
<p>The openssl program is a command line tool for using the various cryptography functions of OpenSSL’s crypto library from the shell. It can be used for</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation and management of private keys, public keys and parameters</p>
</li>
<li>
<p>Public key cryptographic operations</p>
</li>
<li>
<p>Creation of X.509 certificates, CSRs and CRLs</p>
</li>
<li>
<p>Calculation of Message Digests</p>
</li>
<li>
<p>Encryption and Decryption with Ciphers</p>
</li>
<li>
<p>SSL/TLS Client and Server Tests</p>
</li>
<li>
<p>Handling of S/MIME signed or encrypted mail</p>
</li>
<li>
<p>Time Stamp requests, generation and verification</p>
</li>
<li>
<p>Benchmarking the crypto routines</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about OpenSSL, read the free <a href="https://www.feistyduck.com/books/openssl-cookbook/">OpenSSL Cookbook</a>.</p>
</div>
<div class="sect2">
<h3 id="generating-certificates">16.8.1. Generating Certificates<a class="anchor" href="#generating-certificates"></a></h3>
<div class="paragraph">
<p>OpenSSL supports the generation of certificates both to be validated by a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a> and for own use.</p>
</div>
<div class="paragraph">
<p>Run the command <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl&amp;sektion=1&amp;format=html">openssl(1)</a> to generate a valid certificate for a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a> with the following arguments. This command will create two files in the current directory. The certificate request, <span class="filename">req.pem</span>, can be sent to a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a> which, will validate the entered credentials, sign the request, and return the signed certificate. The second file, <span class="filename">cert.key</span>, is the private key for the certificate and should be stored in a secure location. If this falls in the hands of others, it can be used to impersonate the user or the server.</p>
</div>
<div class="paragraph">
<p>Execute the following command to generate the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># openssl req -new -nodes -out req.pem -keyout cert.key -sha3-512 -newkey rsa:4096</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Generating a RSA private key
..................................................................................................................................+++++
......................................+++++
writing new private key to &#39;cert.key&#39;
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &#39;.&#39;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:ES
State or Province Name (full name) [Some-State]:Valencian Community
Locality Name (eg, city) []:Valencia
Organization Name (eg, company) [Internet Widgits Pty Ltd]:My Company
Organizational Unit Name (eg, section) []:Systems Administrator
Common Name (e.g. server FQDN or YOUR name) []:localhost.example.org
Email Address []:user@FreeBSD.org

Please enter the following &#39;extra&#39; attributes
to be sent with your certificate request
A challenge password []:123456789
An optional company name []:Another name</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, if a signature from a <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a> is not required, a self-signed certificate can be created. This will create two new files in the current directory: a private key file <span class="filename">cert.key</span>, and the certificate itself, <span class="filename">cert.crt</span>. These should be placed in a directory, preferably under <span class="filename">/etc/ssl/</span>, which is readable only by <code>root</code>. Permissions of <code>0700</code> are appropriate for these files and can be set using <code>chmod</code>.</p>
</div>
<div class="paragraph">
<p>Execute the following command to generate the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># openssl req -new -x509 -days 365 -sha3-512 -keyout /etc/ssl/private/cert.key -out /etc/ssl/certs/cert.crt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Generating a RSA private key
........................................+++++
...........+++++
writing new private key to &#39;/etc/ssl/private/cert.key&#39;
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &#39;.&#39;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:ES
State or Province Name (full name) [Some-State]:Valencian Community
Locality Name (eg, city) []:Valencia
Organization Name (eg, company) [Internet Widgits Pty Ltd]:My Company
Organizational Unit Name (eg, section) []:Systems Administrator
Common Name (e.g. server FQDN or YOUR name) []:localhost.example.org
Email Address []:user@FreeBSD.org</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fips-provider">16.8.2. Configuring the FIPS Provider<a class="anchor" href="#fips-provider"></a></h3>
<div class="paragraph">
<p>With the import of OpenSSL 3 into the base system (on FreeBSD 14 and later), its new concept of provider modules was introduced in the system. Besides the default provider module built-in to the library, the <em>legacy</em> module implements the now optional deprecated cryptography algorithms, while the <em>fips</em> module restricts the OpenSSL implementation to the cryptography algorithms present in the <a href="https://en.wikipedia.org/wiki/Federal_Information_Processing_Standards">FIPS</a> set of standards. This part of OpenSSL receives <a href="https://www.openssl.org/docs/fips.html">particular care</a>, including a <a href="https://www.openssl.org/news/fips-cve.html">list of relevant security issues</a>, and is subject to the <a href="https://github.com/openssl/openssl/blob/master/README-FIPS.md">FIPS 140 validation process</a> on a regular basis. The <a href="https://www.openssl.org/source/">list of FIPS validated versions</a> is also available. This allows users to ensure FIPS compliance in their use of OpenSSL.</p>
</div>
<div class="paragraph">
<p>Importantly, the <a href="https://man.freebsd.org/cgi/man.cgi?query=fips_module&amp;sektion=7&amp;format=html">fips_module(7)</a> is protected by an additional security measure, preventing its use without passing an integrity check. This check can be setup by the local system administrator, allowing every user of OpenSSL 3 to load this module. When not configured correctly, the FIPS module is expected to fail as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo test | openssl aes-128-cbc -a -provider fips -pbkdf2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ouput should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>aes-128-cbc: unable to load provider fips
Hint: use -provider-path option or OPENSSL_MODULES environment variable.
00206124D94D0000:error:1C8000D5:Provider routines:SELF_TEST_post:missing config data:crypto/openssl/providers/fips/self_test.c:275:
00206124D94D0000:error:1C8000E0:Provider routines:ossl_set_error_state:fips module entering error state:crypto/openssl/providers/fips/self_test.c:373:
00206124D94D0000:error:1C8000D8:Provider routines:OSSL_provider_init_int:self test post failure:crypto/openssl/providers/fips/fipsprov.c:707:
00206124D94D0000:error:078C0105:common libcrypto routines:provider_init:init fail:crypto/openssl/crypto/provider_core.c:932:name=fips</pre>
</div>
</div>
<div class="paragraph">
<p>The check can be configured through the creation of a file in <span class="filename">/etc/ssl/fipsmodule.cnf</span>, which will then be referenced in OpenSSL’s main configuration file <span class="filename">/etc/ssl/openssl.cnf</span>. OpenSSL provides the <a href="https://man.freebsd.org/cgi/man.cgi?query=openssl-fipsinstall&amp;sektion=1&amp;format=html">openssl-fipsinstall(1)</a> utility to help with this process, which can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># openssl fipsinstall -module /usr/lib/ossl-modules/fips.so -out /etc/ssl/fipsmodule.cnf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ouput should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>INSTALL PASSED</pre>
</div>
</div>
<div class="paragraph">
<p>The <span class="filename">/etc/ssl/openssl.cnf</span> should then be modified, in order to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Include the <span class="filename">/etc/ssl/fipsmodule.cnf</span> file generated above,</p>
</li>
<li>
<p>Expose the FIPS module for possible use,</p>
</li>
<li>
<p>And explicitly activate the default module.</p>
</li>
</ul>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[...]
# For FIPS
# Optionally include a file that is generated by the OpenSSL fipsinstall
# application. This file contains configuration data required by the OpenSSL
# fips provider. It contains a named section e.g. [fips_sect] which is
# referenced from the [provider_sect] below.
# Refer to the OpenSSL security policy for more information.
.include /etc/ssl/fipsmodule.cnf

[...]

# List of providers to load
[provider_sect]
default = default_sect
# The fips section name should match the section name inside the
# included fipsmodule.cnf.
fips = fips_sect

# If no providers are activated explicitly, the default one is activated implicitly.
# See man 7 OSSL_PROVIDER-default for more details.
#
# If you add a section explicitly activating any other provider(s), you most
# probably need to explicitly activate the default provider, otherwise it
# becomes unavailable in openssl.  As a consequence applications depending on
# OpenSSL may not work correctly which could lead to significant system
# problems including inability to remotely access the system.
[default_sect]
activate = 1</pre>
</div>
</div>
<div class="paragraph">
<p>With this done, it should be possible to confirm that the FIPS module is effectively available and working:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo test | openssl aes-128-cbc -a -provider fips -pbkdf2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ouput should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>enter AES-128-CBC encryption password:
Verifying - enter AES-128-CBC encryption password:
U2FsdGVkX18idooW6e3LqWeeiKP76kufcOUClh57j8U=</pre>
</div>
</div>
<div class="paragraph">
<p>This procedure has to be repeated every time the FIPS module is modified, e.g., after performing system updates, or after applying security fixes affecting OpenSSL in the base system.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kerberos5">16.9. Kerberos<a class="anchor" href="#kerberos5"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kerberos is a network authentication protocol which was originally created by the Massachusetts Institute of Technology (MIT) as a way to securely provide authentication across a potentially hostile network. The Kerberos protocol uses strong cryptography so that both a client and server can prove their identity without sending any unencrypted secrets over the network. Kerberos can be described as an identity-verifying proxy system and as a trusted third-party authentication system. After a user authenticates with Kerberos, their communications can be encrypted to assure privacy and data integrity.</p>
</div>
<div class="paragraph">
<p>The only function of Kerberos is to provide the secure authentication of users and servers on the network. It does not provide authorization or auditing functions. It is recommended that Kerberos be used with other security methods which provide authorization and audit services.</p>
</div>
<div class="paragraph">
<p>The current version of the protocol is version 5, described in RFC 4120. Several free implementations of this protocol are available, covering a wide range of operating systems. MIT continues to develop their Kerberos package. It is commonly used in the US as a cryptography product, and has historically been subject to US export regulations. In FreeBSD, MITKerberos is available as the <a class="package" href="https://cgit.freebsd.org/ports/tree/security/krb5/">security/krb5</a> package or port. The Heimdal Kerberos implementation was explicitly developed outside of the US to avoid export regulations. The Heimdal Kerberos distribution is included in the base FreeBSD installation, and another distribution with more configurable options is available as <a class="package" href="https://cgit.freebsd.org/ports/tree/security/heimdal/">security/heimdal</a> in the Ports Collection.</p>
</div>
<div class="paragraph">
<p>In Kerberos users and services are identified as &#34;principals&#34; which are contained within an administrative grouping, called a &#34;realm&#34;. A typical user principal would be of the form <code><em>user</em>@<em>REALM</em></code> (realms are traditionally uppercase).</p>
</div>
<div class="paragraph">
<p>This section provides a guide on how to set up Kerberos using the Heimdal distribution included in FreeBSD.</p>
</div>
<div class="paragraph">
<p>For purposes of demonstrating a Kerberos installation, the name spaces will be as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The DNS domain (zone) will be <code>example.org</code>.</p>
</li>
<li>
<p>The Kerberos realm will be <code>EXAMPLE.ORG</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use real domain names when setting up Kerberos, even if it will run internally. This avoids DNS problems and assures inter-operation with other Kerberos realms.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_setting_up_a_heimdal_kdc">16.9.1. Setting up a Heimdal KDC<a class="anchor" href="#_setting_up_a_heimdal_kdc"></a></h3>
<div class="paragraph">
<p>The Key Distribution Center (KDC) is the centralized authentication service that Kerberos provides, the &#34;trusted third party&#34; of the system. It is the computer that issues Kerberos tickets, which are used for clients to authenticate to servers. As the KDC is considered trusted by all other computers in the Kerberos realm, it has heightened security concerns. Direct access to the KDC should be limited.</p>
</div>
<div class="paragraph">
<p>While running a KDC requires few computing resources, a dedicated machine acting only as a KDC is recommended for security reasons.</p>
</div>
<div class="paragraph">
<p>To begin, install the <a class="package" href="https://cgit.freebsd.org/ports/tree/security/heimdal/">security/heimdal</a> package as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg install heimdal</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, update <span class="filename">/etc/rc.conf</span> using <code>sysrc</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc kdc_enable=yes</span>
<span class="c"># sysrc kadmind_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, edit <span class="filename">/etc/krb5.conf</span> as follows:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[libdefaults]
    default_realm = EXAMPLE.ORG
[realms]
    EXAMPLE.ORG = {
	kdc = kerberos.example.org
	admin_server = kerberos.example.org
    }
[domain_realm]
    .example.org = EXAMPLE.ORG</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the KDC will use the fully-qualified hostname <code>kerberos.example.org</code>. The hostname of the KDC must be resolvable in the DNS.</p>
</div>
<div class="paragraph">
<p>Kerberos can also use the DNS to locate KDCs, instead of a <code>[realms]</code> section in <span class="filename">/etc/krb5.conf</span>. For large organizations that have their own DNS servers, the above example could be trimmed to:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[libdefaults]
      default_realm = EXAMPLE.ORG
[domain_realm]
    .example.org = EXAMPLE.ORG</pre>
</div>
</div>
<div class="paragraph">
<p>With the following lines being included in the <code>example.org</code> zone file:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>_kerberos._udp      IN  SRV     01 00 88 kerberos.example.org.
_kerberos._tcp      IN  SRV     01 00 88 kerberos.example.org.
_kpasswd._udp       IN  SRV     01 00 464 kerberos.example.org.
_kerberos-adm._tcp  IN  SRV     01 00 749 kerberos.example.org.
_kerberos           IN  TXT     EXAMPLE.ORG</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order for clients to be able to find the Kerberos services, they <em>must</em> have either a fully configured <span class="filename">/etc/krb5.conf</span> or a minimally configured <span class="filename">/etc/krb5.conf</span> <em>and</em> a properly configured DNS server.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Next, create the Kerberos database which contains the keys of all principals (users and hosts) encrypted with a master password. It is not required to remember this password as it will be stored in <span class="filename">/var/heimdal/m-key</span>; it would be reasonable to use a 45-character random password for this purpose. To create the master key, run <code>kstash</code> and enter a password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kstash</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Master key: xxxxxxxxxxxxxxxxxxxxxxx
Verifying password - Master key: xxxxxxxxxxxxxxxxxxxxxxx</pre>
</div>
</div>
<div class="paragraph">
<p>Once the master key has been created, the database should be initialized. The Kerberos administrative tool <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> can be used on the KDC in a mode that operates directly on the database, without using the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a> network service, as <code>kadmin -l</code>. This resolves the chicken-and-egg problem of trying to connect to the database before it is created. At the <code>kadmin</code> prompt, use <code>init</code> to create the realm’s initial database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kadmin -l</span>
<span class="gp">kadmin&gt; </span>init EXAMPLE.ORG
Realm max ticket life <span class="o">[</span>unlimited]:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, while still in <code>kadmin</code>, create the first principal using <code>add</code>. Stick to the default options for the principal for now, as these can be changed later with <code>modify</code>. Type <code>?</code> at the prompt to see the available options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">kadmin&gt; </span>add tillman</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
Password: xxxxxxxx
Verifying password - Password: xxxxxxxx</pre>
</div>
</div>
<div class="paragraph">
<p>Next, start the KDC services by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service kdc start</span>
<span class="c"># service kadmind start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While there will not be any kerberized daemons running at this point, it is possible to confirm that the KDC is functioning by obtaining a ticket for the principal that was just created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>kinit tillman</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>tillman@EXAMPLE.ORG&#39;s Password:</pre>
</div>
</div>
<div class="paragraph">
<p>Confirm that a ticket was successfully obtained using <code>klist</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>klist</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Credentials cache: FILE:/tmp/krb5cc_1001
	Principal: tillman@EXAMPLE.ORG

  Issued                Expires               Principal
Aug 27 15:37:58 2013  Aug 28 01:37:58 2013  krbtgt/EXAMPLE.ORG@EXAMPLE.ORG</pre>
</div>
</div>
<div class="paragraph">
<p>The temporary ticket can be destroyed when the test is finished:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>kdestroy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_a_server_to_use_kerberos">16.9.2. Configuring a Server to Use Kerberos<a class="anchor" href="#_configuring_a_server_to_use_kerberos"></a></h3>
<div class="paragraph">
<p>The first step in configuring a server to use Kerberos authentication is to ensure that it has the correct configuration in <span class="filename">/etc/krb5.conf</span>. The version from the KDC can be used as-is, or it can be regenerated on the new system.</p>
</div>
<div class="paragraph">
<p>Next, create <span class="filename">/etc/krb5.keytab</span> on the server. This is the main part of &#34;Kerberizing&#34; a service - it corresponds to generating a secret shared between the service and the KDC. The secret is a cryptographic key, stored in a &#34;keytab&#34;. The keytab contains the server’s host key, which allows it and the KDC to verify each others&#39; identity. It must be transmitted to the server in a secure fashion, as the security of the server can be broken if the key is made public. Typically, the <span class="filename">keytab</span> is generated on an administrator’s trusted machine using <code>kadmin</code>, then securely transferred to the server, e.g., with <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>; it can also be created directly on the server if that is consistent with the desired security policy. It is very important that the keytab is transmitted to the server in a secure fashion: if the key is known by some other party, that party can impersonate any user to the server! Using <code>kadmin</code> on the server directly is convenient, because the entry for the host principal in the KDC database is also created using <code>kadmin</code>.</p>
</div>
<div class="paragraph">
<p>Of course, <code>kadmin</code> is a kerberized service; a Kerberos ticket is needed to authenticate to the network service, but to ensure that the user running <code>kadmin</code> is actually present (and their session has not been hijacked), <code>kadmin</code> will prompt for the password to get a fresh ticket. The principal authenticating to the kadmin service must be permitted to use the <code>kadmin</code> interface, as specified in <span class="filename">/var/heimdal/kadmind.acl</span>. See the section titled &#34;Remote administration&#34; in <code>info heimdal</code> for details on designing access control lists. Instead of enabling remote <code>kadmin</code> access, the administrator could securely connect to the KDC via the local console or <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, and perform administration locally using <code>kadmin -l</code>.</p>
</div>
<div class="paragraph">
<p>After installing <span class="filename">/etc/krb5.conf</span>, use <code>add --random-key</code> in <code>kadmin</code>. This adds the server’s host principal to the database, but does not extract a copy of the host principal key to a keytab. To generate the keytab, use <code>ext</code> to extract the server’s host principal key to its own keytab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kadmin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>kadmin&gt; add --random-key host/myserver.example.org
Max ticket life [unlimited]:
Max renewable life [unlimited]:
Principal expiration time [never]:
Password expiration time [never]:
Attributes []:
kadmin&gt; ext_keytab host/myserver.example.org
kadmin&gt; exit</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>ext_keytab</code> stores the extracted key in <span class="filename">/etc/krb5.keytab</span> by default. This is good when being run on the server being kerberized, but the <code>--keytab <em>path/to/file</em></code> argument should be used when the keytab is being extracted elsewhere:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kadmin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>kadmin&gt; ext_keytab --keytab=/tmp/example.keytab host/myserver.example.org
kadmin&gt; exit</pre>
</div>
</div>
<div class="paragraph">
<p>The keytab can then be securely copied to the server using <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a> or a removable media. Be sure to specify a non-default keytab name to avoid inserting unneeded keys into the system’s keytab.</p>
</div>
<div class="paragraph">
<p>At this point, the server can read encrypted messages from the KDC using its shared key, stored in <span class="filename">krb5.keytab</span>. It is now ready for the Kerberos-using services to be enabled. One of the most common such services is <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a>, which supports Kerberos via the GSS-API. In <span class="filename">/etc/ssh/sshd_config</span>, add the line:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>GSSAPIAuthentication yes</pre>
</div>
</div>
<div class="paragraph">
<p>After making this change, <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> must be restarted for the new configuration to take effect: <code>service sshd restart</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_a_client_to_use_kerberos">16.9.3. Configuring a Client to Use Kerberos<a class="anchor" href="#_configuring_a_client_to_use_kerberos"></a></h3>
<div class="paragraph">
<p>As it was for the server, the client requires configuration in <span class="filename">/etc/krb5.conf</span>. Copy the file in place (securely) or re-enter it as needed.</p>
</div>
<div class="paragraph">
<p>Test the client by using <code>kinit</code>, <code>klist</code>, and <code>kdestroy</code> from the client to obtain, show, and then delete a ticket for an existing principal. Kerberos applications should also be able to connect to Kerberos enabled servers. If that does not work but obtaining a ticket does, the problem is likely with the server and not with the client or the KDC. In the case of kerberized <a href="https://man.freebsd.org/cgi/man.cgi?query=ssh&amp;sektion=1&amp;format=html">ssh(1)</a>, GSS-API is disabled by default, so test using <code>ssh -o GSSAPIAuthentication=yes <em>hostname</em></code>.</p>
</div>
<div class="paragraph">
<p>When testing a Kerberized application, try using a packet sniffer such as <code>tcpdump</code> to confirm that no sensitive information is sent in the clear.</p>
</div>
<div class="paragraph">
<p>Various Kerberos client applications are available. With the advent of a bridge so that applications using SASL for authentication can use GSS-API mechanisms as well, large classes of client applications can use Kerberos for authentication, from Jabber clients to IMAP clients.</p>
</div>
<div class="paragraph">
<p>Users within a realm typically have their Kerberos principal mapped to a local user account. Occasionally, one needs to grant access to a local user account to someone who does not have a matching Kerberos principal. For example, <code>tillman@EXAMPLE.ORG</code> may need access to the local user account <code>webdevelopers</code>. Other principals may also need access to that local account.</p>
</div>
<div class="paragraph">
<p>The <span class="filename">.k5login</span> and <span class="filename">.k5users</span> files, placed in a user’s home directory, can be used to solve this problem. For example, if the following <span class="filename">.k5login</span> is placed in the home directory of <code>webdevelopers</code>, both principals listed will have access to that account without requiring a shared password:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>tillman@example.org
jdoe@example.org</pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=ksu&amp;sektion=1&amp;format=html">ksu(1)</a> for more information about <span class="filename">.k5users</span>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mit_differences">16.9.4. MIT Differences<a class="anchor" href="#_mit_differences"></a></h3>
<div class="paragraph">
<p>The major difference between the MIT and Heimdal implementations is that <code>kadmin</code> has a different, but equivalent, set of commands and uses a different protocol. If the KDC is MIT, the Heimdal version of <code>kadmin</code> cannot be used to administer the KDC remotely, and vice versa.</p>
</div>
<div class="paragraph">
<p>Client applications may also use slightly different command line options to accomplish the same tasks. Following the instructions at <a href="http://web.mit.edu/Kerberos/www/">http://web.mit.edu/Kerberos/www/</a> is recommended. Be careful of path issues: the MIT port installs into <span class="filename">/usr/local/</span> by default, and the FreeBSD system applications run instead of the MIT versions if <code>PATH</code> lists the system directories first.</p>
</div>
<div class="paragraph">
<p>When using MIT Kerberos as a KDC on FreeBSD, execute the following commands to add the required configurations to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc kdc_program=&#34;/usr/local/sbin/kdc&#34;</span>
<span class="c"># sysrc kadmind_program=&#34;/usr/local/sbin/kadmind&#34;</span>
<span class="c"># sysrc kdc_flags=&#34;&#34;</span>
<span class="c"># sysrc kdc_enable=&#34;YES&#34;</span>
<span class="c"># sysrc kadmind_enable=&#34;YES&#34;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kerberos_tips_tricks_and_troubleshooting">16.9.5. Kerberos Tips, Tricks, and Troubleshooting<a class="anchor" href="#_kerberos_tips_tricks_and_troubleshooting"></a></h3>
<div class="paragraph">
<p>When configuring and troubleshooting Kerberos, keep the following points in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When using either Heimdal or MITKerberos from ports, ensure that the <code>PATH</code> lists the port’s versions of the client applications before the system versions.</p>
</li>
<li>
<p>If all the computers in the realm do not have synchronized time settings, authentication may fail. <a href="../network-servers/#network-ntp">“Clock Synchronization with NTP”</a> describes how to synchronize clocks using NTP.</p>
</li>
<li>
<p>If the hostname is changed, the <code>host/</code> principal must be changed and the keytab updated. This also applies to special keytab entries like the <code>HTTP/</code> principal used for Apache’s <a class="package" href="https://cgit.freebsd.org/ports/tree/www/mod_auth_kerb/">www/mod_auth_kerb</a>.</p>
</li>
<li>
<p>All hosts in the realm must be both forward and reverse resolvable in DNS or, at a minimum, exist in <span class="filename">/etc/hosts</span>. CNAMEs will work, but the A and PTR records must be correct and in place. The error message for unresolvable hosts is not intuitive: <code>Kerberos5 refuses authentication because Read req failed: Key table entry not found</code>.</p>
</li>
<li>
<p>Some operating systems that act as clients to the KDC do not set the permissions for <code>ksu</code> to be setuid <code>root</code>. This means that <code>ksu</code> does not work. This is a permissions problem, not a KDC error.</p>
</li>
<li>
<p>With MITKerberos, to allow a principal to have a ticket life longer than the default lifetime of ten hours, use <code>modify_principal</code> at the <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmin&amp;sektion=8&amp;format=html">kadmin(8)</a> prompt to change the <code>maxlife</code> of both the principal in question and the <code>krbtgt</code> principal. The principal can then use <code>kinit -l</code> to request a ticket with a longer lifetime.</p>
</li>
<li>
<p>When running a packet sniffer on the KDC to aid in troubleshooting while running <code>kinit</code> from a workstation, the Ticket Granting Ticket (TGT) is sent immediately, even before the password is typed. This is because the Kerberos server freely transmits a TGT to any unauthorized request. However, every TGT is encrypted in a key derived from the user’s password. When a user types their password, it is not sent to the KDC, it is instead used to decrypt the TGT that <code>kinit</code> already obtained. If the decryption process results in a valid ticket with a valid time stamp, the user has valid Kerberos credentials. These credentials include a session key for establishing secure communications with the Kerberos server in the future, as well as the actual TGT, which is encrypted with the Kerberos server’s own key. This second layer of encryption allows the Kerberos server to verify the authenticity of each TGT.</p>
</li>
<li>
<p>Host principals can have a longer ticket lifetime. If the user principal has a lifetime of a week but the host being connected to has a lifetime of nine hours, the user cache will have an expired host principal and the ticket cache will not work as expected.</p>
</li>
<li>
<p>When setting up <span class="filename">krb5.dict</span> to prevent specific bad passwords from being used as described in <a href="https://man.freebsd.org/cgi/man.cgi?query=kadmind&amp;sektion=8&amp;format=html">kadmind(8)</a>, remember that it only applies to principals that have a password policy assigned to them. The format used in <span class="filename">krb5.dict</span> is one string per line. Creating a symbolic link to <span class="filename">/usr/share/dict/words</span> might be useful.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_mitigating_kerberos_limitations">16.9.6. Mitigating Kerberos Limitations<a class="anchor" href="#_mitigating_kerberos_limitations"></a></h3>
<div class="paragraph">
<p>Since Kerberos is an all or nothing approach, every service enabled on the network must either be modified to work with Kerberos or be otherwise secured against network attacks. This is to prevent user credentials from being stolen and re-used. An example is when Kerberos is enabled on all remote shells but the non-Kerberized POP3 mail server sends passwords in plain text.</p>
</div>
<div class="paragraph">
<p>The KDC is a single point of failure. By design, the KDC must be as secure as its master password database. The KDC should have absolutely no other services running on it and should be physically secure. The danger is high because Kerberos stores all passwords encrypted with the same master key which is stored as a file on the KDC.</p>
</div>
<div class="paragraph">
<p>A compromised master key is not quite as bad as one might fear. The master key is only used to encrypt the Kerberos database and as a seed for the random number generator. As long as access to the KDC is secure, an attacker cannot do much with the master key.</p>
</div>
<div class="paragraph">
<p>If the KDC is unavailable, network services are unusable as authentication cannot be performed. This can be alleviated with a single master KDC and one or more slaves, and with careful implementation of secondary or fall-back authentication using PAM.</p>
</div>
<div class="paragraph">
<p>Kerberos allows users, hosts and services to authenticate between themselves. It does not have a mechanism to authenticate the KDC to the users, hosts, or services. This means that a trojaned <code>kinit</code> could record all user names and passwords. File system integrity checking tools like <a class="package" href="https://cgit.freebsd.org/ports/tree/security/tripwire/">security/tripwire</a> can alleviate this.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resources_and_further_information">16.9.7. Resources and Further Information<a class="anchor" href="#_resources_and_further_information"></a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.faqs.org/faqs/Kerberos-faq/general/preamble.html">The Kerberos FAQ</a></p>
</li>
<li>
<p><a href="http://web.mit.edu/Kerberos/www/dialogue.html">Designing an Authentication System: a Dialog in Four Scenes</a></p>
</li>
<li>
<p><a href="https://www.ietf.org/rfc/rfc4120.txt">RFC 4120, The Kerberos Network Authentication Service (V5)</a></p>
</li>
<li>
<p><a href="http://web.mit.edu/Kerberos/www/">MIT Kerberos home page</a></p>
</li>
<li>
<p><a href="https://github.com/heimdal/heimdal/wiki">Heimdal Kerberos project wiki page</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tcpwrappers">16.10. TCP Wrappers<a class="anchor" href="#tcpwrappers"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>TCP Wrappers is a host-based network access control system. By intercepting incoming network requests before they reach the actual network service, TCP Wrappers assess whether the source IP address is permitted or denied access based on predefined rules in configuration files.</p>
</div>
<div class="paragraph">
<p>However, while TCP Wrappers provide basic access control, they should not be considered a substitute for more robust security measures. For comprehensive protection, it’s recommended to use advanced technologies like firewalls, along with proper user authentication practices and intrusion detection systems.</p>
</div>
<div class="sect2">
<h3 id="tcpwrappers-initial-configuration">16.10.1. Initial Configuration<a class="anchor" href="#tcpwrappers-initial-configuration"></a></h3>
<div class="paragraph">
<p>TCP Wrappers are enabled by default in <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a>. So the first step will be to enable <a href="https://man.freebsd.org/cgi/man.cgi?query=inetd&amp;sektion=8&amp;format=html">inetd(8)</a> executing the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc inetd_enable=&#34;YES&#34;</span>
<span class="c"># service inetd start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, properly configure <span class="filename">/etc/hosts.allow</span>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike other implementations of TCP Wrappers, the use of <span class="filename">hosts.deny</span> is deprecated in FreeBSD. All configuration options should be placed in <span class="filename">/etc/hosts.allow</span>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the simplest configuration, daemon connection policies are set to either permit or block, depending on the options in <span class="filename">/etc/hosts.allow</span>. The default configuration in FreeBSD is to allow all connections to the daemons started with inetd.</p>
</div>
<div class="paragraph">
<p>Basic configuration usually takes the form of <code>daemon : address : action</code>, where <code>daemon</code> is the daemon which inetd started, <code>address</code> is a valid hostname, IP address, or an IPv6 address enclosed in brackets ([ ]), and <code>action</code> is either <code>allow</code> or <code>deny</code>. TCP Wrappers uses a first rule match semantic, meaning that the configuration file is scanned from the beginning for a matching rule. When a match is found, the rule is applied and the search process stops.</p>
</div>
<div class="paragraph">
<p>For example, to allow POP3 connections via the <a class="package" href="https://cgit.freebsd.org/ports/tree/mail/qpopper/">mail/qpopper</a> daemon, the following lines should be appended to <span class="filename">/etc/hosts.allow</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># This line is required for POP3 connections:
qpopper : ALL : allow</pre>
</div>
</div>
<div class="paragraph">
<p>Whenever this file is edited, restart inetd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service inetd restart</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tcpwrappers-advanced-config">16.10.2. Advanced Configuration<a class="anchor" href="#tcpwrappers-advanced-config"></a></h3>
<div class="paragraph">
<p>TCP Wrappers provides advanced options to allow more control over the way connections are handled. In some cases, it may be appropriate to return a comment to certain hosts or daemon connections. In other cases, a log entry should be recorded or an email sent to the administrator. Other situations may require the use of a service for local connections only. This is all possible through the use of configuration options known as wildcards, expansion characters, and external command execution. To learn more about wildcards and their associated functionality, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hosts_access&amp;sektion=5&amp;format=html">hosts_access(5)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fs-acl">16.11. Access Control Lists<a class="anchor" href="#fs-acl"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Access Control Lists (ACLs) extend traditional UNIX® file permissions by allowing fine-grained access control for users and groups on a per-file or per-directory basis. Each ACL entry defines a user or group and the associated permissions, such as read, write, and execute. FreeBSD provides commands like <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> to manage ACLs.</p>
</div>
<div class="paragraph">
<p>ACLs are useful in scenarios requiring more specific access control than standard permissions, commonly used in multi-user environments or shared hosting. However, complexity may be unavoidable, but careful planning is required to ensure that the desired security properties are being provided</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>FreeBSD supports the implementation of NFSv4 ACLs in both UFS and OpenZFS. Please note that some arguments to the <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> command only work with POSIX ACLs and others in NFSv4 ACLs.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="acl-enabling-support-ufs">16.11.1. Enabling ACL Support in UFS<a class="anchor" href="#acl-enabling-support-ufs"></a></h3>
<div class="paragraph">
<p>ACLs are enabled by the mount-time administrative flag, <code>acls</code>, which may be added to <span class="filename">/etc/fstab</span>.</p>
</div>
<div class="paragraph">
<p>Therefore it will be necessary to access <span class="filename">/etc/fstab</span> and in the options section add the <code>acls</code> flag as follows:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Device        Mountpoint        FStype    Options     Dump      Pass#
/dev/ada0s1a    /                 ufs       rw,acls     1         1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-acl-info">16.11.2. Get ACLs information<a class="anchor" href="#security-acl-info"></a></h3>
<div class="paragraph">
<p>It is possible to check the ACLs of a file or a directory using <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a>.</p>
</div>
<div class="paragraph">
<p>For example, to view the ACL settings on <span class="filename">~/test</span> file execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>getfacl <span class="nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following in case of using NFSv4 ACLs:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># file: test
# owner: freebsduser
# group: freebsduser
            owner@:rw-p--aARWcCos:-------:allow
            group@:r-----a-R-c--s:-------:allow
         everyone@:r-----a-R-c--s:-------:allow</pre>
</div>
</div>
<div class="paragraph">
<p>And the output should be similar to the following in case of using POSIX.1e ACLs:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># file: test
# owner: freebsduser
# group: freebsduser
user::rw-
group::r--
other::r--</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-working-acls">16.11.3. Working with ACLs<a class="anchor" href="#security-working-acls"></a></h3>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> can be used to add, modify or remove ACLs from a file or directory.</p>
</div>
<div class="paragraph">
<p>As noted above, some arguments to <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> do not work with NFSv4 ACLs, and vice versa. This section covers how to execute the commands for POSIX ACLs and for NFSv4 ACLs and shows examples of both.</p>
</div>
<div class="paragraph">
<p>For example, to set the mandatory elements of the POSIX.1e default ACL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>setfacl -d -m u::rwx,g::rx,o::rx,mask::rwx directory</code></pre>
</div>
</div>
<div class="paragraph">
<p>This other example sets read, write, and execute permissions for the file owner’s POSIX.1e ACL entry and read and write permissions for group mail on file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>setfacl -m u::rwx,g:mail:rw file</code></pre>
</div>
</div>
<div class="paragraph">
<p>To do the same as in the previous example but in NFSv4 ACL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>setfacl -m owner@:rwxp::allow,g:mail:rwp::allow file</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove all ACL entries except for the three required from file in POSIX.1e ACL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>setfacl -bn file</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove all ACL entries in NFSv4 ACL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>setfacl -b file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=getfacl&amp;sektion=1&amp;format=html">getfacl(1)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=setfacl&amp;sektion=1&amp;format=html">setfacl(1)</a> for more information about the options available for these commands.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capsicum">16.12. Capsicum<a class="anchor" href="#capsicum"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Capsicum is a lightweight OS capability and sandbox framework implementing a hybrid capability system model. Capabilities are unforgeable tokens of authority that can be delegated and must be presented to perform an action. Capsicum makes file descriptors into capabilities.</p>
</div>
<div class="paragraph">
<p>Capsicum can be used for application and library compartmentalisation, the decomposition of larger bodies of software into isolated (sandboxed) components in order to implement security policies and limit the impact of software vulnerabilities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-accounting">16.13. Process Accounting<a class="anchor" href="#security-accounting"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Process accounting is a security method in which an administrator may keep track of system resources used and their allocation among users, provide for system monitoring, and minimally track a user’s commands.</p>
</div>
<div class="paragraph">
<p>Process accounting has both positive and negative points. One of the positives is that an intrusion may be narrowed down to the point of entry. A negative is the amount of logs generated by process accounting, and the disk space they may require. This section walks an administrator through the basics of process accounting.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If more fine-grained accounting is needed, refer to <a href="../audit/#audit">Security Event Auditing</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_enabling_and_utilizing_process_accounting">16.13.1. Enabling and Utilizing Process Accounting<a class="anchor" href="#_enabling_and_utilizing_process_accounting"></a></h3>
<div class="paragraph">
<p>Before using process accounting, it must be enabled using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc accounting_enable=yes</span>
<span class="c"># service accounting start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The accounting information is stored in files located in <span class="filename">/var/account</span>, which is automatically created, if necessary, the first time the accounting service starts. These files contain sensitive information, including all the commands issued by all users. Write access to the files is limited to <code>root</code>, and read access is limited to <code>root</code> and members of the <code>wheel</code> group. To also prevent members of <code>wheel</code> from reading the files, change the mode of the <span class="filename">/var/account</span> directory to allow access only by <code>root</code>.</p>
</div>
<div class="paragraph">
<p>Once enabled, accounting will begin to track information such as CPU statistics and executed commands. All accounting logs are in a non-human readable format which can be viewed using <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a>. If issued without any options, <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> prints information relating to the number of per-user calls, the total elapsed time in minutes, total CPU and user time in minutes, and the average number of I/O operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a> for the list of available options which control the output.</p>
</div>
<div class="paragraph">
<p>To display the commands issued by users, use <code>lastcomm</code>.</p>
</div>
<div class="paragraph">
<p>For example, this command prints out all usage of <code>ls</code> by <code>trhodes</code> on the <code>ttyp1</code> terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># lastcomm ls trhodes ttyp1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Many other useful options exist and are explained in <a href="https://man.freebsd.org/cgi/man.cgi?query=lastcomm&amp;sektion=1&amp;format=html">lastcomm(1)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=acct&amp;sektion=5&amp;format=html">acct(5)</a>, and <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=8&amp;format=html">sa(8)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-resourcelimits">16.14. Resource Limits<a class="anchor" href="#security-resourcelimits"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In FreeBSD, resource limits refer to the mechanisms that control and manage the allocation of various system resources to processes and users. These limits are designed to prevent a single process or user from consuming an excessive amount of resources, which could lead to performance degradation or system instability. Resource limits help ensure fair resource distribution among all active processes and users on the system.</p>
</div>
<div class="paragraph">
<p>FreeBSD provides several methods for an administrator to limit the amount of system resources an individual may use.</p>
</div>
<div class="paragraph">
<p>The traditional method defines login classes by editing <span class="filename">/etc/login.conf</span>. While this method is still supported, any changes require a multi-step process of editing this file, rebuilding the resource database, making necessary changes to <span class="filename">/etc/master.passwd</span>, and rebuilding the password database. This can become time consuming, depending upon the number of users to configure.</p>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> can be used to provide a more fine-grained method for controlling resource limits. This command supports more than user limits as it can also be used to set resource constraints on processes and jails.</p>
</div>
<div class="paragraph">
<p>This section demonstrates both methods for controlling resources, beginning with the traditional method.</p>
</div>
<div class="sect2">
<h3 id="security-resource-limits-types">16.14.1. Types of Resources<a class="anchor" href="#security-resource-limits-types"></a></h3>
<div class="paragraph">
<p>FreeBSD provides limits for various types of resources, including:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">表 1. Resource types</caption>
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits the amount of CPU time a process can consume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the amount of physical memory a process can use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits the number of files a process can have open simultaneously</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the number of processes a user or a process can create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits the maximum size of files that a process can create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core Dumps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether processes are allowed to generate core dump files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limits the amount of network resources (e.g., sockets) a process can use</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For a full listing of types see <a href="https://man.freebsd.org/cgi/man.cgi?query=login.conf&amp;sektion=5&amp;format=html">login.conf(5)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="users-limiting">16.14.2. Configuring Login Classes<a class="anchor" href="#users-limiting"></a></h3>
<div class="paragraph">
<p>In the traditional method, login classes and the resource limits to apply to a login class are defined in <span class="filename">/etc/login.conf</span>. Each user account can be assigned to a login class, where <code>default</code> is the default login class. Each login class has a set of login capabilities associated with it. A login capability is a <code><em>name</em>=<em>value</em></code> pair, where <em>name</em> is a well-known identifier and <em>value</em> is an arbitrary string which is processed accordingly depending on the <em>name</em>.</p>
</div>
<div class="paragraph">
<p>The first step to configure a resource limit will be to open <span class="filename">/etc/login.conf</span> by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ee /etc/login.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then locate the section for the user class to be modified. In this example, let’s assume the user class is named <code>limited</code>, create it in case it not exists.</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>limited:\ <i class="conum" data-value="1"></i><b>(1)</b>
        :maxproc=50:\ <i class="conum" data-value="2"></i><b>(2)</b>
        :tc=default: <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the user class. &lt;.&gt; Sets the maximum number of processes (maxproc) to 50 for users in the <code>limited</code> class. &lt;.&gt; Indicates that this user class inherits the default settings from the &#34;default&#34; class.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>After modifying the <span class="filename">/etc/login.conf</span> file, run <a href="https://man.freebsd.org/cgi/man.cgi?query=cap_mkdb&amp;sektion=1&amp;format=html">cap_mkdb(1)</a> to generate the database that FreeBSD uses to apply these settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cap_mkdb /etc/login.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=chpass&amp;sektion=1&amp;format=html">chpass(1)</a> can be used to change the class to the desired user executint the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chpass username</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will open a text editor, add the new <code>limited</code> class there as follows:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#Changing user information for username.
Login: username
Password: $6$2H.419USdGaiJeqK$6kgcTnDadasdasd3YnlNZsOni5AMymibkAfRCPirc7ZFjjv
DVsKyXx26daabdfqSdasdsmL/ZMUpdHiO0
Uid [#]: 1001
Gid [# or name]: 1001
Change [month day year]:
Expire [month day year]:
Class: limited
Home directory: /home/username
Shell: /bin/sh
Full Name: User &amp;
Office Location:
Office Phone:
Home Phone:
Other information:</pre>
</div>
</div>
<div class="paragraph">
<p>Now, the user assigned to the <code>limited</code> class will have a maximum process limit of 50. Remember that this is just one example of setting a resource limit using the <span class="filename">/etc/login.conf</span> file.</p>
</div>
<div class="paragraph">
<p>Keep in mind that after making changes to the <span class="filename">/etc/login.conf</span> file, the user needs to log out and log back in for the changes to take effect. Additionally, always exercise caution when editing system configuration files, especially when using privileged access.</p>
</div>
</div>
<div class="sect2">
<h3 id="security-rctl">16.14.3. Enabling and Configuring Resource Limits<a class="anchor" href="#security-rctl"></a></h3>
<div class="paragraph">
<p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> system provides a more fine-grained way to set and manage resource limits for individual processes and users. It allows you to dynamically assign resource limits to specific processes or users, regardless of their user class.</p>
</div>
<div class="paragraph">
<p>The first step to use <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> will be to enable it adding the following line to <span class="filename">/boot/loader.conf</span> and reboot the system:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>kern.racct.enable=1</pre>
</div>
</div>
<div class="paragraph">
<p>Then active the <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> service and enable it executing by the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc rctl_enable=&#34;YES&#34;</span>
<span class="c"># service rctl start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> may be used to set rules for the system.</p>
</div>
<div class="paragraph">
<p>Rule syntax (<a href="https://man.freebsd.org/cgi/man.cgi?query=rctl.conf&amp;sektion=5&amp;format=html">rctl.conf(5)</a>) is controlled through the use of a subject, subject-id, resource, and action, as seen in this example rule:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>subject:subject-id:resource:action=amount/per</pre>
</div>
</div>
<div class="paragraph">
<p>For example to constrained the user to add no more than 10 processes execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># rctl -a user:username:maxproc:deny=10/user</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the applied resource limits the <a href="https://man.freebsd.org/cgi/man.cgi?query=rctl&amp;sektion=8&amp;format=html">rctl(8)</a> command can be executed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># rctl</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>user:username:maxproc:deny=10</pre>
</div>
</div>
<div class="paragraph">
<p>Rules will persist across reboots if they have been added to <span class="filename">/etc/rctl.conf</span>. The format is a rule, without the preceding command. For example, the previous rule could be added as:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>user:username:maxproc:deny=10</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-pkg">16.15. Monitoring Third Party Security Issues<a class="anchor" href="#security-pkg"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In recent years, the security world has made many improvements to how vulnerability assessment is handled. The threat of system intrusion increases as third party utilities are installed and configured for virtually any operating system available today.</p>
</div>
<div class="paragraph">
<p>Vulnerability assessment is a key factor in security. While FreeBSD releases advisories for the base system, doing so for every third party utility is beyond the FreeBSD Project’s capability. There is a way to mitigate third party vulnerabilities and warn administrators of known security issues. A FreeBSD add on utility known as pkg includes options explicitly for this purpose.</p>
</div>
<div class="paragraph">
<p>pkg polls a database for security issues. The database is updated and maintained by the FreeBSD Security Team and ports developers.</p>
</div>
<div class="paragraph">
<p>Installation provides <a href="https://man.freebsd.org/cgi/man.cgi?query=periodic&amp;sektion=8&amp;format=html">periodic(8)</a> configuration files for maintaining the pkg audit database, and provides a programmatic method of keeping it updated.</p>
</div>
<div class="paragraph">
<p>After installation, and to audit third party utilities as part of the Ports Collection at any time, an administrator may choose to update the database and view known vulnerabilities of installed packages by invoking:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>pkg audit -F</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should be similar to the following:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vulnxml file up-to-date
chromium-116.0.5845.96_1 is vulnerable:
  chromium -- multiple vulnerabilities
  CVE: CVE-2023-4431
  CVE: CVE-2023-4427
  CVE: CVE-2023-4428
  CVE: CVE-2023-4429
  CVE: CVE-2023-4430
  WWW: https://vuxml.FreeBSD.org/freebsd/5fa332b9-4269-11ee-8290-a8a1599412c6.html

samba413-4.13.17_5 is vulnerable:
  samba -- multiple vulnerabilities
  CVE: CVE-2023-3347
  CVE: CVE-2023-34966
  CVE: CVE-2023-34968
  CVE: CVE-2022-2127
  CVE: CVE-2023-34967
  WWW: https://vuxml.FreeBSD.org/freebsd/441e1e1a-27a5-11ee-a156-080027f5fec9.html

2 problem(s) in 2 installed package(s) found.</pre>
</div>
</div>
<div class="paragraph">
<p>By pointing a web browser to the displayed URL, an administrator may obtain more information about the vulnerability.</p>
</div>
<div class="paragraph">
<p>This will include the versions affected, by FreeBSD port version, along with other web sites which may contain security advisories.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-advisories">16.16. FreeBSD Security Advisories<a class="anchor" href="#security-advisories"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like many producers of quality operating systems, the FreeBSD Project has a security team which is responsible for determining the End-of-Life (EoL) date for each FreeBSD release and to provide security updates for supported releases which have not yet reached their EoL. More information about the FreeBSD security team and the supported releases is available on the <a href="https://www.FreeBSD.org/security">FreeBSD security page</a>.</p>
</div>
<div class="paragraph">
<p>One task of the security team is to respond to reported security vulnerabilities in the FreeBSD operating system. Once a vulnerability is confirmed, the security team verifies the steps necessary to fix the vulnerability and updates the source code with the fix. It then publishes the details as a &#34;Security Advisory&#34;. Security advisories are published on the <a href="https://www.FreeBSD.org/security/advisories/">FreeBSD website</a> and mailed to the {freebsd-security-notifications}, {freebsd-security}, and {freebsd-announce}.</p>
</div>
<div class="sect2">
<h3 id="_format_of_a_security_advisory">16.16.1. Format of a Security Advisory<a class="anchor" href="#_format_of_a_security_advisory"></a></h3>
<div class="paragraph">
<p>Here is an example of a FreeBSD security advisory:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

=============================================================================
FreeBSD-SA-23:07.bhyve                                      Security Advisory
                                                          The FreeBSD Project

Topic:          bhyve privileged guest escape via fwctl

Category:       core
Module:         bhyve
Announced:      2023-08-01
Credits:        Omri Ben Bassat and Vladimir Eli Tokarev from Microsoft
Affects:        FreeBSD 13.1 and 13.2
Corrected:      2023-08-01 19:48:53 UTC (stable/13, 13.2-STABLE)
                2023-08-01 19:50:47 UTC (releng/13.2, 13.2-RELEASE-p2)
                2023-08-01 19:48:26 UTC (releng/13.1, 13.1-RELEASE-p9)
CVE Name:       CVE-2023-3494

For general information regarding FreeBSD Security Advisories,
including descriptions of the fields above, security branches, and the
following sections, please visit &lt;URL:https://security.FreeBSD.org/&gt;.

I.   Background

bhyve(8)&#39;s fwctl interface provides a mechanism through which guest
firmware can query the hypervisor for information about the virtual
machine.  The fwctl interface is available to guests when bhyve is run
with the &#34;-l bootrom&#34; option, used for example when booting guests in
UEFI mode.

bhyve is currently only supported on the amd64 platform.

II.  Problem Description

The fwctl driver implements a state machine which is executed when the
guest accesses certain x86 I/O ports.  The interface lets the guest copy
a string into a buffer resident in the bhyve process&#39; memory.  A bug in
the state machine implementation can result in a buffer overflowing when
copying this string.

III. Impact

A malicious, privileged software running in a guest VM can exploit the
buffer overflow to achieve code execution on the host in the bhyve
userspace process, which typically runs as root.  Note that bhyve runs
in a Capsicum sandbox, so malicious code is constrained by the
capabilities available to the bhyve process.

IV.  Workaround

No workaround is available.  bhyve guests that are executed without the
&#34;-l bootrom&#34; option are unaffected.

V.   Solution

Upgrade your vulnerable system to a supported FreeBSD stable or
release / security branch (releng) dated after the correction date.

Perform one of the following:

1) To update your vulnerable system via a binary patch:

Systems running a RELEASE version of FreeBSD on the amd64, i386, or
(on FreeBSD 13 and later) arm64 platforms can be updated via the
freebsd-update(8) utility:

# freebsd-update fetch
# freebsd-update install

Restart all affected virtual machines.

2) To update your vulnerable system via a source code patch:

The following patches have been verified to apply to the applicable
FreeBSD release branches.

a) Download the relevant patch from the location below, and verify the
detached PGP signature using your PGP utility.

[FreeBSD 13.2]
# fetch https://security.FreeBSD.org/patches/SA-23:07/bhyve.13.2.patch
# fetch https://security.FreeBSD.org/patches/SA-23:07/bhyve.13.2.patch.asc
# gpg --verify bhyve.13.2.patch.asc

[FreeBSD 13.1]
# fetch https://security.FreeBSD.org/patches/SA-23:07/bhyve.13.1.patch
# fetch https://security.FreeBSD.org/patches/SA-23:07/bhyve.13.1.patch.asc
# gpg --verify bhyve.13.1.patch.asc

b) Apply the patch.  Execute the following commands as root:

# cd /usr/src
# patch &lt; /path/to/patch

c) Recompile the operating system using buildworld and installworld as
described in &lt;URL:https://www.FreeBSD.org/handbook/makeworld.html&gt;.

Restart all affected virtual machines.

VI.  Correction details

This issue is corrected by the corresponding Git commit hash or Subversion
revision number in the following stable and release branches:

Branch/path                             Hash                     Revision
- -------------------------------------------------------------------------
stable/13/                              9fe302d78109    stable/13-n255918
releng/13.2/                            2bae613e0da3  releng/13.2-n254625
releng/13.1/                            87702e38a4b4  releng/13.1-n250190
- -------------------------------------------------------------------------

Run the following command to see which files were modified by a
particular commit:

# git show --stat &lt;commit hash&gt;

Or visit the following URL, replacing NNNNNN with the hash:

&lt;URL:https://cgit.freebsd.org/src/commit/?id=NNNNNN&gt;

To determine the commit count in a working tree (for comparison against
nNNNNNN in the table above), run:

# git rev-list --count --first-parent HEAD

VII. References

&lt;URL:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-3494&gt;

The latest revision of this advisory is available at
&lt;URL:https://security.FreeBSD.org/advisories/FreeBSD-SA-23:07.bhyve.asc&gt;
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEthUnfoEIffdcgYM7bljekB8AGu8FAmTJdsIACgkQbljekB8A
Gu8Q1Q/7BFw5Aa0cFxBzbdz+O5NAImj58MvKS6xw61bXcYr12jchyT6ENC7yiR+K
qCqbe5TssRbtZ1gg/94gSGEXccz5OcJGxW+qozhcdPUh2L2nzBPkMCrclrYJfTtM
cnmQKjg/wFZLUVr71GEM95ZFaktlZdXyXx9Z8eBzow5rXexpl1TTHQQ2kZZ41K4K
KFhup91dzGCIj02cqbl+1h5BrXJe3s/oNJt5JKIh/GBh5THQu9n6AywQYl18HtjV
fMb1qRTAS9WbiEP5QV2eEuOG86ucuhytqnEN5MnXJ2rLSjfb9izs9HzLo3ggy7yb
hN3tlbfIPjMEwYexieuoyP3rzKkLeYfLXqJU4zKCRnIbBIkMRy4mcFkfcYmI+MhF
NPh2R9kccemppKXeDhKJurH0vsetr8ti+AwOZ3pgO21+9w+mjE+EfaedIi+JWhip
hwqeFv03bAQHJdacNYGV47NsJ91CY4ZgWC3ZOzBZ2Y5SDtKFjyc0bf83WTfU9A/0
drC0z3xaJribah9e6k5d7lmZ7L6aHCbQ70+aayuAEZQLr/N1doB0smNi0IHdrtY0
JdIqmVX+d1ihVhJ05prC460AS/Kolqiaysun1igxR+ZnctE9Xdo1BlLEbYu2KjT4
LpWvSuhRMSQaYkJU72SodQc0FM5mqqNN42Vx+X4EutOfvQuRGlI=
=MlAY
-----END PGP SIGNATURE-----</pre>
</div>
</div>
<div class="paragraph">
<p>Every security advisory uses the following format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each security advisory is signed by the PGP key of the Security Officer. The public key for the Security Officer can be verified at <a href="../pgpkeys/#pgpkeys">OpenPGP Keys</a>.</p>
</li>
<li>
<p>The name of the security advisory always begins with <code>FreeBSD-SA-</code> (for FreeBSD Security Advisory), followed by the year in two digit format (<code>23:</code>), followed by the advisory number for that year (<code>07.</code>), followed by the name of the affected application or subsystem (<code>bhyve</code>).</p>
</li>
<li>
<p>The <code>Topic</code> field summarizes the vulnerability.</p>
</li>
<li>
<p>The <code>Category</code> refers to the affected part of the system which may be one of <code>core</code>, <code>contrib</code>, or <code>ports</code>. The <code>core</code> category means that the vulnerability affects a core component of the FreeBSD operating system. The <code>contrib</code> category means that the vulnerability affects software included with FreeBSD, such as BIND. The <code>ports</code> category indicates that the vulnerability affects software available through the Ports Collection.</p>
</li>
<li>
<p>The <code>Module</code> field refers to the component location. In this example, the <code>bhyve</code> module is affected; therefore, this vulnerability affects an application installed with the operating system.</p>
</li>
<li>
<p>The <code>Announced</code> field reflects the date the security advisory was published. This means that the security team has verified that the problem exists and that a patch has been committed to the FreeBSD source code repository.</p>
</li>
<li>
<p>The <code>Credits</code> field gives credit to the individual or organization who noticed the vulnerability and reported it.</p>
</li>
<li>
<p>The <code>Affects</code> field explains which releases of FreeBSD are affected by this vulnerability.</p>
</li>
<li>
<p>The <code>Corrected</code> field indicates the date, time, time offset, and releases that were corrected. The section in parentheses shows each branch for which the fix has been merged, and the version number of the corresponding release from that branch. The release identifier itself includes the version number and, if appropriate, the patch level. The patch level is the letter <code>p</code> followed by a number, indicating the sequence number of the patch, allowing users to track which patches have already been applied to the system.</p>
</li>
<li>
<p>The <code>CVE Name</code> field lists the advisory number, if one exists, in the public <a href="http://cve.mitre.org">cve.mitre.org</a> security vulnerabilities database.</p>
</li>
<li>
<p>The <code>Background</code> field provides a description of the affected module.</p>
</li>
<li>
<p>The <code>Problem Description</code> field explains the vulnerability. This can include information about the flawed code and how the utility could be maliciously used.</p>
</li>
<li>
<p>The <code>Impact</code> field describes what type of impact the problem could have on a system.</p>
</li>
<li>
<p>The <code>Workaround</code> field indicates if a workaround is available to system administrators who cannot immediately patch the system.</p>
</li>
<li>
<p>The <code>Solution</code> field provides the instructions for patching the affected system. This is a step by step tested and verified method for getting a system patched and working securely.</p>
</li>
<li>
<p>The <code>Correction Details</code> field displays each affected Subversion or Git branch with the revision number that contains the corrected code.</p>
</li>
<li>
<p>The <code>References</code> field offers sources of additional information regarding the vulnerability.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

    </div>
    
    <hr />
    <div class="last-modified">
      <p><strong>Last modified on</strong>: January 10, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=16e6bcc" target="_blank">github actions</a></p>
    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn/books/handbook/boot class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn/books/handbook/jails  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#security-synopsis">16.1. Synopsis</a></li>
    <li><a href="#security-intro">16.2. Introduction</a></li>
    <li><a href="#sec-accounts">16.3. Securing Accounts</a></li>
    <li><a href="#security-ids">16.4. Intrusion Detection System (IDS)</a></li>
    <li><a href="#security-secure-levels">16.5. Secure levels</a></li>
    <li><a href="#security-file-flags">16.6. File flags</a></li>
    <li><a href="#openssh">16.7. OpenSSH</a></li>
    <li><a href="#openssl">16.8. OpenSSL</a></li>
    <li><a href="#kerberos5">16.9. Kerberos</a></li>
    <li><a href="#tcpwrappers">16.10. TCP Wrappers</a></li>
    <li><a href="#fs-acl">16.11. Access Control Lists</a></li>
    <li><a href="#capsicum">16.12. Capsicum</a></li>
    <li><a href="#security-accounting">16.13. Process Accounting</a></li>
    <li><a href="#security-resourcelimits">16.14. Resource Limits</a></li>
    <li><a href="#security-pkg">16.15. Monitoring Third Party Security Issues</a></li>
    <li><a href="#security-advisories">16.16. FreeBSD Security Advisories</a></li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="https://free.bsd-doc.org/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="https://free.bsd-doc.org/zh-cn/languages">
                
                <img src="https://free.bsd-doc.org/images/language.png" class="language-image" alt="Choose language">
                <span>简体中文</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
