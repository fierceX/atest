<!DOCTYPE html>
<html class="theme-light" lang="zh-cn-auto">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="FreeBSD 基本系统内置了三个防火墙：PF、IPFW 和 IPFILTER。本章介绍如何定义数据包过滤规则，FreeBSD 内置防火墙之间的区别以及如何使用它们。"/>
  <meta name="keywords" content="firewall, pf, ipfw, ipfilter, blacklistd, filtering"/>
  <meta name="copyright" content="1995-2024 The FreeBSD Foundation" />
  <link rel="canonical" href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/" />

  <title>第 33 章 防火墙 |  FreeBSD 中文文档</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>


    <link rel="shortcut icon" href="https://free.bsd-doc.org/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="https://free.bsd-doc.org/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>
    <script defer src="/js/fssearch.min.js"></script>

  
  
    
    <meta property="og:title" content="第 33 章 防火墙" />
    <meta property="og:description" content="FreeBSD 基本系统内置了三个防火墙：PF、IPFW 和 IPFILTER。本章介绍如何定义数据包过滤规则，FreeBSD 内置防火墙之间的区别以及如何使用它们。" />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://free.bsd-doc.orgfavicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="zh-cn-auto" />
    <meta property="og:url" content="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/" />
    <meta property="og:site_name" content="FreeBSD 中文文档" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "https:\/\/free.bsd-doc.org\/zh-cn-auto\/books\/handbook\/firewalls\/",
        "name": "FreeBSD 中文文档",
        "headline": "FreeBSD 中文文档",
        "description": "FreeBSD 中文文档"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="https://free.bsd-doc.org" class="logo">
        <img src="https://free.bsd-doc.org/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      <form class="search" method="get" id="search-header-form" action="https://free.bsd-doc.org/zh-cn/search" name="search-header-form">
        <input id="search-query" name="s" type="text" size="20" maxlength="255" value="" />
        <button>
          <i class="fa fa-search" aria-hidden="true"></i>
        </button>
      </form>
      <div class="donate">
        <a href="https://github.com/fierceX/freebsd-doc-cn" target="_blank">
          <span class="heart">♥</span>
          GitHub
        </a>
      </div>
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="搜索" aria-label="搜索" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/">
              前言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-audience">预期读者</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-changes-from4">第四版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-changes-from3">第三版</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-changes-from2">第二版（2004 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-changes">第一版（2001 年）</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-overview">本书的组织结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-conv">本书中使用的约定</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-conv-typographic">排版约定</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-conv-commands">用户输入</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-conv-examples">示例</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/preface/#preface-acknowledgements">致谢</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/parti/">
              第一部分：入门指南
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/">
              第 1 章 引言
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#introduction-synopsis">1.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#nutshell">1.2. 欢迎来到 FreeBSD ！</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#os-overview">1.2.1. FreeBSD 可以做什么？</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#introduction-nutshell-users">1.2.2. 谁使用 FreeBSD ？</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#history">1.3. 关于 FreeBSD 项目</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#intro-history">1.3.1. FreeBSD 的简要历史</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#goals">1.3.2. FreeBSD 项目的目标</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#development">1.3.3. FreeBSD 开发模型</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#third-party-programs">1.3.4. 第三方程序</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/#_附加文档">1.3.5. 附加文档</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/">
              第 2 章 安装 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-synopsis">2.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-hardware">2.2. 最低硬件要求</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-pre">2.3. 安装前的任务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-installation-media">2.3.1. 准备安装介质</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-start">2.4. 开始安装</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-view-probe">2.4.1. FreeBSD 启动菜单</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#using-bsdinstall">2.5. 使用 bsdinstall</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-keymap">2.5.1. 选择键映射菜单</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-hostname">2.5.2. 设置主机名</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-components">2.5.3. 选择要安装的组件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-netinstall">2.5.4. 从网络安装</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-partitioning">2.6. 分配磁盘空间</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#configtuning-initial">2.6.1. 设计分区布局</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-part-guided">2.6.2. 使用 UFS 进行引导分区</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-part-manual">2.6.3. 手动分区</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-part-zfs">2.6.4. 使用 Root-on-ZFS 进行引导分区</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-part-shell">2.6.5. Shell 模式分区</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-fetching-distribution">2.7. 获取分发文件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-post">2.8. 网络接口，账户，时区，服务和加固</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-post-root">2.8.1. 设置 <code>root</code> 密码</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-config-network-dev">2.8.2. 配置网络接口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-timezone">2.8.3. 设置时区</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-sysconf">2.8.4. 启用服务</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-hardening">2.8.5. 启用强化安全选项</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-addusers">2.8.6. 添加用户</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-final-conf">2.8.7. 最终配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#bsdinstall-install-trouble">2.9. 故障排除</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bsdinstall/#using-live-cd">2.10. 使用 Live CD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/">
              第 3 章 FreeBSD 基础知识
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-synopsis">3.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#consoles">3.2. 虚拟控制台和终端</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#consoles-virtual">3.2.1. 虚拟控制台</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#consoles-singleuser">3.2.2. 单用户模式</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#consoles-vidcontrol">3.2.3. 更改控制台视频模式</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#users-synopsis">3.3. 用户和基本账户管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#users-introduction">3.3.1. 账户类型</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#users-modifying">3.3.2. 管理账户</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#users-groups">3.3.3. 管理群组</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#permissions">3.4. 权限</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#_符号权限">3.4.1. 符号权限</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#_freebsd_文件标志">3.4.2. FreeBSD 文件标志</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#_setuid_setgid_和_sticky_权限">3.4.3. setuid 、setgid 和 sticky 权限</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#dirstructure">3.5. 目录结构</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disk-organization">3.6. 磁盘组织</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disks-file-systems">3.6.1. 文件系统</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disks-partitions">3.6.2. 磁盘分区</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#mount-unmount">3.7. 挂载和卸载文件系统</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disks-fstab">3.7.1. fstab 文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disks-mount">3.7.2. 使用 mount(8)</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#disks-umount">3.7.3. 使用 umount(8)</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-processes">3.8. 进程和守护进程</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#_查看进程">3.8.1. 查看进程</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-daemons">3.8.2. 杀死进程</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#shells">3.9. Shells</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#changing-shells">3.9.1. 更改 Shell</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#_高级_shell_技巧">3.9.2. 高级 Shell 技巧</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#editors">3.10. 文本编辑器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-devices">3.11. 设备和设备节点</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-more-information">3.12. 手册页</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/basics/#basics-info">3.12.1. GNU Info 文件</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/">
              第 4 章 安装应用程序：软件包和 Ports
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-synopsis">4.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-overview">4.2. 软件安装概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-finding-applications">4.3. 寻找软件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-intro">4.4. 使用 pkg 进行二进制包管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-initial-setup">4.4.1. 开始使用 pkg</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#quarterly-latest-branch">4.4.2. 季度和最新的 ports 分支</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkg-configuration">4.4.3. 配置 pkg</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkg-search">4.4.4. 搜索软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkg-installing-fetching">4.4.5. 安装和获取软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-pkg-info">4.4.6. 获取已安装软件包的信息</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-upgrading">4.4.7. 升级已安装的软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-auditing">4.4.8. 审核已安装的软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkg-delete">4.4.9. 移除软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-autoremove">4.4.10. 自动删除未使用的软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-clean">4.4.11. 移除过期的软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkg-locking-unlocking">4.4.12. 锁定和解锁软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#pkgng-set">4.4.13. 修改软件包元数据</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-using">4.5. 使用 Ports 集合</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-using-installation-methods">4.5.1. 安装 Ports 集合</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#_安装_ports">4.5.2. 安装 Ports</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-removing">4.5.3. 移除已安装的 ports</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-upgrading">4.5.4. 升级 ports</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-disk-space">4.5.5. ports 和磁盘空间</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-poudriere">4.6. 使用 poudriere 构建软件包</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#poudriere-initialization">4.6.1. 初始化 Jails 和 Port Trees</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#_配置_pkg_客户端以使用_poudriere_仓库">4.6.2. 配置 pkg 客户端以使用 poudriere 仓库</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-nextsteps">4.7. 安装后的考虑事项</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ports/#ports-broken">4.8. 处理损坏的 ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/">
              第 5 章 X Window 系统
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x11-synopsis">5.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-install">5.2. 安装 Xorg</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-graphic-card-drivers">5.3. 显卡驱动程序</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-configuration-intel">5.3.1. Intel®</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-configuration-amd">5.3.2. AMD®</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-configuration-nvidia">5.3.3. NVIDIA®</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config">5.4. Xorg 配置</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config-files">5.4.1. 配置文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config-files-single-or-multi">5.4.2. 单个文件或多个文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config-video-cards">5.4.3. 视频卡</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config-monitors">5.4.4. 显示器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-config-input">5.4.5. 输入设备</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#x-fonts">5.5. 在 Xorg 中使用字体</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#type1">5.5.1. Type1 字体</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#truetype">5.5.2. TrueType® 字体</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/x11/#antialias">5.5.3. 抗锯齿字体</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-235af08fb87fd7a58003348706d2111d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-235af08fb87fd7a58003348706d2111d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/">
              第 6 章 Wayland
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-synopsis">6.1. Wayland 概述</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-wayfire">6.2. Wayfire 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-hikari">6.3. Hikari 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-sway">6.4. Sway 合成器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-xwayland">6.5. 使用 Xwayland</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-remotedesktop">6.6. 使用 VNC 进行远程桌面访问</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-ly">6.7. Wayland 登录管理器</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wayland/#wayland-utilities">6.8. 有用的工具</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4de18483dde20bf9ed0024176afd09da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4de18483dde20bf9ed0024176afd09da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/">
              第 7 章 网络
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#network-synopsis">7.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-network-setup">7.2. 设置网络</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-identify-network-adapter">7.2.1. 识别网络适配器</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-network-connection">7.3. 有线网络</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-static-ip-v4">7.3.1. 配置静态 IPv4 地址</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-dynamic-ip-v4">7.3.2. 配置动态 IPv4 地址</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#network-ipv6">7.3.3. IPv6</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-static-ip-v6">7.3.4. 配置静态 IPv6 地址</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#config-dynamic-ip-v6">7.3.5. 配置动态 IPv6 地址</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#_路由器通告和主机自动配置">7.3.6. 路由器通告和主机自动配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#_ipv6_和_ipv4_地址映射">7.3.7. IPv6 和 IPv4 地址映射</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#network-wireless">7.4. 无线网络</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#network-wireless-quick-start">7.4.1. 连接无线网络的快速入门指南</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#basic-wireless-configuration">7.4.2. 基本无线配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#scan-wireless-networks">7.4.3. 扫描无线网络</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#wireless-authentication">7.4.4. 连接和认证无线网络</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#_同时使用有线和无线连接">7.4.5. 同时使用有线和无线连接</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#hostname">7.5. 主机名</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#get-hostname">7.5.1. 检查当前主机名</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#change-hostname">7.5.2. 更改主机名</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#dns">7.6. DNS</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#local-addresses">7.6.1. 本地地址</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#configuring-nameserver">7.6.2. 配置域名服务器</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#troubleshooting">7.7. 故障排除</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#wired-troubleshooting">7.7.1. 有线网络故障排除</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network/#wireless-troubleshooting">7.7.2. 无线网络故障排除</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/partii/">
              第二部分：常见任务
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/">
              第 8 章 桌面环境
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-synopsis">8.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-environments">8.2. 桌面环境</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#kde-environment">8.2.1. KDE Plasma 是一个开源的桌面环境，为 Linux 和其他类 Unix 操作系统提供了一个现代化和可定制的用户界面。它提供了丰富的功能和工具，包括面板、应用程序菜单、任务管理器、文件管理器等，使用户能够方便地管理和使用计算机。 KDE Plasma 还支持各种主题和插件，可以根据个人喜好进行个性化设置。它被广泛用于许多 Linux 发行版中，被认为是一个功能强大且易于使用的桌面环境。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#gnome-environment">8.2.2. GNOME 是一个开源的桌面环境，它提供了一个直观和用户友好的界面，用于在 Linux 和其他类 Unix 操作系统上运行。 GNOME 的目标是提供一个现代化、易于使用和高度可定制的桌面环境，以满足各种用户的需求。 GNOME 还提供了许多应用程序和工具，用于增强用户体验和提高生产力。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#xfce-environment">8.2.3. XFCE 是一个轻量级的桌面环境，它注重速度和资源效率。它提供了一个简洁而直观的用户界面，适用于各种操作系统，包括 Linux 、 BSD 和 Solaris 。 XFCE 提供了许多常用的功能，如窗口管理、面板、应用程序菜单和文件管理器。它还支持自定义和扩展，用户可以根据自己的喜好进行个性化设置。总体而言， XFCE 是一个稳定、可靠且易于使用的桌面环境。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#mate-environment">8.2.4. MATE 是一个开源的桌面环境，最初是为 GNOME 2 开发的一个分支。它提供了一个传统的、直观的用户界面，类似于早期的 GNOME 版本。 MATE 桌面环境具有稳定性和可定制性的特点，可以在多种 Linux 发行版上使用。它支持多任务处理、窗口管理、面板、应用程序菜单等常见功能，并提供了许多扩展和插件来增强用户体验。 MATE 桌面环境还提供了一些自带的应用程序，如文件管理器、文本编辑器、终端模拟器等。总之， MATE 是一个功能强大且易于使用的桌面环境，适合那些喜欢传统风格的用户。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#cinnamon-environment">8.2.5. 肉桂</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#lxqt-environment">8.2.6. LXQt 是一个轻量级的桌面环境，它是 LXDE 和 Razor-qt 两个项目的合并。它使用 Qt 框架和 Openbox 窗口管理器，并提供了一个简洁、快速和易于使用的用户界面。 LXQt 支持多种语言，并且具有可定制性强的特点，可以根据用户的喜好进行个性化设置。它适用于资源有限的系统，如低端计算机和嵌入式设备。</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-browsers">8.3. 浏览器</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#firefox">8.3.1. Firefox 是一款开源的网络浏览器，由 Mozilla 基金会开发和维护。它是一款跨平台的浏览器，可在 Windows 、 macOS 、 Linux 和 Android 等操作系统上运行。 Firefox 以其快速的浏览速度、强大的安全性和丰富的功能而闻名。它支持扩展插件，用户可以根据自己的需求自定义浏览器功能。 Firefox 还注重用户隐私保护，提供了一系列的隐私设置选项，以确保用户的个人信息安全。作为一款开源软件， Firefox 的源代码对开发者开放，任何人都可以参与到其开发和改进中。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#chromium">8.3.2. Chromium 是一个开源的网页浏览器项目，由 Google 主导开发。它是 Google Chrome 浏览器的基础，提供了类似的功能和用户界面。 Chromium 的目标是提供一个快速、稳定和安全的浏览器，同时也为开发者提供一个可扩展的平台。它支持多种操作系统，包括 Windows 、 Mac 和 Linux 。 Chromium 的源代码是公开的，任何人都可以查看和修改。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#iridium">8.3.3. 铱浏览器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#falkon">8.3.4. Falkon 是一个开源的跨平台网络浏览器，旨在提供快速、轻量级和用户友好的浏览体验。它基于 QtWebEngine 引擎，具有现代化的用户界面和丰富的功能，包括标签页管理、书签管理、扩展支持等。 Falkon 支持多种操作系统，包括 Windows 、 macOS 和 Linux 。它还提供了一些高级功能，如广告拦截、隐私保护和自定义设置，以满足用户的不同需求。无论是日常浏览网页还是进行在线活动， Falkon 都是一个可靠的选择。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#konqueror">8.3.5. Konqueror 是一款开源的网络浏览器和文件管理器，最初是 KDE 桌面环境的一部分。它是一个功能强大且灵活的应用程序，可以在 Linux 和其他类 Unix 系统上运行。 Konqueror 支持多种网络协议，包括 HTTP 、 FTP 和 SMB 等。它还具有文件管理功能，可以浏览本地文件系统和远程文件系统。 Konqueror 还支持插件和扩展，可以根据用户的需求进行定制。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#gnome-web-epiphany">8.3.6. Gnome Web （ Epiphany ）</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#qutebrowser">8.3.7. qutebrowser 是一个基于 Python 和 QtWebEngine 的开源网络浏览器。它的设计目标是提供一个快速、轻量级且可定制的浏览器，同时保持简洁和易于使用的界面。 qutebrowser 支持键盘导航和命令行操作，可以通过键盘快捷键来浏览网页、打开链接和执行其他操作。它还支持用户脚本和插件，可以根据个人需求进行扩展和定制。 qutebrowser 是一个适用于计算机爱好者和技术专业人士的浏览器，它提供了丰富的功能和灵活的配置选项。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#dillo">8.3.8. Dillo</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#links">8.3.9. 链接</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#w3m">8.3.10. w3m 是一个用于终端的文本浏览器。它支持 HTML 、 ASCII 文本和图像的浏览，并且具有一些基本的浏览功能，如超链接导航、书签管理和搜索等。 w3m 是一个轻量级的浏览器，适用于在命令行界面下浏览互联网或本地文件。它在 Linux 和其他类 Unix 系统上广泛使用，并且可以通过命令行或配置文件进行自定义设置。</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-development">8.4. 开发工具</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#vs-code">8.4.1. Visual Studio Code 是一款由微软开发的免费源代码编辑器。它支持多种编程语言，并提供了丰富的功能和插件，使开发者能够更高效地编写和调试代码。 Visual Studio Code 具有直观的用户界面和强大的编辑功能，可以满足开发者的各种需求。它还支持版本控制系统，如 Git ，以便开发者可以轻松地管理和共享代码。无论是初学者还是专业开发者， Visual Studio Code 都是一个强大而可靠的工具。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#qt-creator">8.4.2. Qt Creator 是一个跨平台的集成开发环境（ IDE ），用于开发基于 Qt 框架的应用程序。它提供了一套丰富的工具和功能，包括代码编辑器、调试器、可视化界面设计工具和项目管理工具等。 Qt Creator 支持多种编程语言，如 C ++、 QML 和 JavaScript ，并且可以与其他开发工具和版本控制系统集成。它是 Qt 开发者的首选工具，可以帮助开发者更高效地创建和调试 Qt 应用程序。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#kdevelop">8.4.3. KDevelop 是一个开源的集成开发环境（ IDE ），用于开发计算机软件。它支持多种编程语言，包括 C ++， Python ， PHP 等。 KDevelop 提供了丰富的功能，如代码编辑器，调试器，版本控制集成等，以帮助开发人员提高效率和质量。它是一个跨平台的工具，可以在多个操作系统上使用，如 Linux ， Windows 和 macOS 。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#eclipse">8.4.4. Eclipse IDE 是一个开发环境，用于编写、调试和部署各种类型的应用程序。它是一个开源的集成开发环境，支持多种编程语言，包括 Java 、 C ++、 Python 等。 Eclipse IDE 提供了丰富的功能和插件，可以帮助开发人员提高效率和代码质量。它还具有强大的调试和测试工具，以及集成的版本控制系统。 Eclipse IDE 是一个非常受欢迎的开发工具，被广泛用于各种软件开发项目。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#vim">8.4.5. Vim 是一款功能强大的文本编辑器，广泛用于计算机编程和文本处理。它是 Vi 编辑器的改进版本，具有更多的功能和定制选项。 Vim 支持多种编程语言，并提供了丰富的插件和扩展功能，使用户可以根据自己的需求进行定制和扩展。 Vim 具有高度可配置性和灵活性，可以通过命令行或图形界面进行使用。它被认为是一款高效和强大的编辑器，深受程序员和技术人员的喜爱。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#neovim">8.4.6. Neovim 是一个现代化的文本编辑器，是 Vim 编辑器的一个分支。它旨在提供更好的性能、更好的可扩展性和更好的用户体验。 Neovim 保留了 Vim 的大部分功能和快捷键，同时还引入了一些新的功能和改进。它支持各种编程语言和插件，可以通过配置文件进行个性化设置。 Neovim 是一个开源项目，可以在多个操作系统上运行。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#gnu-emacs">8.4.7. GNU Emacs 是一款自由开源的文本编辑器，它具有强大的可扩展性和定制性。它最初由 Richard Stallman 开发，旨在提供一个功能丰富且可自定义的编辑环境。 Emacs 支持多种编程语言和文件格式，并提供了许多有用的功能，如语法高亮、自动完成、代码调试等。它还具有强大的文本处理功能，如搜索替换、宏录制和批处理操作。 Emacs 使用 Lisp 作为其扩展语言，使用户能够根据自己的需求定制编辑器的行为。它在计算机领域被广泛使用，并且有一个庞大的用户社区，提供了大量的扩展和插件。</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-productivity">8.5. 桌面办公生产力</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#libreoffice">8.5.1. LibreOffice 是一款免费开源的办公软件套件，它包含了文字处理、电子表格、演示文稿、数据库和绘图等多个应用程序。 LibreOffice 是一个跨平台的软件，可以在 Windows 、 macOS 和 Linux 等操作系统上运行。它提供了丰富的功能和工具，可以满足用户在办公和学习中的各种需求。 LibreOffice 还支持多种文件格式，包括 Microsoft Office 的文件格式，使用户可以方便地与其他办公软件进行兼容和交流。作为一个开源项目， LibreOffice 还鼓励用户参与到软件的开发和改进中，以不断提升软件的质量和功能。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#calligra">8.5.2. Calligra 是一套开源的办公软件套件，旨在提供各种办公应用程序，如文字处理、电子表格、演示文稿、绘图和数据库管理。它是一个功能强大且灵活的工具，适用于个人用户和企业用户。 Calligra 具有直观的用户界面和丰富的功能，可以满足各种办公需求。无论是撰写文档、制作报告、创建图表还是管理数据， Calligra 都可以提供高效的解决方案。此外， Calligra 还支持多种文件格式，包括 Microsoft Office 和 OpenDocument 格式，使用户可以方便地与其他办公软件进行兼容和交互。无论您是个人用户还是企业用户， Calligra 都是一个值得考虑的办公软件选择。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#abiword">8.5.3. AbiWord 是一款开源的字处理软件，它支持多种操作系统，包括 Windows 、 Mac 和 Linux 。它具有类似于 Microsoft Word 的功能，可以创建、编辑和格式化文档。 AbiWord 还支持多种文件格式，包括 .doc 、 .docx 、 .odt 和 .rtf 。它还提供了一些高级功能，如拼写检查、批注和表格编辑。 AbiWord 是一个轻量级的应用程序，占用系统资源较少，适合在低配置的计算机上使用。它是一个功能强大且易于使用的字处理工具。</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-viewers">8.6. 文档查看器</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#okular">8.6.1. Okular 是一个开源的多平台文档阅读器。它支持多种文件格式，包括 PDF 、 EPUB 、 MOBI 、 CHM 等。 Okular 具有丰富的功能，如注释、书签、文本搜索、旋转页面等。它还支持插件扩展，可以根据用户的需求进行定制。 Okular 是 KDE 桌面环境的一部分，但也可以在其他桌面环境中使用。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#evince">8.6.2. Evince 是一款开源的文档查看器，它支持多种文件格式，包括 PDF 、 PostScript 、 DjVu 、 TIFF 和 DVI 等。它具有简洁的界面和丰富的功能，可以方便地查看和浏览文档内容。 Evince 还支持注释、书签、搜索和打印等功能，使用户能够更好地管理和处理文档。它是 Linux 操作系统中常用的文档查看器之一，也可以在其他操作系统上使用。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#epdfview">8.6.3. ePDFView 是一个开源的 PDF 文档查看器，它可以在计算机上运行。它提供了一种方便的方式来浏览和阅读 PDF 文件。 ePDFView 支持基本的 PDF 功能，如缩放、滚动和搜索。它还具有一些高级功能，如注释和书签。 ePDFView 易于使用，界面简洁明了。它是一个功能强大的工具，适用于需要频繁查看和处理 PDF 文件的用户。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#xpdf">8.6.4. Xpdf 是一个开源的 PDF 阅读器和解析器，它可以在多个操作系统上运行。它提供了一些基本的功能，如查看和打印 PDF 文件，以及搜索和复制文本。 Xpdf 还支持一些高级功能，如注释和书签。它是一个轻量级的工具，易于使用和集成到其他应用程序中。</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#desktop-finance">8.7. 金融</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#kmymoney">8.7.1. KMyMoney 是一款开源的个人财务管理软件，旨在帮助用户跟踪和管理他们的财务情况。它提供了一个直观的界面，可以记录和分类收入和支出，创建预算和报告，以及跟踪投资和贷款。 KMyMoney 还支持多个账户和货币，并提供了强大的导入和导出功能，以便与其他财务软件和银行进行数据交互。无论是个人用户还是小型企业， KMyMoney 都是一个功能齐全且易于使用的财务管理解决方案。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/desktop/#gnucash">8.7.2. GnuCash 是一款自由开源的会计软件。它可以帮助个人和小型企业进行财务管理和记账。 GnuCash 支持多种货币和账户类型，并提供了丰富的报表和图表功能。它还支持导入和导出数据，以及与其他软件的集成。 GnuCash 是一个功能强大且易于使用的工具，适用于任何需要进行财务管理的人或组织。</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/">
              第 9 章 多媒体
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#multimedia-synopsis">9.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#sound-setup">9.2. 设置声卡</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#sound-testing">9.2.1. 测试声音</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#sound-mixer">9.2.2. 搅拌器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#graphics-card-sound">9.2.3. 显卡声音</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#automatically-switching-headphones">9.2.4. 自动切换到耳机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#troubleshooting-sound">9.2.5. 音频故障排除</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#audio-ports">9.3. 音频播放器</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#elisa">9.3.1. Elisa</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#gnome-music">9.3.2. GNOME 音乐</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#audacious">9.3.3. Audacious 是一个免费的音频播放器，可在多个平台上使用。它具有简洁的界面和丰富的功能，可以播放各种音频格式。 Audacious 还支持插件扩展，用户可以根据自己的需求添加额外的功能和特性。无论是在个人使用还是在专业环境中， Audacious 都是一个强大而可靠的音频播放器选择。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#moc-music-on-console">9.3.4. MOC （音乐控制台）</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#video-ports">9.4. 视频播放器</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#mplayer">9.4.1. MPlayer 是一个开源的多媒体播放器，可以在多个平台上运行。它支持各种音频和视频格式，并具有强大的功能和灵活的配置选项。 MPlayer 是一个非常流行的播放器，被广泛用于电影、音乐和其他媒体的播放。它具有简单易用的界面和高质量的播放效果，是许多用户的首选播放器之一。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#smplayer">9.4.2. SMPlayer 是一个免费的多媒体播放器，可在 Windows 和 Linux 操作系统上使用。它支持各种音频和视频格式，并具有许多有用的功能，如字幕支持、音频和视频过滤器、播放列表和快捷键。 SMPlayer 还具有用户友好的界面和可自定义的外观。它是一个功能强大且易于使用的播放器，适用于各种媒体播放需求。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#vlc">9.4.3. VLC 媒体播放器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#kodi">9.4.4. Kodi （ XBMC ）</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#conferencing-meetings">9.5. 会议和会议</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#webcam-setup">9.5.1. 设置网络摄像头</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#meetings-software-status">9.5.2. 会议软件状态</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#scanners">9.6. 图像扫描仪</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#scanners-kernel-usb">9.6.1. 检查扫描仪</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/multimedia/#_sane_configuration">9.6.2. SANE 配置</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/">
              第 10 章 配置 FreeBSD 内核
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-synopsis">10.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-custom-kernel">10.2. 为什么要构建自定义内核？</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-devices">10.3. 查找系统硬件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-config">10.4. 配置文件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-building">10.5. 构建和安装自定义内核</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/kernelconfig/#kernelconfig-trouble">10.6. 如果出现问题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/">
              第 11 章 打印
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-quick-start">11.1. 快速入门</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-connections">11.2. 打印机连接</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-connections-summary">11.2.1. 摘要</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-pdls">11.3. 常见的页面描述语言</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#print-pdls-table">11.3.1. 将 PostScript® 转换为其他 PDLs</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#print-pdls-summary">11.3.2. 摘要</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-direct">11.4. 直接打印</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd">11.5. LPD （ Line Printer Daemon ）是一种用于打印机的网络协议。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-setup">11.5.1. 初始设置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-lpr">11.5.2. 使用 lpr(1) 打印</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-filters">11.5.3. 过滤器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-queues">11.5.4. 多个队列</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-monitor">11.5.5. 监控和控制打印</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-shared">11.5.6. 共享打印机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-lpd-references">11.5.7. 参考文献</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-other">11.6. 其他打印系统</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-other-cups">11.6.1. CUPS （ Common UNIX® Printing System ）</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-other-hplip">11.6.2. HPLIP 是一种用于 Linux 操作系统的开源打印机和扫描仪驱动程序。它提供了与 HP 打印机和扫描仪的通信接口，使用户能够轻松地配置和使用这些设备。 HPLIP 支持各种 HP 打印机和扫描仪的功能，包括打印、扫描、复印和传真等。它还提供了一些额外的功能，如墨水和墨盒状态监测、打印机设置和网络打印等。 HPLIP 是一个非常有用的工具，可以帮助用户更好地管理和使用他们的 HP 打印机和扫描仪。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/printing/#printing-other-lprng">11.6.3. LPRng 是一个用于打印管理的软件系统，它是 LPD （ Line Printer Daemon ）的一个增强版本。 LPRng 提供了更多的功能和灵活性，可以在 UNIX 和类 UNIX 系统上运行。它支持多种打印机和打印队列，并提供了高级的打印作业控制和管理功能。 LPRng 还支持通过网络打印，并提供了安全性和权限控制机制。它是一个强大而可靠的打印管理解决方案。</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/">
              第 12 章 Linux 二进制兼容性
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-synopsis">12.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-lbc-install">12.2. 配置 Linux 二进制兼容性</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linux-userlands">12.3. Linux 用户空间</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-packages">12.3.1. 从 FreeBSD 软件包中获取的 CentOS 基本系统</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-debootstrap">12.3.2. 使用 debootstrap 创建 Debian/Ubuntu 基础系统</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-advanced">12.4. 高级主题</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-libs-manually">12.4.1. 手动安装额外的库</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#_标记_linux_elf_可执行文件">12.4.2. 标记 Linux ELF 可执行文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#_安装基于_linux_rpm_的应用程序">12.4.3. 安装基于 Linux RPM 的应用程序</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#_配置主机名解析器">12.4.4. 配置主机名解析器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/linuxemu/#linuxemu-misc">12.4.5. 杂项</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-af234c193ce95c480af0ff5ec3f32f5c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-af234c193ce95c480af0ff5ec3f32f5c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/">
              第 13 章 WINE
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-synopsis">13.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-overview-concepts">13.2. WINE 概述与概念</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#what-is-wine">13.2.1. WINE 是什么？</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-and-the-os-system">13.2.2. WINE 和 FreeBSD 系统</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#graphical-versus-text-modeterminal-programs-in-wine">13.2.3. WINE 中的图形模式与文本模式 / 终端程序</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-derivative-projects">13.2.4. WINE 衍生项目</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#alternatives-to-wine">13.2.5. WINE 的替代方案</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#installing-wine-on-freebsd">13.3. 在 FreeBSD 上安装 WINE</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-prerequistes">13.3.1. WINE 的先决条件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#installing-wine">13.3.2. 通过 FreeBSD 软件包仓库安装 WINE</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#thirtytwo-vs-sixtyfour-bit-wine">13.3.3. WINE 安装中的 32 位与 64 位的问题</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#running-first-wine-program">13.4. 在 FreeBSD 上运行第一个 WINE 程序</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#running-a-program-from-the-command-line">13.4.1. 从命令行运行程序</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#running-a-program-from-a-gui">13.4.2. 从图形用户界面 (GUI) 运行程序</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#configuring-wine-installation">13.5. 配置 WINE 安装</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-prefixes">13.5.1. WINE 前缀</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#creating-and-using-wine-prefixes">13.5.2. 创建和使用 WINE 前缀</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#configuring-wine-prefixes-with-winecfg">13.5.3. 使用 winecfg 配置 WINE 前缀</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-management-guis">13.6. WINE 管理图形界面</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#winetricks">13.6.1. Winetricks 是一个用于在 Wine 环境中安装和配置 Windows 应用程序所需组件的实用工具。它提供了一个简单的命令行界面，使用户可以轻松地安装各种 Windows 库和运行时环境，以便在 Wine 中运行各种 Windows 软件。使用 Winetricks ，用户可以安装诸如 .NET Framework 、 DirectX 、 Visual C ++运行时库等常用的 Windows 组件，以便更好地支持和运行 Windows 应用程序。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#homura">13.6.2. 苏伊马祖</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#running-multiple-management-guis">13.6.3. 运行多个管理图形用户界面 (GUI)</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-in-multi-user-os-installations">13.7. 在多用户的 FreeBSD 安装中使用 WINE</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#issues-with-using-a-common-wine-prefix">13.7.1. 使用共享的 WINE 前缀的问题</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#installing-applications-to-a-common-drivesettings">13.7.2. 将应用程序安装到公共驱动器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#using-a-common-installation-of-wine">13.7.3. 使用通用的 WINE 安装方法</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#wine-on-os-faq">13.8. 在 FreeBSD 上使用 WINE 的常见问题解答</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#basic-installation-and-usage">13.8.1. 基本安装和使用</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#install-optimization">13.8.2. 安装优化</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#application-specific">13.8.3. 特定应用</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/wine/#other-os-resources">13.8.4. 其他操作系统资源</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/partiii/">
              第三部分：系统管理
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/">
              第 14 章 配置、服务、日志和电源管理
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#config-synopsis">14.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-configfiles">14.2. 配置文件</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#_etc_目录">14.2.1. <span class="filename">/etc</span> 目录</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-sysctl">14.2.2. sysctl 实用程序</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-sysctlconf">14.2.3. <span class="filename">/etc/sysctl.conf</span> 文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-core-configuration">14.2.4. 管理系统特定配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-rcd">14.3. 在 FreeBSD 中管理服务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-starting-services">14.3.1. 启动服务</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-status-services">14.3.2. 服务的状态</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-reload-services">14.3.3. 重新加载服务</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#_使用服务启动服务">14.3.4. 使用服务启动服务</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#cron-periodic">14.4. Cron 和周期性任务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-cron">14.4.1. Cron 是一个用于在 Unix 和类 Unix 系统上执行定期任务的工具。它允许用户根据特定的时间表安排命令或脚本的运行。 Cron 使用 crontab 文件来存储任务和时间表信息，并通过 cron 守护进程来执行这些任务。 Cron 的时间表语法非常灵活，可以指定分钟、小时、日期、月份和星期几等。它还支持一些特殊的时间表选项，如@ reboot （系统启动时运行）和@ daily （每天运行一次）。 Cron 是系统管理员和开发人员常用的工具之一，用于自动化重复性任务的执行。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-installcrontab">14.4.2. 创建用户的定时任务表</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-periodic">14.4.3. 周期性的</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#enable-disable-periodic">14.4.4. 启用或禁用定期任务</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configuring-output-periodic-tasks">14.4.5. 配置周期性任务的输出</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#configtuning-syslog">14.5. 配置系统日志</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#_配置本地日志记录">14.5.1. 配置本地日志记录</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#logging-facilities">14.5.2. 日志记录设施</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#logging-levels">14.5.3. 日志级别</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#read-log-messages">14.5.4. 阅读日志消息</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#_日志管理和轮转">14.5.5. 日志管理和轮转</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#network-syslogd">14.5.6. 配置远程日志记录</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#acpi-overview">14.6. 功耗和资源管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#acpi-config">14.6.1. ACPI 配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#cpu-power-management">14.6.2. CPU 功耗管理</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#cpufreq">14.6.3. CPU 频率控制</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#est">14.6.4. 英特尔 ® Enhanced SpeedStep™</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#hwpstate_intel">14.6.5. 英特尔速度转移 ™</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#graphics-card-power-management">14.6.6. 图形卡功耗管理</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#_暂停_恢复">14.6.7. 暂停 / 恢复</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#adding-swap-space">14.7. 添加交换空间</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#new-drive-swap">14.7.1. 在新硬盘或现有分区上进行交换</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/config/#create-swapfile">14.7.2. 创建交换文件</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/">
              第 15 章 FreeBSD 的引导过程
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-synopsis">15.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-introduction">15.2. FreeBSD 引导过程</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-boot0">15.2.1. 引导管理器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-boot1">15.2.2. 第一阶段和第二阶段</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-loader">15.2.3. 第三阶段</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-init">15.2.4. 最后阶段</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#device-hints">15.3. 设备提示</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/boot/#boot-shutdown">15.4. 关机序列</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/">
              第 16 章 安全
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-synopsis">16.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-intro">16.2. 介绍</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#sec-accounts">16.3. 保护账户安全</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-accounts">16.3.1. 防止登录</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-passwords">16.3.2. 密码哈希值</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-pwpolicy">16.3.3. 密码策略强制执行</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-sudo">16.3.4. 使用 sudo 进行共享管理</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-doas">16.3.5. 使用 Doas 进行共享管理</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ids">16.4. 入侵检测系统（ IDS ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ids-generate-spec-file">16.4.1. 生成规范文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ids-spec-file-structure">16.4.2. 规范文件结构</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ids-verify-specification-file">16.4.3. 验证规范文件</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-secure-levels">16.5. 安全级别</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-secure-levels-definitions">16.5.1. 安全级别定义</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-modify-secure-levels">16.5.2. 修改安全级别</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-file-flags">16.6. 文件标志</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-work-file-flag">16.6.1. 处理文件标志</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#openssh">16.7. OpenSSH 是一个用于安全远程登录和文件传输的开源软件套件。它提供了加密的通信通道，以防止未经授权的访问和数据泄露。 OpenSSH 支持 SSH 协议，可以在不同的操作系统上运行，并且具有强大的身份验证和加密功能。它被广泛用于管理远程服务器和保护敏感数据的传输。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_使用_ssh_客户端工具">16.7.1. 使用 SSH 客户端工具</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ssh-keygen">16.7.2. 基于密钥的身份验证</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-ssh-tunneling">16.7.3. SSH 隧道</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_启用_ssh_服务器">16.7.4. 启用 SSH 服务器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#config-publickey-auth">16.7.5. 配置公钥身份验证方法</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-sshd-security-options">16.7.6. SSH 服务器安全选项</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#openssl">16.8. OpenSSL 是一个开源的软件库，提供了一套用于安全通信的加密工具。它支持多种加密算法和协议，包括 SSL 和 TLS 。 OpenSSL 广泛用于网络通信、数字证书管理和数据加密等领域。它是一个功能强大且可靠的工具，被广泛应用于各种计算机系统和应用程序中。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#generating-certificates">16.8.1. 生成证书</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#fips-provider">16.8.2. 配置 FIPS 提供程序</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#kerberos5">16.9. Kerberos 是一种网络身份验证协议，用于在计算机网络中验证用户的身份。它使用加密技术来确保通信的安全性，并防止身份伪造和中间人攻击。 Kerberos 还提供了单点登录功能，允许用户在一次身份验证后访问多个网络服务。它是计算机领域中常用的身份验证解决方案之一。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_设置_heimdal_kdc">16.9.1. 设置 Heimdal KDC</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_配置服务器使用_kerberos">16.9.2. 配置服务器使用 Kerberos</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_配置客户端使用_kerberos">16.9.3. 配置客户端使用 Kerberos</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_mit_的差异">16.9.4. MIT 的差异</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_kerberos_技巧技巧和故障排除">16.9.5. Kerberos 技巧、技巧和故障排除</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_缓解_kerberos_的限制">16.9.6. 缓解 Kerberos 的限制</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_资源和进一步信息">16.9.7. 资源和进一步信息</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#tcpwrappers">16.10. TCP 包装器（ TCP Wrappers ）是一种网络访问控制工具，用于在 TCP/IP 网络上限制对特定服务的访问。它通过检查远程主机的 IP 地址和主机名来决定是否允许连接到受保护的服务。 TCP 包装器可以用于增强网络安全性，防止未经授权的访问和恶意活动。它通常与网络服务（如 SSH 、 FTP 和 Telnet ）一起使用，以提供对这些服务的访问控制。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#tcpwrappers-initial-configuration">16.10.1. 初始配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#tcpwrappers-advanced-config">16.10.2. 高级配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#fs-acl">16.11. 访问控制列表</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#acl-enabling-support-ufs">16.11.1. 在 UFS 中启用 ACL 支持</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-acl-info">16.11.2. 获取 ACL 信息</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-working-acls">16.11.3. 使用 ACLs 进行工作</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#capsicum">16.12. Capsicum 是一种辣椒植物，属于茄科。它的果实通常被用作调味品和食材，具有辛辣的味道。 Capsicum 也被用于药用目的，具有抗氧化和抗炎作用。它含有丰富的维生素 C 和维生素 A ，对于保持健康非常重要。 Capsicum 在烹饪中被广泛使用，可以用于制作各种菜肴和调味品。</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-accounting">16.13. 进程账户</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_启用和利用进程账户">16.13.1. 启用和利用进程账户</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-resourcelimits">16.14. 资源限制</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-resource-limits-types">16.14.1. 资源的类型</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#users-limiting">16.14.2. 配置登录类</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-rctl">16.14.3. 启用和配置资源限制</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-pkg">16.15. 监控第三方安全问题</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#security-advisories">16.16. FreeBSD 安全公告</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/security/#_安全公告的格式">16.16.1. 安全公告的格式</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/">
              第 17 章 Jails 和容器
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jails-synopsis">17.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-types">17.2. Jail 类型</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#thick-jails">17.2.1. 厚（Thick）Jails</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#thin-jails">17.2.2. 薄（Thin）Jails</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#vnet-jails">17.2.3. VNET Jails</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#linux-jails">17.2.4. Linux Jails</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#host-configuration">17.3. 主机配置</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#host-configuration-jail-utility">17.3.1. Jail 实用工具</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jails-networking">17.3.2. 网络</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#host-configuration-directories">17.3.3. 设置 jail 目录树</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-configuration-files">17.3.4. Jail 配置文件</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#classic-jail">17.4. 经典 Jail（厚 Jail ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#creating-classic-jail">17.4.1. 创建一个经典 Jail</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#thin-jail">17.5. 薄（Thin）Jails</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#creating-thin-jail-openzfs-snapshots">17.5.1. 使用 OpenZFS 快照创建一个瘦 Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#creating-thin-jail-nullfs">17.5.2. 使用 NullFS 创建一个薄 Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#creating-vnet-jail">17.5.3. 创建一个 VNET Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#creating-linux-jail">17.5.4. 创建一个 Linux Jail</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-management">17.6. Jail 管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#list-running-jails">17.6.1. 列出运行中的 Jails</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#start-jail">17.6.2. 启动、重新启动和停止一个 Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#destroy-jail">17.6.3. 销毁一个 jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#handle-packages-jail">17.6.4. 在 Jail 中处理软件包</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#access-jail">17.6.5. 访问一个 Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#execute-commands-jail">17.6.6. 在 Jail 中执行命令</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-upgrading">17.7. Jail 升级</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jails-updating">17.7.1. 使用 OpenZFS 快照升级经典 Jail 或薄 Jail</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#upgrading-thin-jail">17.7.2. 使用 NullFS 升级薄 Jail</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-resource-limits">17.8. Jail 资源限制</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/jails/#jail-managers-and-containers">17.9. Jail 管理器和容器</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/">
              第 18 章 强制访问控制
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-synopsis">18.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-inline-glossary">18.2. 关键术语</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-understandlabel">18.3. 理解 MAC 标签</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_标签配置">18.3.1. 标签配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_预定义标签">18.3.2. 预定义标签</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_数字标签">18.3.3. 数字标签</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_用户标签">18.3.4. 用户标签</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_网络接口标签">18.3.5. 网络接口标签</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-planning">18.4. 规划安全配置</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-policies">18.5. 可用的 MAC 策略</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-seeotheruids">18.5.1. MAC 查看其他 UID 策略</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-bsdextended">18.5.2. MAC BSD 扩展策略</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-ifoff">18.5.3. MAC 接口禁止策略</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-portacl">18.5.4. MAC 端口访问控制列表策略</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-partition">18.5.5. MAC 分区策略</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-mls">18.5.6. MAC 多级安全模块</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-biba">18.5.7. MAC Biba 模块</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-lomac">18.5.8. MAC 低水位标记模块</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-userlocked">18.6. 用户锁定</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-implementing">18.7. 在 MAC Jail 中的 Nagios</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_创建一个不安全的用户类">18.7.1. 创建一个不安全的用户类</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_配置用户">18.7.2. 配置用户</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_创建上下文文件">18.7.3. 创建上下文文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_加载器配置">18.7.4. 加载器配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#_测试配置">18.7.5. 测试配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mac/#mac-troubleshoot">18.8. 解决 MAC 框架的问题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/">
              第 19 章 安全事件审计
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#audit-synopsis">19.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#audit-inline-glossary">19.2. 关键术语</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#audit-config">19.3. 审计配置</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#_事件选择表达式">19.3.1. 事件选择表达式</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#_配置文件">19.3.2. 配置文件</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#audit-administration">19.4. 使用审计跟踪功能</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#_使用审计管道进行实时监控">19.4.1. 使用审计管道进行实时监控</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/audit/#_旋转和压缩审计日志文件">19.4.2. 旋转和压缩审计日志文件</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/">
              第 20 章 存储
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-synopsis">20.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-adding">20.2. 添加磁盘</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-growing">20.3. 调整和扩展磁盘大小</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#usb-disks">20.4. USB 存储设备</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_设备配置">20.4.1. 设备配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_自动挂载可移动介质">20.4.2. 自动挂载可移动介质</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#creating-cds">20.5. 创建和使用 CD 媒体</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#atapicam">20.5.1. 支持的设备</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#cdrecord">20.5.2. 刻录光盘</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#mkisofs">20.5.3. 将数据写入 ISO 文件系统</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#mounting-cd">20.5.4. 使用数据光盘</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#duplicating-audiocds">20.5.5. 复制音频 CDs</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#creating-dvds">20.6. 创建和使用 DVD 媒体</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_配置">20.6.1. 配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_刻录数据_dvd">20.6.2. 刻录数据 DVD</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_刻录_dvd_视频">20.6.3. 刻录 DVD 视频</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_使用_dvd_rw">20.6.4. 使用 DVD + RW</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_使用_dvd_rw_2">20.6.5. 使用 DVD-RW</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_多会话">20.6.6. 多会话</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_更多信息请参考">20.6.7. 更多信息请参考</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#creating-dvd-ram">20.6.8. 使用 DVD-RAM</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#floppies">20.7. 创建和使用软盘</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#using-ntfs">20.8. 使用 NTFS 磁盘</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#backup-basics">20.9. 备份基础知识</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_文件系统备份">20.9.1. 文件系统备份</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_目录备份">20.9.2. 目录备份</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#backups-tapebackups">20.9.3. 使用数据磁带进行备份</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#backups-programs-amanda">20.9.4. 第三方备份工具</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_紧急恢复">20.9.5. 紧急恢复</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-virtual">20.10. 内存磁盘</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-mdconfig">20.10.1. 附加和分离现有图片</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-md-freebsd5">20.10.2. 创建一个基于文件或内存的内存磁盘</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#snapshots">20.11. 文件系统快照</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#quotas">20.12. 磁盘配额</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_启用磁盘配额">20.12.1. 启用磁盘配额</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_设置配额限制">20.12.2. 设置配额限制</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_检查配额限制和磁盘使用情况">20.12.3. 检查配额限制和磁盘使用情况</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_nfs_上的配额限制">20.12.4. NFS 上的配额限制</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-encrypting">20.13. 加密磁盘分区</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_使用_gbde_进行磁盘加密">20.13.1. 使用 gbde 进行磁盘加密</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-encrypting-geli">20.13.2. 使用 <code>geli</code> 进行磁盘加密</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#swap-encrypting">20.14. 加密交换分区</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_配置加密交换空间">20.14.1. 配置加密交换空间</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_加密交换验证">20.14.2. 加密交换验证</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#disks-hast">20.15. 高可用存储（ Highly Available Storage ， HAST ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_hast_操作">20.15.1. HAST 操作</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_hast_配置">20.15.2. HAST 配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/disks/#_故障排除">20.15.3. 故障排除</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/">
              第 21 章 GEOM ：模块化磁盘转换框架
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-synopsis">21.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-striping">21.2. RAID0 - 条带化</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-mirror">21.3. RAID1 - 镜像</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-mirror-metadata">21.3.1. 元数据问题</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-mirror-two-new-disks">21.3.2. 使用两个新硬盘创建镜像</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-mirror-existing-drive">21.3.3. 使用现有驱动器创建镜像</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#gmirror-troubleshooting">21.3.4. 故障排除</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#_从磁盘故障中恢复">21.3.5. 从磁盘故障中恢复</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-raid3">21.4. RAID3 - 以字节为单位的条带化和专用奇偶校验</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#_创建一个专用的_raid3_阵列">21.4.1. 创建一个专用的 RAID3 阵列</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid">21.5. 软件 RAID 设备</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-creating">21.5.1. 创建一个数组</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-volumes">21.5.2. 多个卷</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-converting">21.5.3. 将单个驱动器转换为镜像</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-inserting">21.5.4. 将新驱动器插入阵列中</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-removing">21.5.5. 从阵列中移除驱动器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-stopping">21.5.6. 停止数组</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-status">21.5.7. 检查数组状态</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-deleting">21.5.8. 删除数组</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-graid-unexpected">21.5.9. 删除意外的数组</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-ggate">21.6. GEOM Gate Network 是一种计算机网络技术。</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-glabel">21.7. 标记磁盘设备</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#_标签类型和示例">21.7.1. 标签类型和示例</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/geom/#geom-gjournal">21.8. 通过 GEOM 实现的 UFS 日志记录</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f1657a05627dd16bad31d4c7f675604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f1657a05627dd16bad31d4c7f675604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/">
              第 22 章 Z 文件系统（ZFS）
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-differences">22.1. ZFS 有何不同之处</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-quickstart">22.2. 快速入门指南</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-quickstart-single-disk-pool">22.2.1. 单磁盘池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-quickstart-raid-z">22.2.2. RAID-Z</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-quickstart-recovering-raid-z">22.2.3. 恢复 RAID-Z</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-quickstart-data-verification">22.2.4. 数据验证</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool">22.3. <code>zpool</code> 管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-create">22.3.1. 创建和销毁存储池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-attach">22.3.2. 添加和移除设备</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-status">22.3.3. 检查池的状态</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-clear">22.3.4. 清除错误</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-replace">22.3.5. 替换一个正常工作的设备</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-resilver">22.3.6. 处理故障设备</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-scrub">22.3.7. Scrubbing 池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-selfheal">22.3.8. 自我修复</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-online">22.3.9. 扩展池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-import">22.3.10. 导入和导出存储池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-upgrade">22.3.11. 升级存储池</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-history">22.3.12. 显示池的历史记录</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-iostat">22.3.13. 性能监控</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zpool-split">22.3.14. 分割存储池</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs">22.4. <code>zfs</code> 管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-create">22.4.1. 创建和销毁数据集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-volume">22.4.2. 创建和销毁卷</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-rename">22.4.3. 重命名数据集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-set">22.4.4. 设置数据集属性</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-snapshot">22.4.5. 管理快照</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-clones">22.4.6. 管理克隆实例</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-send">22.4.7. 复制</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-quota">22.4.8. 数据集、用户和组配额</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-reservation">22.4.9. 预留空间</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-compression">22.4.10. 压缩</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-compression-zstd">22.4.11. Zstandard 压缩</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-deduplication">22.4.12. 去重</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-jail">22.4.13. ZFS 和 Jails</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-allow">22.5. 委派管理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-allow-create">22.5.1. 委托数据集创建</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-zfs-allow-allow">22.5.2. 委派权限委派</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-advanced">22.6. 高级主题</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-advanced-tuning">22.6.1. 调优</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-advanced-i386">22.6.2. i386 上的 ZFS</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-links">22.7. 进一步资源</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/zfs/#zfs-term">22.8. ZFS 功能和术语</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/filesystems/">
              第 23 章 其他文件系统
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/filesystems/#filesystems-synopsis">23.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/filesystems/#filesystems-linux">23.2. Linux® 文件系统</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/filesystems/#_ext2_ext3_ext4">23.2.1. ext2 / ext3 / ext4</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/">
              第 24 章 虚拟化
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-synopsis">24.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-parallelsdesktop">24.2. 在 Parallels Desktop for macOS® 上作为客户机的 FreeBSD</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-parallelsdesktop-install">24.2.1. 在 Mac 上使用 Parallels Desktop 安装 FreeBSD</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-parallels-configure">24.2.2. 在 Parallels 上配置 FreeBSD</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-vmware">24.3. 在 macOS 上使用 VMware Fusion 作为客户机的 FreeBSD</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-vmware-install">24.3.1. 在 VMware Fusion 上安装 FreeBSD</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-vmware-configure">24.3.2. 在 VMware Fusion 上配置 FreeBSD</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-guest-virtualbox">24.4. 在 VirtualBox™ 上作为客户机的 FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-virtualbox">24.5. 使用 VirtualBox™ 将 FreeBSD 作为主机</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-virtualbox-install">24.5.1. 安装 VirtualBox™</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-virtualbox-usb-support">24.5.2. VirtualBox™ USB 支持</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-virtualbox-host-dvd-cd-access">24.5.3. VirtualBox™ 主机 DVD/CD 访问</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-bhyve">24.6. 使用 bhyve 作为 FreeBSD 主机</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-prep">24.6.1. 准备主机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-freebsd">24.6.2. 创建一个 FreeBSD 虚拟机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-linux">24.6.3. 创建一个 Linux® 虚拟机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-uefi">24.6.4. 使用 UEFI 固件引导 bhyve 虚拟机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-framebuffer">24.6.5. bhyve 客户机的图形 UEFI 帧缓冲</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-zfs">24.6.6. 使用 ZFS 与 bhyve 虚拟机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-nmdm">24.6.7. 虚拟机控制台</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-managing">24.6.8. 管理虚拟机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-bhyve-onboot">24.6.9. 持久化配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-xen">24.7. FreeBSD 作为 Xen™ 主机</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-xen-requirements">24.7.1. Xen™ Dom0 的硬件要求</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-xen-dom0-setup">24.7.2. Xen™ Dom0 控制域设置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-xen-domu-setup">24.7.3. Xen™ DomU 客户机虚拟机配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/virtualization/#virtualization-host-xen-troubleshooting">24.7.4. 故障排除</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/">
              第 25 章 本地化 - i18n/L10n 的使用和设置
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#l10n-synopsis">25.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#using-localization">25.2. 使用本地化</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#setting-locale">25.2.1. 设置登录 Shell 的区域设置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#setting-console">25.2.2. 控制台设置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#_xorg_设置">25.2.3. Xorg 设置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#l10n-compiling">25.3. 寻找国际化应用程序</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#lang-setup">25.4. 特定语言的区域配置</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#ru-localize">25.4.1. 俄语（ KOI8-R 编码）</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/l10n/#_其他语言特定资源">25.4.2. 其他语言特定资源</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/">
              第 26 章 更新和升级 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-upgrading-synopsis">26.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">26.2. FreeBSD 更新</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#freebsdupdate-config-file">26.2.1. 配置文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#freebsdupdate-security-patches">26.2.2. 应用安全补丁</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#freebsdupdate-upgrade">26.2.3. 执行次要和主要版本升级</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#freebsdupdate-system-comparison">26.2.4. 系统状态比较</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-bootcode">26.3. 更新引导代码</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-upgrading-documentation">26.4. 更新文档集合</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-installed-documentation">26.4.1. 从源代码更新文档</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#current-stable">26.5. 跟踪开发分支</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#current">26.5.1. 使用 FreeBSD-CURRENT</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#stable">26.5.2. 使用 FreeBSD-STABLE</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#translate-n-number">26.5.3. N 号码</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#makeworld">26.6. 从源代码更新 FreeBSD</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-quick-start">26.6.1. 快速入门</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-preparing">26.6.2. 准备进行源代码更新</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-obtaining-src">26.6.3. 更新源代码</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-building">26.6.4. 从源代码构建</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-installing">26.6.5. 安装编译后的代码</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#updating-src-completing">26.6.6. 完成更新</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#small-lan">26.7. 多台机器的追踪</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/cutting-edge/#building-on-non-freebsd-hosts">26.8. 在非 FreeBSD 主机上构建</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/dtrace/">
              第 27 章 DTrace
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/dtrace/#dtrace-synopsis">27.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/dtrace/#dtrace-implementation">27.2. 实现差异</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/dtrace/#dtrace-enable">27.3. 启用 DTrace 支持</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/dtrace/#dtrace-using">27.4. 使用 DTrace</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bdb217202a0a3eef4571dd1fcd50863c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bdb217202a0a3eef4571dd1fcd50863c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/">
              第 28 章 USB 设备模式 /USB OTG
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#usb-device-mode-synopsis">28.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#usb-device-mode-terminals">28.2. USB 虚拟串口</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_配置_usb_设备模式串口">28.2.1. 配置 USB 设备模式串口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_从_freebsd_连接到_usb_设备模式串口">28.2.2. 从 FreeBSD 连接到 USB 设备模式串口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_在_macos_上连接_usb_设备模式串口">28.2.3. 在 macOS 上连接 USB 设备模式串口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_在_linux_上连接_usb_设备模式串口">28.2.4. 在 Linux 上连接 USB 设备模式串口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_在_microsoft_windows_10_上连接_usb_设备模式串口">28.2.5. 在 Microsoft Windows 10 上连接 USB 设备模式串口</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#usb-device-mode-network">28.3. USB 设备模式网络接口</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#usb-device-mode-storage">28.4. USB 虚拟存储设备</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_使用_cfumass_启动脚本配置_usb_大容量存储目标">28.4.1. 使用 cfumass 启动脚本配置 USB 大容量存储目标</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/usb-device-mode/#_使用其他方法配置_usb_大容量存储设备">28.4.2. 使用其他方法配置 USB 大容量存储设备</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/partiv/">
              第四部分：网络通信
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/">
              第 29 章 串行通信
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serial-synopsis">29.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serial">29.2. 串行术语和硬件</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#term-cables-null">29.2.1. 串行电缆和端口</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serial-hw-config">29.2.2. 串口配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#term">29.3. 终端</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#term-config">29.3.1. 终端配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#term-debug">29.3.2. 连接故障排除</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#dialup">29.4. 拨入服务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#dialup-ttys">29.4.1. 调制解调器配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#_故障排除">29.4.2. 故障排除</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#dialout">29.5. 拨出服务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#hayes-unsupported">29.5.1. 使用一台斯托克海斯调制解调器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#direct-at">29.5.2. 使用 <code>AT</code> 命令</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#gt-failure">29.5.3. ` @ ` 符号不起作用</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#dial-command-line">29.5.4. 从命令行拨号</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#set-bps">29.5.5. 设置波特率</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#terminal-server">29.5.6. 通过终端服务器访问多台主机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#tip-multiline">29.5.7. 使用多行显示 <code>tip</code> 提示信息</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#multi-controlp">29.5.8. 使用 Force 字符</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#uppercase">29.5.9. 大写字母</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#tip-filetransfer">29.5.10. 使用 <code>tip</code> 进行文件传输</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#zmodem-tip">29.5.11. 使用 <code>tip</code> 与 zmodem 一起使用？</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serialconsole-setup">29.6. 设置串行控制台</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serialconsole-howto-fast">29.6.1. 快速串行控制台配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serialconsole-howto">29.6.2. 深入的串行控制台配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#_设置更快的串口速度">29.6.3. 设置更快的串口速度</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/serialcomms/#serialconsole-ddb">29.6.4. 通过串行线进入 DDB 调试器</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/">
              第 30 章 PPP
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">30.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#userppp">30.2. 配置 PPP</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#userppp-staticIP">30.2.1. 基本配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_高级配置">30.2.2. 高级配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#userppp-final">30.2.3. 最终系统配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_使用_ppp">30.2.4. 使用 <code>ppp</code></a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#userppp-mgetty">30.2.5. 配置拨入服务</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#ppp-troubleshoot">30.3. PPP 连接故障排除</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_检查设备节点">30.3.1. 检查设备节点</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_手动连接">30.3.2. 手动连接</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_调试">30.3.3. 调试</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#pppoe">30.4. 使用以太网上的点对点协议（ PPP over Ethernet ， PPPoE ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_使用_pppoe_服务标签">30.4.1. 使用 PPPoE 服务标签</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#ppp-3com">30.4.2. 使用 3Com® HomeConnect™ ADSL Modem Dual Link 的 PPPoE</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#pppoa">30.5. 使用 ATM 上的 PPP （ PPPoA ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_使用_mpd">30.5.1. 使用 mpd</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/ppp-and-slip/#_使用_pptpclient">30.5.2. 使用 pptpclient</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/">
              第 31 章 电子邮件
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-synopsis">31.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-using">31.2. 邮件组件</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#dragonFly-mail-agent">31.3. DragonFly Mail Agent （ DMA ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#configuring-dragonfly-mail-agent">31.3.1. 配置 DragonFly Mail Agent (DMA)</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#sendmail">31.4. Sendmail 是一种用于电子邮件传输的开源软件。它是一种邮件传输代理（ MTA ），用于将电子邮件从发送者的计算机发送到接收者的计算机。 Sendmail 具有广泛的功能和灵活性，可以在各种操作系统上运行，并且被广泛用于互联网上的电子邮件传输。它支持多种邮件协议和格式，并提供了丰富的配置选项，使用户能够根据自己的需求进行定制。 Sendmail 是互联网上最早的邮件传输代理之一，至今仍然被广泛使用。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#configuring-sendmail">31.4.1. 配置文件</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-changingmta">31.5. 更改邮件传输代理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#replace-sendmail-dma">31.5.1. 替换 Sendmail 与其他 MTA</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#replace-dma">31.5.2. 用其他邮件传输代理（ MTA ）替换 DragonFly Mail Agent （ DMA ）</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-agents">31.6. 邮件用户代理</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-command">31.6.1. 邮件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mutt-command">31.6.2. Mutt 是一个基于文本的电子邮件客户端，它在 Unix-like 操作系统上运行。它具有高度可定制性和灵活性，可以通过配置文件进行个性化设置。 Mutt 支持多种邮件协议，包括 POP3 、 IMAP 和 SMTP ，并且可以与其他工具集成，如 GnuPG 和 Muttprint 。它被广泛用于命令行环境下的电子邮件管理。</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#alpine-command">31.6.3. 阿尔卑斯</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-advanced">31.7. 高级主题</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-config">31.7.1. 基本配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#mail-domain">31.7.2. 域名的邮件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#outgoing-only">31.7.3. 设置仅发送的配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mail/#SMTP-Auth">31.7.4. Sendmail 中的 SMTP 身份验证</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/">
              第 32 章 网络服务器
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-servers-synopsis">32.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-inetd">32.2. inetd 超级服务器</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-inetd-conf">32.2.1. 配置文件</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-inetd-cmdline">32.2.2. 命令行选项</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-inetd-security">32.2.3. 安全考虑</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-nfs">32.3. 网络文件系统（ NFS ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-configuring-nfs">32.3.1. 配置服务器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_配置客户端">32.3.2. 配置客户端</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_锁定">32.3.3. 锁定</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-autofs">32.3.4. 使用 autofs(5) 自动挂载</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-nis">32.4. 网络信息系统（ NIS ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_nis_术语和流程">32.4.1. NIS 术语和流程</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_机器类型">32.4.2. 机器类型</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_规划考虑因素">32.4.3. 规划考虑因素</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_配置_nis_主服务器">32.4.4. 配置 NIS 主服务器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_设置一个_nis_从服务器">32.4.5. 设置一个 NIS 从服务器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_设置_nis_客户端">32.4.6. 设置 NIS 客户端</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_nis_安全">32.4.7. NIS 安全</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-netgroups">32.4.8. 使用 Netgroups</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_密码格式">32.4.9. 密码格式</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-ldap">32.5. 轻量级目录访问协议（ LDAP ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_ldap_术语和结构">32.5.1. LDAP 术语和结构</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#ldap-config">32.5.2. 配置 LDAP 服务器</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-dhcp">32.6. 动态主机配置协议（ DHCP ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_配置_dhcp_客户端">32.6.1. 配置 DHCP 客户端</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-dhcp-server">32.6.2. 安装和配置 DHCP 服务器</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-dns">32.7. 域名系统（ DNS ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_运行名称服务器的原因">32.7.1. 运行名称服务器的原因</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_dns_服务器配置">32.7.2. DNS 服务器配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_权威名称服务器配置">32.7.3. 权威名称服务器配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-apache">32.8. Apache HTTP Server 是一个开源的 Web 服务器软件，它是目前最流行的 Web 服务器之一。它由 Apache 软件基金会开发和维护，可运行在多种操作系统上，包括 Windows 、 Linux 和 Unix 等。 Apache HTTP Server 具有高度可扩展性和灵活性，支持多种模块和插件，可以实现各种功能，如动态内容生成、虚拟主机配置和安全性控制等。它还提供了丰富的文档和社区支持，使得用户能够轻松地学习和使用。无论是个人网站还是大型企业应用， Apache HTTP Server 都是一个可靠和强大的选择。</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_配置和启动_apache">32.8.1. 配置和启动 Apache</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_虚拟主机">32.8.2. 虚拟主机</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_apache_模块">32.8.3. Apache 模块</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_动态网站">32.8.4. 动态网站</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-ftp">32.9. 文件传输协议（ FTP ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_配置">32.9.1. 配置</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-samba">32.10. 适用于 Microsoft® Windows® 客户端的文件和打印服务（ Samba ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_服务器配置">32.10.1. 服务器配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_启动_samba">32.10.2. 启动 Samba</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-ntp">32.11. 使用 NTP 进行时钟同步</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_ntp_配置">32.11.1. NTP 配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#_使用_ppp_连接的_ntp">32.11.2. 使用 PPP 连接的 NTP</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-iscsi">32.12. iSCSI 发起者和目标配置</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-iscsi-target">32.12.1. 配置 iSCSI 目标</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers/#network-iscsi-initiator">32.12.2. 配置 iSCSI 发起者</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/">
              第 33 章 防火墙
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-intro">33.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-concepts">33.2. 防火墙概念</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-pf">33.3. PF</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_启用_pf">33.3.1. 启用 PF</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#pf-tutorial">33.3.2. PF 规则集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_启用_altq">33.3.3. 启用 ALTQ</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipfw">33.4. IPFW</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipfw-enable">33.4.1. 启用 IPFW</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipfw-rules">33.4.2. IPFW 规则语法</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_示例规则集">33.4.3. 示例规则集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#in-kernel-nat">33.4.4. 内核级网络地址转换（In-kernel NAT）</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipfw-cmd">33.4.5. IPFW 命令</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipfw-kernelconfig">33.4.6. IPFW 内核选项</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-ipf">33.5. IPFILTER (IPF)</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_启用_ipf">33.5.1. 启用 IPF</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_ipf_规则语法">33.5.2. IPF 规则语法</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_示例规则集_2">33.5.3. 示例规则集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_配置_nat">33.5.4. 配置 NAT</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_查看_ipf_统计信息">33.5.5. 查看 IPF 统计信息</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_ipf_日志记录">33.5.6. IPF 日志记录</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#firewalls-blacklistd">33.6. 黑名单服务</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_启用_blacklistd">33.6.1. 启用 Blacklistd</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_创建一个_blacklistd_规则集">33.6.2. 创建一个 Blacklistd 规则集</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_黑名单客户端配置">33.6.3. 黑名单客户端配置</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_黑名单管理">33.6.4. 黑名单管理</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/firewalls/#_从阻止列表中移除主机">33.6.5. 从阻止列表中移除主机</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/">
              第 34 章 . 高级网络
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#advanced-networking-synopsis">34.1. 简介</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-routing">34.2. 网关和路由</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-routing-default">34.2.1. 路由基础知识</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-static-routes">34.2.2. 使用静态路由配置路由器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-routing-troubleshooting">34.2.3. 故障排除</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-routing-multicast">34.2.4. 多播考虑因素</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#configtuning-virtual-hosts">34.3. 虚拟主机</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-advanced-wireless">34.4. 无线高级认证</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-wireless-wpa-eap-tls">34.4.1. WPA 与 EAP-TLS</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-wireless-wpa-eap-ttls">34.4.2. WPA 与 EAP-TTLS</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-wireless-wpa-eap-peap">34.4.3. WPA 与 EAP-PEAP</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#wireless-ad-hoc-mode">34.5. 无线自组网模式</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-wireless-ap">34.5.1. FreeBSD 主机访问点</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-usb-tethering">34.6. USB 网络共享</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-bluetooth">34.7. 蓝牙</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_加载蓝牙支持">34.7.1. 加载蓝牙支持</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_查找其他蓝牙设备">34.7.2. 查找其他蓝牙设备</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_设备配对">34.7.3. 设备配对</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_使用_ppp_配置文件的网络访问">34.7.4. 使用 PPP 配置文件的网络访问</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_蓝牙协议">34.7.5. 蓝牙协议</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_故障排除">34.7.6. 故障排除</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-bridging">34.8. 桥接</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_启用桥接功能">34.8.1. 启用桥接功能</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_启用生成树">34.8.2. 启用生成树</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_桥接接口参数">34.8.3. 桥接接口参数</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_snmp_监控">34.8.4. SNMP 监控</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-aggregation">34.9. 链路聚合和故障转移</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_配置示例">34.9.1. 配置示例</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-diskless">34.10. 使用 PXE 进行无盘操作</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-pxe-nfs">34.10.1. 设置 PXE 环境</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-pxe-setting-up-dhcp">34.10.2. 配置 DHCP 服务器</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#_调试_pxe_问题">34.10.3. 调试 PXE 问题</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#carp">34.11. 常见地址冗余协议（ CARP ）</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#carp-10x">34.11.1. 在 FreeBSD 10 及更高版本上使用 CARP</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#carp-9x">34.11.2. 在 FreeBSD 9 及更早版本上使用 CARP</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking/#network-vlan">34.12. 虚拟局域网（ VLANs ）</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/partv/">
              第五部分. 附录
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/mirrors/">
              附录 A. 获取 FreeBSD
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bibliography/">
              附录 B. 参考文献
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bibliography/#bibliography-freebsd">B.1. FreeBSD 参考文献</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bibliography/#bibliography-security">B.2. 安全参考</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bibliography/#bibliography-history">B.3. UNIX® 历史</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/bibliography/#bibliography-journals">B.4. 期刊、杂志和期刊</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/">
              附录 C. 互联网资源
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-www">C.1. 网站</a></li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-mail">C.2. 邮件列表</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-subscribe">C.2.1. 如何订阅或取消订阅</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-charters">C.2.2. 列表基本规则</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-mailfiltering">C.2.3. 在邮件列表上进行过滤</a></li>
      </ul>
    </li>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#eresources-news">C.3. Usenet 新闻组</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#_bsd_特定的新闻组">C.3.1. BSD 特定的新闻组</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#_其他感兴趣的_unix_新闻组">C.3.2. 其他感兴趣的 UNIX® 新闻组</a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/eresources/#_x_window_system">C.3.3. X Window System</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/">
              附录 D. OpenPGP 密钥
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/#pgpkeys-officers">D.1. 官员们</a>
      <ul>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/#_security_officer_name_security_officer_email">D.1.1. {security-officer-name} <code><{security-officer-email}></code></a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/#_core_secretary_name_core_secretaryfreebsd_org">D.1.2. {core-secretary-name} <code><core-secretary@FreeBSD.org></code></a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/#_portmgr_secretary_name_portmgr_secretary_email">D.1.3. {portmgr-secretary-name} <code><{portmgr-secretary-email}></code></a></li>
        <li><a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/pgpkeys/#_doceng_secretaryfreebsd_org_是一个占位符表示文档工程部门秘书的电子邮件地址">D.1.4. <code><doceng-secretary@FreeBSD.org></code> 是一个占位符，表示文档工程部门秘书的电子邮件地址。</a></li>
      </ul>
    </li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-2a8deedf14429128049622ec007c9d3f" class="toggle"  />
          <label  for="chapter-2a8deedf14429128049622ec007c9d3f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/glossary/">
              FreeBSD 词汇表
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-110dbb242491bf200e51e76db171f670" class="toggle"  />
          <label  for="chapter-110dbb242491bf200e51e76db171f670"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/colophon/">
              后记
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-caffbcba74982e4b26b9263ac0232bc3" class="toggle"  />
          <label  for="chapter-caffbcba74982e4b26b9263ac0232bc3"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/zh-cn-auto/books/handbook/introduction/">
              
            </a>
            
            
          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">第 33 章 防火墙</h1>
    
    
      <div class="admonitionblock note">
        <p>
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          如果发现翻译错误，请直接 <a href="https://github.com/fierceX/freebsd-doc-cn/pulls" target="_blank">发起PR修改</a>。
        </p>
      </div>
    
    
    
    <div class="toc-mobile">
      <h3>目录</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#firewalls-intro">33.1. 简介</a></li>
    <li><a href="#firewalls-concepts">33.2. 防火墙概念</a></li>
    <li><a href="#firewalls-pf">33.3. PF</a>
      <ul>
        <li><a href="#_启用_pf">33.3.1. 启用 PF</a></li>
        <li><a href="#pf-tutorial">33.3.2. PF 规则集</a></li>
        <li><a href="#_启用_altq">33.3.3. 启用 ALTQ</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-ipfw">33.4. IPFW</a>
      <ul>
        <li><a href="#firewalls-ipfw-enable">33.4.1. 启用 IPFW</a></li>
        <li><a href="#firewalls-ipfw-rules">33.4.2. IPFW 规则语法</a></li>
        <li><a href="#_示例规则集">33.4.3. 示例规则集</a></li>
        <li><a href="#in-kernel-nat">33.4.4. 内核级网络地址转换（In-kernel NAT）</a></li>
        <li><a href="#firewalls-ipfw-cmd">33.4.5. IPFW 命令</a></li>
        <li><a href="#firewalls-ipfw-kernelconfig">33.4.6. IPFW 内核选项</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-ipf">33.5. IPFILTER (IPF)</a>
      <ul>
        <li><a href="#_启用_ipf">33.5.1. 启用 IPF</a></li>
        <li><a href="#_ipf_规则语法">33.5.2. IPF 规则语法</a></li>
        <li><a href="#_示例规则集_2">33.5.3. 示例规则集</a></li>
        <li><a href="#_配置_nat">33.5.4. 配置 NAT</a></li>
        <li><a href="#_查看_ipf_统计信息">33.5.5. 查看 IPF 统计信息</a></li>
        <li><a href="#_ipf_日志记录">33.5.6. IPF 日志记录</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-blacklistd">33.6. 黑名单服务</a>
      <ul>
        <li><a href="#_启用_blacklistd">33.6.1. 启用 Blacklistd</a></li>
        <li><a href="#_创建一个_blacklistd_规则集">33.6.2. 创建一个 Blacklistd 规则集</a></li>
        <li><a href="#_黑名单客户端配置">33.6.3. 黑名单客户端配置</a></li>
        <li><a href="#_黑名单管理">33.6.4. 黑名单管理</a></li>
        <li><a href="#_从阻止列表中移除主机">33.6.5. 从阻止列表中移除主机</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="firewalls-intro">33.1. 简介<a class="anchor" href="#firewalls-intro"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>防火墙使得过滤通过系统流动的进出流量成为可能。防火墙可以使用一个或多个“规则”集来检查进出网络连接的网络数据包，并允许流量通过或阻止它。防火墙的规则可以检查数据包的一个或多个特征，如协议类型、源或目标主机地址以及源或目标端口。</p>
</div>
<div class="paragraph">
<p>防火墙可以增强主机或网络的安全性。它们可以用于执行以下一项或多项功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>保护和隔离内部网络中的应用程序、服务和机器，以防止来自公共互联网的不必要的流量。</p>
</li>
<li>
<p>限制或禁止内部网络主机访问公共互联网的服务。</p>
</li>
<li>
<p>支持网络地址转换（NAT），允许内部网络使用私有 IP 地址，并使用单个 IP 地址或共享的自动分配的公共地址池与公共互联网建立单一连接。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FreeBSD 基本系统内置了三个防火墙：PF、IPFW 和 IPFILTER（也称为 IPF）。FreeBSD 还提供了两个流量整形器，用于控制带宽使用：<a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a>。ALTQ 通常与 PF 紧密关联，而 dummynet 与 IPFW 关联。每个防火墙使用规则来控制数据包对 FreeBSD 系统的访问，尽管它们的实现方式不同，并且每个防火墙都有不同的规则语法。</p>
</div>
<div class="paragraph">
<p>FreeBSD 提供多个防火墙，以满足各种用户的不同需求和偏好。每个用户应该评估哪个防火墙最适合他们的需求。</p>
</div>
<div class="paragraph">
<p>阅读完本章后，您将了解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如何定义数据包过滤规则。</p>
</li>
<li>
<p>FreeBSD 内置防火墙的区别。</p>
</li>
<li>
<p>如何使用和配置 PF 防火墙。</p>
</li>
<li>
<p>如何使用和配置 IPFW 防火墙。</p>
</li>
<li>
<p>如何使用和配置 IPFILTER 防火墙。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在阅读本章之前，你应该：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>了解基本的 FreeBSD 和互联网概念。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>由于所有防火墙都是基于检查选定数据包控制字段的值，因此防火墙规则集的创建者必须了解 TCP/IP 的工作原理，数据包控制字段中不同值的含义，以及这些值在正常会话中的使用方式。对于一个很好的介绍，请参考 <a href="http://www.ipprimer.com">Daryl 的 TCP/IP 入门指南</a> 。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="firewalls-concepts">33.2. 防火墙概念<a class="anchor" href="#firewalls-concepts"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>一个规则集包含一组规则，根据数据包中包含的值来通过或阻止数据包。主机之间的双向数据包交换构成一个会话对话。防火墙规则集处理来自公共互联网的数据包以及系统作为对其响应而产生的数据包。每个 TCP/IP 服务都由其协议和监听端口预定义。目标为特定服务的数据包源自源地址使用非特权端口，并且目标地址上的特定服务端口。所有上述参数都可以用作选择条件来创建将通过或阻止服务的规则。</p>
</div>
<div class="paragraph">
<p>要查找未知的端口号，请参考 <span class="filename">/etc/services</span>。或者，访问 [<a href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers" class="bare">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers</a>](<a href="http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)，进行端口号查找以找到特定端口号的用途。" class="bare">http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)，进行端口号查找以找到特定端口号的用途。</a></p>
</div>
<div class="paragraph">
<p>请查看此链接，了解 <a href="http://web.archive.org/web/20150803024617/http://www.sans.org/security-resources/idfaq/oddports.php">Trojans 使用的端口号</a>。</p>
</div>
<div class="paragraph">
<p>FTP 有两种模式：主动模式和被动模式。它们的区别在于数据通道的获取方式。被动模式更安全，因为数据通道是由原始的 FTP 会话请求者获取的。关于 FTP 和不同模式的详细解释，请参见 <a href="http://www.slacksite.com/other/ftp.html">http://www.slacksite.com/other/ftp.html</a>。</p>
</div>
<div class="paragraph">
<p>防火墙规则集可以是“排他性（exclusive）”或“包容性（inclusive）”。排他性防火墙允许所有流量通过，除了与规则集匹配的流量。而包容性防火墙则相反，它只允许与规则匹配的流量通过，阻止其他所有流量。</p>
</div>
<div class="paragraph">
<p>一个包容性防火墙可以更好地控制出站流量，因此对于向公共互联网提供服务的系统来说是更好的选择。它还可以控制来自公共互联网的流量类型，以便访问私有网络。所有不符合规则的流量都会被阻止并记录。包容性防火墙通常比排他性防火墙更安全，因为它们显著降低了允许不需要的流量的风险。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>除非另有说明，本章中的所有配置和示例规则集都创建包容性防火墙规则集。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>可以使用“有状态防火墙（stateful firewall）”进一步加强安全性。这种类型的防火墙会跟踪打开的连接，并且只允许与现有连接匹配或打开新的允许连接的流量通过。</p>
</div>
<div class="paragraph">
<p>有状态过滤将流量视为会话中的双向数据包交换。当在匹配规则上指定状态时，防火墙会动态生成每个会话期间预期交换的数据包的内部规则。它具有足够的匹配能力来确定数据包是否适用于会话。任何不符合会话模板的数据包都会被自动拒绝。</p>
</div>
<div class="paragraph">
<p>当会话完成时，它将从动态状态表中移除。</p>
</div>
<div class="paragraph">
<p>有状态过滤允许我们专注于阻止/通过新的会话。如果新的会话被通过，所有后续的数据包将自动被允许通过，任何冒充的数据包将自动被拒绝。如果新的会话被阻止，它的所有后续数据包都将被禁止。有状态过滤提供了高级匹配能力，能够抵御攻击者使用的各种攻击方法。</p>
</div>
<div class="paragraph">
<p>NAT 代表网络地址转换。NAT 功能使得防火墙后面的私有局域网能够共享一个由 ISP 分配的 IP 地址，即使该地址是动态分配的。NAT 允许局域网中的每台计算机都能够访问互联网，而无需为多个互联网账户或 IP 地址向 ISP 付费。</p>
</div>
<div class="paragraph">
<p>NAT 会自动将局域网上每个系统的私有 LAN IP 地址转换为单个公共 IP 地址，以便在通过防火墙发送到公共互联网的数据包中使用。它还会对返回的数据包执行相反的转换。</p>
</div>
<div class="paragraph">
<p>根据 RFC 1918，以下 IP 地址范围被保留用于私有网络，这些地址将不会直接路由到公共互联网，因此可用于与 NAT 一起使用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>10.0.0.0/8</code>。</p>
</li>
<li>
<p><code>172.16.0.0/12</code>。</p>
</li>
<li>
<p><code>192.168.0.0/16</code>。</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在处理防火墙规则时，请非常小心。某些配置可能会将管理员锁在服务器外。为了安全起见，考虑从本地控制台执行初始防火墙配置，而不是通过 ssh 远程执行。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="firewalls-pf">33.3. PF<a class="anchor" href="#firewalls-pf"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>自从 FreeBSD 5.3 版本以来，OpenBSD 的 PF 防火墙的移植版本已经作为基本系统的一部分包含在其中。PF 是一个完整的、功能齐全的防火墙，可选择性地支持 ALTQ（Alternate Queuing ），提供了服务质量（QoS）功能。</p>
</div>
<div class="paragraph">
<p>OpenBSD 项目在 <a href="http://www.openbsd.org/faq/pf/">PF FAQ</a> 中维护了 PF 的权威参考。Peter Hansteen 在 <a href="http://home.nuug.no/\~" class="bare">http://home.nuug.no/\~</a> peter/pf/[<a href="http://home.nuug.no/~peter/pf/" class="bare">http://home.nuug.no/~peter/pf/</a>] 上维护了一个详尽的 PF 教程。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>阅读 <a href="http://www.openbsd.org/faq/pf/">PF FAQ</a> 时，请记住多年来，FreeBSD 的 PF 版本与上游的 OpenBSD 版本有很大的差异。在 FreeBSD 上，不是所有的功能都与 OpenBSD 上的工作方式相同，反之亦然。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>{freebsd-pf} 是一个很好的地方，可以询问有关配置和运行 PF 防火墙的问题。在提问之前，请先查看邮件列表的存档，因为可能已经有人回答过了。</p>
</div>
<div class="paragraph">
<p>本手册的这一部分重点介绍了与 FreeBSD 相关的 PF。它演示了如何启用 PF 和 ALTQ。还提供了在 FreeBSD 系统上创建规则集的几个示例。</p>
</div>
<div class="sect2">
<h3 id="_启用_pf">33.3.1. 启用 PF<a class="anchor" href="#_启用_pf"></a></h3>
<div class="paragraph">
<p>要使用 PF，首先必须加载其内核模块。本节描述了可以添加到 <span class="filename">/etc/rc.conf</span> 文件中以启用 PF 的条目。</p>
</div>
<div class="paragraph">
<p>首先，在 <span class="filename">/etc/rc.conf</span> 中添加 <code>pf_enable=yes</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc pf_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>当启动 PF 时，可以传递在 <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a> 中描述的其他选项。在 <span class="filename">/etc/rc.conf</span> 中添加或更改此条目，并在两个引号（<code>&#34;&#34;</code>）之间指定任何所需的标志。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pf_flags=&#34;&#34;                     # additional flags for pfctl startup</pre>
</div>
</div>
<div class="paragraph">
<p>如果 PF 无法找到其规则集配置文件，则不会启动。默认情况下，FreeBSD 不提供规则集，并且没有 <span class="filename">/etc/pf.conf</span> 文件。示例规则集可以在 <span class="filename">/usr/share/examples/pf/</span> 中找到。如果已经将自定义规则集保存在其他位置，请在 <span class="filename">/etc/rc.conf</span> 文件中添加一行，指定文件的完整路径：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pf_rules=&#34;/path/to/pf.conf&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>PF 提供了日志记录支持，可以通过 <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a> 来查看。要启用日志记录支持，请将 <code>pflog_enable=yes</code> 添加到 <span class="filename">/etc/rc.conf</span> 文件中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc pflog_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>还可以添加以下行来更改日志文件的默认位置，或者指定在启动 <a href="https://man.freebsd.org/cgi/man.cgi?query=pflog&amp;sektion=4&amp;format=html">pflog(4)</a> 时传递的任何其他标志：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pflog_logfile=&#34;/var/log/pflog&#34;  # where pflogd should store the logfile
pflog_flags=&#34;&#34;                  # additional flags for pflogd startup</pre>
</div>
</div>
<div class="paragraph">
<p>最后，如果防火墙后面有一个局域网，并且需要转发局域网上的计算机的数据包，或者需要进行网络地址转换（NAT），请启用以下选项：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gateway_enable=&#34;YES&#34;            # Enable as LAN gateway</pre>
</div>
</div>
<div class="paragraph">
<p>保存所需的编辑后，可以通过输入以下命令启动带有日志支持的 PF：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service pf start</span>
<span class="c"># service pflog start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，PF 从 <span class="filename">/etc/pf.conf</span> 读取其配置规则，并根据该文件中指定的规则或定义修改、丢弃或通过数据包。FreeBSD 安装包含位于 <span class="filename">/usr/share/examples/pf/</span> 的几个示例文件。请参考 <a href="http://www.openbsd.org/faq/pf/">PF FAQ</a> 以获取完整的 PF 规则集覆盖范围。</p>
</div>
<div class="paragraph">
<p>要控制 PF，请使用 <code>pfctl</code> 命令。<a href="#pfctl">有用的 <code>pfctl</code> 选项</a> 总结了一些对该命令有用的选项。有关所有可用选项的描述，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a>。</p>
</div>
<table id="pfctl" class="tableblock frame-none grid-all stretch">
<caption class="title">表 1. 有用的 <code>pfctl</code> 选项</caption>
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">命令</th>
<th class="tableblock halign-left valign-top">目的</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pfctl -e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用 PF 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pfctl -d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用 PF 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pfctl -F all -f /etc/pf.conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">清除所有的 NAT、过滤、状态和表规则，并重新加载 <span class="filename">/etc/pf.conf</span> 文件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pfctl -s [ rules | nat | states ]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">关于过滤规则、 NAT 规则或状态表的报告。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pfctl -vnf /etc/pf.conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查 <span class="filename">/etc/pf.conf</span> 是否有错误，但不要加载规则集。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a class="package" href="https://cgit.freebsd.org/ports/tree/security/sudo/">security/sudo</a> 是用于运行需要提升权限的命令，例如 <code>pfctl</code>。它可以从 Ports Collection 安装。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>要监视通过 PF 防火墙的流量，请考虑安装 <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/pftop/">sysutils/pftop</a> 包或 port。安装完成后，可以运行 pftop 以查看类似于 <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> 的格式的流量的实时快照。</p>
</div>
</div>
<div class="sect2">
<h3 id="pf-tutorial">33.3.2. PF 规则集<a class="anchor" href="#pf-tutorial"></a></h3>
<div class="paragraph">
<p>本节演示如何创建自定义规则集。它从最简单的规则集开始，并通过多个示例来构建其概念，以展示 PF 的许多功能在实际应用中的用法。</p>
</div>
<div class="paragraph">
<p>最简单的规则集适用于不运行任何服务且需要访问一个网络（可能是互联网）的单台机器。要创建这个最小的规则集，请编辑 <span class="filename">/etc/pf.conf</span> 文件，使其如下所示：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>block in all
pass out all keep state</pre>
</div>
</div>
<div class="paragraph">
<p>第一条规则默认拒绝所有传入流量。第二条规则允许由该系统创建的连接通过，并保留这些连接的状态信息。这些状态信息允许这些连接的返回流量通过，并且只应在可信任的机器上使用。可以使用以下命令加载规则集：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -e ; pfctl -f /etc/pf.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了保持状态，PF 还提供了可以在创建规则时定义和使用的 <em>列表</em> 和 <em>宏</em>。宏可以包含列表，并且需要在使用之前进行定义。例如，在规则集的最顶部插入以下行：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>tcp_services = &#34;{ ssh, smtp, domain, www, pop3, auth, pop3s }&#34;
udp_services = &#34;{ domain }&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>PF 不仅可以识别端口号，还可以识别端口名称，只要这些名称在 <span class="filename">/etc/services</span> 文件中列出。这个例子创建了两个宏。第一个宏是一个包含七个 TCP 端口名称的列表，第二个宏是一个 UDP 端口名称。一旦定义了宏，就可以在规则中使用它们。在这个例子中，除了由该系统发起的与七个指定的 TCP 服务和一个指定的 UDP 服务相关的连接之外，所有流量都被阻止。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>tcp_services = &#34;{ ssh, smtp, domain, www, pop3, auth, pop3s }&#34;
udp_services = &#34;{ domain }&#34;
block all
pass out proto tcp to any port $tcp_services keep state
pass proto udp to any port $udp_services keep state</pre>
</div>
</div>
<div class="paragraph">
<p>尽管 UDP 被认为是一种无状态协议，但 PF 能够跟踪一些状态信息。例如，当传递一个 UDP 请求来询问域名服务器的域名时，PF 会监视响应并将其传递回去。</p>
</div>
<div class="paragraph">
<p>每当对规则集进行编辑时，必须加载新的规则，以便可以使用它们：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -f /etc/pf.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果没有语法错误，<code>pfctl</code> 在加载规则时不会输出任何消息。在尝试加载规则之前，也可以对规则进行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -nf /etc/pf.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>包括 <code>-n</code> 会导致规则仅被解释而不被加载。这提供了纠正任何错误的机会。在任何时候，只有最后一个有效的规则集被加载，直到 PF 被禁用或加载了一个新的规则集。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在 <code>pfctl</code> 规则集的验证或加载命令后添加 <code>-v</code> 参数，将会显示完全解析的规则，这些规则将会被加载。在调试规则时，这非常有用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="pftut-gateway">33.3.2.1. 一个带有 NAT 的简单网关<a class="anchor" href="#pftut-gateway"></a></h4>
<div class="paragraph">
<p>本节演示了如何配置运行 PF 的 FreeBSD 系统，使其充当至少一台其他计算机的网关。网关需要至少两个网络接口，每个接口连接到不同的网络。在本示例中，<span class="filename">xl0</span> 连接到互联网， <span class="filename">xl1</span> 连接到内部网络。</p>
</div>
<div class="paragraph">
<p>首先，启用网关以使机器将其接收到的网络流量从一个接口转发到另一个接口。这个 sysctl 设置将转发 IPv4 数据包：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl net.inet.ip.forwarding=1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要转发 IPv6 流量，请使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl net.inet6.ip6.forwarding=1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要在系统启动时启用这些设置，请使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysrc&amp;sektion=8&amp;format=html">sysrc(8)</a> 将它们添加到 <span class="filename">/etc/rc.conf</span> 文件中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc gateway_enable=yes</span>
<span class="c"># sysrc ipv6_gateway_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>ifconfig</code> 命令验证两个接口是否都已启动并运行。</p>
</div>
<div class="paragraph">
<p>接下来，创建 PF 规则以允许网关传递流量。虽然以下规则允许来自内部网络主机的有状态流量通过网关，但 <code>to</code> 关键字不能保证从源到目的地的完全通过：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass in on xl1 from xl1:network to xl0:network port $ports keep state</pre>
</div>
</div>
<div class="paragraph">
<p>该规则只允许流量通过内部接口进入网关。要让数据包继续传递，需要一个匹配的规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass out on xl0 from xl1:network to xl0:network port $ports keep state</pre>
</div>
</div>
<div class="paragraph">
<p>虽然这两个规则可以工作，但这样具体的规则很少需要。对于忙碌的网络管理员来说，一个可读的规则集是更安全的规则集。本节的其余部分演示了如何尽可能简化规则以提高可读性。例如，这两个规则可以用一条规则来替代：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass from xl1:network to any port $ports keep state</pre>
</div>
</div>
<div class="paragraph">
<p>可以使用宏来替代 <code>interface:network</code> 表示法，使规则集更易读。例如，可以定义一个 <code>$localnet</code> 宏，表示直接连接到内部接口的网络（<code>$xl1:network</code>）。另外，也可以将 <code>$localnet</code> 的定义更改为 <em>IP 地址/子网掩码</em> 表示法来表示网络，例如 <code>192.168.100.1/24</code> 表示私有地址的子网。</p>
</div>
<div class="paragraph">
<p>如果需要的话，<code>$localnet</code> 甚至可以被定义为一个网络列表。无论具体需求如何，一个合理的 <code>$localnet</code> 定义可以在典型的通过规则中使用，如下所示：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass from $localnet to any port $ports keep state</pre>
</div>
</div>
<div class="paragraph">
<p>以下示例规则集允许内部网络上的机器发起的所有流量。它首先定义了两个宏，用于表示网关的外部和内部 3COM 接口。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>对于拨号用户，外部接口将使用 <span class="filename">tun0</span>。对于 ADSL 连接，特别是使用以太网上的 PPP（PPPoE）的连接，正确的外部接口是 <span class="filename">tun0</span>，而不是物理以太网接口。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ext_if = &#34;xl0&#34;	# macro for external interface - use tun0 for PPPoE
int_if = &#34;xl1&#34;	# macro for internal interface
localnet = $int_if:network
# ext_if IP address could be dynamic, hence ($ext_if)
nat on $ext_if from $localnet to any -&gt; ($ext_if)
block all
pass from { lo0, $localnet } to any keep state</pre>
</div>
</div>
<div class="paragraph">
<p>这个规则集引入了 <code>nat</code> 规则，用于处理内部网络中不可路由的地址到分配给外部接口的 IP 地址的网络地址转换。nat 规则的最后部分周围的括号 <code>($ext_if)</code> 是在外部接口的 IP 地址是动态分配时包含的。它确保即使外部 IP 地址发生变化，网络流量也能够正常运行而不会有严重的中断。</p>
</div>
<div class="paragraph">
<p>请注意，这个规则集可能允许更多的流量从网络中通过，而实际上并不需要这么多。一个合理的设置可以创建这个宏：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>client_out = &#34;{ ftp-data, ftp, ssh, domain, pop3, auth, nntp, http, \
    https, cvspserver, 2628, 5999, 8000, 8080 }&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>用于主要通行规则中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto tcp from $localnet to any port $client_out \
    flags S/SA keep state</pre>
</div>
</div>
<div class="paragraph">
<p>可能还需要一些其他的通行规则。这个规则允许在外部接口上使用 SSH ：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass in inet proto tcp to $ext_if port ssh</pre>
</div>
</div>
<div class="paragraph">
<p>这个宏定义和规则允许内部客户端使用 DNS 和 NTP 服务。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>udp_services = &#34;{ domain, ntp }&#34;
pass quick inet proto { tcp, udp } to any port $udp_services keep state</pre>
</div>
</div>
<div class="paragraph">
<p>请注意这条规则中的 <code>quick</code> 关键字。由于规则集包含多个规则，因此了解规则集中规则之间的关系非常重要。规则按照从上到下的顺序进行评估，按照它们编写的顺序进行。对于每个由 PF 评估的数据包或连接，规则集中的 <em>最后一个匹配的规则</em> 是应用的规则。然而，当一个数据包匹配包含 <code>quick</code> 关键字的规则时，规则处理停止，数据包根据该规则进行处理。当需要对一般规则进行异常处理时，这非常有用。</p>
</div>
</div>
<div class="sect3">
<h4 id="pftut-ftp">33.3.2.2. 创建一个 FTP 代理<a class="anchor" href="#pftut-ftp"></a></h4>
<div class="paragraph">
<p>由于 FTP 协议的特性，配置工作中的 FTP 规则可能会出现问题。 FTP 在防火墙出现几十年之前就存在，并且在设计上存在不安全性。使用 FTP 的最常见问题包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>密码以明文形式传输。</p>
</li>
<li>
<p>该协议要求使用至少两个 TCP 连接（控制和数据），并且这两个连接要使用不同的端口。</p>
</li>
<li>
<p>当建立会话时，数据使用随机选择的端口进行通信。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在考虑客户端或服务器软件的潜在安全弱点之前，所有这些要点都提出了安全挑战。存在更安全的文件传输替代方案，例如 <a href="https://man.freebsd.org/cgi/man.cgi?query=sftp&amp;sektion=1&amp;format=html">sftp(1)</a> 或 <a href="https://man.freebsd.org/cgi/man.cgi?query=scp&amp;sektion=1&amp;format=html">scp(1)</a>，它们都具有身份验证和加密连接上的数据传输功能。</p>
</div>
<div class="paragraph">
<p>对于需要使用 FTP 的情况，PF 提供了将 FTP 流量重定向到一个名为 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a> 的小型代理程序，该程序包含在 FreeBSD 的基本系统中。代理的作用是使用一组锚点动态插入和删除规则，以正确处理 FTP 流量。</p>
</div>
<div class="paragraph">
<p>要启用 FTP 代理，请将以下行添加到 <span class="filename">/etc/rc.conf</span> 文件中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ftpproxy_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>然后通过运行以下命令启动代理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># service ftp-proxy start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于基本配置，需要将三个元素添加到 <span class="filename">/etc/pf.conf</span> 文件中。首先是代理将用于插入生成的 FTP 会话规则的锚点：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>nat-anchor &#34;ftp-proxy/*&#34;
rdr-anchor &#34;ftp-proxy/*&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>其次，需要一个通过规则来允许 FTP 流量进入代理服务器。</p>
</div>
<div class="paragraph">
<p>第三，重定向和 NAT 规则需要在过滤规则之前定义。在 <code>nat</code> 规则之后立即插入以下 <code>rdr</code> 规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>rdr pass on $int_if proto tcp from any to any port ftp -&gt; 127.0.0.1 port 8021</pre>
</div>
</div>
<div class="paragraph">
<p>最后，允许重定向的流量通过。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass out proto tcp from $proxy to any port ftp</pre>
</div>
</div>
<div class="paragraph">
<p><code>$proxy</code> 是代理守护程序绑定的地址的展开形式。</p>
</div>
<div class="paragraph">
<p>保存 <span class="filename">/etc/pf.conf</span> 文件，加载新的规则，并从客户端验证 FTP 连接是否正常工作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -f /etc/pf.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子涵盖了一个基本的设置，其中本地网络中的客户端需要联系其他地方的 FTP 服务器。这个基本配置应该适用于大多数 FTP 客户端和服务器的组合。如 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a> 所示，通过在 <code>ftpproxy_flags=</code> 行中添加选项，可以改变代理的行为。一些客户端或服务器可能有特定的问题，在配置中必须进行补偿，或者可能需要以特定的方式集成代理，例如将 FTP 流量分配给特定的队列。</p>
</div>
<div class="paragraph">
<p>要以 PF 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftp-proxy&amp;sektion=8&amp;format=html">ftp-proxy(8)</a> 保护的方式运行 FTP 服务器，可以配置一个独立的 <code>ftp-proxy</code> 以反向模式运行，使用 <code>-R</code> 选项，在一个独立的端口上，并具有自己的重定向通过规则。</p>
</div>
</div>
<div class="sect3">
<h4 id="pftut-icmp">33.3.2.3. 管理 ICMP<a class="anchor" href="#pftut-icmp"></a></h4>
<div class="paragraph">
<p>许多用于调试或故障排除 TCP/IP 网络的工具依赖于 Internet 控制消息协议（ICMP），该协议专门设计用于调试。</p>
</div>
<div class="paragraph">
<p>ICMP 协议在主机和网关之间发送和接收 <em>控制消息（ontrol messages）</em>，主要是为了向发送方提供有关到目标主机的任何异常或困难条件的反馈。路由器使用 ICMP 来协商数据包大小和其他传输参数，这个过程通常被称为 <em>路径 MTU 发现（path MTU discovery）</em>。</p>
</div>
<div class="paragraph">
<p>从防火墙的角度来看，一些 ICMP 控制消息容易受到已知的攻击向量的攻击。此外，无条件地允许所有诊断流量通过可以使调试更容易，但也会使他人更容易提取有关网络的信息。因此，以下规则可能不是最佳选择：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto icmp from any to any</pre>
</div>
</div>
<div class="paragraph">
<p>一种解决方案是允许本地网络中的所有 ICMP 流量通过，同时阻止来自网络外部的所有探测。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto icmp from $localnet to any keep state
pass inet proto icmp from any to $ext_if keep state</pre>
</div>
</div>
<div class="paragraph">
<p>还有其他可用的选项，这些选项展示了 PF 的一些灵活性。例如，可以指定 <a href="https://man.freebsd.org/cgi/man.cgi?query=ping&amp;sektion=8&amp;format=html">ping(8)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a> 使用的消息，而不是允许所有的 ICMP 消息。首先，定义一个用于该类型消息的宏：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>icmp_types = &#34;echoreq&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>和一个使用宏的规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto icmp all icmp-type $icmp_types keep state</pre>
</div>
</div>
<div class="paragraph">
<p>如果需要其他类型的 ICMP 数据包，请将 <code>icmp_types</code> 扩展为这些数据包类型的列表。输入 <code>more /usr/src/sbin/pfctl/pfctl_parser.c</code> 以查看 PF 支持的 ICMP 消息类型列表。请参考 <a href="http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml">http://www.iana.org/assignments/icmp-parameters/icmp-parameters.xhtml</a> 以了解每个消息类型的解释。</p>
</div>
<div class="paragraph">
<p>由于 Unix 的 <code>traceroute</code> 默认使用 UDP，因此需要添加另一条规则来允许 Unix 的 <code>traceroute</code>。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># allow out the default range for traceroute(8):
pass out on $ext_if inet proto udp from any to any port 33433 &gt;&lt; 33626 keep state</pre>
</div>
</div>
<div class="paragraph">
<p>由于 Microsoft Windows 系统上的 <code>TRACERT.EXE</code> 使用 ICMP 回显请求消息，因此只需要第一个规则来允许来自这些系统的网络跟踪。Unix 的 <code>traceroute</code> 也可以指示使用其他协议，并且如果使用了 <code>-I</code> 选项，它将使用 ICMP 回显请求消息。有关详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=traceroute&amp;sektion=8&amp;format=html">traceroute(8)</a> 手册页。</p>
</div>
<div class="sect4">
<h5 id="pftut-pathmtudisc">33.3.2.3.1. 路径 MTU 发现<a class="anchor" href="#pftut-pathmtudisc"></a></h5>
<div class="paragraph">
<p>Internet 协议被设计为与设备无关，设备无关的一个结果是无法可靠地预测给定连接的最佳数据包大小。数据包大小的主要限制是 <em>最大传输单元</em>（MTU），它设置了接口的数据包大小的上限。输入 <code>ifconfig</code> 命令可以查看系统网络接口的 MTU 值。</p>
</div>
<div class="paragraph">
<p>TCP/IP 使用一种称为路径 MTU 发现的过程来确定连接的正确数据包大小。该过程发送大小不同的数据包，并设置“不分片（Do not fragment）”标志，期望在达到上限时收到一个 ICMP 返回数据包，其类型为“type 3, code 4”。Type 3 表示“目标不可达（destination unreachable）”，Code 4 表示“需要分片，但设置了不分片标志（fragmentation needed,but the do-not-fragment flag is set）”。为了支持与其他 MTU 的连接，可以将 <code>destination unreachable</code> 类型添加到 <code>icmp_types</code> 宏中，以允许路径 MTU 发现。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>icmp_types = &#34;{ echoreq, unreach }&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>由于 pass 规则已经使用了该宏，所以不需要修改 pass 规则来支持新的 ICMP 类型。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto icmp all icmp-type $icmp_types keep state</pre>
</div>
</div>
<div class="paragraph">
<p>PF 允许对所有 ICMP 类型和代码进行过滤。可能的类型和代码的列表在 <a href="https://man.freebsd.org/cgi/man.cgi?query=icmp&amp;sektion=4&amp;format=html">icmp(4)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=icmp6&amp;sektion=4&amp;format=html">icmp6(4)</a> 中有文档记录。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pftut-tables">33.3.2.4. 使用表格<a class="anchor" href="#pftut-tables"></a></h4>
<div class="paragraph">
<p>某些类型的数据在特定时间对过滤和重定向很重要，但它们的定义太长了，无法包含在规则集文件中。 PF 支持使用表格，这些表格是定义的列表，可以在不需要重新加载整个规则集的情况下进行操作，并且可以提供快速查找。表格名称始终用 <code>&lt; &gt;</code> 括起来，就像这样：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>table &lt;clients&gt; { 192.168.2.0/24, !192.168.2.5 }</pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，<code>192.168.2.0/24</code> 网络是表的一部分，除了地址 <code>192.168.2.5</code>，它使用 <code>!</code> 运算符被排除在外。还可以从文件中加载表，其中每个项目都在单独的行上，就像在这个例子中看到的那样 <span class="filename">/etc/clients</span>：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>192.168.2.0/24
!192.168.2.5</pre>
</div>
</div>
<div class="paragraph">
<p>要引用该文件，请按照以下方式定义表格：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>table &lt;clients&gt; persist file &#34;/etc/clients&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>一旦表被定义，就可以通过规则进行引用：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass inet proto tcp from &lt;clients&gt; to any port $client_out flags S/SA keep state</pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>pfctl</code> 实时操作表的内容。以下示例将另一个网络添加到表中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -t clients -T add 192.168.1.0/16</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，通过这种方式进行的任何更改将立即生效，这使它们非常适合测试，但在断电或重启后将不会保留。要使更改永久生效，可以修改规则集中表的定义或编辑表所引用的文件。可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> 作业来维护表的磁盘副本，该作业定期将表的内容转储到磁盘上，使用类似 <code>pfctl -t clients -T show &gt;/etc/clients</code> 的命令。或者，也可以使用 <span class="filename">/etc/clients</span> 更新内存中的表内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -t clients -T replace -f /etc/clients</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pftut-overload">33.3.2.5. 使用过载表保护 SSH<a class="anchor" href="#pftut-overload"></a></h4>
<div class="paragraph">
<p>那些在外部接口上运行 SSH 的人可能在身份验证日志中看到类似于以下内容的信息：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Sep 26 03:12:34 skapet sshd[25771]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:34 skapet sshd[5279]: Failed password for root from 200.72.41.31 port 40992 ssh2
Sep 26 03:12:35 skapet sshd[5279]: Received disconnect from 200.72.41.31: 11: Bye Bye
Sep 26 03:12:44 skapet sshd[29635]: Invalid user admin from 200.72.41.31
Sep 26 03:12:44 skapet sshd[24703]: input_userauth_request: invalid user admin
Sep 26 03:12:44 skapet sshd[24703]: Failed password for invalid user admin from 200.72.41.31 port 41484 ssh2</pre>
</div>
</div>
<div class="paragraph">
<p>这表明正在进行一次暴力攻击，某人或某个程序正在尝试发现能够让他们进入系统的用户名和密码。</p>
</div>
<div class="paragraph">
<p>如果需要合法用户进行外部 SSH 访问，更改 SSH 使用的默认端口可以提供一定的保护。然而，PF 提供了一种更优雅的解决方案。通过 Pass 规则，可以限制连接主机的操作，并将违规者放入被拒绝某些或全部访问的地址表中。甚至可以断开超出限制的机器的所有现有连接。</p>
</div>
<div class="paragraph">
<p>要进行配置，请在规则集的表格部分创建此表格。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>table &lt;bruteforce&gt; persist</pre>
</div>
</div>
<div class="paragraph">
<p>然后，在规则集的早期位置添加规则，以阻止暴力访问，同时允许合法访问：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>block quick from &lt;bruteforce&gt;
pass inet proto tcp from any to $localnet port $tcp_services \
    flags S/SA keep state \
    (max-src-conn 100, max-src-conn-rate 15/5, \
    overload &lt;bruteforce&gt; flush global)</pre>
</div>
</div>
<div class="paragraph">
<p>括号中的部分定义了限制条件，数字应根据当地要求进行更改。可以按以下方式阅读：</p>
</div>
<div class="paragraph">
<p><code>max-src-conn</code> 是指允许来自一个主机的同时连接数。</p>
</div>
<div class="paragraph">
<p><code>max-src-conn-rate</code> 是每秒钟（<em>5</em>）允许来自任何单个主机的新连接的速率（<em>15</em>）。</p>
</div>
<div class="paragraph">
<p><code>overload &lt;bruteforce&gt;</code> 的意思是任何超过这些限制的主机都会将其地址添加到 <code>bruteforce</code> 表中。规则集会阻止来自 <code>bruteforce</code> 表中地址的所有流量。</p>
</div>
<div class="paragraph">
<p>最后，<code>flush global</code> 表示当一个主机达到限制时，该主机的所有连接 (<code>global</code>) 将被终止 (<code>flush</code>) 。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这些规则将 <em>不会</em> 阻止慢速暴力破解者，如 <a href="http://home.nuug.no/~peter/hailmary2013/">http://home.nuug.no/~peter/hailmary2013/</a> 中所描述的。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这个示例规则集主要是为了说明。例如，如果希望有大量的连接，但对于 ssh 的要求更加严格，可以在规则集的早期添加以下类似的规则来补充上面的规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>pass quick proto { tcp, udp } from any to any port ssh \
    flags S/SA keep state \
    (max-src-conn 15, max-src-conn-rate 5/3, \
    overload &lt;bruteforce&gt; flush global)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>不一定需要阻止所有超载器：</strong><br/></p>
</div>
<div class="paragraph">
<p>值得注意的是，过载机制是一种通用技术，不仅适用于 SSH，并且完全阻止来自违规者的所有流量并不总是最优的选择。</p>
</div>
<div class="paragraph">
<p>例如，可以使用过载规则来保护邮件服务或网络服务，并且可以在规则中使用过载表来将违规者分配到带有最小带宽分配的队列中，或者重定向到特定的网页。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>随着时间的推移，表格将被过载规则填满，其大小将逐渐增长，占用更多的内存。有时，被阻止的 IP 地址是一个动态分配的地址，后来被分配给了一个有合法理由与本地网络中的主机通信的主机。</p>
</div>
<div class="paragraph">
<p>对于这种情况，pfctl 提供了过期表项的功能。例如，以下命令将删除在 <code>86400</code> 秒内没有被引用的 <code>&lt;bruteforce&gt;</code> 表项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -t bruteforce -T expire 86400</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>类似的功能由 <a class="package" href="https://cgit.freebsd.org/ports/tree/security/expiretable/">security/expiretable</a> 提供，该包会删除在指定时间内未被访问的表条目。</p>
</div>
<div class="paragraph">
<p>安装完成后，可以运行 expiretable 来删除指定时限之前的 <code>&lt;bruteforce&gt;</code> 表条目。以下示例将删除所有 24 小时之前的条目：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/usr/local/sbin/expiretable -v -d -t 24h bruteforce</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pftut-spamd">33.3.2.6. 防止垃圾邮件的保护措施<a class="anchor" href="#pftut-spamd"></a></h4>
<div class="paragraph">
<p>不要将其与 spamassassin 捆绑的 spamd 守护程序混淆，<a class="package" href="https://cgit.freebsd.org/ports/tree/mail/spamd/">mail/spamd</a> 可以通过配置 PF 来提供对垃圾邮件的外部防御。这个 spamd 通过一组重定向钩入 PF 配置。</p>
</div>
<div class="paragraph">
<p>垃圾邮件发送者往往发送大量的消息，垃圾邮件主要来自一些友好的垃圾邮件网络和大量被劫持的机器，这些都会被迅速报告给封锁列表。</p>
</div>
<div class="paragraph">
<p>当接收到来自黑名单中地址的 SMTP 连接时，spamd 会呈现其横幅，并立即切换到一种模式，以逐字节地回答 SMTP 流量。这种技术旨在尽可能浪费垃圾邮件发送者的时间，被称为“蜿蜒（tarpitting）”。具体实现使用逐字节 SMTP 回复的方法通常被称为“口吃（stuttering）”。</p>
</div>
<div class="paragraph">
<p>这个示例演示了使用自动更新的屏蔽列表设置 spamd 的基本步骤。有关更多信息，请参考安装在 <a class="package" href="https://cgit.freebsd.org/ports/tree/mail/spamd/">mail/spamd</a> 中的 man 页面。</p>
</div>
<div class="sidebarblock procedure">
<div class="content">
<div class="olist arabic">
<div class="title">配置 spamd 过程</div>
<ol class="arabic">
<li>
<p>安装 <a class="package" href="https://cgit.freebsd.org/ports/tree/mail/spamd/">mail/spamd</a> 包或 port。要使用 spamd 的灰名单功能，必须在 <span class="filename">/dev/fd</span> 上挂载 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;format=html">fdescfs(5)</a>。将以下行添加到 <span class="filename">/etc/fstab</span>：</p>
<div class="literalblock programlisting">
<div class="content">
<pre> fdescfs /dev/fd fdescfs rw 0 0</pre>
</div>
</div>
<div class="paragraph">
<p>然后，挂载文件系统：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#  mount fdescfs</pre>
</div>
</div>
</li>
<li>
<p>接下来，编辑 PF 规则集以包含以下内容：</p>
<div class="literalblock programlisting">
<div class="content">
<pre>table &lt;spamd&gt; persist
table &lt;spamd-white&gt; persist
rdr pass on $ext_if inet proto tcp from &lt;spamd&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025
rdr pass on $ext_if inet proto tcp from !&lt;spamd-white&gt; to \
    { $ext_if, $localnet } port smtp -&gt; 127.0.0.1 port 8025</pre>
</div>
</div>
<div class="paragraph">
<p>两个表 <code>&lt;spamd&gt;</code> 和 <code>&lt;spamd-white&gt;</code> 是必需的。来自在 <code>&lt;spamd&gt;</code> 中列出但不在 <code>&lt;spamd-white&gt;</code> 中列出的地址的 SMTP 流量将被重定向到监听在端口 8025 的 spamd 守护进程。</p>
</div>
</li>
<li>
<p>下一步是在 <span class="filename">/usr/local/etc/spamd.conf</span> 中配置 spamd，并添加一些 <span class="filename">rc.conf</span> 参数。</p>
<div class="paragraph">
<p><a class="package" href="https://cgit.freebsd.org/ports/tree/mail/spamd/">mail/spamd</a> 安装包括一个示例配置文件（<span class="filename">/usr/local/etc/spamd.conf.sample</span>）和一个用于 <span class="filename">spamd.conf</span> 的 man 页面。请参考这些内容以获取超出本示例所示配置选项的其他配置选项。</p>
</div>
<div class="paragraph">
<p>配置文件中第一行不以 <code>#</code> 注释符号开头的行包含了定义 <code>all</code> 列表的块，该列表指定要使用的列表：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>all:\
    :traplist:allowlist:</pre>
</div>
</div>
<div class="paragraph">
<p>此条目添加了所需的阻止列表，用冒号（<code>:</code>）分隔。要使用允许列表从阻止列表中减去地址，请在该阻止列表的名称之后 <em>立即</em> 添加允许列表的名称。例如：<code>:blocklist:allowlist:</code> 。</p>
</div>
<div class="paragraph">
<p>接下来是指定块列表的定义：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>traplist:\
    :black:\
    :msg=&#34;SPAM. Your address %A has sent spam within the last 24 hours&#34;:\
    :method=http:\
    :file=www.openbsd.org/spamd/traplist.gz</pre>
</div>
</div>
<div class="paragraph">
<p>第一行是块列表的名称，第二行指定了列表类型。<code>msg</code> 字段包含在 SMTP 对话期间显示给被列入块列表的发件人的消息。<code>method</code> 字段指定了 spamd-setup 获取列表数据的方式；支持的方法有 <code>http</code>、<code>ftp</code>、从挂载文件系统中的 <code>file</code> 文件和通过执行外部程序的 <code>exec</code>。最后，<code>file</code> 字段指定了 spamd 期望接收的文件的名称。</p>
</div>
<div class="paragraph">
<p>指定允许列表的定义类似，但省略了 <code>msg</code> 字段，因为不需要消息。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>allowlist:\
    :white:\
    :method=file:\
    :file=/var/mail/allowlist.txt</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>谨慎选择数据源:</strong><br/></p>
</div>
<div class="paragraph">
<p>使用样本中的所有屏蔽列表 <span class="filename">spamd.conf</span> 将会屏蔽大量的互联网区块。管理员需要编辑该文件，以创建一个最佳配置，使用适用的数据源，并在必要时使用自定义列表。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>接下来，将此条目添加到 <span class="filename">/etc/rc.conf</span> 文件中。其他标志在由注释指定的 man 页面中有描述。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>spamd_flags=&#34;-v&#34; # use &#34;&#34; and see spamd-setup(8) for flags</pre>
</div>
</div>
<div class="paragraph">
<p>完成后，重新加载规则集，通过输入 <code>service obspamd start</code> 启动 spamd，并使用 <code>spamd-setup</code> 完成配置。最后，创建一个 <a href="https://man.freebsd.org/cgi/man.cgi?query=cron&amp;sektion=8&amp;format=html">cron(8)</a> 任务，定期调用 <code>spamd-setup</code> 来更新表格。</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>在邮件服务器前的典型网关上，主机很快就会在几秒钟到几分钟内被困住。</p>
</div>
<div class="paragraph">
<p>PF 还支持 <em>灰名单（greylisting）</em>，它会暂时拒绝来自未知主机的带有 <em>45n</em> 代码的消息。在合理的时间内再次尝试的灰名单主机的消息将被放行。符合 RFC 1123 和 RFC 2821 规定的发件人的流量将立即被放行。</p>
</div>
<div class="paragraph">
<p>关于灰名单技术的更多信息可以在 <a href="http://www.greylisting.org/">greylisting.org</a> 网站上找到。灰名单最令人惊讶的事情之一，除了它的简单性，就是它仍然有效。垃圾邮件发送者和恶意软件编写者一直非常慢地适应绕过这种技术。</p>
</div>
<div class="paragraph">
<p>配置灰名单的基本步骤如下：</p>
</div>
<div class="olist arabic procedure">
<div class="title">配置灰名单过程</div>
<ol class="arabic">
<li>
<p>确保按照上一个步骤的说明，将 <a href="https://man.freebsd.org/cgi/man.cgi?query=fdescfs&amp;sektion=5&amp;format=html">fdescfs(5)</a> 挂载起来。</p>
</li>
<li>
<p>要以灰名单模式运行 spamd，请将以下行添加到 <span class="filename">/etc/rc.conf</span> 文件中：</p>
<div class="literalblock programlisting">
<div class="content">
<pre>spamd_grey=&#34;YES&#34;  # use spamd greylisting if YES</pre>
</div>
</div>
<div class="paragraph">
<p>请参考 spamd 手册，了解其他相关参数的描述。</p>
</div>
</li>
<li>
<p>完成灰名单设置的步骤：</p>
<div class="literalblock programlisting">
<div class="content">
<pre>#  service obspamd restart
#  service obspamlogd start</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>在幕后，spamdb 数据库工具和 spamlogd 白名单更新程序为灰名单功能执行重要功能。spamdb 是管理员通过 <span class="filename">/var/db/spamdb</span> 数据库的内容来管理阻止、灰名单和允许名单的主要界面。</p>
</div>
</div>
<div class="sect3">
<h4 id="pftut-hygiene">33.3.2.7. 网络维护<a class="anchor" href="#pftut-hygiene"></a></h4>
<div class="paragraph">
<p>本节介绍了如何使用 <code>block-policy</code>、<code>scrub</code> 和 <code>antispoof</code> 来使规则集的行为正常。</p>
</div>
<div class="paragraph">
<p><code>block-policy</code> 是一个选项，可以在规则集的 <code>options</code> 部分中设置，该部分位于重定向和过滤规则之前。该选项确定了 PF 在规则阻止主机时发送的反馈信息（如果有的话）。该选项有两个可能的值：<code>drop</code> 会丢弃被阻止的数据包而不提供反馈，<code>return</code> 会返回一个状态码，例如 <code>Connection refused</code>。</p>
</div>
<div class="paragraph">
<p>如果未设置，默认策略为 <code>drop</code>。要更改 <code>block-policy</code>，请指定所需的值：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>set block-policy return</pre>
</div>
</div>
<div class="paragraph">
<p>在 PF 中，<code>scrub</code> 是一个关键字，它可以启用网络数据包的规范化。该过程会重新组装分段的数据包，并且丢弃具有无效标志组合的 TCP 数据包。启用 <code>scrub</code> 可以提供一定程度的保护，防止基于数据包片段处理不正确的某些攻击。有许多选项可供选择，但最简单的形式适用于大多数配置：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>scrub in all</pre>
</div>
</div>
<div class="paragraph">
<p>一些服务，如 NFS，需要特定的片段处理选项。有关更多信息，请参阅 <a href="https://home.nuug.no/~peter/pf/en/scrub.html">https://home.nuug.no/~peter/pf/en/scrub.html</a></p>
</div>
<div class="paragraph">
<p>这个例子重新组装片段，清除“不分段（do not fragment）”位，并将最大分段大小设置为 1440 字节：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>scrub in all fragment reassemble no-df max-mss 1440</pre>
</div>
</div>
<div class="paragraph">
<p><code>antispoof</code> 机制通过阻止出现在逻辑上不可能的接口和方向上的数据包，主要保护免受伪造或伪装的 IP 地址的活动的影响。</p>
</div>
<div class="paragraph">
<p>这些规则可以过滤掉来自世界其他地方的伪造流量，以及源自本地网络的任何伪造数据包。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>antispoof for $ext_if
antispoof for $int_if</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pftut-unrouteables">33.3.2.8. 处理非可路由地址<a class="anchor" href="#pftut-unrouteables"></a></h4>
<div class="paragraph">
<p>即使有一个正确配置的网关来处理网络地址转换，人们可能仍然需要弥补其他人的错误配置。常见的错误配置是允许非可路由地址的流量进入互联网。由于来自非可路由地址的流量可能参与多种拒绝服务攻击技术，建议通过外部接口明确地阻止非可路由地址的流量进入网络。</p>
</div>
<div class="paragraph">
<p>在这个例子中，定义了一个包含非可路由地址的宏，然后在阻止规则中使用。对这些地址的流量在网关的外部接口上被静默丢弃。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>martians = &#34;{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \
	      10.0.0.0/8, 169.254.0.0/16, 192.0.2.0/24, \
	      0.0.0.0/8, 240.0.0.0/4 }&#34;

block drop in quick on $ext_if from $martians to any
block drop out quick on $ext_if from any to $martians</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_启用_altq">33.3.3. 启用 ALTQ<a class="anchor" href="#_启用_altq"></a></h3>
<div class="paragraph">
<p>在 FreeBSD 上，可以使用 ALTQ 与 PF 一起提供服务质量（QoS）。一旦启用 ALTQ，可以在规则集中定义队列，确定出站数据包的处理优先级。</p>
</div>
<div class="paragraph">
<p>在启用 ALTQ 之前，请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=altq&amp;sektion=4&amp;format=html">altq(4)</a> 以确定系统上安装的网络卡驱动程序是否支持它。</p>
</div>
<div class="paragraph">
<p>ALTQ 不可用作可加载的内核模块。如果系统的接口支持 ALTQ，请按照 <a href="../kernelconfig/#kernelconfig">配置 FreeBSD 内核</a> 中的说明创建自定义内核。以下内核选项可用。第一个选项用于启用 ALTQ。其他选项中至少需要一个来指定队列调度算法：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options         ALTQ
options         ALTQ_CBQ        # Class Based Queuing (CBQ)
options         ALTQ_RED        # Random Early Detection (RED)
options         ALTQ_RIO        # RED In/Out
options         ALTQ_HFSC       # Hierarchical Packet Scheduler (HFSC)
options         ALTQ_PRIQ       # Priority Queuing (PRIQ)</pre>
</div>
</div>
<div class="paragraph">
<p>以下调度算法可用：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CBQ</dt>
<dd>
<p>基于类的排队（CBQ）用于将连接的带宽划分为不同的类别或队列，以根据过滤规则对流量进行优先级排序。</p>
</dd>
<dt class="hdlist1">RED</dt>
<dd>
<p>随机早期检测（RED）用于通过测量队列的长度并将其与队列的最小和最大阈值进行比较来避免网络拥塞。当队列超过最大阈值时，所有新的数据包将被随机丢弃。</p>
</dd>
<dt class="hdlist1">RIO</dt>
<dd>
<p>在随机早期检测输入输出（RIO）模式中，RED 维护多个平均队列长度和多个阈值，每个 QOS 级别对应一个阈值。</p>
</dd>
<dt class="hdlist1">HFSC</dt>
<dd>
<p>层次公平服务曲线分组调度器（HFSC）的描述可以在 <a href="http://www-2.cs.cmu.edu/" class="bare">http://www-2.cs.cmu.edu/</a><sub>hzhang/HFSC/main.html[<a href="http://www-2.cs.cmu.edu/" class="bare">http://www-2.cs.cmu.edu/</a></sub>hzhang/HFSC/main.html] 找到。</p>
</dd>
<dt class="hdlist1">PRIQ</dt>
<dd>
<p>优先队列（PRIQ）始终首先传递位于较高队列中的流量。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>有关调度算法和示例规则集的更多信息，请访问 OpenBSD 的网络存档： <a href="https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html" class="bare">https://web.archive.org/web/20151109213426/http://www.openbsd.org/faq/pf/queueing.html</a> 。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="firewalls-ipfw">33.4. IPFW<a class="anchor" href="#firewalls-ipfw"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>IPFW 是为 FreeBSD 编写的一种有状态防火墙，支持 IPv4 和 IPv6。它由几个组件组成：内核防火墙过滤规则处理器及其集成的数据包计数功能、日志记录功能、 NAT、<a href="https://man.freebsd.org/cgi/man.cgi?query=dummynet&amp;sektion=4&amp;format=html">dummynet(4)</a> 流量整形器、转发功能、桥接功能和 ipstealth 功能。</p>
</div>
<div class="paragraph">
<p>FreeBSD 在 <span class="filename">/etc/rc.firewall</span> 中提供了一个示例规则集，该规则集定义了几种常见场景的防火墙类型，以帮助新手用户生成适当的规则集。IPFW 提供了一个强大的语法，高级用户可以使用它来创建符合特定环境安全要求的自定义规则集。</p>
</div>
<div class="paragraph">
<p>本节介绍了如何启用 IPFW，提供了其规则语法的概述，并演示了几个常见配置场景的规则集。</p>
</div>
<div class="sect2">
<h3 id="firewalls-ipfw-enable">33.4.1. 启用 IPFW<a class="anchor" href="#firewalls-ipfw-enable"></a></h3>
<div class="paragraph">
<p>IPFW 已经作为一个可加载的内核模块包含在基本的 FreeBSD 安装中，这意味着不需要自定义内核来启用 IPFW。</p>
</div>
<div class="paragraph">
<p>对于那些希望将 IPFW 支持静态编译到自定义内核中的用户，请参阅 <a href="#firewalls-ipfw-kernelconfig">IPFW 内核选项</a>。</p>
</div>
<div class="paragraph">
<p>要在启动时配置系统以启用 IPFW ，请将 <code>firewall_enable =&#34;YES&#34;</code> 添加到 <span class="filename">/etc/rc.conf</span> 文件中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc firewall_enable=&#34;YES&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用 FreeBSD 提供的默认防火墙类型之一，请添加另一行来指定类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc firewall_type=&#34;open&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可用的类型有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>open</code>：允许通过所有流量。</p>
</li>
<li>
<p><code>client</code>: 仅保护本机。</p>
</li>
<li>
<p><code>simple</code>：保护整个网络。</p>
</li>
<li>
<p><code>closed</code>：完全禁用 IP 流量，除了回环接口之外。</p>
</li>
<li>
<p><code>workstation</code>：使用有状态规则仅保护此计算机。</p>
</li>
<li>
<p><code>UNKNOWN</code>：禁用防火墙规则的加载。</p>
</li>
<li>
<p><span class="filename">filename</span>: 包含防火墙规则集的文件的完整路径。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果 <code>firewall_type</code> 被设置为 <code>client</code> 或 <code>simple</code> ，请修改 <span class="filename">/etc/rc.firewall</span> 中的默认规则以适应系统的配置。</p>
</div>
<div class="paragraph">
<p>请注意，<code>filename</code> 类型用于加载自定义规则集。</p>
</div>
<div class="paragraph">
<p>加载自定义规则集的另一种方法是将 <code>firewall_script</code> 变量设置为包含 IPFW 命令的可执行脚本的绝对路径。本节中使用的示例假设 <code>firewall_script</code> 设置为 <span class="filename">/etc/ipfw.rules</span>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc firewall_script=&#34;/etc/ipfw.rules&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要通过 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> 启用日志记录，请包含以下行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc firewall_logging=&#34;YES&#34;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>只有带有 <code>log</code> 选项的防火墙规则才会被记录。默认规则不包含此选项，必须手动添加。因此，建议编辑默认规则集以进行日志记录。此外，如果日志存储在单独的文件中，可能需要进行日志轮转。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>没有设置日志限制的 <span class="filename">/etc/rc.conf</span> 变量。要限制每个连接尝试中规则被记录的次数，请在 <span class="filename">/etc/sysctl.conf</span> 中使用以下行指定数字：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#34;net.inet.ip.fw.verbose_limit=5&#34; &gt;&gt; /etc/sysctl.conf</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要通过名为 <code>ipfw0</code> 的专用接口启用日志记录，请将以下行添加到 <span class="filename">/etc/rc.conf</span> 中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc firewall_logif=&#34;YES&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用 tcpdump 查看被记录的内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tcpdump -t -n -i ipfw0</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>只有在附加了 tcpdump 时，才会出现由于日志记录而产生的额外开销。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>保存所需的编辑后，启动防火墙。要立即启用日志记录限制，还需设置上述 <code>sysctl</code> 值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service ipfw start</span>
<span class="c"># sysctl net.inet.ip.fw.verbose_limit=5</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="firewalls-ipfw-rules">33.4.2. IPFW 规则语法<a class="anchor" href="#firewalls-ipfw-rules"></a></h3>
<div class="paragraph">
<p>当一个数据包进入 IPFW 防火墙时，它会与规则集中的第一条规则进行比较，并按顺序逐条进行，从上到下移动。当数据包与规则的选择参数匹配时，执行规则的动作，并终止该数据包的规则集搜索。这被称为“先中者胜（first match wins）”。如果数据包不匹配任何规则，则被强制 IPFW 默认规则号 65535 捕获，该规则拒绝所有数据包并将其静默丢弃。然而，如果数据包与包含 <code>count</code>、<code>skipto</code> 或 <code>tee</code> 关键字的规则匹配，搜索将继续进行。有关这些关键字如何影响规则处理的详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。</p>
</div>
<div class="paragraph">
<p>创建 IPFW 规则时，关键字必须按照以下顺序编写。某些关键字是必需的，而其他关键字是可选的。大写字母表示变量，小写字母表示必须在其后出现的变量。 <code>#</code> 符号用于标记注释的开始，可以出现在规则的末尾或单独的一行上。空行将被忽略。</p>
</div>
<div class="paragraph">
<p><code><em>CMD RULE_NUMBER set SET_NUMBER ACTION log LOG_AMOUNT PROTO from SRC SRC_PORT to DST DST_PORT OPTIONS</em></code></p>
</div>
<div class="paragraph">
<p>本节提供了这些关键字及其选项的概述。这不是一个详尽无遗的选项列表。有关创建 IPFW 规则时可用的规则语法的完整描述，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CMD</dt>
<dd>
<p>每条规则都必须以 <code>ipfw add</code> 开头。</p>
</dd>
<dt class="hdlist1">RULE_NUMBER</dt>
<dd>
<p>每个规则都与一个从 <code>1</code> 到 <code>65534</code> 的数字相关联。该数字用于指示规则处理的顺序。多个规则可以具有相同的数字，这种情况下它们按照添加的顺序应用。</p>
</dd>
<dt class="hdlist1">SET_NUMBER</dt>
<dd>
<p>每个规则与一个从 <code>0</code> 到 <code>31</code> 的集合编号相关联。可以单独禁用或启用集合，从而可以快速添加或删除一组规则。如果未指定 SET_NUMBER ，则规则将被添加到集合 <code>0</code> 中。</p>
</dd>
<dt class="hdlist1">动作（ACTION）</dt>
<dd>
<p>规则可以与以下动作之一关联。当数据包与规则的选择条件匹配时，将执行指定的动作。</p>
<div class="paragraph">
<p><code>allow | accept | pass | permit</code>：这些关键字是等效的，允许匹配规则的数据包通过。</p>
</div>
<div class="paragraph">
<p><code>check-state</code>：检查数据包是否与动态状态表匹配。如果找到匹配项，则执行与生成此动态规则相关联的操作，否则转到下一条规则。 <code>check-state</code> 规则没有选择条件。如果规则集中没有 <code>check-state</code> 规则，则在第一个 <code>keep-state</code> 或 <code>limit</code> 规则处检查动态规则表。</p>
</div>
<div class="paragraph">
<p><code>count</code>：更新与规则匹配的所有数据包的计数器。搜索将继续进行下一个规则。</p>
</div>
<div class="paragraph">
<p><code>deny | drop</code>：这两个词都表示静默丢弃与此规则匹配的数据包。</p>
</div>
<div class="paragraph">
<p>还有其他可用的操作。有关详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。</p>
</div>
</dd>
<dt class="hdlist1">LOG_AMOUNT</dt>
<dd>
<p>当一个数据包与带有 <code>log</code> 关键字的规则匹配时，将会向 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> 记录一条消息，该消息的设施名称为 <code>SECURITY</code>。只有在特定规则的记录的数据包数量不超过指定的 LOG_AMOUNT 时才会发生记录。如果没有指定 LOG_AMOUNT，则限制值将从 <code>net.inet.ip.fw.verbose_limit</code> 的值中获取。值为零将移除记录限制。一旦达到限制，可以通过清除该规则的记录计数器或数据包计数器来重新启用记录，使用 <code>ipfw resetlog</code> 命令。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在满足所有其他数据包匹配条件之后，进行日志记录，并在对数据包执行最终操作之前。管理员决定在哪些规则上启用日志记录。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</dd>
<dt class="hdlist1">协议（PROTO）</dt>
<dd>
<p>这个可选值可以用来指定在 <span class="filename">/etc/protocols</span> 中找到的任何协议名称或编号。</p>
</dd>
<dt class="hdlist1">源地址（SRC）</dt>
<dd>
<p><code>from</code> 关键字后面必须跟着源地址或表示源地址的关键字。地址可以用 <code>any</code>、<code>me</code>（在此系统上配置的任何接口的地址）、<code>me6</code>（在此系统上配置的任何 IPv6 地址）或 <code>table</code> 后跟包含地址列表的查找表的编号来表示。在指定 IP 地址时，可以选择性地跟着 CIDR 掩码或子网掩码。例如，<code>1.2.3.4/25</code> 或 <code>1.2.3.4:255.255.255.128</code>。</p>
</dd>
<dt class="hdlist1">源端口（SRC_PORT）</dt>
<dd>
<p>可以使用端口号或者从 <span class="filename">/etc/services</span> 中的名称来指定可选的源端口。</p>
</dd>
<dt class="hdlist1">目标地址（DST）</dt>
<dd>
<p><code>to</code> 关键字后面必须跟着目标地址或代表目标地址的关键字。在 SRC 部分描述的相同关键字和地址可以用来描述目标。</p>
</dd>
<dt class="hdlist1">目标端口（DST_PORT）</dt>
<dd>
<p>可以使用端口号或者从 <span class="filename">/etc/services</span> 文件中的名称来指定可选的目标端口。</p>
</dd>
<dt class="hdlist1">选项（OPTIONS）</dt>
<dd>
<p>源和目的地后面可以跟随几个关键字。顾名思义，OPTIONS 是可选的。常用的选项包括 <code>in</code> 或 <code>out</code>，用于指定数据包流动的方向，<code>icmptypes</code> 后面跟随 ICMP 消息的类型，以及 <code>keep-state</code>。</p>
<div class="paragraph">
<p>当匹配到 <code>keep-state</code> 规则时，防火墙将创建一个动态规则，该规则匹配源地址和目标地址以及端口之间的双向流量，使用相同的协议。</p>
</div>
<div class="paragraph">
<p>动态规则功能容易受到 SYN 洪水攻击的资源耗尽问题的影响，该攻击会打开大量的动态规则。为了使用 IPFW 来对抗这种类型的攻击，可以使用 <code>limit</code> 选项。该选项通过检查打开的动态规则，计算该规则和 IP 地址组合出现的次数，来限制同时会话的数量。如果该计数大于 <code>limit</code> 指定的值，数据包将被丢弃。</p>
</div>
<div class="paragraph">
<p>有数十种选项可供选择。有关每个可用选项的描述，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_示例规则集">33.4.3. 示例规则集<a class="anchor" href="#_示例规则集"></a></h3>
<div class="paragraph">
<p>本节演示了如何创建一个名为 <span class="filename">/etc/ipfw.rules</span> 的示例有状态防火墙规则脚本。在这个示例中，所有连接规则使用 <code>in</code> 或 <code>out</code> 来明确方向。它们还使用 <code>via</code> <em>interface-name</em> 来指定数据包所经过的接口。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在首次创建或测试防火墙规则集时，考虑临时设置此可调整项：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>net.inet.ip.fw.default_to_accept=&#34;1&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>这将将 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 的默认策略设置为比默认的 <code>deny ip from any to any</code> 更宽松，这样在重新启动后更难被系统锁定。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>防火墙脚本首先指示它是一个 Bourne shell 脚本，并清除任何现有的规则。然后它创建 <code>cmd</code> 变量，这样在每个规则的开头就不需要输入 <code>ipfw add</code> 。它还定义了 <code>pif</code> 变量，表示连接到互联网的接口的名称。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#!/bin/sh
# Flush out the list before we begin.
ipfw -q -f flush

# Set rules command prefix
cmd=&#34;ipfw -q add&#34;
pif=&#34;dc0&#34;     # interface name of NIC attached to Internet</pre>
</div>
</div>
<div class="paragraph">
<p>前两条规则允许在可信的内部接口和回环接口上的所有流量通过。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Change xl0 to LAN NIC interface name
$cmd 00005 allow all from any to any via xl0

# No restrictions on Loopback Interface
$cmd 00010 allow all from any to any via lo0</pre>
</div>
</div>
<div class="paragraph">
<p>下一个规则允许数据包通过，如果它与动态规则表中的现有条目匹配：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>$cmd 00101 check-state</pre>
</div>
</div>
<div class="paragraph">
<p>下面的规则集定义了内部系统可以与互联网上的主机建立哪些有状态连接：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Allow access to public DNS
# Replace x.x.x.x with the IP address of a public DNS server
# and repeat for each DNS server in /etc/resolv.conf
$cmd 00110 allow tcp from any to x.x.x.x 53 out via $pif setup keep-state
$cmd 00111 allow udp from any to x.x.x.x 53 out via $pif keep-state

# Allow access to ISP&#39;s DHCP server for cable/DSL configurations.
# Use the first rule and check log for IP address.
# Then, uncomment the second rule, input the IP address, and delete the first rule
$cmd 00120 allow log udp from any to any 67 out via $pif keep-state
#$cmd 00120 allow udp from any to x.x.x.x 67 out via $pif keep-state

# Allow outbound HTTP and HTTPS connections
$cmd 00200 allow tcp from any to any 80 out via $pif setup keep-state
$cmd 00220 allow tcp from any to any 443 out via $pif setup keep-state

# Allow outbound email connections
$cmd 00230 allow tcp from any to any 25 out via $pif setup keep-state
$cmd 00231 allow tcp from any to any 110 out via $pif setup keep-state

# Allow outbound ping
$cmd 00250 allow icmp from any to any out via $pif keep-state

# Allow outbound NTP
$cmd 00260 allow udp from any to any 123 out via $pif keep-state

# Allow outbound SSH
$cmd 00280 allow tcp from any to any 22 out via $pif setup keep-state

# deny and log all other outbound connections
$cmd 00299 deny log all from any to any out via $pif</pre>
</div>
</div>
<div class="paragraph">
<p>下一组规则控制来自互联网主机到内部网络的连接。它首先拒绝通常与攻击相关的数据包，然后明确允许特定类型的连接。所有从互联网发起的授权服务都使用 <code>limit</code> 来防止洪水攻击。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Deny all inbound traffic from non-routable reserved address spaces
$cmd 00300 deny all from 192.168.0.0/16 to any in via $pif     #RFC 1918 private IP
$cmd 00301 deny all from 172.16.0.0/12 to any in via $pif      #RFC 1918 private IP
$cmd 00302 deny all from 10.0.0.0/8 to any in via $pif         #RFC 1918 private IP
$cmd 00303 deny all from 127.0.0.0/8 to any in via $pif        #loopback
$cmd 00304 deny all from 0.0.0.0/8 to any in via $pif          #loopback
$cmd 00305 deny all from 169.254.0.0/16 to any in via $pif     #DHCP auto-config
$cmd 00306 deny all from 192.0.2.0/24 to any in via $pif       #reserved for docs
$cmd 00307 deny all from 204.152.64.0/23 to any in via $pif    #Sun cluster interconnect
$cmd 00308 deny all from 224.0.0.0/3 to any in via $pif        #Class D &amp; E multicast

# Deny public pings
$cmd 00310 deny icmp from any to any in via $pif

# Deny ident
$cmd 00315 deny tcp from any to any 113 in via $pif

# Deny all Netbios services.
$cmd 00320 deny tcp from any to any 137 in via $pif
$cmd 00321 deny tcp from any to any 138 in via $pif
$cmd 00322 deny tcp from any to any 139 in via $pif
$cmd 00323 deny tcp from any to any 81 in via $pif

# Deny fragments
$cmd 00330 deny all from any to any frag in via $pif

# Deny ACK packets that did not match the dynamic rule table
$cmd 00332 deny tcp from any to any established in via $pif

# Allow traffic from ISP&#39;s DHCP server.
# Replace x.x.x.x with the same IP address used in rule 00120.
#$cmd 00360 allow udp from any to x.x.x.x 67 in via $pif keep-state

# Allow HTTP connections to internal web server
$cmd 00400 allow tcp from any to me 80 in via $pif setup limit src-addr 2

# Allow inbound SSH connections
$cmd 00410 allow tcp from any to me 22 in via $pif setup limit src-addr 2

# Reject and log all other incoming connections
$cmd 00499 deny log all from any to any in via $pif</pre>
</div>
</div>
<div class="paragraph">
<p>最后一条规则记录所有不符合规则集中任何规则的数据包：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Everything else is denied and logged
$cmd 00999 deny log all from any to any</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="in-kernel-nat">33.4.4. 内核级网络地址转换（In-kernel NAT）<a class="anchor" href="#in-kernel-nat"></a></h3>
<div class="paragraph">
<p>FreeBSD 的 IPFW 防火墙有两种 NAT 实现：用户空间实现 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 和更近期的内核 NAT 实现。两者都与 IPFW 配合工作，提供网络地址转换功能。这可以用于提供 Internet 连接共享解决方案，使多台内部计算机可以使用单个公共 IP 地址连接到互联网。</p>
</div>
<div class="paragraph">
<p>要实现这一点，连接到互联网的 FreeBSD 机器必须充当网关。该系统必须具有两个网络接口卡（NIC），其中一个连接到互联网，另一个连接到内部局域网（LAN）。连接到 LAN 的每台机器应分配一个私有网络空间中的 IP 地址，如 <a href="https://www.ietf.org/rfc/rfc1918.txt">RFC 1918</a> 所定义。</p>
</div>
<div class="paragraph">
<p>为了启用 IPFW 内核中的 NAT 功能，需要进行一些额外的配置。要在启动时启用内核中的 NAT 支持，必须在 <span class="filename">/etc/rc.conf</span> 文件中设置以下内容：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gateway_enable=&#34;YES&#34;
firewall_enable=&#34;YES&#34;
firewall_nat_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当设置了 <code>firewall_nat_enable</code> 但未设置 <code>firewall_enable</code> 时，它将不会产生任何效果和作用。这是因为内核中的 NAT 实现仅与 IPFW 兼容。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>当规则集包含有状态的规则时，NAT 规则的位置至关重要，并且使用 <code>skipto</code> 操作。<code>skipto</code> 操作需要一个规则编号，以便知道要跳转到哪个规则。下面的示例基于前一节中显示的防火墙规则集进行构建。它添加了一些额外的条目并修改了一些现有规则，以便为内核中的 NAT 配置防火墙。首先添加一些额外的变量，这些变量表示要跳转到的规则编号，<code>keep-state</code> 选项以及将用于减少规则数量的 TCP 端口列表。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#!/bin/sh
ipfw -q -f flush
cmd=&#34;ipfw -q add&#34;
skip=&#34;skipto 1000&#34;
pif=dc0
ks=&#34;keep-state&#34;
good_tcpo=&#34;22,25,37,53,80,443,110&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>使用内核级别的 NAT 时，由于 <a href="https://man.freebsd.org/cgi/man.cgi?query=libalias&amp;sektion=3&amp;format=html">libalias(3)</a> 的架构，需要禁用 TCP 分段卸载（TSO），<a href="https://man.freebsd.org/cgi/man.cgi?query=libalias&amp;sektion=3&amp;format=html">libalias(3)</a> 是一个作为内核模块实现的库，用于提供 IPFW 的内核级别 NAT 功能。可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a> 在每个网络接口上禁用 TSO，也可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=8&amp;format=html">sysctl(8)</a> 在整个系统上禁用 TSO。要在整个系统上禁用 TSO，需要在 <span class="filename">/etc/sysctl.conf</span> 中设置以下内容：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>net.inet.tcp.tso=&#34;0&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>还将配置一个 NAT 实例。可以配置多个 NAT 实例，每个实例都有自己的配置。在这个例子中，只需要一个 NAT 实例，即 NAT 实例号 1。配置可以包括一些选项，如：<code>if</code> 表示公共接口，<code>same_ports</code> 确保别名端口和本地端口号映射相同，<code>unreg_only</code> 将只处理未注册（私有）地址空间的 NAT 实例，<code>reset</code> 将帮助保持一个正常运行的 NAT 实例，即使 IPFW 机器的公共 IP 地址发生变化。有关可以传递给单个 NAT 实例配置的所有可能选项，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。在配置有状态的 NAT 防火墙时，需要允许将已转换的数据包重新注入防火墙进行进一步处理。可以通过在防火墙脚本的开始处禁用 <code>one_pass</code> 行为来实现这一点。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ipfw disable one_pass
ipfw -q nat 1 config if $pif same_ports unreg_only reset</pre>
</div>
</div>
<div class="paragraph">
<p>入站 NAT 规则被插入在允许所有受信任和回环接口上的所有流量的两个规则之后，并且在重新组装规则之后，但在 <code>check-state</code> 规则之前。在此示例中，为此 NAT 规则选择的规则编号（例如 <code>100</code>）比前三个规则更高，但比 <code>check-state</code> 规则更低非常重要。此外，由于内核 NAT 的行为，建议在第一个 NAT 规则之前和允许受信任接口上的流量的规则之后放置一个重新组装规则。通常情况下，不应发生 IP 分段，但在处理 IPSEC/ESP/GRE 隧道流量时可能会发生，并且在将完整数据包交给内核 NAT 设备之前需要重新组装片段。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在使用用户空间的 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 时，不需要使用 reassemble 规则，因为 IPFW 的 <code>divert</code> 动作在将数据包传递到套接字之前已经负责重新组装数据包，这也在 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 中有所说明。</p>
</div>
<div class="paragraph">
<p>在这个示例中使用的 NAT 实例和规则编号与由 <span class="filename">rc.firewall</span> 创建的默认 NAT 实例和规则编号不匹配。 <span class="filename">rc.firewall</span> 是一个设置 FreeBSD 中默认防火墙规则的脚本。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>$cmd 005 allow all from any to any via xl0  # exclude LAN traffic
$cmd 010 allow all from any to any via lo0  # exclude loopback traffic
$cmd 099 reass all from any to any in       # reassemble inbound packets
$cmd 100 nat 1 ip from any to any in via $pif # NAT any inbound packets
# Allow the packet through if it has an existing entry in the dynamic rules table
$cmd 101 check-state</pre>
</div>
</div>
<div class="paragraph">
<p>出站规则已经被修改，将 <code>allow</code> 操作替换为 <code>$skip</code> 变量，表示规则处理将继续在规则 <code>1000</code> 处。七个 <code>tcp</code> 规则已被替换为规则 <code>125</code>，因为 <code>$good_tcpo</code> 变量包含了七个允许的出站端口。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请记住，IPFW 的性能主要取决于规则集中存在的规则数量。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Authorized outbound packets
$cmd 120 $skip udp from any to x.x.x.x 53 out via $pif $ks
$cmd 121 $skip udp from any to x.x.x.x 67 out via $pif $ks
$cmd 125 $skip tcp from any to any $good_tcpo out via $pif setup $ks
$cmd 130 $skip icmp from any to any out via $pif $ks</pre>
</div>
</div>
<div class="paragraph">
<p>入站规则保持不变，除了最后一条规则，它移除了 <code>via$pif</code>，以便捕获入站和出站规则。NAT 规则必须跟随这个最后的出站规则，规则号必须比最后一条规则的号码更高，并且规则号必须被 <code>skipto</code> 动作引用。在这个规则集中，规则号为 <code>1000</code> 的规则处理将所有数据包传递给我们配置的实例进行 NAT 处理。下一条规则允许经过 NAT 处理的任何数据包通过。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>$cmd 999 deny log all from any to any
$cmd 1000 nat 1 ip from any to any out via $pif # skipto location for outbound stateful rules
$cmd 1001 allow ip from any to any</pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，规则 <code>100</code>、<code>101</code>、<code>125</code>、<code>1000</code> 和 <code>1001</code> 控制出站和入站数据包的地址转换，以便动态状态表中的条目始终注册私有 LANIP 地址。</p>
</div>
<div class="paragraph">
<p>考虑一个内部的网络浏览器，它通过 80 端口初始化一个新的出站 HTTP 会话。当第一个出站数据包进入防火墙时，它不匹配规则 <code>100</code> ，因为它是向外而不是向内的。它通过规则 <code>101</code> ，因为这是第一个数据包，并且尚未被添加到动态状态表中。该数据包最终匹配规则 <code>125</code> ，因为它是在允许的端口上进行出站，并且具有来自内部局域网的源 IP 地址。匹配此规则后，会执行两个操作。首先，<code>keep-state</code> 操作将一个条目添加到动态状态表中，并执行指定的操作 <code>skipto rule 1000</code>。接下来，数据包经过 NAT 处理并发送到互联网。该数据包到达目标 Web 服务器，生成并发送一个响应数据包。这个新的数据包进入规则集的顶部。它匹配规则 <code>100</code>，并将其目标 IP 地址映射回原始的内部地址。然后，它经过 <code>check-state</code> 规则的处理，在表中被识别为一个现有的会话，并被释放到局域网。</p>
</div>
<div class="paragraph">
<p>在入站方面，规则集必须拒绝恶意数据包，并仅允许授权的服务。与入站规则匹配的数据包将被发布到动态状态表，并将数据包释放到局域网。作为响应生成的数据包被 <code>check-state</code> 规则识别为属于现有会话。然后，它将被发送到规则 <code>1000</code> 进行网络地址转换（NAT），然后释放到出站接口。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>从用户空间的 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 过渡到内核级别的 NAT 可能一开始看起来是无缝的，但有一个小问题。当使用 GENERIC 内核时，当在 <span class="filename">/etc/rc.conf</span> 中启用 <code>firewall_nat_enable</code> 时，IPFW 将加载 <span class="filename">libalias.ko</span> 内核模块。 <span class="filename">libalias.ko</span> 内核模块只提供基本的 NAT 功能，而用户空间实现的 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 在其用户空间库中提供了所有的 NAT 功能，无需任何额外配置。所有功能都指的是以下内核模块，除了标准的 <span class="filename">libalias.ko</span> 内核模块之外，还可以在需要时额外加载： <span class="filename">alias_ftp.ko</span>、<span class="filename">alias_bbt.ko</span>、<span class="filename">skinny.ko</span>、<span class="filename">irc.ko</span>、<span class="filename">alias_pptp.ko</span> 和 <span class="filename">alias_smedia.ko</span>，使用[.filename]<mark>/etc/rc.conf</mark> 中的 <code>kld_list</code> 指令。如果使用自定义内核，可以使用 <code>options LIBALIAS</code> 将用户空间库的全部功能编译到内核中。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_端口重定向">33.4.4.1. 端口重定向<a class="anchor" href="#_端口重定向"></a></h4>
<div class="paragraph">
<p>NAT 的一般缺点是 LAN 客户端无法从互联网访问。 LAN 上的客户端可以向外部建立连接，但无法接收传入连接。如果尝试在 LAN 客户端机器上运行互联网服务，这将带来问题。一个简单的解决方法是将 NAT 提供机器上的选定互联网端口重定向到 LAN 客户端。</p>
</div>
<div class="paragraph">
<p>例如，IRC 服务器运行在客户端 <code>A</code> 上，而 Web 服务器运行在客户端 <code>B</code> 上。为了使其正常工作，必须将接收到的 6667 端口（IRC）和 80 端口（HTTP）的连接重定向到相应的机器上。</p>
</div>
<div class="paragraph">
<p>使用内核级别的 NAT，所有配置都在 NAT 实例配置中完成。要查看内核级别 NAT 实例可以使用的所有选项，请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a>。 IPFW 的语法遵循 natd 的语法。<code>redirect_port</code> 的语法如下：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>redirect_port proto targetIP:targetPORT[-targetPORT]
  [aliasIP:]aliasPORT[-aliasPORT]
  [remoteIP[:remotePORT[-remotePORT]]]</pre>
</div>
</div>
<div class="paragraph">
<p>要配置上述示例设置，参数应为：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>redirect_port tcp 192.168.0.2:6667 6667
redirect_port tcp 192.168.0.3:80 80</pre>
</div>
</div>
<div class="paragraph">
<p>在上述规则集中将这些参数添加到 NAT 实例 1 的配置后，TCP 端口将被端口转发到运行 IRC 和 HTTP 服务的局域网客户机。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ipfw -q nat 1 config if $pif same_ports unreg_only reset \
  redirect_port tcp 192.168.0.2:6667 6667 \
  redirect_port tcp 192.168.0.3:80 80</pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>redirect_port</code> 指示端口范围而不是单个端口。例如，<em>tcp 192.168.0.2:2000-3000 2000-3000</em> 将会将所有在端口 2000 到 3000 上接收到的连接重定向到客户端 <code>A</code> 上的端口 2000 到 3000 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_地址重定向">33.4.4.2. 地址重定向<a class="anchor" href="#_地址重定向"></a></h4>
<div class="paragraph">
<p>如果有多个 IP 地址可用，地址重定向非常有用。每个局域网客户端可以通过 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 分配自己的外部 IP 地址，然后 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 将重写来自局域网客户端的出站数据包，使用正确的外部 IP 地址，并将所有进入特定 IP 地址的流量重定向回特定的局域网客户端。这也被称为静态 NAT 。例如，如果可用的 IP 地址为 <code>128.1.1.1</code>、<code>128.1.1.2</code> 和 <code>128.1.1.3</code>，则 <code>128.1.1.1</code> 可以用作 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 机器的外部 IP 地址，而 <code>128.1.1.2</code> 和 <code>128.1.1.3</code> 则被转发回局域网客户端 <code>A</code> 和 <code>B</code>。</p>
</div>
<div class="paragraph">
<p><code>redirect_addr</code> 的语法如下，其中 <code>localIP</code> 是局域网客户端的内部 IP 地址，<code>publicIP</code> 是与局域网客户端对应的外部 IP 地址。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>redirect_addr localIP publicIP</pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，参数将被读取为：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>redirect_addr 192.168.0.2 128.1.1.2
redirect_addr 192.168.0.3 128.1.1.3</pre>
</div>
</div>
<div class="paragraph">
<p>与 <code>redirect_port</code> 类似，这些参数也被放置在 NAT 实例配置中。通过地址重定向，不需要进行端口重定向，因为所有接收到的特定 IP 地址的数据都会被重定向。</p>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=ipfw&amp;sektion=8&amp;format=html">ipfw(8)</a> 机器上的外部 IP 地址必须处于活动状态，并且必须与外部接口进行别名设置。有关详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_用户空间_nat">33.4.4.3. 用户空间 NAT<a class="anchor" href="#_用户空间_nat"></a></h4>
<div class="paragraph">
<p>让我们从一个声明开始：用户空间的 NAT 实现：<a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>，比内核中的 NAT 有更多的开销。为了让 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 翻译数据包，数据包必须从内核复制到用户空间，然后再返回，这带来了额外的开销，而内核中的 NAT 则没有这种开销。</p>
</div>
<div class="paragraph">
<p>要在启动时启用用户空间 NAT 守护进程 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>，以下是在文件 <span class="filename">/etc/rc.conf</span> 中的最小配置。其中，<code>natd_interface</code> 设置为连接到互联网的网卡的名称。<a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 的 <a href="https://man.freebsd.org/cgi/man.cgi?query=rc&amp;sektion=8&amp;format=html">rc(8)</a> 脚本将自动检查是否使用动态 IP 地址，并配置自身以处理该地址。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gateway_enable=&#34;YES&#34;
natd_enable=&#34;YES&#34;
natd_interface=&#34;rl0&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>通常情况下，上述内核 NAT 的规则集也可以与 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a> 一起使用。唯一的例外是内核 NAT 实例的配置 <code>(ipfw -q nat 1 config …​)</code> ，不需要与重组规则 99 一起使用，因为其功能已包含在 <code>divert</code> 操作中。规则编号 100 和 1000 需要稍作修改，如下所示。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>$cmd 100 divert natd ip from any to any in via $pif
$cmd 1000 divert natd ip from any to any out via $pif</pre>
</div>
</div>
<div class="paragraph">
<p>要配置端口或地址重定向，使用与内核 NAT 相似的语法。然而，现在，与内核 NAT 不同，我们不再在规则集脚本中指定配置，而是最好在配置文件中配置 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>。为了做到这一点，必须通过 <span class="filename">/etc/rc.conf</span> 传递一个额外的标志，指定配置文件的路径。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>natd_flags=&#34;-f /etc/natd.conf&#34;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>指定的文件必须包含一行一个的配置选项列表。有关配置文件和可能的变量的更多信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=natd&amp;sektion=8&amp;format=html">natd(8)</a>。以下是两个示例条目，每行一个：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>redirect_port tcp 192.168.0.2:6667 6667
redirect_addr 192.168.0.3 128.1.1.3</pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="firewalls-ipfw-cmd">33.4.5. IPFW 命令<a class="anchor" href="#firewalls-ipfw-cmd"></a></h3>
<div class="paragraph">
<p><code>ipfw</code> 可以在防火墙运行时手动添加或删除单个规则。使用这种方法的问题是，当系统重新启动时，所有更改都会丢失。建议将所有规则写入一个文件，并在启动时使用该文件加载规则，并在该文件更改时替换当前运行的防火墙规则。</p>
</div>
<div class="paragraph">
<p><code>ipfw</code> 是一种将运行中的防火墙规则显示到控制台屏幕的有用方法。 IPFW 计费功能会为每个规则动态创建一个计数器，用于计算与规则匹配的每个数据包。在测试规则的过程中，列出规则及其计数器是确定规则是否按预期工作的一种方式。</p>
</div>
<div class="paragraph">
<p>列出所有正在运行的规则的顺序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>列出所有正在运行的规则，并显示规则最后匹配的时间戳：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw -t list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>下一个示例列出了匹配规则的会计信息和数据包计数，以及规则本身。第一列是规则编号，其后是匹配的数据包和字节数，然后是规则本身。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw -a list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了静态规则外，列出动态规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw -d list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为了显示已过期的动态规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw -d -e list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>将计数器归零：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw zero</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>将编号为 <em>NUM</em> 的规则的计数器清零：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw zero NUM</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_记录防火墙消息">33.4.5.1. 记录防火墙消息<a class="anchor" href="#_记录防火墙消息"></a></h4>
<div class="paragraph">
<p>即使启用了日志功能，IPFW 也不会自动生成任何规则日志。防火墙管理员决定哪些规则将被记录，并在这些规则中添加 <code>log</code> 关键字。通常只有拒绝规则会被记录。习惯上，在规则集中将“ipfw default deny everything”规则复制一份，并在最后一条规则中包含 <code>log</code> 关键字。这样，就可以查看所有未匹配规则集中任何规则的数据包。</p>
</div>
<div class="paragraph">
<p>日志记录是一把双刃剑。如果不小心处理，过多的日志数据或者 DoS 攻击可能会填满磁盘的日志文件。日志消息不仅会被写入 syslogd，还会显示在根控制台屏幕上，很快就会变得令人讨厌。</p>
</div>
<div class="paragraph">
<p><code>IPFIREWALL_VERBOSE_LIMIT=5</code> 内核选项限制了发送给 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> 的连续消息数量，这些消息涉及给定规则的数据包匹配。当内核中启用了这个选项时，关于特定规则的连续消息数量被限制在指定的数量上。200 条相同的日志消息并没有什么好处。当这个选项设置为五时，关于特定规则的五条连续消息将被记录到 syslogd 中，其余相同的连续消息将被计数并以类似以下的短语发布到 syslogd 中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>last message repeated 45 times</pre>
</div>
</div>
<div class="paragraph">
<p>所有已记录的数据包消息默认写入到 <span class="filename">/var/log/security</span>，该路径在 <span class="filename">/etc/syslog.conf</span> 中定义。</p>
</div>
</div>
<div class="sect3">
<h4 id="firewalls-ipfw-rules-script">33.4.5.2. 构建规则脚本<a class="anchor" href="#firewalls-ipfw-rules-script"></a></h4>
<div class="paragraph">
<p>大多数经验丰富的 IPFW 用户会创建一个包含规则的文件，并以与脚本运行兼容的方式编码它们。这样做的主要好处是防火墙规则可以批量刷新，而无需重新启动系统来激活它们。这种方法在测试新规则时非常方便，因为可以根据需要执行该过程多次。作为脚本，可以使用符号替换来将常用值替换为多个规则中的值。</p>
</div>
<div class="paragraph">
<p>这个示例脚本与 <a href="https://man.freebsd.org/cgi/man.cgi?query=sh&amp;sektion=1&amp;format=html">sh(1)</a>、<a href="https://man.freebsd.org/cgi/man.cgi?query=csh&amp;sektion=1&amp;format=html">csh(1)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=tcsh&amp;sektion=1&amp;format=html">tcsh(1)</a> shells 使用的语法兼容。符号替换字段以美元符号 ($) 为前缀。符号字段没有 $ 前缀。用于填充符号字段的值必须用双引号 (&#34;&#34;) 括起来。</p>
</div>
<div class="paragraph">
<p>像这样开始规则文件：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>############### start of example ipfw rules script #############
#
ipfw -q -f flush       # Delete all rules
# Set defaults
oif=&#34;tun0&#34;             # out interface
odns=&#34;192.0.2.11&#34;      # ISP&#39;s DNS server IP address
cmd=&#34;ipfw -q add &#34;     # build rule prefix
ks=&#34;keep-state&#34;        # just too lazy to key this each time
$cmd 00500 check-state
$cmd 00502 deny all from any to any frag
$cmd 00501 deny tcp from any to any established
$cmd 00600 allow tcp from any to any 80 out via $oif setup $ks
$cmd 00610 allow tcp from any to $odns 53 out via $oif setup $ks
$cmd 00611 allow udp from any to $odns 53 out via $oif $ks
################### End of example ipfw rules script ############</pre>
</div>
</div>
<div class="paragraph">
<p>规则并不重要，因为这个例子的重点是如何填充符号替换字段。</p>
</div>
<div class="paragraph">
<p>如果上面的示例位于 <span class="filename">/etc/ipfw.rules</span> 文件中，则可以使用以下命令重新加载规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sh /etc/ipfw.rules</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="filename">/etc/ipfw.rules</span> 可以位于任何位置，文件的名称也可以是任意的。</p>
</div>
<div class="paragraph">
<p>通过手动运行这些命令也可以实现相同的效果：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipfw -q -f flush</span>
<span class="c"># ipfw -q add check-state</span>
<span class="c"># ipfw -q add deny all from any to any frag</span>
<span class="c"># ipfw -q add deny tcp from any to any established</span>
<span class="c"># ipfw -q add allow tcp from any to any 80 out via tun0 setup keep-state</span>
<span class="c"># ipfw -q add allow tcp from any to 192.0.2.11 53 out via tun0 setup keep-state</span>
<span class="c"># ipfw -q add 00611 allow udp from any to 192.0.2.11 53 out via tun0 keep-state</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="firewalls-ipfw-kernelconfig">33.4.6. IPFW 内核选项<a class="anchor" href="#firewalls-ipfw-kernelconfig"></a></h3>
<div class="paragraph">
<p>为了将 IPFW 支持静态编译到自定义内核中，请参考 <a href="../kernelconfig/#kernelconfig，配置 FreeBSD 内核"></a> 中的说明。以下选项可用于自定义内核配置文件：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options    IPFIREWALL			# enables IPFW
options    IPFIREWALL_VERBOSE		# enables logging for rules with log keyword to syslogd(8)
options    IPFIREWALL_VERBOSE_LIMIT=5	# limits number of logged packets per-entry
options    IPFIREWALL_DEFAULT_TO_ACCEPT # sets default policy to pass what is not explicitly denied
options    IPFIREWALL_NAT		# enables basic in-kernel NAT support
options    LIBALIAS			# enables full in-kernel NAT support
options    IPFIREWALL_NAT64		# enables in-kernel NAT64 support
options    IPFIREWALL_NPTV6		# enables in-kernel IPv6 NPT support
options    IPFIREWALL_PMOD		# enables protocols modification module support
options    IPDIVERT			# enables NAT through natd(8)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>IPFW 可以作为内核模块加载：上述选项默认情况下被构建为模块，或者可以在运行时使用可调节参数进行设置。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="firewalls-ipf">33.5. IPFILTER (IPF)<a class="anchor" href="#firewalls-ipf"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>IPFILTER，也称为 IPF，是一个跨平台的开源防火墙，已经移植到多个操作系统，包括 FreeBSD、NetBSD、OpenBSD 和 Solaris™。</p>
</div>
<div class="paragraph">
<p>IPFILTER 是一个位于内核的防火墙和 NAT 机制，可以由用户空间程序进行控制和监控。可以使用 ipf 设置或删除防火墙规则，使用 ipnat 设置或删除 NAT 规则，使用 ipfstat 打印 IPFILTER 内核部分的运行时统计信息，并可以使用 ipmon 将 IPFILTER 的操作记录到系统日志文件中。</p>
</div>
<div class="paragraph">
<p>IPF 最初使用“最后匹配规则获胜（the last matching rule wins）”的规则处理逻辑，并且只使用无状态规则。此后，IPF 已经进行了增强，包括了 <code>quick</code> 和 <code>keep state</code> 选项。</p>
</div>
<div class="paragraph">
<p>IPF FAQ 位于 <a href="http://www.phildev.net/ipf/index.html">http://www.phildev.net/ipf/index.html</a>。IPFilter 邮件列表的可搜索存档可在 <a href="http://marc.info/?l=ipfilter">http://marc.info/?l=ipfilter</a> 上找到。</p>
</div>
<div class="paragraph">
<p>本手册的这一部分重点介绍了与 FreeBSD 相关的 IPF。它提供了包含 <code>quick</code> 和 <code>keep state</code> 选项的规则示例。</p>
</div>
<div class="sect2">
<h3 id="_启用_ipf">33.5.1. 启用 IPF<a class="anchor" href="#_启用_ipf"></a></h3>
<div class="paragraph">
<p>IPF 被包含在基本的 FreeBSD 安装中作为一个可加载的内核模块，这意味着不需要自定义内核来启用 IPF 。</p>
</div>
<div class="paragraph">
<p>对于喜欢将 IPF 支持静态编译到自定义内核中的用户，请参考 <a href="../kernelconfig/#kernelconfig">配置 FreeBSD 内核</a> 中的说明。以下内核选项可用：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options IPFILTER
options IPFILTER_LOG
options IPFILTER_LOOKUP
options IPFILTER_DEFAULT_BLOCK</pre>
</div>
</div>
<div class="paragraph">
<p><code>options IPFILTER</code> 启用对 IPFILTER 的支持，<code>options IPFILTER_LOG</code> 启用使用 <span class="filename">ipl</span> 伪设备对于每个带有 <code>log</code> 关键字的规则进行 IPF 日志记录，<code>IPFILTER_LOOKUP</code> 启用 IP 池以加快 IP 查找速度，而 <code>options IPFILTER_DEFAULT_BLOCK</code> 更改默认行为，使得任何不符合防火墙 <code>pass</code> 规则的数据包都被阻止。</p>
</div>
<div class="paragraph">
<p>要在启动时配置系统以启用 IPF，请将以下条目添加到 <span class="filename">/etc/rc.conf</span> 文件中。这些条目还将启用日志记录和 <code>default pass all</code>。要将默认策略更改为 <code>block all</code> 而无需编译自定义内核，请记住在规则集的末尾添加一个 <code>block all</code> 规则。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ipfilter_enable=&#34;YES&#34;             # Start ipf firewall
ipfilter_rules=&#34;/etc/ipf.rules&#34;   # loads rules definition text file
ipv6_ipfilter_rules=&#34;/etc/ipf6.rules&#34; # loads rules definition text file for IPv6
ipmon_enable=&#34;YES&#34;                # Start IP monitor log
ipmon_flags=&#34;-Ds&#34;                 # D = start as daemon
                                  # s = log to syslog
                                  # v = log tcp window, ack, seq
                                  # n = map IP &amp; port to names</pre>
</div>
</div>
<div class="paragraph">
<p>如果需要 NAT 功能，还需要添加以下行：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gateway_enable=&#34;YES&#34;              # Enable as LAN gateway
ipnat_enable=&#34;YES&#34;                # Start ipnat function
ipnat_rules=&#34;/etc/ipnat.rules&#34;    # rules definition file for ipnat</pre>
</div>
</div>
<div class="paragraph">
<p>然后，现在开始启动 IPF：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#  service ipfilter start</pre>
</div>
</div>
<div class="paragraph">
<p>要加载防火墙规则，请使用 <code>ipf</code> 指定规则集文件的名称。可以使用以下命令替换当前运行的防火墙规则：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipf -Fa -f /etc/ipf.rules</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-Fa</code> 选项会清空所有内部规则表，<code>-f</code> 选项用于指定包含要加载的规则的文件。</p>
</div>
<div class="paragraph">
<p>这提供了对自定义规则集进行更改并使用最新的规则副本更新正在运行的防火墙的能力，而无需重新启动系统。这种方法对于测试新规则非常方便，因为可以根据需要执行该过程多次。</p>
</div>
<div class="paragraph">
<p>有关此命令可用的其他标志的详细信息，请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=8&amp;format=html">ipf(8)</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ipf_规则语法">33.5.2. IPF 规则语法<a class="anchor" href="#_ipf_规则语法"></a></h3>
<div class="paragraph">
<p>本节描述了用于创建有状态规则的 IPF 规则语法。在创建规则时，请记住，除非规则中出现了 <code>quick</code> 关键字，否则每个规则都会按顺序读取，应用的是 <em>最后匹配的规则</em>。这意味着，即使第一个匹配数据包的规则是 <code>pass</code>，如果后面有一个匹配的规则是 <code>block</code>，数据包将被丢弃。示例规则集可以在 <span class="filename">/usr/share/examples/ipfilter</span> 中找到。</p>
</div>
<div class="paragraph">
<p>创建规则时，使用 <code>#</code> 字符来标记注释的开始，并且可以出现在规则的末尾，以解释该规则的功能，或者独占一行。任何空行都会被忽略。</p>
</div>
<div class="paragraph">
<p>在规则中使用的关键字必须按照特定的顺序从左到右进行编写。一些关键字是必需的，而其他一些是可选的。一些关键字具有子选项，这些子选项可能是关键字本身，并且还可以包含更多的子选项。关键字的顺序如下所示，其中大写字母表示变量，小写字母表示必须在其后面的变量之前出现的关键字：</p>
</div>
<div class="paragraph">
<p><code><em>ACTION DIRECTION OPTIONS proto PROTO_TYPE from SRC_ADDR SRC_PORT to DST_ADDR DST_PORT TCP_FLAG|ICMP_TYPE keep state STATE</em></code></p>
</div>
<div class="paragraph">
<p>本节描述了每个关键字及其选项。这不是一个详尽无遗的选项列表。有关在创建 IPF 规则和使用每个关键字的示例时可以使用的规则语法的完整描述，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a>。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">动作（ACTION）</dt>
<dd>
<p>action 关键字指示如果数据包与该规则匹配，应该采取什么操作。每个规则都 <strong>必须</strong> 有一个动作。以下动作被识别：</p>
<div class="paragraph">
<p><code>block</code>：丢弃该数据包。</p>
</div>
<div class="paragraph">
<p><code>pass</code>：允许数据包通过。</p>
</div>
<div class="paragraph">
<p><code>log</code>：生成一条日志记录。</p>
</div>
<div class="paragraph">
<p><code>count</code>：计算数据包和字节数的数量，可以提供规则使用频率的指示。</p>
</div>
<div class="paragraph">
<p><code>auth</code>：将数据包排队，以便由另一个程序进一步处理。</p>
</div>
<div class="paragraph">
<p><code>call</code>：提供对内置于 IPF 中的函数的访问，允许执行更复杂的操作。</p>
</div>
<div class="paragraph">
<p><code>decapsulate</code>：移除任何头部以便处理数据包的内容。</p>
</div>
</dd>
<dt class="hdlist1">方向（DIRECTION）</dt>
<dd>
<p>接下来，每个规则必须明确指定流量的方向，使用以下关键字之一：</p>
<div class="paragraph">
<p><code>in</code>：规则应用于入站数据包。</p>
</div>
<div class="paragraph">
<p><code>out</code>: 规则应用于出站数据包。</p>
</div>
<div class="paragraph">
<p><code>all</code>: 规则适用于任何方向。</p>
</div>
<div class="paragraph">
<p>如果系统有多个接口，可以在指定方向时同时指定接口。一个例子是 <code>in on fxp0</code>。</p>
</div>
</dd>
<dt class="hdlist1">选项（OPTIONS）</dt>
<dd>
<p>选项是可选的。然而，如果指定了多个选项，则必须按照这里显示的顺序使用。</p>
<div class="paragraph">
<p><code>log</code>：在执行指定的操作时，数据包头部的内容将被写入到 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipl&amp;sektion=4&amp;format=html">ipl(4)</a> 数据包日志伪设备中。</p>
</div>
<div class="paragraph">
<p><code>quick</code>: 如果一个数据包符合这个规则，那么规则指定的操作将会执行，并且对于这个数据包，不会再进行任何后续规则的处理。</p>
</div>
<div class="paragraph">
<p><code>on</code>：必须跟随着 <code><a href="https://man.freebsd.org/cgi/man.cgi?query=ifconfig&amp;sektion=8&amp;format=html">ifconfig(8)</a></code> 中显示的接口名称。只有当数据包通过指定的接口以指定的方向传输时，规则才会匹配。</p>
</div>
<div class="paragraph">
<p>使用 <code>log</code> 关键字时，可以按照以下顺序使用以下限定词：</p>
</div>
<div class="paragraph">
<p><code>body</code>：表示在报文头部之后，将记录报文内容的前 128 个字节。</p>
</div>
<div class="paragraph">
<p><code>first</code>：如果 <code>log</code> 关键字与 <code>keep state</code> 选项一起使用，建议使用此选项，以便仅记录触发的数据包，而不是与状态连接匹配的每个数据包。</p>
</div>
<div class="paragraph">
<p>还有其他选项可用于指定错误返回消息。有关更多详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a>。</p>
</div>
</dd>
<dt class="hdlist1">协议类型（PROTO_TYPE）</dt>
<dd>
<p>协议类型是可选的。然而，如果规则需要指定 SRC_PORT 或 DST_PORT ，则协议类型是必需的，因为它定义了协议的类型。在指定协议类型时，使用 <code>proto</code> 关键字，后面跟着来自 <span class="filename">/etc/protocols</span> 的协议号或名称。示例协议名称包括 <code>tcp</code>、<code>udp</code> 或 <code>icmp</code>。如果指定了 PROTO_TYPE，但未指定 SRC_PORT 或 DST_PORT，则该规则将匹配该协议的所有端口号。</p>
</dd>
<dt class="hdlist1">源地址</dt>
<dd>
<p><code>from</code> 关键字是必需的，并且后面跟着一个关键字，表示数据包的来源。来源可以是主机名、IP 地址后跟 CIDR 掩码、地址池或关键字 <code>all</code>。有关示例，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a>。</p>
<div class="paragraph">
<p>没有办法匹配那些不容易用点分十进制形式或掩码长度表示的 IP 地址范围。可以使用 <a class="package" href="https://cgit.freebsd.org/ports/tree/net-mgmt/ipcalc/">net-mgmt/ipcalc</a> 软件包或 port 来简化 CIDR 掩码的计算。有关该实用程序的更多信息，请访问其网页：http://jodies.de/ipcalc[<a href="http://jodies.de/ipcalc" class="bare">http://jodies.de/ipcalc</a>]。</p>
</div>
</dd>
<dt class="hdlist1">源端口（SRC_PORT）</dt>
<dd>
<p>源端口号是可选的。但是，如果使用了源端口号，规则中必须首先定义 PROTO_TYPE。端口号还必须在 <code>proto</code> 关键字之前。</p>
<div class="paragraph">
<p>支持多种不同的比较运算符：` = <code>（等于），</code>!=<code>（不等于），</code>&lt;`（小于），<code>&gt;</code>（大于），<code>⇐</code>（小于等于）和 <code>&gt;=</code>（大于等于）。</p>
</div>
<div class="paragraph">
<p>要指定端口范围，请将两个端口号放在 <code>&lt;&gt;</code>（小于和大于）、<code>&gt;&lt;</code>（大于和小于）或 <code>:</code>（大于或等于和小于或等于）之间。</p>
</div>
</dd>
<dt class="hdlist1">目标地址</dt>
<dd>
<p><code>to</code> 关键字是必需的，后面跟着一个关键字，表示数据包的目的地。与 SRC_ADDR 类似，它可以是主机名、IP 地址后跟 CIDR 掩码、地址池或关键字 <code>all</code>。</p>
</dd>
<dt class="hdlist1">目标端口（DST_PORT）</dt>
<dd>
<p>与 SRC_PORT 类似，目标端口号是可选的。然而，如果使用了目标端口号，规则中必须首先定义 PROTO_TYPE 。端口号还必须在 <code>proto</code> 关键字之前。</p>
</dd>
<dt class="hdlist1">TCP_FLAG|ICMP_TYPE</dt>
<dd>
<p>如果指定 <code>tcp</code> 作为 PROTO_TYPE，那么可以使用字母来指定标志，其中每个字母代表用于确定连接状态的可能的 TCP 标志之一。可能的值包括：<code>S</code>（SYN），<code>A</code>（ACK），<code>P</code>（PSH），<code>F</code>（FIN），<code>U</code>（URG），<code>R</code>（RST），<code>C</code>（CWN）和 <code>E</code>（ECN）。</p>
<div class="paragraph">
<p>如果指定了 <code>icmp</code> 作为 PROTO_TYPE，可以指定要匹配的 ICMP 类型。有关允许的类型，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a>。</p>
</div>
</dd>
<dt class="hdlist1">状态（STATE）</dt>
<dd>
<p>如果一个 <code>pass</code> 规则包含 <code>keep state</code>，IPF 将在其动态状态表中添加一个条目，并允许匹配连接的后续数据包。IPF 可以跟踪 TCP、UDP 和 ICMP 会话的状态。任何 IPF 可以确定是活动会话的一部分的数据包，即使是不同的协议，也将被允许通过。</p>
<div class="paragraph">
<p>在 IPF 中，目标要通过连接到公共互联网的接口发送的数据包首先会与动态状态表进行匹配检查。如果数据包与活动会话对话的下一个预期数据包匹配，它将离开防火墙，并且会话对话流的状态将在动态状态表中更新。不属于已经活动会话的数据包将会与出站规则集进行检查。从连接到公共互联网的接口进入的数据包首先会与动态状态表进行匹配检查。如果数据包与活动会话的下一个预期数据包匹配，它将离开防火墙，并且会话对话流的状态将在动态状态表中更新。不属于已经活动会话的数据包将会与入站规则集进行检查。</p>
</div>
<div class="paragraph">
<p>在 <code>keep state</code> 之后可以添加几个关键字。如果使用了这些关键字，它们可以设置各种控制有状态过滤的选项，例如设置连接限制或连接时长。请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> 以获取可用选项及其描述的列表。</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_示例规则集_2">33.5.3. 示例规则集<a class="anchor" href="#_示例规则集_2"></a></h3>
<div class="paragraph">
<p>本节演示如何创建一个示例规则集，该规则集仅允许与 <code>pass</code> 规则匹配的服务，并阻止所有其他服务。</p>
</div>
<div class="paragraph">
<p>FreeBSD 使用回环接口（<span class="filename">lo0</span>）和 IP 地址 <code>127.0.0.1</code> 进行内部通信。防火墙规则集必须包含允许这些内部使用的数据包自由传输的规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># no restrictions on loopback interface
pass in quick on lo0 all
pass out quick on lo0 all</pre>
</div>
</div>
<div class="paragraph">
<p>与互联网连接的公共接口用于授权和控制所有出站和入站连接的访问。如果一个或多个接口连接到私有网络，那些内部接口可能需要规则来允许源自局域网的数据包在内部网络之间或连接到互联网的接口之间流动。规则集应该分为三个主要部分：任何受信任的内部接口、通过公共接口的出站连接和通过公共接口的入站连接。</p>
</div>
<div class="paragraph">
<p>这两条规则允许所有流量通过一个名为 <span class="filename">xl0</span> 的受信任的局域网接口传输。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># no restrictions on inside LAN interface for private network
pass out quick on xl0 all
pass in quick on xl0 all</pre>
</div>
</div>
<div class="paragraph">
<p>公共接口的出站和入站部分的规则应该将最常匹配的规则放在不常匹配的规则之前，而该部分的最后一条规则应该阻止并记录该接口和方向的所有数据包。</p>
</div>
<div class="paragraph">
<p>这组规则定义了名为 <span class="filename">dc0</span> 的公共接口的出站部分。这些规则保持状态并标识内部系统被授权用于公共互联网访问的特定服务。所有规则都使用 <code>quick</code> 并指定适当的端口号和（如果适用）目标地址。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># interface facing Internet (outbound)
# Matches session start requests originating from or behind the
# firewall, destined for the Internet.

# Allow outbound access to public DNS servers.
# Replace x.x.x.x with address listed in /etc/resolv.conf.
# Repeat for each DNS server.
pass out quick on dc0 proto tcp from any to x.x.x.x port = 53 flags S keep state
pass out quick on dc0 proto udp from any to x.x.x.x port = 53 keep state

# Allow access to ISP&#39;s specified DHCP server for cable or DSL networks.
# Use the first rule, then check log for the IP address of DHCP server.
# Then, uncomment the second rule, replace z.z.z.z with the IP address,
# and comment out the first rule
pass out log quick on dc0 proto udp from any to any port = 67 keep state
#pass out quick on dc0 proto udp from any to z.z.z.z port = 67 keep state

# Allow HTTP and HTTPS
pass out quick on dc0 proto tcp from any to any port = 80 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 443 flags S keep state

# Allow email
pass out quick on dc0 proto tcp from any to any port = 110 flags S keep state
pass out quick on dc0 proto tcp from any to any port = 25 flags S keep state

# Allow NTP
pass out quick on dc0 proto tcp from any to any port = 37 flags S keep state

# Allow FTP
pass out quick on dc0 proto tcp from any to any port = 21 flags S keep state

# Allow SSH
pass out quick on dc0 proto tcp from any to any port = 22 flags S keep state

# Allow ping
pass out quick on dc0 proto icmp from any to any icmp-type 8 keep state

# Block and log everything else
block out log first quick on dc0 all</pre>
</div>
</div>
<div class="paragraph">
<p>公共接口入站部分的规则示例首先阻止所有不需要的数据包。这样可以减少最后一个规则记录的数据包数量。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># interface facing Internet (inbound)
# Block all inbound traffic from non-routable or reserved address spaces
block in quick on dc0 from 192.168.0.0/16 to any    #RFC 1918 private IP
block in quick on dc0 from 172.16.0.0/12 to any     #RFC 1918 private IP
block in quick on dc0 from 10.0.0.0/8 to any        #RFC 1918 private IP
block in quick on dc0 from 127.0.0.0/8 to any       #loopback
block in quick on dc0 from 0.0.0.0/8 to any         #loopback
block in quick on dc0 from 169.254.0.0/16 to any    #DHCP auto-config
block in quick on dc0 from 192.0.2.0/24 to any      #reserved for docs
block in quick on dc0 from 204.152.64.0/23 to any   #Sun cluster interconnect
block in quick on dc0 from 224.0.0.0/3 to any       #Class D &amp; E multicast

# Block fragments and too short tcp packets
block in quick on dc0 all with frags
block in quick on dc0 proto tcp all with short

# block source routed packets
block in quick on dc0 all with opt lsrr
block in quick on dc0 all with opt ssrr

# Block OS fingerprint attempts and log first occurrence
block in log first quick on dc0 proto tcp from any to any flags FUP

# Block anything with special options
block in quick on dc0 all with ipopts

# Block public pings and ident
block in quick on dc0 proto icmp all icmp-type 8
block in quick on dc0 proto tcp from any to any port = 113

# Block incoming Netbios services
block in log first quick on dc0 proto tcp/udp from any to any port = 137
block in log first quick on dc0 proto tcp/udp from any to any port = 138
block in log first quick on dc0 proto tcp/udp from any to any port = 139
block in log first quick on dc0 proto tcp/udp from any to any port = 81</pre>
</div>
</div>
<div class="paragraph">
<p>每当规则上有带有 <code>log first</code> 选项的日志消息时，运行 <code>ipfstat -hio</code> 来评估该规则被匹配的次数。大量的匹配可能表明系统正在遭受攻击。</p>
</div>
<div class="paragraph">
<p>入站部分的其余规则定义了允许从互联网发起的连接。最后一条规则拒绝了所有未在本节中明确允许的连接。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Allow traffic in from ISP&#39;s DHCP server. Replace z.z.z.z with
# the same IP address used in the outbound section.
pass in quick on dc0 proto udp from z.z.z.z to any port = 68 keep state

# Allow public connections to specified internal web server
pass in quick on dc0 proto tcp from any to x.x.x.x port = 80 flags S keep state

# Block and log only first occurrence of all remaining traffic.
block in log first quick on dc0 all</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置_nat">33.5.4. 配置 NAT<a class="anchor" href="#_配置_nat"></a></h3>
<div class="paragraph">
<p>要启用 NAT，请将以下语句添加到 <span class="filename">/etc/rc.conf</span> 文件中，并指定包含 NAT 规则的文件的名称：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gateway_enable=&#34;YES&#34;
ipnat_enable=&#34;YES&#34;
ipnat_rules=&#34;/etc/ipnat.rules&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>NAT 规则是灵活的，可以实现许多不同的功能，以满足商业和家庭用户的需求。这里介绍的规则语法已经简化，以展示常见用法。有关完整的规则语法描述，请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipnat&amp;sektion=5&amp;format=html">ipnat(5)</a>。</p>
</div>
<div class="paragraph">
<p>NAT 规则的基本语法如下所示，其中 <code>map</code> 是规则的开始，<em>IF</em> 应替换为外部接口的名称：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>map IF LAN_IP_RANGE -&gt; PUBLIC_ADDRESS</pre>
</div>
</div>
<div class="paragraph">
<p><em>LAN_IP_RANGE</em> 是内部客户端使用的 IP 地址范围。通常情况下，它是一个私有地址范围，比如 <code>192.168.1.0/24</code> 。<em>PUBLIC_ADDRESS</em> 可以是静态外部 IP 地址，也可以是关键字 <code>0/32</code>，表示分配给 <em>IF</em> 的 IP 地址。</p>
</div>
<div class="paragraph">
<p>在 IPF 中，当一个数据包从局域网带有公共目的地到达防火墙时，它首先通过防火墙规则集的出站规则。然后，数据包被传递到 NAT 规则集，该规则集从上到下进行读取，第一个匹配的规则获胜。IPF 会将每个 NAT 规则与数据包的接口名称和源 IP 地址进行测试。当数据包的接口名称与 NAT 规则匹配时，将检查数据包在私有局域网中的源 IP 地址是否落在 <em>LAN_IP_RANGE</em> 指定的 IP 地址范围内。如果匹配成功，数据包的源 IP 地址将被重写为 <em>PUBLIC_ADDRESS</em> 指定的公共 IP 地址。IPF 会在其内部 NAT 表中发布一个条目，以便当数据包从互联网返回时，可以将其映射回原始的私有 IP 地址，然后将其传递给防火墙规则进行进一步处理。</p>
</div>
<div class="paragraph">
<p>对于拥有大量内部系统或多个子网的网络来说，将每个私有 IP 地址汇集到一个公共 IP 地址中的过程会成为一个资源问题。有两种方法可以解决这个问题。</p>
</div>
<div class="paragraph">
<p>第一种方法是分配一段端口作为源端口使用。通过添加 <code>portmap</code> 关键字，可以指示 NAT 仅使用指定范围内的源端口。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp 20000:60000</pre>
</div>
</div>
<div class="paragraph">
<p>或者，使用 <code>auto</code> 关键字，告诉 NAT 确定可用于使用的端口：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>map dc0 192.168.1.0/24 -&gt; 0/32 portmap tcp/udp auto</pre>
</div>
</div>
<div class="paragraph">
<p>第二种方法是使用一个公共地址池。当局域网地址太多无法适应单个公共地址，并且有一块公共 IP 地址可用时，这种方法非常有用。这些公共地址可以作为一个池， NAT 会从中选择一个 IP 地址，将数据包的地址映射为其外部传输时的地址。</p>
</div>
<div class="paragraph">
<p>公共 IP 地址的范围可以使用网络掩码或 CIDR 表示法来指定。这两个规则是等价的：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>map dc0 192.168.1.0/24 -&gt; 204.134.75.0/255.255.255.0
map dc0 192.168.1.0/24 -&gt; 204.134.75.0/24</pre>
</div>
</div>
<div class="paragraph">
<p>常见做法是将公共可访问的 Web 服务器或邮件服务器隔离到内部网络段。这些服务器的流量仍然需要经过 NAT ，但需要进行端口重定向以将入站流量定向到正确的服务器。例如，要将使用内部地址 <code>10.0.10.25</code> 的 Web 服务器映射到其公共 IP 地址 <code>20.20.20.5</code>，请使用以下规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>rdr dc0 20.20.20.5/32 port 80 -&gt; 10.0.10.25 port 80</pre>
</div>
</div>
<div class="paragraph">
<p>如果它是唯一的 Web 服务器，这个规则也会起作用，因为它会将所有外部 HTTP 请求重定向到 <code>10.0.10.25</code>。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>rdr dc0 0.0.0.0/0 port 80 -&gt; 10.0.10.25 port 80</pre>
</div>
</div>
<div class="paragraph">
<p>IPF 内置了一个可以与 NAT 一起使用的 FTP 代理。它监视所有出站流量，以检测主动或被动的 FTP 连接请求，并动态创建临时过滤规则，其中包含 FTP 数据通道使用的端口号。这样就不需要打开大范围的高阶端口来进行 FTP 连接。</p>
</div>
<div class="paragraph">
<p>在这个例子中，第一条规则调用代理来处理内部局域网的出站 FTP 流量。第二条规则将 FTP 流量从防火墙传递到互联网，第三条规则处理内部局域网的所有非 FTP 流量。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>map dc0 10.0.10.0/29 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 0.0.0.0/0 -&gt; 0/32 proxy port 21 ftp/tcp
map dc0 10.0.10.0/29 -&gt; 0/32</pre>
</div>
</div>
<div class="paragraph">
<p>FTP 的 <code>map</code> 规则在 NAT 规则之前，这样当一个数据包匹配到 FTP 规则时， FTP 代理会创建临时过滤规则，以便让 FTP 会话数据包通过并进行 NAT。所有不是 FTP 的局域网数据包如果匹配到第三条规则，也会进行 NAT 处理。</p>
</div>
<div class="paragraph">
<p>如果没有 FTP 代理，将需要以下防火墙规则。请注意，如果没有代理，需要允许所有大于 <code>1024</code> 的端口：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Allow out LAN PC client FTP to public Internet
# Active and passive modes
pass out quick on rl0 proto tcp from any to any port = 21 flags S keep state

# Allow out passive mode data channel high order port numbers
pass out quick on rl0 proto tcp from any to any port &gt; 1024 flags S keep state

# Active mode let data channel in from FTP server
pass in quick on rl0 proto tcp from any to any port = 20 flags S keep state</pre>
</div>
</div>
<div class="paragraph">
<p>每当编辑包含 NAT 规则的文件时，运行 <code>ipnat</code> 命令并使用 <code>-CF</code> 选项来删除当前的 NAT 规则，并清空动态转换表的内容。同时，使用 <code>-f</code> 选项并指定要加载的 NAT 规则集的名称。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipnat -CF -f /etc/ipnat.rules</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>显示 NAT 统计信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipnat -s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要列出 NAT 表的当前映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipnat -l</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要打开详细模式并显示与规则处理、活动规则和表项相关的信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ipnat -v</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_查看_ipf_统计信息">33.5.5. 查看 IPF 统计信息<a class="anchor" href="#_查看_ipf_统计信息"></a></h3>
<div class="paragraph">
<p>IPF 包括 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a>，可用于检索和显示统计信息，这些统计信息是在数据包通过防火墙时匹配规则时收集的。统计信息从上次启动防火墙或使用 <code>ipf -Z</code> 将其重置为零的上次重置以来累积。</p>
</div>
<div class="paragraph">
<p>默认的 <code>ipfstat</code> 输出如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">input packets: blocked 99286 passed 1255609 nomatch 14686 counted 0
 output packets: blocked 4200 passed 1284345 nomatch 14687 counted 0
 input packets logged: blocked 99286 passed 0
 output packets logged: blocked 0 passed 0
 packets logged: input 0 output 0
 log failures: input 3898 output 0
 fragment state<span class="o">(</span><span class="k">in</span><span class="o">)</span>: kept 0 lost 0
 fragment state<span class="o">(</span>out<span class="o">)</span>: kept 0 lost 0
 packet state<span class="o">(</span><span class="k">in</span><span class="o">)</span>: kept 169364 lost 0
 packet state<span class="o">(</span>out<span class="o">)</span>: kept 431395 lost 0
 ICMP replies: 0 TCP RSTs sent: 0
 Result cache hits<span class="o">(</span><span class="k">in</span><span class="o">)</span>: 1215208 <span class="o">(</span>out<span class="o">)</span>: 1098963
 IN Pullups succeeded: 2 failed: 0
 OUT Pullups succeeded: 0 failed: 0
 Fastroute successes: 0 failures: 0
 TCP cksum fails<span class="o">(</span><span class="k">in</span><span class="o">)</span>: 0 <span class="o">(</span>out<span class="o">)</span>: 0
 Packet log flags <span class="nb">set</span>: <span class="o">(</span>0<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>有几个选项可供选择。当使用 <code>-i</code> 参数表示入站规则，或使用 <code>-o</code> 参数表示出站规则时，该命令将检索并显示内核当前安装和使用的相应过滤规则列表。如果想要同时看到规则编号，可以加上 <code>-n</code> 参数。例如，<code>ipfstat -on</code> 将显示带有规则编号的出站规则表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">@1 pass out on xl0 from any to any
@2 block out on dc0 from any to any
@3 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre>
</div>
</div>
<div class="paragraph">
<p>在每个规则前加上匹配次数的计数，请使用 <code>-h</code> 选项。例如，<code>ipfstat -oh</code> 显示出站内部规则表，每个规则前都有它的使用次数计数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">2451423 pass out on xl0 from any to any
354727 block out on dc0 from any to any
430918 pass out quick on dc0 proto tcp/udp from any to any keep state</code></pre>
</div>
</div>
<div class="paragraph">
<p>要以类似于 <a href="https://man.freebsd.org/cgi/man.cgi?query=top&amp;sektion=1&amp;format=html">top(1)</a> 的格式显示状态表，请使用 <code>ipfstat -t</code> 命令。当防火墙遭受攻击时，此选项可以识别和查看攻击数据包。可选的子标志提供了实时监控目标或源 IP、端口或协议的能力。有关详细信息，请参阅 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipfstat&amp;sektion=8&amp;format=html">ipfstat(8)</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ipf_日志记录">33.5.6. IPF 日志记录<a class="anchor" href="#_ipf_日志记录"></a></h3>
<div class="paragraph">
<p>IPF 提供了 <code>ipmon</code> 工具，可以将防火墙的日志信息以人类可读的格式写入。使用该工具需要首先按照 <a href="../kernelconfig/#kernelconfig">配置 FreeBSD 内核</a> 中的说明，在自定义内核中添加 <code>options IPFILTER_LOG</code> 选项。</p>
</div>
<div class="paragraph">
<p>该命令通常以守护进程模式运行，以提供连续的系统日志文件，以便可以回顾过去事件的记录。由于 FreeBSD 内置了 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> 设施来自动轮转系统日志，因此默认的 <span class="filename">rc.conf</span> <code>ipmon_flags</code> 语句使用了 <code>-Ds</code> 选项。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ipmon_flags=&#34;-Ds&#34; # D = start as daemon
                  # s = log to syslog
                  # v = log tcp window, ack, seq
                  # n = map IP &amp; port to names</pre>
</div>
</div>
<div class="paragraph">
<p>日志记录提供了事后审查的能力，可以查看诸如哪些数据包被丢弃、它们来自哪些地址以及它们的目的地是什么等信息。这些信息在追踪攻击者方面非常有用。</p>
</div>
<div class="paragraph">
<p>一旦在 <span class="filename">rc.conf</span> 中启用了日志记录功能，并使用 <code>service ipmon start</code> 启动后，IPF 将只记录包含 <code>log</code> 关键字的规则。防火墙管理员决定哪些规则应该被记录，通常只有拒绝规则会被记录。习惯上，在规则集中的最后一个规则中包含 <code>log</code> 关键字。这样可以查看所有未匹配规则集中任何规则的数据包。</p>
</div>
<div class="paragraph">
<p>默认情况下，<code>ipmon -Ds</code> 模式使用 <code>local0</code> 作为日志设备。以下日志级别可用于进一步分离记录的数据：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">LOG_INFO - packets logged using the <span class="s2">&#34;log&#34;</span> keyword as the action rather than pass or block.
LOG_NOTICE - packets logged which are also passed
LOG_WARNING - packets logged which are also blocked
LOG_ERR - packets which have been logged and which can be considered short due to an incomplete header</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了将 IPF 设置为将所有数据记录到 <span class="filename">/var/log/ipfilter.log</span> 文件中，首先创建一个空文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># touch /var/log/ipfilter.log</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，要将所有记录的消息写入指定的文件，请将以下语句添加到 <span class="filename">/etc/syslog.conf</span> 文件中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>local0.* /var/log/ipfilter.log</pre>
</div>
</div>
<div class="paragraph">
<p>要激活更改并指示 <a href="https://man.freebsd.org/cgi/man.cgi?query=syslogd&amp;sektion=8&amp;format=html">syslogd(8)</a> 读取修改后的 <span class="filename">/etc/syslog.conf</span>，请运行 <code>service syslogd reload</code>。</p>
</div>
<div class="paragraph">
<p>不要忘记编辑 <span class="filename">/etc/newsyslog.conf</span> 来轮转新的日志文件。</p>
</div>
<div class="paragraph">
<p><code>ipmon</code> 生成的消息由以空格分隔的数据字段组成。所有消息都包含以下共同字段：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>数据包接收日期。</p>
</li>
<li>
<p>数据包接收时间。格式为 HH:MM:SS.F，表示小时、分钟、秒和秒的小数部分。</p>
</li>
<li>
<p>处理数据包的接口名称。</p>
</li>
<li>
<p>规则的组和规则编号的格式为 <code>@0:17</code>。</p>
</li>
<li>
<p>动作：<code>p</code> 表示通过，<code>b</code> 表示阻止，<code>S</code> 表示短数据包，<code>n</code> 表示未匹配任何规则，<code>L</code> 表示日志规则。</p>
</li>
<li>
<p>地址写作三个字段：源地址和端口由逗号分隔，→ 符号，以及目标地址和端口。例如： <code>209.53.17.22,80 → 198.73.220.17,1722</code>。</p>
</li>
<li>
<p>以协议名称或编号后跟 <code>PR</code>：例如，<code>PR tcp</code>。</p>
</li>
<li>
<p><code>len</code> 后面跟着数据包的头部长度和总长度：例如，<code>len 20 40</code>。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果数据包是 TCP 数据包，则会有一个额外的字段，以连字符开头，后面跟着对应于设置的任何标志的字母。请参考 <a href="https://man.freebsd.org/cgi/man.cgi?query=ipf&amp;sektion=5&amp;format=html">ipf(5)</a> 以获取字母和它们的标志列表。</p>
</div>
<div class="paragraph">
<p>如果数据包是一个 ICMP 数据包，那么在末尾将会有两个字段：第一个字段始终是“icmp”，下一个字段是 ICMP 消息和子消息类型，用斜杠分隔。例如：对于一个端口不可达的消息，表示为 <code>icmp 3/3</code>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="firewalls-blacklistd">33.6. 黑名单服务<a class="anchor" href="#firewalls-blacklistd"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Blacklistd 是一个守护进程，监听套接字以接收来自其他守护进程的有关连接尝试失败或成功的通知。它最常用于阻止在开放端口上进行过多的连接尝试。一个典型的例子是在互联网上运行的 SSH 收到大量来自机器人或脚本的密码猜测和入侵尝试。使用 blacklistd ，守护进程可以通知防火墙在多次尝试后创建一个过滤规则，以阻止来自单个源的过多连接尝试。 Blacklistd 最初在 NetBSD 上开发，并在版本 7 中首次出现。FreeBSD 11 从 NetBSD 导入了 blacklistd。</p>
</div>
<div class="paragraph">
<p>本章介绍了如何设置和配置 blacklistd ，并提供了如何使用它的示例。读者应该熟悉基本的防火墙概念，如规则。有关详细信息，请参阅防火墙章节。示例中使用了 PF，但在 FreeBSD 上可用的其他防火墙也应该能够与 blacklistd 一起使用。</p>
</div>
<div class="sect2">
<h3 id="_启用_blacklistd">33.6.1. 启用 Blacklistd<a class="anchor" href="#_启用_blacklistd"></a></h3>
<div class="paragraph">
<p>blacklistd 的主要配置存储在 <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a> 中。还有一些命令行选项可用于更改 blacklistd 的运行时行为。重启后的持久配置应存储在 <span class="filename">/etc/blacklistd.conf</span> 中。要在系统启动时启用守护进程，请在 <span class="filename">/etc/rc.conf</span> 中添加一行 <code>blacklistd_enable</code>，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc blacklistd_enable=yes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要手动启动服务，请运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service blacklistd start</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_创建一个_blacklistd_规则集">33.6.2. 创建一个 Blacklistd 规则集<a class="anchor" href="#_创建一个_blacklistd_规则集"></a></h3>
<div class="paragraph">
<p>黑名单规则在 <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a> 中配置，每行一个条目。每个规则包含一个由空格或制表符分隔的元组。规则可以属于 <code>local</code> 或 <code>remote</code>，分别适用于运行 blacklistd 的机器或外部来源。</p>
</div>
<div class="sect3">
<h4 id="_本地规则">33.6.2.1. 本地规则<a class="anchor" href="#_本地规则"></a></h4>
<div class="paragraph">
<p>一个本地规则的示例 blacklistd.conf 条目如下：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[local]
ssh             stream  *       *               *       3       24h</pre>
</div>
</div>
<div class="paragraph">
<p>在 <code>[local]</code> 部分之后的所有规则都被视为本地规则（这是默认情况），适用于本地机器。当遇到 <code>[remote]</code> 部分时，其后的所有规则都被视为远程机器规则。</p>
</div>
<div class="paragraph">
<p>规则由七个字段组成，字段之间用制表符或空格分隔。前四个字段用于标识应该被加入黑名单的流量。接下来的三个字段定义了黑名单的行为。通配符用星号（<code>*</code>）表示，可以匹配该字段中的任何内容。第一个字段定义了位置，对于本地规则来说，这些是网络端口。位置字段的语法如下：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[address|interface][/mask][:port]</pre>
</div>
</div>
<div class="paragraph">
<p>地址可以以数字格式指定为 IPv4 ，也可以以方括号指定为 IPv6 。还可以使用类似 <code><em>em0</em></code> 的接口名称。</p>
</div>
<div class="paragraph">
<p>套接字类型由第二个字段定义。TCP 套接字的类型是 <code>stream</code>，而 UDP 则表示为 <code>dgram</code> 。上面的示例使用 TCP，因为 SSH 正在使用该协议。</p>
</div>
<div class="paragraph">
<p>协议可以在 blacklistd 规则的第三个字段中使用。可以使用以下协议：<code>tcp</code>，<code>udp</code>，<code>tcp6</code>，<code>udp6</code> 或数字。通常使用通配符（如示例中）来匹配所有协议，除非有理由通过特定协议区分流量。</p>
</div>
<div class="paragraph">
<p>在第四个字段中，定义了报告事件的守护进程的有效用户或所有者。可以在这里使用用户名或 UID ，也可以使用通配符（参见上面的示例规则）。</p>
</div>
<div class="paragraph">
<p>数据包过滤规则的名称由第五个字段声明，该字段开始规则的行为部分。默认情况下，blacklistd 将所有阻止的数据包放在名为 <code>blacklistd</code> 的 pf 锚点下，就像这样在 <span class="filename">pf.conf</span> 中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>anchor &#34;blacklistd/*&#34; in on $ext_if
block in
pass out</pre>
</div>
</div>
<div class="paragraph">
<p>对于单独的块列表，可以在此字段中使用锚点名称。在其他情况下，通配符就足够了。当名称以连字符（<code>-</code>）开头时，意味着应该使用带有默认规则名称前缀的锚点。使用连字符的修改示例如下所示：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ssh             stream  *       *               -ssh       3       24h</pre>
</div>
</div>
<div class="paragraph">
<p>有了这样的规则，任何新的阻止列表规则都会被添加到一个名为 <code>blacklistd-ssh</code> 的锚点中。</p>
</div>
<div class="paragraph">
<p>为了针对单个规则违规封锁整个子网，可以在规则名称中使用 <code>/</code>。这会导致名称的剩余部分被解释为要应用于规则中指定的地址的掩码。例如，这个规则将封锁与 <code>/24</code> 相邻的每个地址。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>22              stream  tcp       *               */24    3       24h</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在这里指定正确的协议是很重要的。 IPv4 和 IPv6 对待 /24 的方式不同，这就是为什么在这个规则的第三个字段中不能使用“ * ”。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这条规则定义了如果该网络中的任何一个主机表现不当，那么该网络上的其他所有内容也将被阻止。</p>
</div>
<div class="paragraph">
<p>第六个字段称为 <code>nfail</code>，它设置了在特定远程 IP 被列入黑名单之前所需的登录失败次数。当在此位置使用通配符时，意味着永远不会发生阻止。在上面的示例规则中，定义了三次限制，这意味着在一次连接中尝试三次登录 SSH 后，该 IP 将被阻止。</p>
</div>
<div class="paragraph">
<p>在 blacklistd 规则定义中，最后一个字段指定了主机被加入黑名单的时间长度。默认单位是秒，但也可以使用后缀 <code>m</code>、<code>h</code> 和 <code>d</code> 分别指定分钟、小时和天。</p>
</div>
<div class="paragraph">
<p>整个示例规则的意思是，当通过 SSH 进行三次身份验证后，将为该主机生成一个新的 PF 阻止规则。规则匹配是通过首先按顺序检查本地规则来进行的，从最具体到最不具体。当发生匹配时，将应用 <code>remote</code> 规则，并且匹配的 <code>remote</code> 规则将更改名称、<code>nfail</code> 和 <code>disable</code> 字段。</p>
</div>
</div>
<div class="sect3">
<h4 id="_远程规则">33.6.2.2. 远程规则<a class="anchor" href="#_远程规则"></a></h4>
<div class="paragraph">
<p>远程规则用于指定 blacklistd 根据当前评估的远程主机来改变其行为的方式。远程规则中的每个字段与本地规则中的字段相同，唯一的区别在于 blacklistd 使用它们的方式。为了解释这一点，我们使用以下示例规则：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[remote]
203.0.113.128/25 *      *       *               =/25    =       48h</pre>
</div>
</div>
<div class="paragraph">
<p>地址字段可以是 IP 地址（IPv4 或 IPv6），端口或两者兼有。这允许为特定的远程地址范围设置特殊规则，就像这个例子中一样。套接字类型、协议和所有者字段的解释与本地规则完全相同。</p>
</div>
<div class="paragraph">
<p>然而，名称字段是不同的：远程规则中的等号（<code>=</code>）告诉 blacklistd 使用匹配的本地规则的值。这意味着防火墙规则条目被采用，并添加了 <code>/25</code> 前缀（一个 <code>255.255.255.128</code> 的网络掩码）。当来自该地址范围的连接被列入黑名单时，整个子网都会受到影响。在这里也可以使用 PF 锚点名称，这样 blacklistd 将为该地址块添加到该名称的锚点的规则。当指定通配符时，将使用默认表。</p>
</div>
<div class="paragraph">
<p>可以为地址定义 <code>nfail</code> 列中的自定义失败次数。这对于特定规则的例外情况非常有用，可以允许某人对规则应用更宽松或更宽容的登录尝试。当在第六个字段中使用星号时，阻止功能将被禁用。</p>
</div>
<div class="paragraph">
<p>远程规则允许对登录尝试的限制进行更严格的执行，相比于来自本地网络（如办公室）的尝试。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_黑名单客户端配置">33.6.3. 黑名单客户端配置<a class="anchor" href="#_黑名单客户端配置"></a></h3>
<div class="paragraph">
<p>在 FreeBSD 中有几个软件包可以利用 blacklistd 的功能。其中最重要的两个是 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> 和 <a href="https://man.freebsd.org/cgi/man.cgi?query=sshd&amp;sektion=8&amp;format=html">sshd(8)</a> ，用于阻止过多的连接尝试。要在 SSH 守护程序中激活 blacklistd，请将以下行添加到 <span class="filename">/etc/ssh/sshd_config</span> 文件中：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>UseBlacklist yes</pre>
</div>
</div>
<div class="paragraph">
<p>在进行这些更改后，重新启动 sshd 以使其生效。</p>
</div>
<div class="paragraph">
<p>对于 <a href="https://man.freebsd.org/cgi/man.cgi?query=ftpd&amp;sektion=8&amp;format=html">ftpd(8)</a> 的黑名单功能已启用，可以使用 <code>-B</code> 选项，在 <span class="filename">/etc/inetd.conf</span> 文件中或者作为 <span class="filename">/etc/rc.conf</span> 文件中的一个标志来设置，如下所示：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ftpd_flags=&#34;-B&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>这就是使这些程序与 blacklistd 通信所需的全部内容。</p>
</div>
</div>
<div class="sect2">
<h3 id="_黑名单管理">33.6.4. 黑名单管理<a class="anchor" href="#_黑名单管理"></a></h3>
<div class="paragraph">
<p>Blacklistd 为用户提供了一个名为 <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistctl&amp;sektion=8&amp;format=html">blacklistctl(8)</a> 的管理工具。它显示由 <a href="https://man.freebsd.org/cgi/man.cgi?query=blacklistd.conf&amp;sektion=5&amp;format=html">blacklistd.conf(5)</a> 中定义的规则所屏蔽的地址和网络。要查看当前被屏蔽的主机列表，可以使用 <code>dump</code> 和 <code>-b</code> 组合，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># blacklistctl dump -b</span>
      address/ma:port id      nfail   last access
213.0.123.128/25:22   OK      6/3     2019/06/08 14:30:19</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子显示，来自地址范围 <code>213.0.123.128/25</code> 的端口 22 上有 3 次允许的尝试中有 6 次失败。列出的尝试次数比允许的次数多，因为 SSH 允许客户端在单个 TCP 连接上尝试多次登录。正在进行中的连接不会被 blacklistd 停止。最后一次连接尝试在输出的 <code>last access</code> 列中列出。</p>
</div>
<div class="paragraph">
<p>要查看此主机在封锁列表上的剩余时间，请在上一个命令中添加 <code>-r</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># blacklistctl dump -br</span>
      address/ma:port id      nfail   remaining <span class="nb">time
</span>213.0.123.128/25:22   OK      6/3     36s</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，还有 36 秒的时间，直到这个主机不再被阻止。</p>
</div>
</div>
<div class="sect2">
<h3 id="_从阻止列表中移除主机">33.6.5. 从阻止列表中移除主机<a class="anchor" href="#_从阻止列表中移除主机"></a></h3>
<div class="paragraph">
<p>有时候在剩余时间到期之前需要将主机从阻止列表中移除。不幸的是，blacklistd 中没有这样的功能。然而，可以使用 pfctl 将地址从 PF 表中移除。对于每个被阻止的端口，在 <span class="filename">/etc/pf.conf</span> 中的 blacklistd 锚点内定义了一个子锚点。例如，如果有一个用于阻止端口 22 的子锚点，它被称为 <code>blacklistd/22</code>。在该子锚点内有一个包含被阻止地址的表。该表的名称是 port 加上端口号。在这个例子中，它将被称为 <code>port22</code>。有了这些信息，现在可以使用 <a href="https://man.freebsd.org/cgi/man.cgi?query=pfctl&amp;sektion=8&amp;format=html">pfctl(8)</a> 来显示所有列出的地址。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -a blacklistd/22 -t port22 -T show</span>
...
213.0.123.128/25
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>在确定要从列表中解除阻止的地址之后，以下命令将其从列表中移除：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pfctl -a blacklistd/22 -t port22 -T delete 213.0.123.128/25</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>该地址现在已从 PF 中移除，但仍会显示在 blacklistctl 列表中，因为它不知道在 PF 中所做的任何更改。blacklistd 数据库中的条目最终会过期并从其输出中删除。 如果主机再次匹配 blacklistd 中的阻止规则，则该条目将被再次添加。</p>
</div>
</div>
</div>
</div>

    </div>
    
    <hr />
    <div class="last-modified">
      <p><strong>上次修改时间</strong>: January 16, 2024 by <a href="https://cgit.freebsd.org/doc/commit/?id=16cefea" target="_blank">fiercex</a></p>
    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn-auto/books/handbook/network-servers class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=https://free.bsd-doc.org/zh-cn-auto/books/handbook/advanced-networking  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>目录</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#firewalls-intro">33.1. 简介</a></li>
    <li><a href="#firewalls-concepts">33.2. 防火墙概念</a></li>
    <li><a href="#firewalls-pf">33.3. PF</a>
      <ul>
        <li><a href="#_启用_pf">33.3.1. 启用 PF</a></li>
        <li><a href="#pf-tutorial">33.3.2. PF 规则集</a></li>
        <li><a href="#_启用_altq">33.3.3. 启用 ALTQ</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-ipfw">33.4. IPFW</a>
      <ul>
        <li><a href="#firewalls-ipfw-enable">33.4.1. 启用 IPFW</a></li>
        <li><a href="#firewalls-ipfw-rules">33.4.2. IPFW 规则语法</a></li>
        <li><a href="#_示例规则集">33.4.3. 示例规则集</a></li>
        <li><a href="#in-kernel-nat">33.4.4. 内核级网络地址转换（In-kernel NAT）</a></li>
        <li><a href="#firewalls-ipfw-cmd">33.4.5. IPFW 命令</a></li>
        <li><a href="#firewalls-ipfw-kernelconfig">33.4.6. IPFW 内核选项</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-ipf">33.5. IPFILTER (IPF)</a>
      <ul>
        <li><a href="#_启用_ipf">33.5.1. 启用 IPF</a></li>
        <li><a href="#_ipf_规则语法">33.5.2. IPF 规则语法</a></li>
        <li><a href="#_示例规则集_2">33.5.3. 示例规则集</a></li>
        <li><a href="#_配置_nat">33.5.4. 配置 NAT</a></li>
        <li><a href="#_查看_ipf_统计信息">33.5.5. 查看 IPF 统计信息</a></li>
        <li><a href="#_ipf_日志记录">33.5.6. IPF 日志记录</a></li>
      </ul>
    </li>
    <li><a href="#firewalls-blacklistd">33.6. 黑名单服务</a>
      <ul>
        <li><a href="#_启用_blacklistd">33.6.1. 启用 Blacklistd</a></li>
        <li><a href="#_创建一个_blacklistd_规则集">33.6.2. 创建一个 Blacklistd 规则集</a></li>
        <li><a href="#_黑名单客户端配置">33.6.3. 黑名单客户端配置</a></li>
        <li><a href="#_黑名单管理">33.6.4. 黑名单管理</a></li>
        <li><a href="#_从阻止列表中移除主机">33.6.5. 从阻止列表中移除主机</a></li>
      </ul>
    </li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="https://free.bsd-doc.org/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="https://free.bsd-doc.org/zh-cn-auto/languages">
                
                <img src="https://free.bsd-doc.org/images/language.png" class="language-image" alt="Choose language">
                <span>简体中文-自动翻译</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2024 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
