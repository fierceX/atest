<!DOCTYPE html>
<html class="theme-light" lang="zh-cn">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=""/>
  <meta name="keywords" content=""/>
  <meta name="copyright" content="1995-2023 The FreeBSD Foundation" />
  <link rel="canonical" href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/" />

  <title>第 25 章 更新与升级 FreeBSD |  FreeBSD Documentation Portal</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>

  
  
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.FreeBSD.org"/>
    <meta name="twitter:site" content="@freebsd"/>
    <meta name="twitter:url" content="https://twitter.com/freebsd"/>
    <meta property="og:title" content="第 25 章 更新与升级 FreeBSD" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://127.0.0.1:5500favicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="zh-cn" />
    <meta property="og:url" content="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/" />
    <meta property="og:site_name" content="FreeBSD Documentation Portal" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "http:\/\/127.0.0.1:5500\/zh-cn\/books\/handbook\/cutting-edge\/",
        "name": "FreeBSD Documentation Portal",
        "headline": "FreeBSD Documentation Portal",
        "description": "FreeBSD Documentation Portal"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="http://127.0.0.1:5500" class="logo">
        <img src="/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="Search" aria-label="Search" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/">
              前言
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-audience">预期的读者</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes-from3">相对于第三版的改动</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes-from2">相对于第二版的改动 (2004)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes">相对于第一版的改变 (2001)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-overview">本手册的组织</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-conv">本书中使用的一些约定</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-acknowledgements">致谢</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/parti/">
              部分 I. 起步
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/">
              第 1 章 介绍
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#introduction-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#nutshell">2. 欢迎来到 FreeBSD 的世界!</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#history">3. 关于 FreeBSD 项目</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6655173739803bf0920b92a7fe8a363d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6655173739803bf0920b92a7fe8a363d"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/">
              第 2 章 安装 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-hardware">2. 硬件需求</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-pre">3. 安装前的准备工作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-start">4. 开始安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#using-sysinstall">5. 介绍 Sysinstall</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-steps">6. 分配磁盘空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-choosing">7. 选择要安装的软件包</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-media">8. 选择您要使用的安装介质</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-final-warning">9. 安装确认</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-post">10. 安装后的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-trouble">11. 常见问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-advanced">12. 高级安装指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-diff-media">13. 准备您自己的安装介质</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/">
              第 3 章 安装 FreeBSD（适用于 9.x 及以后版本）
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-hardware">2. 硬件需求</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-pre">3. 安装前的准备工作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-start">4. 开始安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#using-bsdinstall">5. 介绍 bsdinstall</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-netinstall">6. 通过网络安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-partitioning">7. 分配磁盘空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-final-warning">8. 安装确认</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-post">9. 安装后的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-install-trouble">10. 故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/">
              第 4 章 UNIX 基础
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#consoles">2. 虚拟控制台和终端</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#permissions">3. 权限</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#dirstructure">4. 目录架构</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#disk-organization">5. 磁盘组织</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#mount-unmount">6. 文件系统的挂接和卸下</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-processes">7. 进程</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-daemons">8. 守护进程，信号和杀死进程</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#shells">9. Shells</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#editors">10. 文本编辑器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-devices">11. 设备和设备节点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#binary-formats">12. 二进制文件格式</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-more-information">13. 取得更多的资讯</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/">
              第 5 章 安装应用程序: Packages 和 Ports
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-overview">2. 软件安装预览</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-finding-applications">3. 寻找您要的应用程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#packages-using">4. 使用 Package 系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-using">5. 使用Ports Collection</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-nextsteps">6. 安装之后还要做点什么？</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-broken">7. 如何处理坏掉的 Ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/">
              第 6 章 X Window 系统
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x11-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-understanding">2. 理解 X</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-install">3. 安装 X11</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-config">4. 配置 X11</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-fonts">5. 在 X11 中使用字体</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-xdm">6. X 显示管理器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x11-wm">7. 桌面环境</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partii/">
              部分 II. 常见的任务
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/">
              第 7 章 桌面应用
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-browsers">2. 浏览器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-productivity">3. 办公、图象处理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-viewers">4. 文档查看器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-finance">5. 财务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-summary">6. 总结</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/">
              第 8 章 多媒体
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#multimedia-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#sound-setup">2. 安装声卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#sound-mp3">3. MP3音频</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#video-playback">4. 视频回放</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#tvcard">5. 安装电视卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#scanners">6. 图象扫描仪</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/">
              第 9 章 配置FreeBSD的内核
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-custom-kernel">2. 为什么需要建立定制的内核?</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-devices">3. 发现系统硬件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-modules">4. 内核驱动，子系统和模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-building">5. 建立并安装一个定制的内核</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-config">6. 配置文件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-trouble">7. 如果出现问题怎么办</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/">
              第 10 章 打印
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-intro-spooler">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-intro-setup">3. 基本设置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-advanced">4. 高级设置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-using">5. 使用打印机</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-lpd-alternatives">6. 替换标准后台打印</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-troubleshooting">7. 疑难问题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/">
              第 11 章 Linux® 二进制兼容模式
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-lbc-install">2. 配置 Linux® 二进制兼容模式</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-advanced">3. 高级主题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partiii/">
              部分 III. 系统管理
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/">
              第 12 章 设置和调整
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#config-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-initial">2. 初步配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-core-configuration">3. 核心配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-appconfig">4. 应用程序配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-starting-services">5. 启动服务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-cron">6. 配置 <code>cron</code></a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-rcd">7. 在 FreeBSD 中使用 rc</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#config-network-setup">8. 设置网卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-virtual-hosts">9. 虚拟主机</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-configfiles">10. 配置文件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-sysctl">11. 用 sysctl 进行调整</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-disk">12. 调整磁盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-kernel-limits">13. 调整内核限制</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#adding-swap-space">14. 添加交换空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#acpi-overview">15. 电源和资源管理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#ACPI-debug">16. 使用和调试 FreeBSD ACPI</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/">
              第 13 章 FreeBSD 引导过程
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-introduction">2. 引导问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-blocks">3. 引导管理器和各引导阶段</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-kernel">4. 内核在引导时的交互</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#device-hints">5. Device Hints</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-init">6. Init：进程控制及初始化</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-shutdown">7. 关机 (shutdown) 过程</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-17a53b356b407d9ed656b7babd2efa34" class="toggle"  />
          <label  class="icon cursor"  for="chapter-17a53b356b407d9ed656b7babd2efa34"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/">
              第 14 章 用户和基本的帐户管理
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-introduction">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-superuser">3. 超级用户帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-system">4. 系统帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-user">5. 用户帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-modifying">6. 修改帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-limiting">7. 限制用户使用系统资源</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-groups">8. 组</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/">
              第 15 章 安全
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-intro">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#securing-freebsd">3. 确保 FreeBSD 的安全</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#crypt">4. DES、 Blowfish、 MD5， 以及 Crypt</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#one-time-passwords">5. 一次性口令</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#tcpwrappers">6. TCP Wrappers</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#kerberos5">7. Kerberos5</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#openssl">8. OpenSSL</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#ipsec">9. IPsec 上的 VPN</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#openssh">10. OpenSSH</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#fs-acl">11. 文件系统访问控制表</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-portaudit">12. 监视第三方安全问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-advisories">13. FreeBSD 安全公告</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-accounting">14. 进程记帐</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/">
              第 16 章 Jails
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-terms">2. 与 Jail 相关的一些术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-intro">3. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-build">4. 建立和控制 jail</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-tuning">5. 微调和管理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-application">6. Jail 的应用</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/">
              第 17 章 强制访问控制
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-synopsis">1. 概要</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-inline-glossary">2. 本章出现的重要术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-initial">3. 关于 MAC 的说明</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-understandlabel">4. 理解 MAC 标签</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-planning">5. 规划安全配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-modules">6. 模块配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-seeotheruids">7. MAC seeotheruids 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-bsdextended">8. MAC bsdextended 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-ifoff">9. MAC ifoff 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-portacl">10. MAC portacl 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-partition">11. MAC partition (分区) 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-mls">12. MAC 多级 (Multi-Level) 安全模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-biba">13. MAC Biba 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-lomac">14. MAC LOMAC 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-implementing">15. MAC Jail 中的 Nagios</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-userlocked">16. User Lock Down</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-troubleshoot">17. MAC 框架的故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/">
              第 18 章 安全事件审计
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-inline-glossary">2. 本章中的一些关键术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-install">3. 安装审计支持</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-config">4. 对审计进行配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-administration">5. 管理审计子系统</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/">
              第 19 章 存储
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-naming">2. 设备命名</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-adding">3. 添加磁盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#raid">4. RAID</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#usb-disks">5. USB 存储设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#creating-cds">6. 创建和使用光学介质(CD)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#creating-dvds">7. 创建和使用光学介质(DVD)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#floppies">8. 创建和使用软盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backups-tapebackups">9. 用磁带机备份</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backups-floppybackups">10. 用软盘备份</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backup-strategies">11. 备份策略</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backup-basics">12. 备份程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-virtual">13. 网络、内存和 和以及映像文件为介质的虚拟文件系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#snapshots">14. 文件系统快照</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#quotas">15. 文件系统配额</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-encrypting">16. 加密磁盘分区</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#swap-encrypting">17. 对交换区进行加密</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-hast">18. 高可用性存储 (HAST)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/">
              第 20 章 GEOM: 模块化磁盘变换框架
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-intro">2. GEOM 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-striping">3. RAID0 - 条带</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-mirror">4. RAID1 - 镜像</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-raid3">5. RAID3 - 使用专用校验设备的字节级条带</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-ggate">6. GEOM Gate 网络设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-glabel">7. 为磁盘设备添加卷标</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-gjournal">8. 通过 GEOM 实现 UFS 日志</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/">
              第 21 章 文件系统 Support
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/#filesystems-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/#filesystems-zfs">2. Z 文件系统 (ZFS)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-11d260f2685c0b17137e64887e1b1989" class="toggle"  />
          <label  class="icon cursor"  for="chapter-11d260f2685c0b17137e64887e1b1989"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/">
              第 22 章 Vinum 卷管理程序
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-intro">2. 磁盘容量太小</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-access-bottlenecks">3. 访问瓶颈</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-data-integrity">4. 数据的完整性</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-objects">5. Vinum 目标</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-examples">6. 一些例子</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-object-naming">7. 对象命名</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-config">8. 配置 Vinum</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-root">9. 使用 Vinum 作为根文件系统</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/">
              第 23 章 虚拟化
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-guest">2. 作为客户 OS 的 FreeBSD</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-host">3. 作为宿主 OS 的 FreeBSD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/">
              第 24 章 本地化－I18N/L10N使用和设置
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-basics">2. 基础知识</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#using-localization">3. 使用本地化语言</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-compiling">4. 编译I18N程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#lang-setup">5. 本地化FreeBSD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/">
              第 25 章 更新与升级 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">2. FreeBSD 更新</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-portsnap">3. Portsnap： 一个 Ports Collection 更新工具</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-documentation">4. 更新系统附带的文档</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#current-stable">5. 追踪开发分支</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#synching">6. 同步您的源码</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#makeworld">7. 重新编译 "world"</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#make-delete-old">8. 删除过时的文件、 目录和函数库</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#small-lan">9. 跟踪多台机器</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/">
              第 26 章 DTrace
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-implementation">2. 实现上的差异</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-enable">3. 启用 DTrace 支持</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-using">4. 使用 DTrace</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-language">5. D 语言</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partiv/">
              部分 IV. 网络通讯
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/">
              第 27 章 串口通讯
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serial-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serial">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#term">3. 终端</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#dialup">4. 拨入服务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#dialout">5. 拨出设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serialconsole-setup">6. 设置串口控制台</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/">
              第 28 章 PPP 和 SLIP
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#userppp">2. 使用用户级 PPP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp">3. 使用内核级PPP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp-troubleshoot">4. PPP 连接故障排除</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#pppoe">5. 使用基于以太网的PPP(PPPoE)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#pppoa">6. 使用 ATM 上的 PPP (PPPoA)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#slip">7. 使用SLIP</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/">
              第 29 章 电子邮件
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-using">2. 使用电子邮件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#sendmail">3. sendmail 配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-changingmta">4. 改变您的邮件传输代理程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-trouble">5. 疑难解答</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-advanced">6. 高级主题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-UUCP">7. SMTP 与 UUCP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#outgoing-only">8. 只发送邮件的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-dialup">9. 拨号连接时使用邮件传送</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-Auth">10. SMTP 验证</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-agents">11. 邮件用户代理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-fetchmail">12. 使用 fetchmail</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-procmail">13. 使用 procmail</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/">
              第 30 章 网络服务器
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-servers-synopsis">1. 概要</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-inetd">2. inetd"超级服务器"</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-nfs">3. 网络文件系统（NFS）</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-nis">4. 网络信息服务 (NIS/YP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-dhcp">5. 网络自动配置 (DHCP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-dns">6. 域名系统 (DNS)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-apache">7. Apache HTTP 服务器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-ftp">8. 文件传输协议 (FTP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-samba">9. 为 Microsoft® Windows® 客户机提供文件和打印服务 (Samba)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-ntp">10. 通过 NTP 进行时钟同步</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-syslogd">11. 使用 <code>syslogd</code> 记录远程主机的日志</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/">
              第 31 章 防火墙
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-intro">1. 入门</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-concepts">2. 防火墙的概念</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-apps">3. 防火墙软件包</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-pf">4. OpenBSD Packet Filter (PF) 和 ALTQ</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-ipf">5. IPFILTER (IPF) 防火墙</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-ipfw">6. IPFW</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/">
              第 32 章 高级网络
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#advanced-networking-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-routing">2. 网关和路由</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-wireless">3. 无线网络</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-bluetooth">4. 蓝牙</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-bridging">5. 桥接</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-aggregation">6. 链路聚合与故障转移</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-diskless">7. 无盘操作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-pxe-nfs">8. 从 PXE 启动一个 NFS 根文件系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-isdn">9. ISDN</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-natd">10. 网络地址转换</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-plip">11. 并口电缆 IP (PLIP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-ipv6">12. IPv6</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-atm">13. 异步传输模式 (ATM)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#carp">14. Common Address Redundancy Protocol (CARP， 共用地址冗余协议)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partv/">
              部分 V. 附录
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/">
              附录 A. 获取 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-cdrom">1. CDROM 和 DVD 发行商</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-ftp">2. FTP 站点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#anoncvs">3. 匿名 CVS</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#ctm">4. 使用 CTM</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#cvsup">5. 使用 CVSup</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#cvs-tags">6. CVS 标签</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-afs">7. AFS 站点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-rsync">8. rsync 站点</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/">
              附录 B. 参考文献
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-freebsd">1. 关于 FreeBSD 的专业书籍与杂志</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-userguides">2. 用户指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-adminguides">3. 管理员指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-programmers">4. 开发指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-osinternals">5. 操作系统原理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-security">6. 安全方面的参考文献</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-hardware">7. 硬件参考</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-history">8. UNIX® 历史</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-journals">9. 各种期刊</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/">
              附录 C. Internet上的资源
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-mail">1. 邮件列表</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-news">2. Usenet新闻组</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-web">3. World Wide Web服务器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-email">4. Email地址</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/pgpkeys/">
              附录 D. PGP公钥
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/pgpkeys/#pgpkeys-officers">1. Officers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">第 25 章 更新与升级 FreeBSD</h1>
    
    
      <div class="admonitionblock note">
        <p>
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          This translation may be out of date. To help with the translations please access the <a href="https://translate-dev.freebsd.org/" target="_blank">FreeBSD translations instance</a>.
        </p>
      </div>
    
    
    
    <div class="toc-mobile">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#updating-upgrading-synopsis">1. 概述</a></li>
    <li><a href="#updating-upgrading-freebsdupdate">2. FreeBSD 更新</a></li>
    <li><a href="#updating-upgrading-portsnap">3. Portsnap： 一个 Ports Collection 更新工具</a></li>
    <li><a href="#updating-upgrading-documentation">4. 更新系统附带的文档</a></li>
    <li><a href="#current-stable">5. 追踪开发分支</a></li>
    <li><a href="#synching">6. 同步您的源码</a></li>
    <li><a href="#makeworld">7. 重新编译 &#34;world&#34;</a></li>
    <li><a href="#make-delete-old">8. 删除过时的文件、 目录和函数库</a></li>
    <li><a href="#small-lan">9. 跟踪多台机器</a></li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="updating-upgrading-synopsis">1. 概述<a class="anchor" href="#updating-upgrading-synopsis"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD 在发行版之间始终是持续开发的。 一些人喜欢使用官方发行的版本， 另一些喜欢与最新的开发保持同步。 然而， 即使是官方的发行版本也常常需要安全补丁和重大修正方面的更新。 不论你使用了何种版本， FreeBSD 都提供了所有更新系统所需的工具， 让你轻松的在不同版本间升级。 这一章节将帮助你决定是跟踪开发系统还是坚持使用某个发行的版本。 同时还列出了一些保持系统更新所需的基本工具。</p>
</div>
<div class="paragraph">
<p>读了本章后，您将了解到：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用哪些工具来更新系统与 Ports Collection。</p>
</li>
<li>
<p>如何使用 freebsd-update, CVSup, CVS, or CTM 让你的系统保持更新。</p>
</li>
<li>
<p>如何比较已安装的系统与原来已知拷贝的状态。</p>
</li>
<li>
<p>如何使用 CVSup 或者文档 ports 来更新本地的文档。</p>
</li>
<li>
<p>两个开发分支 FreeBSD-STABLE 和 FreeBSD-CURRENT 的区别。</p>
</li>
<li>
<p>如何通过 <code>make buildworld</code> 重新编译安装整个基本系统(等等)。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在读本章这前，您应该了解的：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>正确设置网络连接 (crossref:advanced-networking[advanced-networking,高级网络])。</p>
</li>
<li>
<p>知道怎样安装附加的第三方软件(crossref:ports[ports,安装应用程序. Packages 和 Ports])。</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>整个这一章中，<code>cvsup</code> 命令都被用来获取 FreeBSD 源代码的更新。 你需要安装 package:net/cvsup[] port 或者二进制包(如果你不想要安装图形界面的 <code>cvsup</code> 客户端的话， 则可以安装 package:net/cvsup-without-gui[] port)。 你也可以使用 man:csup[1] 代替， 它现在已经是基本系统的一部分了。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-upgrading-freebsdupdate">2. FreeBSD 更新<a class="anchor" href="#updating-upgrading-freebsdupdate"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>打安全补丁是对于维护计算机软件的一个重要部分， 特别是对于操作系统。对于 FreeBSD 来说， 很长的一段时间以来这都不是一件容易的事情。 补丁打在源代码上，代码需要被重新编译为二进制， 然后再重新安装编译后的程序。</p>
</div>
<div class="paragraph">
<p>FreeBSD 引入了 <code>freebsd-update</code> 工具之后这便不再是问题了。这个工具提供了 2 种功能。 第一，它可以把二进制的安全和勘误更新直接应用于 FreeBSD 的基本系统，而不需要重新编译和安装。第二， 这个工具还支持主要跟次要的发行版的升级。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>由安全小组支持的各种体系结构和发行版都可使用二进制更新。 在升级到一个新的发行版本之前， 应先阅读一下当前发行版的声明， 因为它们可能包含有关于你期望升级版本的重要消息。 这些发行声明可以通过以下链接查阅： <a href="http://www.FreeBSD.org/releases/">http://www.FreeBSD.org/releases/</a>。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果 <code>crontab</code> 中存在有用到 <code>freebsd-update</code> 特性的部分， 那么这些在开始以下操作前必须先被禁止。</p>
</div>
<div class="sect2">
<h3 id="freebsdupdate-config-file">2.1. 配置文件<a class="anchor" href="#freebsdupdate-config-file"></a></h3>
<div class="paragraph">
<p>有些用户可能希望通过调整配置文件 <span class="filename">/etc/freebsd-update.conf</span> 中的默认配置来更好地控制升级的过程。 可用的参数在文档中介绍的很详细， 但下面的这些可能需要进一步的解释：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Components of the base system which should be kept updated.
Components src world kernel</pre>
</div>
</div>
<div class="paragraph">
<p>这个参数是控制 FreeBSD 的哪一部分将被保持更新。 默认的是更新源代码，整个基本系统还有内核。 这些部件跟安装时的那些相同，举例来说， 在这里加入 <code>world/games</code> 就会允许打入游戏相关的补丁。 使用 <code>src/bin</code> 则是允许更新 <span class="filename">src/bin</span> 目录中的源代码。</p>
</div>
<div class="paragraph">
<p>最好的选择是把这个选项保留为默认值， 因为如果要修改它去包含一些指定的选项， 就需要用户列出每一个想要更新的项目。 这可能会引起可怕的后果， 因为部分的源代码和二进制程序得不到同步。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Paths which start with anything matching an entry in an IgnorePaths
# statement will be ignored.
IgnorePaths</pre>
</div>
</div>
<div class="paragraph">
<p>添加路径，比如 <span class="filename">/bin</span> 或者 <span class="filename">/sbin</span> 让这些指定的目录在更新过程中不被修改。 这个选项能够防止本地的修改被 <code>freebsd-update</code> 覆盖。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Paths which start with anything matching an entry in an UpdateIfUnmodified
# statement will only be updated if the contents of the file have not been
# modified by the user (unless changes are merged; see below).
UpdateIfUnmodified /etc/ /var/ /root/ /.cshrc /.profile</pre>
</div>
</div>
<div class="paragraph">
<p>更新指定目录中的未被修改的配置文件。 用户的任何修改都会使这些文件的自动更新失效。 还有另外一个选项， <code>KeepModifiedMetadata</code>， 这个能让 <code>freebsd-update</code> 在合并时保存修改。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># When upgrading to a new FreeBSD release, files which match MergeChanges
# will have any local changes merged into the version from the new release.
MergeChanges /etc/ /var/named/etc/</pre>
</div>
</div>
<div class="paragraph">
<p>一个 <code>freebsd-update</code> 应该尝试合并的配置文件的列表。文件合并的过程是 一系列的 man:diff[1] 补丁类似于更少选项的 man:mergemaster[8] 合并的选项是接受，打开一个文本编辑器，或者 <code>freebsd-update</code> 会被中止。 在不能确定的时候，请先备份 <span class="filename">/etc</span> 然后接受合并。更多关于 <code>mergemaster</code> 的信息请参阅 <a href="#mergemaster"><code>mergemaster</code></a>。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Directory in which to store downloaded updates and temporary
# files used by FreeBSD Update.
# WorkDir /var/db/freebsd-update</pre>
</div>
</div>
<div class="paragraph">
<p>这个目录是放置所有补丁和临时文件的。 用户做一个版本升级的话，请确认此处至少有 1 GB 的可用磁盘空间。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># When upgrading between releases, should the list of Components be
# read strictly (StrictComponents yes) or merely as a list of components
# which *might* be installed of which FreeBSD Update should figure out
# which actually are installed and upgrade those (StrictComponents no)?
# StrictComponents no</pre>
</div>
</div>
<div class="paragraph">
<p>当设置成 <code>yes</code> 时， <code>freebsd-update</code> 将假设这个 <code>Components</code> 列表时完整的， 并且对此列表以外的项目不会修改。实际上就是 <code>freebsd-update</code> 会尝试更新 <code>Componets</code> 列表里的每一个文件。</p>
</div>
</div>
<div class="sect2">
<h3 id="freebsdupdate-security-patches">2.2. 安全补丁<a class="anchor" href="#freebsdupdate-security-patches"></a></h3>
<div class="paragraph">
<p>安全补丁存储在远程的机器上， 可以使用如下的命令下载并安装：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update fetch</span>
<span class="c"># freebsd-update install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果给内核打了补丁，那么系统需要重新启动。 如果一切都进展顺利，系统就应该被打好了补丁而且 <code>freebsd-update</code> 可由夜间 man:cron[8] 执行。在 <span class="filename">/etc/crontab</span> 中加入以下条目足以完成这项任务：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>@daily                                  root    freebsd-update cron</pre>
</div>
</div>
<div class="paragraph">
<p>这条记录是说明每天运行一次 <code>freebsd-update</code> 工具。 用这种方法， 使用了 <code>cron</code> 参数， <code>freebsd-update</code> 仅检查是否存在更新。 如果有了新的补丁，就会自动下载到本地的磁盘， 但不会自动给系统打上。<code>root</code> 会收到一封电子邮件告知需手动安装补丁。</p>
</div>
<div class="paragraph">
<p>如果出现了错误，可以使用下面的 <code>freebsd-update</code> 命令回退到上一次的修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update rollback</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>完成以后如果内核或任何的内核模块被修改的话， 就需要重新启动系统。这将使 FreeBSD 装载新的二进制程序进内存。</p>
</div>
<div class="paragraph">
<p><code>freebsd-update</code> 工具只能自动更新 <span class="filename">GENERIC</span> 内核。 如果您使用自行联编的内核， 则在 <code>freebsd-update</code> 安装完更新的其余部分之后需要手工重新联编和安装内核。 不过， <code>freebsd-update</code> 会检测并更新位于 <span class="filename">/boot/GENERIC</span> (如果存在) 中的 <span class="filename">GENERIC</span> 内核， 即使它不是当前 (正在运行的) 系统的内核。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>保存一份 <span class="filename">GENERIC</span> 内核的副本到 <span class="filename">/boot/GENERIC</span> 是一个明智的主意。 在诊断许多问题， 以及在 <a href="#freebsdupdate-upgrade">重大和次要的更新</a> 中介绍的使用 <code>freebsd-update</code> 更新系统时会很有用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>除非修改位于 <span class="filename">/etc/freebsd-update.conf</span> 中的配置， <code>freebsd-update</code> 会随其他安装一起对内核的源代码进行更新。 重新联编并安装定制的内核可以以通常的方式来进行。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>通过 <code>freebsd-update</code> 发布的更新有时并不会涉及内核。 如果在执行 <code>freebsd-update install</code> 的过程中内核代码没有进行变动， 就没有必要重新联编内核了。 不过， 由于 <code>freebsd-update</code> 每次都会更新 <span class="filename">/usr/src/sys/conf/newvers.sh</span> 文件， 而修订版本 (<code>uname -r</code> 报告的 <code>-p</code> 数字) 来自这个文件， 因此， 即使内核没有发生变化， 重新联编内核也可以让 man:uname[1] 报告准确的修订版本。 在维护许多系统时这样做会比较有帮助， 因为这一信息可以迅速反映机器上安装的软件更新情况。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="freebsdupdate-upgrade">2.3. 重大和次要的更新<a class="anchor" href="#freebsdupdate-upgrade"></a></h3>
<div class="paragraph">
<p>这个过程会删除旧的目标文件和库， 这将使大部分的第三方应用程序无法删除。 建议将所有安装的 ports 先删除然后重新安装，或者稍后使用 package:ports-mgmt/portupgrade[] 工具升级。 大多数用户将会使用如下命令尝试编译：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portupgrade -af</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将确保所有的东西都会被正确的重新安装。 请注意环境变量 <code>BATCH</code> 设置成 <code>yes</code> 的话将在整个过程中对所有询问回答 <code>yes</code>，这会帮助在编译过程中免去人工的介入。</p>
</div>
<div class="paragraph">
<p>如果正在使用的是定制的内核， 则升级操作会复杂一些。 您会需要将一份 <span class="filename">GENERIC</span> 内核的副本放到 <span class="filename">/boot/GENERIC</span>。 如果系统中没有 <span class="filename">GENERIC</span> 内核， 可以用以下两种方法之一来安装：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果只联编过一次内核， 则位于 <span class="filename">/boot/kernel.old</span> 中的内核， 就是 <span class="filename">GENERIC</span> 的那一个。 只需将这个目录改名为 <span class="filename">/boot/GENERIC</span> 即可。</p>
</li>
<li>
<p>假如能够直接接触机器， 则可以通过 CD-ROM 介质来安装 <span class="filename">GENERIC</span> 内核。 将安装盘插入光驱， 并执行下列命令：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount /cdrom</span>
<span class="c"># cd /cdrom/X.Y-RELEASE/kernels</span>
<span class="c"># ./install.sh GENERIC</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您需要将 <span class="filename">X.Y-RELEASE</span> 替换为您正在使用的版本。 <span class="filename">GENERIC</span> 内核默认情况下会安装到 <span class="filename">/boot/GENERIC</span>。</p>
</div>
</li>
<li>
<p>如果前面的方法都不可用， 还可以使用源代码来重新联编和安装 <span class="filename">GENERIC</span> 内核：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span>
<span class="c"># env DESTDIR=/boot/GENERIC make kernel</span>
<span class="c"># mv /boot/GENERIC/boot/kernel/* /boot/GENERIC</span>
<span class="c"># rm -rf /boot/GENERIC/boot</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果希望 <code>freebsd-update</code> 能够正确地将内核识别为 <span class="filename">GENERIC</span>， 您必须确保没有对 <span class="filename">GENERIC</span> 配置文件进行过任何变动。 此外， 建议您取消任何其他特殊的编译选项 (例如使用空的 <span class="filename">/etc/make.conf</span>)。</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>上述步骤并不需要使用这个 <span class="filename">GENERIC</span> 内核来引导系统。</p>
</div>
<div class="paragraph">
<p>重大和次要的更新可以由 <code>freebsd-update</code> 命令后指定一个发行版本来执行， 举例来说，下面的命令将帮助你升级到 FreeBSD 8.1：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update -r 8.1-RELEASE upgrade</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在执行这个命令之后，<code>freebsd-update</code> 将会先解析配置文件和评估当前的系统以获得更新系统所需的必要信息。 然后便会显示出一个包含了已检测到与未检测到的组件列表。 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">Looking up update.FreeBSD.org mirrors... 1 mirrors found.
Fetching metadata signature <span class="k">for </span>8.0-RELEASE from update1.FreeBSD.org... <span class="k">done</span><span class="nb">.</span>
Fetching metadata index... <span class="k">done</span><span class="nb">.</span>
Inspecting system... <span class="k">done</span><span class="nb">.</span>

The following components of FreeBSD seem to be installed:
kernel/smp src/base src/bin src/contrib src/crypto src/etc src/games
src/gnu src/include src/krb5 src/lib src/libexec src/release src/rescue
src/sbin src/secure src/share src/sys src/tools src/ubin src/usbin
world/base world/info world/lib32 world/manpages

The following components of FreeBSD <span class="k">do </span>not seem to be installed:
kernel/generic world/catpages world/dict world/doc world/games
world/proflibs

Does this look reasonable <span class="o">(</span>y/n<span class="o">)</span>? y</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时，<code>freebsd-update</code> 将会尝试下载所有升级所需的文件。在某些情况下， 用户可能被问及需安装些什么和如何进行之类的问题。</p>
</div>
<div class="paragraph">
<p>当使用定制内核时， 前面的步骤会产生类似下面的警告：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">WARNING: This system is running a <span class="s2">&#34;MYKERNEL&#34;</span> kernel, which is not a
kernel configuration distributed as part of FreeBSD 8.0-RELEASE.
This kernel will not be updated: you MUST update the kernel manually
before running <span class="s2">&#34;/usr/sbin/freebsd-update install&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此时您可以暂时安全地无视这个警告。 更新的 <span class="filename">GENERIC</span> 内核将在升级过程的中间步骤中使用。</p>
</div>
<div class="paragraph">
<p>在下载完针对本地系统的补丁之后， 这些补丁会被应用到系统上。 这个过程需要消耗的时间取决于机器的速度和其负载。 这个过程中将会对配置文件所做的变动进行合并 - 这一部分需要用户的参与， 文件可能会自动合并， 屏幕上也可能会给出一个编辑器， 用于手工完成合并操作。 在处理过程中， 合并成功的结果会显示给用户。 失败或被忽略的合并， 则会导致这一过程的终止。 用户可能会希望备份一份 <span class="filename">/etc</span> 并在这之后手工合并重要的文件， 例如 <span class="filename">master.passwd</span> 和 <span class="filename">group</span>。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>系统至此还没有被修改，所有的补丁和合并都在另外一个目录中进行。 当所有的补丁都被成功的打上了以后，所有的配置文件都被合并后， 我们就已经完成了整个升级过程中最困难的部分， 下面就需要用户来安装这些变更了。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>一旦这个步骤完成后，使用如下的命令将升级后的文件安装到磁盘上。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>内核和内核模块会首先被打上补丁。 此时必须重新启动计算机。 如果您使用的是定制的内核， 请使用 man:nextboot[8] 命令来将下一次用于引导系统的内核 <span class="filename">/boot/GENERIC</span> (它会被更新)：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># nextboot -k GENERIC</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在使用 <span class="filename">GENERIC</span> 内核启动之前， 请确信它包含了用于引导系统所需的全部驱动程序 (如果您是在远程进行升级操作， 还应确信网卡驱动也是存在的)。 特别要注意的情形是， 如果之前的内核中静态联编了通常以内核模块形式存在的驱动程序， 一定要通过 <span class="filename">/boot/loader.conf</span> 机制来将这些模块加载到 <span class="filename">GENERIC</span> 内核的基础上。 此外， 您可能也希望临时取消不重要的服务、 磁盘和网络挂载等等， 直到升级过程完成为止。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>现在可以用更新后的内核引导系统了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># shutdown -r now</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在系统重新上线后，需要再次运行 <code>freebsd-update</code>。 升级的状态被保存着，这样 <code>freebsd-update</code> 就无需重头开始，但是会删除所有旧的共享库和目标文件。 执行如下命令继续这个阶段的升级：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update install</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>取决与是否有库的版本更新，通常只有 2 个而不是 3 个安装阶段。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>现在需要重新编译和安装第三方软件。 这么做的原因是某些已安装的软件可能依赖于在升级过程中已删除的库。 可使用 package:ports-mgmt/portupgrade[] 自动化这个步骤，以如下的命令开始：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portupgrade -f ruby</span>
<span class="c"># rm /var/db/pkg/pkgdb.db</span>
<span class="c"># portupgrade -f ruby18-bdb</span>
<span class="c"># rm /var/db/pkg/pkgdb.db /usr/ports/INDEX-*.db</span>
<span class="c"># portupgrade -af</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦这个完成了以后，再最后一次运行 <code>freebsd-update</code> 来结束升级过程。 执行如下命令处理升级中的所有细节：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您临时用过 <span class="filename">GENERIC</span> 内核来引导系统， 现在是按照通常的方法重新联编并安装新的定制内核的时候了。</p>
</div>
<div class="paragraph">
<p>重新启动机器进入新版本的 FreeBSD 升级过程至此就完成了。</p>
</div>
</div>
<div class="sect2">
<h3 id="freebsdupdate-system-comparison">2.4. 系统状态对照<a class="anchor" href="#freebsdupdate-system-comparison"></a></h3>
<div class="paragraph">
<p><code>freebsd-update</code> 工具也可被用来对着一个已知完好的 FreeBSD 拷贝测试当前的版本。 这个选项评估当前的系统工具，库和配置文件。 使用以下的命令开始对照：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># freebsd-update IDS &gt;&gt; outfile.ids</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这个命令的名称是 IDS， 它并不是一个像 package:security/snort[] 这样的入侵检测系统的替代品。因为 <code>freebsd-update</code> 在磁盘上存储数据， 很显然它们有被篡改的可能。 当然也可以使用一些方法来降低被篡改的可能性，比如设置 <code>kern.securelevel</code> 和不使用时把 <code>freebsd-update</code> 数据放在只读文件系统上，例如 DVD 或 安全存放的外置 USB 磁盘上。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>现在系统将会被检查，生成一份包含了文件和它们的 man:sha256[1] 哈希值的清单，已知发行版中的值与当前系统中安装的值将会被打印到屏幕上。 这就是为什么输出被送到了 <span class="filename">outfile.ids</span> 文件。 它滚动的太块无法用肉眼对照，而且会很快填满控制台的缓冲区。</p>
</div>
<div class="paragraph">
<p>这个文件中有非常长的行，但输出的格式很容易分析。 举例来说，要获得一份与发行版中不同哈希值的文件列表， 已可使用如下的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cat outfile.ids | awk &#39;{ print $1 }&#39; | more</span>
/etc/master.passwd
/etc/motd
/etc/passwd
/etc/pf.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>这份输出时删节缩短后的，其实是有更多的文件。 其中有些文件并非人为修改，比如 <span class="filename">/etc/passwd</span> 被修改是因为添加了用户进系统。在某些情况下， 还有另外的一些文件，诸如内核模块与 <code>freebsd-update</code> 的不同是因为它们被更新过了。 为了指定的文件或目录排除在外，把它们加到 <span class="filename">/etc/freebsd-update.conf</span> 的 <code>IDSIgnorePaths</code> 选项中。</p>
</div>
<div class="paragraph">
<p>除了前面讨论过的部分之外， 这也能被当作是对升级方法的详细补充。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-upgrading-portsnap">3. Portsnap： 一个 Ports Collection 更新工具<a class="anchor" href="#updating-upgrading-portsnap"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD 基本系统也包括了一个更新 Ports Collection 的工具： man:portsnap[8]。在运行之后，它会连上一个远程网站， 校验安全密钥，然后下载一份 Ports Collection 的拷贝。 密钥是用来校验所有下载文件的完整性，确保它们在传输是未被修改。 使用以下的命令下载最新的 Ports Collection：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portsnap fetch</span>
Looking up portsnap.FreeBSD.org mirrors... 3 mirrors found.
Fetching snapshot tag from portsnap1.FreeBSD.org... <span class="k">done</span><span class="nb">.</span>
Fetching snapshot metadata... <span class="k">done</span><span class="nb">.</span>
Updating from Wed Aug  6 18:00:22 EDT 2008 to Sat Aug 30 20:24:11 EDT 2008.
Fetching 3 metadata patches.. <span class="k">done</span><span class="nb">.</span>
Applying metadata patches... <span class="k">done</span><span class="nb">.</span>
Fetching 3 metadata files... <span class="k">done</span><span class="nb">.</span>
Fetching 90 patches.....10....20....30....40....50....60....70....80....90. <span class="k">done</span><span class="nb">.</span>
Applying patches... <span class="k">done</span><span class="nb">.</span>
Fetching 133 new ports or files... <span class="k">done</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子展示的是 man:portsnap[8] 发现并校验了几个用于当前 ports 的补丁。这还表明以前运行过， 如果是第一次运行的话，那么仅仅只会下载 Ports Collection。</p>
</div>
<div class="paragraph">
<p>在 man:portsnap[8] 成功地完成一次 <code>fetch</code> 操作之后， 会将校验过的 Ports 套件和后续的补丁保存在本地。 首次执行 <code>portsnap</code> 之后， 你必须使用 <code>extract</code> 安装下载的文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portsnap extract</span>
/usr/ports/.cvsignore
/usr/ports/CHANGES
/usr/ports/COPYRIGHT
/usr/ports/GIDs
/usr/ports/KNOBS
/usr/ports/LEGAL
/usr/ports/MOVED
/usr/ports/Makefile
/usr/ports/Mk/bsd.apache.mk
/usr/ports/Mk/bsd.autotools.mk
/usr/ports/Mk/bsd.cmake.mk
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>portsnap update</code> 命令更新已安装的 Ports：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portsnap update</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>至此更新就完成了，然后便可以使用更新后的 Ports Collection 来安装或升级应用程序。</p>
</div>
<div class="paragraph">
<p><code>fetch</code> 和 <code>extract</code> 或 <code>update</code> 可以作为连续的动作执行， 如下例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portsnap fetch update</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个命令将会下载最新版本的 Ports 并更新本地位于 <span class="filename">/usr/ports</span> 的拷贝。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updating-upgrading-documentation">4. 更新系统附带的文档<a class="anchor" href="#updating-upgrading-documentation"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>除了基本系统和 Ports 套件之外， 文档也是 FreeBSD 操作系统的一个组成部分。 尽管您总是可以通过 <a href="http://www.freebsd.org/doc/">FreeBSD 网站</a> 来访问最新的 FreeBSD 文档， 一些用户的网络连接可能很慢， 甚至完全没有网络连接。 幸运的是， 有很多方法可以用来更新随发行版本附带的 FreeBSD 文档的本地副本。</p>
</div>
<div class="sect2">
<h3 id="csup-doc">4.1. 使用 CVSup 来更新文档<a class="anchor" href="#csup-doc"></a></h3>
<div class="paragraph">
<p>FreeBSD 文档的源代码和安装版本都可以通过 CVSup 来以与基本系统 (参考 <a href="#makeworld">重新编译 &#34;world&#34;</a>) 类似的方法来升级。 这一节中将会介绍：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如何安装联编文档所需的工具集， 用于从源代码来联编 FreeBSD 文档所需的那些工具。</p>
</li>
<li>
<p>如何使用 CVSup 将文档下载到 <span class="filename">/usr/doc</span>。</p>
</li>
<li>
<p>如何从源代码联编 FreeBSD 文档， 并将其安装到 <span class="filename">/usr/shared/doc</span>。</p>
</li>
<li>
<p>联编文档的过程中支持的一些编译选项， 例如只联编某些语言的版本， 或只联编特定的输出格式。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installing-documentation-toolchain">4.2. 安装 CVSup 和文档工具集<a class="anchor" href="#installing-documentation-toolchain"></a></h3>
<div class="paragraph">
<p>从源代码联编 FreeBSD 文档需要大量的工具。 这些工具并不是 FreeBSD 基本系统的一部分， 因为这些工具需要占用大量的磁盘空间， 而且并不是对所有 FreeBSD 用户都有用； 只有活跃地撰写 FreeBSD 新文档， 或经常从源代码更新文档的用户才需要这些工具。</p>
</div>
<div class="paragraph">
<p>全部所需的工具， 均可通过 Ports 套件来安装。 package:textproc/docproj[] port 是由 FreeBSD 文档计划开发的方便安装和更新这些工具的主 port。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果不需要 PostScript® 或 PDF 文档的话， 也可以考虑安装 package:textproc/docproj-nojadetex[] port。 这套文档工具集包含除了 teTeX typesetting 引擎之外的其他全部工具。 teTeX 是一个很大的工具集， 因此如果不需要 PDF 输出的话， 排除它会节省很多时间和磁盘空间。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如欲了解关于安装和使用 CVSup 的进一步信息， 请参阅 crossref:mirrors[cvsup,使用 CVSup]。</p>
</div>
</div>
<div class="sect2">
<h3 id="updating-documentation-sources">4.3. 更新文档源代码<a class="anchor" href="#updating-documentation-sources"></a></h3>
<div class="paragraph">
<p>CVSup 工具能够下载文档源代码的原始副本， 您可使用 <span class="filename">/usr/shared/examples/cvsup/doc-supfile</span> 文件作为配置模板来修改。 在 <span class="filename">doc-supfile</span> 中的默认主机名是一个无效的占位主机名， 但 man:cvsup[1] 能够通过命令行来指定主机名， 因此文档源代码可以使用下面的命令从 CVSup 服务器获得：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cvsup -h cvsup.FreeBSD.org -g -L 2 /usr/shared/examples/cvsup/doc-supfile</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您应将 <em>cvsup.FreeBSD.org</em> 改为最近的 CVSup 服务器。 参见 crossref:mirrors[cvsup-mirrors,CVSup 站点] 关于镜像站点的完整列表。</p>
</div>
<div class="paragraph">
<p>初始的文档源代码下载需要一些时间， 您需要耐心等待它完成。</p>
</div>
<div class="paragraph">
<p>后续的更新可以用同样的命令来进行。 由于 CVSup 工具只下载上次运行之后所发生过的更新， 因此在首次运行之后再运行 CVSup 应该是很快的。</p>
</div>
<div class="paragraph">
<p>在签出源代码之后， 还可以使用另一种由 <span class="filename">/usr/doc</span> 目录中的 <span class="filename">Makefile</span> 支持的方法来更新它。 通过在 <span class="filename">/etc/make.conf</span> 中配置 <code>SUP_UPDATE</code>、 <code>SUPHOST</code> 和 <code>DOCSUPFILE</code>， 可以通过运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/doc</span>
<span class="c"># make update</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>来完成更新。 典型的 <span class="filename">/etc/make.conf</span> 中的 man:make[1] 选项是：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>SUP_UPDATE= yes
SUPHOST?= cvsup.freebsd.org
DOCSUPFILE?= /usr/shared/examples/cvsup/doc-supfile</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>将 <code>SUPHOST</code> 和 <code>DOCSUPFILE</code> 的值使用 <code>?=</code> 来指定的好处是使 make 命令行能够覆盖这些选项。 在向 <span class="filename">make.conf</span> 中增加选项时推荐这样做， 以避免在测试时反复修改这个文件。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="updating-documentation-options">4.4. 文档源代码中可调的选项<a class="anchor" href="#updating-documentation-options"></a></h3>
<div class="paragraph">
<p>FreeBSD 文档的更新和联编系统支持一些方便只更新一部分文档， 或只联编特定格式及译文的选项。 这些选项可以在 <span class="filename">/etc/make.conf</span> 文件中配置， 也可以通过 man:make[1] 工具来指定。</p>
</div>
<div class="paragraph">
<p>这些选项包括：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>DOC_LANG</code></dt>
<dd>
<p>准备联编和安装的语言列表。 例如， 指定为 <code>en_US.ISO8859-1</code> 表示只联编英文版的文档。</p>
</dd>
<dt class="hdlist1"><code>FORMATS</code></dt>
<dd>
<p>准备输出的格式列表。 目前， 系统支持 <code>html</code>、 <code>html-split</code>、 <code>txt</code>、 <code>ps</code>、 <code>pdf</code>、 和 <code>rtf</code>。</p>
</dd>
<dt class="hdlist1"><code>SUPHOST</code></dt>
<dd>
<p>用于用来更新的 CVSup 服务器的主机名。</p>
</dd>
<dt class="hdlist1"><code>DOCDIR</code></dt>
<dd>
<p>用于安装文档的目录。 默认为 <span class="filename">/usr/shared/doc</span>。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>如欲了解 FreeBSD 中其他可供配置的全局 make 变量， 请参阅 man:make.conf[5]。</p>
</div>
<div class="paragraph">
<p>关于 FreeBSD 文档联编系统的其他详情， 请参阅 extref:https://docs.freebsd.org/en/books/fdp-primer/[FreeBSD 文档计划入门之新手必读部分]。</p>
</div>
</div>
<div class="sect2">
<h3 id="updating-installed-documentation">4.5. 从源代码安装 FreeBSD 文档<a class="anchor" href="#updating-installed-documentation"></a></h3>
<div class="paragraph">
<p>在 <span class="filename">/usr/doc</span> 中下载了最新的文档源代码快照之后， 就可以开始动手联编文档了。</p>
</div>
<div class="paragraph">
<p>要更新全部 <code>DOC_LANG</code> 中定义的语言的文档， 需要执行下面的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/doc</span>
<span class="c"># make install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果在 <span class="filename">make.conf</span> 中配置了正确的 <code>DOCSUPFILE</code>、 <code>SUPHOST</code> 和 <code>SUP_UPDATE</code> 选项， 则可以将更新源代码和安装一步完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/doc</span>
<span class="c"># make update install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果只需要更新某个特定语言的文档， 可以在 <span class="filename">/usr/doc</span> 中与之对应的目录中运行 man:make[1]：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/doc/en_US.ISO8859-1</span>
<span class="c"># make update install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此外， 还可以透过 make 变量 <code>FORMATS</code> 来控制输出格式， 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/doc</span>
<span class="c"># make FORMATS=&#39;html html-split&#39; install clean</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="doc-ports">4.6. 使用文档 Ports<a class="anchor" href="#doc-ports"></a></h3>
<div class="paragraph">
<p>在之前的章节中， 我们已展示了从源代码更新 FreeBSD 文档的方法。 基于源代码的更新的方法可能并不是对于所有的 FreeBSD 系统都可行有效。 编译文档源代码需要一大堆的工具， <em>文档工具链</em>， 对于 CVS 的一定了解和从仓库中检出源代码， 还有一些编译已检出代码的手工步骤。 这一章节我们将介绍一种使用 Ports 来更新已安装的 FreeBSD 文档：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>下载并安装预编译好的文档快照， 而不用在本地编译任何部份 (这样便不再需要安装整个文档工具链了)。</p>
</li>
<li>
<p>下载文档的源代码并使用 ports 框架编译 (使得检出和编译的步骤更容易些)。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两种更新 FreeBSD 文档的方法都由一组 文档工程组 &lt;<a href="mailto:doceng@FreeBSD.org">doceng@FreeBSD.org</a>&gt; 每月更新的 <em>文档 ports</em> 提供支持。 这些都列在了 FreeBSD Ports <a href="http://www.freshports.org/docs/">docs</a> 虚拟分类下面。</p>
</div>
<div class="sect3">
<h4 id="doc-ports-install-make">4.6.1. 编译和安装文档 Ports<a class="anchor" href="#doc-ports-install-make"></a></h4>
<div class="paragraph">
<p>文档 ports 使用 ports 的构建框架使得文档的编译变得更加容易。 自动化了检出文档源代码， 配以适合的环境设置和命令行参数运行 man:make[1]， 它们使得安装或卸载文档变得就像安装 FreeBSD 其他 port 或二进制包那样容易。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>另一个特性便是当在本地编译文档 ports 时， <em>文档工具链</em> ports 会被列入依赖关系， 并自动安装。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>文档 ports 按以下的方式组织：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个 &#34;主 port&#34;， 在 package:misc/freebsd-doc-en[] 下可以找到这个文档 port。 它是所有文档 ports 的基础。 在默认的情况下， 它只安装英文版文档。</p>
</li>
<li>
<p>一个 &#34;合集 port&#34;， package:misc/freebsd-doc-all[]， 它将构建并安装所有语言版本的所有文档。</p>
</li>
<li>
<p>最后是各种翻译的 &#34;从属 port&#34;， 比如： package:misc/freebsd-doc-hu[] 是匈牙利文版的文档。 所有这些都基于主 port 并会安装上对应语言的翻译文档。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以 <code>root</code> 用户身份运行如下的命令安装文档：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/ports/misc/freebsd-doc-en</span>
<span class="c"># make install clean</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将会安装分章节的英文版本 HTML 格式文档 (与<a href="http://www.FreeBSD.org">http://www.FreeBSD.org</a> 上的相同) 到 <span class="filename">/usr/local/shared/doc/freebsd</span> 目录。</p>
</div>
<div class="sect4">
<h5 id="doc-ports-options">4.6.1.1. 常见的调节选项<a class="anchor" href="#doc-ports-options"></a></h5>
<div class="paragraph">
<p>文档 ports 有许多用来修改默认行为的选项。 以下是一段简要列表：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>WITH_HTML</code></dt>
<dd>
<p>允许构建 HTML 格式： 每份文档为一个单一的 HTML 文件。 此种文档的文件名视情况而定通常是 <span class="filename">article.html</span>， 或 <span class="filename">book.html</span>， 另外附加一些图片。</p>
</dd>
<dt class="hdlist1"><code>WITH_PDF</code></dt>
<dd>
<p>允许构建 Adobe® Portable Document Format， 可使用 Adobe® Acrobat Reader®， Ghostscript 或者其他的 PDF 阅读器查阅。 此种文档的文件名视情况而定通常是 <span class="filename">article.pdf</span> 或 <span class="filename">book.pdf</span>。</p>
</dd>
<dt class="hdlist1"><code>DOCBASE</code></dt>
<dd>
<p>文档将被安装到的目录。默认值 <span class="filename">/usr/local/shared/doc/freebsd</span>。</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>请注意默认的目录与 CVSup 方法种所使用的目录不同。 这是因为我们正在安装的是一个 port， 而 ports 通常会被安装到 <span class="filename">/usr/local</span> 目录。 这可以指定 <code>PREFIX</code> 变量覆盖默认值。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>这是一份简短的关于如何使用以上提到变量来安装 PDF 格式的匈牙利文档：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/ports/misc/freebsd-doc-hu</span>
<span class="c"># make -DWITH_PDF DOCBASE=share/doc/freebsd/hu install clean</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="doc-ports-install-package">4.6.2. 使用文档 Packages<a class="anchor" href="#doc-ports-install-package"></a></h4>
<div class="paragraph">
<p>正如上文所述， 从 ports 构建文档需要在本地安装一份文档工具链和一些编译所需的磁盘空间。 当不够资源安装文档工具链， 或者从源代码编译需要太多的磁盘空间时， 我们仍然可以安装预编译好的文档快照的 ports。</p>
</div>
<div class="paragraph">
<p>文档工程组 &lt;<a href="mailto:doceng@FreeBSD.org">doceng@FreeBSD.org</a>&gt; 每个月都会制作 FreeBSD 文档快照的包。 这些二进制包可以通过包工具来操作， 比如 man:pkg_add[1]， man:pkg_delete[1]， 等等。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>当使用二进制包时， 将安装所指定语言相关的 FreeBSD 文档的 <em>所有</em> 可用格式。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>举例来说， 以下的命令将安装最新预编译的匈牙利语文档：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg_add -r hu-freebsd-doc</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>二进制包使用了以下与对应 ports 名称不同的命名格式: <code>lang-freebsd-doc</code>。 这里的 <em>lang</em> 是语言代码的简短形式， 比如 <code>hu</code> 表示匈牙利语， 或者 <code>zh_cn</code> 表示简体中文。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="doc-ports-update">4.6.3. 更新文档 Ports<a class="anchor" href="#doc-ports-update"></a></h4>
<div class="paragraph">
<p>任何用于更新 ports 的工具都可以被用来更新已安装的文档 port。 举例来说， 下面的命令通过 package:ports-mgmt/portupgrade[] 工具来更新已安装的匈牙利语文档二进制包。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># portupgrade -PP hu-freebsd-doc</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="current-stable">5. 追踪开发分支<a class="anchor" href="#current-stable"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD 有两个开发分支： FreeBSD-CURRENT 和 FreeBSD-STABLE。 这一章节将对每个分支作相应介绍与如何保持你的系统更新。 我们将先介绍 FreeBSD-CURRENT 然后是 FreeBSD-STABLE。</p>
</div>
<div class="sect2">
<h3 id="current">5.1. 使用最新的 FreeBSD CURRENT<a class="anchor" href="#current"></a></h3>
<div class="paragraph">
<p>这里再次强调， FreeBSD-CURRENT 是 FreeBSD 开发的 &#34;最前沿&#34;。 FreeBSD-CURRENT 用户要有较高的技术能力， 并且应该有能力自已解决困难的系统问题。 如果您是个 FreeBSD 新手， 那么在安装之前最好三思。</p>
</div>
<div class="sect3">
<h4 id="_freebsd_current_是什么">5.1.1. FreeBSD-CURRENT 是什么？<a class="anchor" href="#_freebsd_current_是什么"></a></h4>
<div class="paragraph">
<p>FreeBSD-CURRENT 是 FreeBSD 的发展前沿。 包括了在下一个官方发行的软件中可能存在， 也可能不存在的发展、 试验性改动、 以及过渡性的机制。 尽管许多 FreeBSD 开发者每天都会编译 FreeBSD-CURRENT 源代码， 但有时这些代码仍然会是不能编译的。 虽然这些问题会很快解决， 但 FreeBSD-CURRENT 是带来破坏还是您正希望的功能性改善， 很可能完全取决于您获取源代码的的时机！</p>
</div>
</div>
<div class="sect3">
<h4 id="_谁需要_freebsd_current">5.1.2. 谁需要 FreeBSD-CURRENT？<a class="anchor" href="#_谁需要_freebsd_current"></a></h4>
<div class="paragraph">
<p>FreeBSD-CURRENT 适合下边三种主要兴趣团体：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>FreeBSD 社区的成员： 积极工作在源码树的某部分的人和为保持 &#34;最新&#34; 为绝对需求的人。</p>
</li>
<li>
<p>FreeBSD 社区的成员： 为促使 FreeBSD-CURRENT 保持尽可能的健全而愿花时间去解决问题的积极的测试者； 以及那些愿意提出关于 FreeBSD 变化和总体方向的建设性建议并且提供补丁实现它们的人们。</p>
</li>
<li>
<p>那些只是想关注或为了参考目的使用当前 (current) 源码的人们 (如，为了<em>阅读</em>，而不是执行)。 这些人也偶尔做做注释或贡献代码。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_freebsd_current_不是什么">5.1.3. FreeBSD-CURRENT <em>不是</em>什么？<a class="anchor" href="#_freebsd_current_不是什么"></a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>追求最新功能， 您听说里面有一些很酷的新功能， 并希望成为您周围的人中第一个尝试它们的人。 尽管您能够因此首先了解到最新的功能， 但这也意味着在出现新的 bug 时您也首当其冲。</p>
</li>
<li>
<p>修复错漏的快捷方式。任何 FreeBSD-CURRENT 的既定版本在修复已知错漏的同时又可能会产生新的错漏。</p>
</li>
<li>
<p>无所不在的&#34;官方支持&#34;。 我们尽最大努力在3个&#34;合法的&#34; FreeBSD-CURRENT 组之一真诚给人们提供帮助，但是我们 <em>没有时间</em>提供技术支持。 这并不是因为我们是那种不喜欢帮助人解困的无耻之徒 (如果我们是的话，就不会制作 FreeBSD 了)。 我们不能每天简单地回复上百的消息，<em>而且</em> 我们继续发展 FreeBSD！ 在改善 FreeBSD 和回复大量关于实验代码的问题之间如果要做个选择的话， 开发人员会选择前者。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_使用_freebsd_current">5.1.4. 使用 FreeBSD-CURRENT<a class="anchor" href="#_使用_freebsd_current"></a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>加入 <a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a> 和 <a href="https://lists.FreeBSD.org/subscription/svn-src-head">SVN src 树 head/-current 分支的修订讯息</a> 列表。 这个不仅仅是个好主意，而且很 <em>重要</em>。如果您不去 <em><a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a></em>， 您就不会看到人们所做的关于系统当前状态的说明， 这样您就有可能在别人已经发现并解决了的一大堆问题面前难倒。 更重要的是您会错过一些重要的公告---对于您的系统安全可能是至关重要的。</p>
<div class="paragraph">
<p><a href="https://lists.FreeBSD.org/subscription/svn-src-head">SVN src 树 head/-current 分支的修订讯息</a> 列表允许您看到每个变化的提交记录， 因为这些记录与其它相关信息是同步的。</p>
</div>
<div class="paragraph">
<p>要加入这些列表，或其它可能的列表，请访问 <a href="https://lists.freebsd.org" class="bare">https://lists.freebsd.org</a> ，并且点击您想订阅的列项。 关于其它步骤的说明那里有提供。 如果你有兴趣追踪整个原代码树的变更记录， 我们建议你订阅 <a href="https://lists.FreeBSD.org/subscription/svn-src-all">SVN 整个 src 树的修订讯息 (除了 &#34;user&#34; 与 &#34;projects&#34;)</a> 邮件列表。</p>
</div>
</li>
<li>
<p>从FreeBSD crossref:mirrors[mirrors,镜像站点] 获取源码。 您有两种方式选择：
..</p>
<div class="paragraph">
<p>与称作 <span class="filename">standard-supfile</span> 的 <span class="filename">supfile</span> 一起使用 crossref:mirrors[cvsup,cvsup]，这个可以从 <span class="filename">/usr/shared/examples/cvsup</span>得到。 这是最被推荐的方式，因为它允许您一次获取整个集合， 以后就只取更改过的部分。许多人从 <code>cron</code> 运行 <code>cvsup</code>，以保持他们的源码自动更新。 您须要定制上边的 <span class="filename">supfile</span> 样本，并且配置 crossref:mirrors[cvsup,cvsup] 以适应您的环境。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><span class="filename">standard-supfile</span> 例子是为追踪指定的 FreeBSD 安全分支而指定的， 而不是 FreeBSD-CURRENT。 你需要编辑这个文件并把如下这行：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>*default release=cvs tag=RELENG_X_Y</pre>
</div>
</div>
<div class="paragraph">
<p>替换为：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>*default release=cvs tag=.</pre>
</div>
</div>
<div class="paragraph">
<p>可以参阅手册中的 crossref:mirrors[cvs-tags,CVS Tags] 章节获得更多可用 tag 的详细说明。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>使用工具 CTM。 如果您的连接性能不太好(高价连接或只能通过电子邮件存取)， CTM 是个选择。 但这也颇有争议并且常常得到到坏文件。因此很少使用它， 这也注定了不能长期用它来工作。对于使用 9600 bps 或更快连接的人，我们推荐使用 CVSup。</p>
</div>
</li>
<li>
<p>如果您获取源码是用于运行，而不只是看看，那么就获取 <em>整个</em> FreeBSD-CURRENT，不要选部分。 这样做的原因是源码的大部分都依赖于其他部分， 要是您试着只编译其中一部分的话，保证您会陷入麻烦。</p>
<div class="paragraph">
<p>在编译 FreeBSD-CURRENT 之前，请仔细阅读 <span class="filename">/usr/src</span> 里的 <span class="filename">Makefile</span> 文件。 尽管是部分的升级过程，您至少也要首先<a href="#makeworld">安装新的内核和重建系统</a>。阅读 <a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a> 邮件列表和 <span class="filename">/usr/src/UPDATING</span>， 会让您在其它循序渐进的过程中保持最新， 这对于我们向下一个发行版转移是很有必要的。</p>
</div>
</li>
<li>
<p>热心一点！如果您正运行 FreeBSD-CURRENT， 我们很想知道您关于它的一些想法， 尤其是关于错漏修复或增进的建议。 非常欢迎带有代码的建议！</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stable">5.2. 使用最新的 FreeBSD STABLE<a class="anchor" href="#stable"></a></h3>
<div class="sect3">
<h4 id="_freebsd_stable_是什么">5.2.1. FreeBSD-STABLE 是什么?<a class="anchor" href="#_freebsd_stable_是什么"></a></h4>
<div class="paragraph">
<p>FreeBSD-STABLE 是我们的发展分支，我们的主要发行版就由此而来。 这个分支会以不同速度变化，并且假定这些是第一次进入 FreeBSD-CURRENT 进行测试。然而，这 <em>仍然</em> 是个发展中的分支，这意味着在一定的时候，FreeBSD-STABLE 源码可能或不可能满足一些特殊的要求。 它只不过是另一个工程发展途径，并不是终端用户的资源。</p>
</div>
</div>
<div class="sect3">
<h4 id="_谁需要_freebsd_stable">5.2.2. 谁需要 FreeBSD-STABLE？<a class="anchor" href="#_谁需要_freebsd_stable"></a></h4>
<div class="paragraph">
<p>如果您有兴趣追随 FreeBSD 的开发过程或为其做点贡献， 尤其是和下一个 &#34;非计划&#34; 的 FreeBSD 发行版有关时， 您应该考虑采用 FreeBSD-STABLE。</p>
</div>
<div class="paragraph">
<p>尽管安全更新也会进入 FreeBSD-STABLE 分支，但您并不 <em>必须</em> 使用 FreeBSD-STABLE 来达到这样的目的。 每一个 FreeBSD 的安全公告都会解释如何修复受到影响的发行版中的问题 ，而因为安全原因而去采用一个开发分支显然可能会同时引入一些不希望的修改。</p>
</div>
<div class="paragraph">
<p>尽管我们尽力确保 FreeBSD-STABLE 分支在任何时候都能够正确编译和运行， 但没有人能够担保它在任何时候都总可以。 此外， 尽管代码在进入 FreeBSD-STABLE 之前都是在 FreeBSD-CURRENT 上完成开发， 但使用 FreeBSD-STABLE 的人要比使用 FreeBSD-CURRENT 的更多。 有证据显示， 犄角旮旯里的各种问题有些时候仍然会由于在 FreeBSD-CURRENT 不那么明显 而在 FreeBSD-STABLE 暴露出来。</p>
</div>
<div class="paragraph">
<p>基于这些原因， <em>不</em> 推荐您盲目地追随 FreeBSD-STABLE， 并且， 在粗略地测试过代码之前不要更新任何生产服务器到 FreeBSD-STABLE 也非常重要。</p>
</div>
<div class="paragraph">
<p>如果您没有用于完成这些工作的资源， 我们推荐您使用最新的 FreeBSD 发行版， 并使用发行版提供的二进制更新机制来在发行版之间完成迁移。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用freebsd_stable">5.2.3. 使用FreeBSD-STABLE<a class="anchor" href="#_使用freebsd_stable"></a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>加入 <a href="https://lists.FreeBSD.org/subscription/freebsd-stable">FreeBSD-STABLE; 邮件列表</a> 列表。让您随时了解可能出现在 FreeBSD-STABLE 里的&#34;build 依赖性&#34;或其它需要特别注意的问题。 当开发员正在考虑某些有争议的修复或更新时， 他们就会在这个邮件列表里发表声明，给用户机会回应， 看他们对于提出的变化是否还有什么问题。</p>
<div class="paragraph">
<p>加入相关的 SVN 列表来追踪你所关心的分支。比如，如果你在追踪 7-STABLE 分支，加入 <a href="https://lists.FreeBSD.org/subscription/svn-src-stable-7">svn-src-stable-7</a> 列表。 这样每次这个分支上有改动的时候就能让你看到提交记录, 还包括了修改可能引起的副作用之类的相关信息。</p>
</div>
<div class="paragraph">
<p>要加入这些列表或其他可用的，访问 <a href="https://lists.freebsd.org" class="bare">https://lists.freebsd.org</a> 并点击您希望订阅的列表。关于其它步骤的说明可以在那里看到。 如果你有兴趣追踪整个原代码树的变更记录， 我们建议你订阅 <a href="https://lists.FreeBSD.org/subscription/svn-src-all">SVN 整个 src 树的修订讯息 (除了 &#34;user&#34; 与 &#34;projects&#34;)</a> 邮件列表。</p>
</div>
</li>
<li>
<p>如果您正安装一个新系统， 并希望它运行每月从 FreeBSD-STABLE 编译的快照， 请察看 <a href="https://www.FreeBSD.org/snapshots/"> Snapshots</a> 网页以了解更多信息。 另外， 也可以从 crossref:mirrors[mirrors,镜像站点] 安装最新的 FreeBSD-STABLE 发行版， 并按照其中的说明将系统更新到最新的 FreeBSD-STABLE 源代码。</p>
<div class="paragraph">
<p>如果您已经在运行较早的 FreeBSD 版本， 并希望通过源代码方式升级， 则可以通过 FreeBSD crossref:mirrors[mirrors,镜像站点] 来完成。 这可以通过两种方式来进行：
..</p>
</div>
<div class="paragraph">
<p>与称作 <span class="filename">stable-supfile</span> 的 <span class="filename">supfile</span> 一起使用 crossref:mirrors[cvsup,cvsup]，这个可以从 <span class="filename">/usr/shared/examples/cvsup</span> 得到。 这是最被推荐的方式，因为它允许您一次获取整个集合， 以后就只取更改过的部分。许多人从 <code>cron</code> 运行 <code>cvsup</code>，以保持他们的源码自动更新。 您须要定制上边的 <span class="filename">supfile</span> 样本，并且配置 crossref:mirrors[cvsup,cvsup] 以适应您的环境。
..</p>
</div>
<div class="paragraph">
<p>使用工具 CTM。 如果您的连接性能不太好(高价连接或只能通过电子邮件存取)， CTM 是个选择。 但这也颇有争议并且常常得到到坏文件。因此很少使用它， 这也注定了不能长期用它来工作。对于使用 9600 bps 或更快连接的人，我们推荐使用 CVSup。</p>
</div>
</li>
<li>
<p>本质上说，如果您需要快速存取源码并且不计较通信宽带的话，可以使用 <code>cvsup</code> 或 <code>ftp</code>。否则，就使用 CTM。
.</p>
<div class="paragraph">
<p>在编译 FreeBSD-STABLE 之前，请仔细阅读 <span class="filename">/usr/src</span> 里的 <span class="filename">Makefile</span>。 您至少应该<a href="#makeworld">安装一个新的内核并重建系统</a>， 首先做为升级过程的一部分。阅读 <a href="https://lists.FreeBSD.org/subscription/freebsd-stable">FreeBSD-STABLE; 邮件列表</a> 邮件列表和 <span class="filename">/usr/src/UPDATING</span>， 可能让您在其它循序渐进的过程中保持更新， 这在我们向下一发行版转移时是很有必要的。</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synching">6. 同步您的源码<a class="anchor" href="#synching"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>有许多方式通过互联网(或电子邮件)与 FreeBSD 项目源码特定领域或所有领域保持更新，主要依赖于您的兴趣。 我们提供的主要服务是crossref:mirrors[anoncvs,匿名 CVS]、 crossref:mirrors[cvsup,CVSup]，和 crossref:mirrors[ctm,CTM]。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>虽然只更新源码树中的部分是可能的， 唯一被支持的更新过程是更新整个树、并且重编译用户区 (如：在用户空间运行的所有程序，像 <span class="filename">/bin</span> 和 <span class="filename">/sbin</span>下边的)和内核源码。 只更新源码树中的部分，或只有内核，或只有用户区 (userland) 通常会出现错误。这些问题包括有编译错误、内核崩溃 (kernel panics)、数据出错。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>匿名 CVS 和 CVSup 使用 <em>下拉(pull)</em> 模式来更新源代码。 在 CVSup 中， 用户 (或者 <code>cron</code> 脚本) 会调用 <code>cvsup</code> 程序， 后者会同某一个 <code>cvsupd</code> 服务进行交互， 以更新您的文件。 您接到的更新是更新时刻最新的， 并且您只会收到那些需要的更新。 您可以很容易地限制更新的范围， 只更新那些您需要的文件。 服务器端会根据您手头已经有的文件即时地生成更新内容。 匿名 CVS 相对于 CVSup 而言要简单一些， 因为它只是对 CVS 的一种扩展， 让您可以从远程的 CVS 代码库得到更新。 CVSup 相对而言， 要比 匿名 CVS 更有效率， 然而后者却更容易使用。</p>
</div>
<div class="paragraph">
<p>另一种方法是 CTM。 这种方法并不能将您手头的代码与中央代码库中的版本进行比较， 也不能下载它们。 在主 CTM 服务器上运行的脚本会每天执行多次， 每次运行都能够自动地识别所有文件自上次运行以来所发生的变化， 如果发现有文件发生了变动， 就会压缩、 标上一个序列号， 并进行便于使用电子邮件进行传送的编码操作 (其中只包括可打印的 ASCII 字符)。 一旦接收到， 这些&#34;CTM deltas&#34;就会被传送给 man:ctm_rmail[1] 工具---可以自动进行解码、校验和应用这些变化到用户的复制的源码里。 这个过程比 CVSup 更为有效， 而且更少占用我们的服务器资源，因为它不仅仅采用 <em>下拉(pull)</em> 模式，还采用 <em>上推(push)</em> 模式。</p>
</div>
<div class="paragraph">
<p>当然， 这样做也会带来一些不便。 如果您不经意删除了您的压缩包的部分内容， CVSup 会检测到并为您重建破坏的部分。 CTM 是不会这样做的， 如果您删除了您的源码树中的某部分(并已不能恢复)， 那么您就必须从破坏处 (从最新的CVS &#34;base delta&#34;) 开始，使用 CTM 或 匿名 CVS 进行重建，仅仅删除坏的数据并再同步。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="makeworld">7. 重新编译 &#34;world&#34;<a class="anchor" href="#makeworld"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>只要您根据一定版本的 FreeBSD (FreeBSD-STABLE、FreeBSD-CURRENT 等等)， 已经同步了您本地的源码树，那么您就可以使用这些源码树来重建系统。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">做好备份</div>
<div class="paragraph">
<p>无需强调在行动 <em>之前</em> 备份整个系统是多么的重要。 尽管重新编译系统是 (如果您按照文档的指示做的话) 一件很容易完成的工作， 但出错也是在所难免的， 另外， 别人在源码里面引入的错误也可能造成系统无法引导。</p>
</div>
<div class="paragraph">
<p>请确信自己已经做过备份， 并且在手边有恢复软盘或可以引导的光盘。 您可能永远也不会用到它， 但安全第一嘛！</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">订阅恰当的邮件列表</div>
<div class="paragraph">
<p>FreeBSD-STABLE 和 FreeBSD-CURRENT 分支自然是 <em>发展中的</em>。为 FreeBSD 做贡献的都是人，偶尔也会犯错误。</p>
</div>
<div class="paragraph">
<p>有时这些错误没什么危害，只是引起您的系统生成新的诊断警告。 有时是灾难性的，并导致您的系统不能启动或破坏您的文件系统 (甚至更糟)。</p>
</div>
<div class="paragraph">
<p>如果出现了类似的问题， 贴一封&#34;小心(heads up)&#34;帖到相关的邮件列表里， 讲清问题的本质以及受影响的系统。在问题解决后，再贴封&#34;解除(all clear)&#34;声明。</p>
</div>
<div class="paragraph">
<p>如果使用 FreeBSD-STABLE 或 FreeBSD-CURRENT 而又不阅读 <a href="https://lists.FreeBSD.org/subscription/freebsd-stable">FreeBSD-STABLE; 邮件列表</a> 和 <a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a> 各自的邮件列表， 那么您是自找麻烦。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">不要使用 <code>make world</code></div>
<div class="paragraph">
<p>许多较早的文档推荐使用 <code>make world</code> 来完成这项工作。 这样做会跳过一些必要的步骤， 因此只有在您知道自己在做什么的时候才可以这样做。 几乎所有的情况下 <code>make world</code> 都是不应该做的事情， 您应该使用这里描述的方法。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="canonical-build">7.1. 更新系统的规范方法<a class="anchor" href="#canonical-build"></a></h3>
<div class="paragraph">
<p>在更新系统时， 一定要首先查看 <span class="filename">/usr/src/UPDATING</span> 文件， 以便了解在 buildworld 之前需要进行的操作， 然后按照下面列出的步骤进行操作：</p>
</div>
<div class="paragraph">
<p>这些更新步骤假定您使用的是包含旧编译器、 内核以及用户态工具及配置的旧版 FreeBSD。 我们使用 &#34;world&#34; 来表示系统中的核心执行文件、 函数库和程序文件。 编译器是 &#34;world&#34; 的一部分， 但有其特殊性。</p>
</div>
<div class="paragraph">
<p>此外， 我们还假定您已经获得了较新版本操作系统的源代码。 如果您正更新的系统中的源代码也是旧版系统所附带的， 您还需要参阅 <a href="#synching">同步您的源码</a> 来把代码同步到较新的版本。</p>
</div>
<div class="paragraph">
<p>从源代码更新系统， 有时会比初看上去的时候更麻烦一些， 另一方面， FreeBSD 的开发人员有时会不得不修改推荐的更新步骤， 特别是当出现了一些无法避免的依赖关系的时候。 这一节余下的部分， 将介绍目前推荐的更新步骤背后的原理。</p>
</div>
<div class="paragraph">
<p>成功的更新操作必须解决下面的这些问题：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>旧的编译器可能无法编译新的内核。 (另一方面， 旧的编译器很可能有 bug。) 因此， 新的内核应该以新的编译器编译。 更具体地说， 新的编译器应在新内核开始联编之前已经完成了联编步骤。 请注意， 新的编译器并不一定需要在联编新内核之前 <em>安装</em> 到系统中。</p>
</li>
<li>
<p>新的 world 有可能依赖一些新的内核特性。 因此， 新内核必须在新的 world 之前安装。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个问题就是为什么我们将在后面的章节中介绍的， 需要按照 <code>buildworld</code>、 <code>buildkernel</code>、 <code>installkernel</code>、 <code>installworld</code> 的顺序来更新系统的原因。 这并不是您需要遵守推荐的更新操作的全部原因， 除了这两个最重要的理由之外， 还有一些并不那么显而易见的原因：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>旧的 world 可能无法配合新的内核正常工作， 因此， 您在安装完新内核之后， 应尽快将 world 也随之更新。</p>
</li>
<li>
<p>有些配置文件的变动必须在安装新的 world 之前完成， 而另一些配置文件的变动则有可能导致旧 world 工作不正常。 因此， 通常而言会需要两次不同的配置文件更新步骤。</p>
</li>
<li>
<p>多数情况下， 更新步骤只会替换或增加文件； 换言之， 现有的旧文件并不会被删除。 有时， 这可能会导致一些其他问题。 因此， 有时安装操作会指明， 必须在某些操作之前手工删除一些文件。 这些在未来可能会被自动化， 也可能不会自动化。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>由于有这些考虑， 因此一般情况下我们建议使用下列更新步骤。 请注意， 具体的更新操作中可能会需要一些附加的步骤， 但核心的过程应该是不会轻易发生变化的：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>make buildworld</code></p>
<div class="paragraph">
<p>这步操作会联编新的编译器， 以及少量相关工具， 并在随后使用新的编译器来联编 world。 联编的结果会存放在 <span class="filename">/usr/obj</span>。</p>
</div>
</li>
<li>
<p><code>make buildkernel</code></p>
<div class="paragraph">
<p>与旧式的、 使用 man:config[8] 和 man:make[1] 的方法不同， 这种做法会使用存放于 <span class="filename">/usr/obj</span> 中的 <em>新的</em> 编译器。 这种做法使得您免去了由于编译器与内核源代码不一致导致的问题。</p>
</div>
</li>
<li>
<p><code>make installkernel</code></p>
<div class="paragraph">
<p>安装新的内核及其模块， 使系统能够以更新后的内核启动。</p>
</div>
</li>
<li>
<p>重启系统并进入单用户模式。</p>
<div class="paragraph">
<p>单用户模式使得更新正在运行的软件可能导致的问题减到最少。 此外， 它也使配合新内核运行旧 world 可能出现的问题减到最少。</p>
</div>
</li>
<li>
<p><code>mergemaster -p</code></p>
<div class="paragraph">
<p>这步操作会进行完成安装新的 world 所需的配置文件更新操作。 例如， 它可能会在系统的密码数据库中添加新的用户组或用户。 这些操作通常在上次更新之后增加了新的用户组或特殊系统用户之后是需要的， 因为 <code>installworld</code> 这步操作会需要这些用户或组才能顺利完成。</p>
</div>
</li>
<li>
<p><code>make installworld</code></p>
<div class="paragraph">
<p>从 <span class="filename">/usr/obj</span> 中复制 world。 这步操作之后， 您在盘上的系统， 包括内核和 world 就都是新的了。</p>
</div>
</li>
<li>
<p><code>mergemaster</code></p>
<div class="paragraph">
<p>更新余下的配置文件， 因为您的 world 已经更新完成了。</p>
</div>
</li>
<li>
<p>重启系统。</p>
<div class="paragraph">
<p>这步操作将加在新的内核， 以及新的 world 和更新过的配置文件。</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>注意， 如果您正从同一 FreeBSD 版本分支升级， 例如， 从 7.0 到 7.1， 则上述过程可能没有那么必要， 因为您不太可能遇到严重的编译器、 内核源代码、 用户态程序源代码或配置文件不匹配的情形。 旧式的 <code>make world</code> 然后再联编新内核的升级方法， 很可能有机会能够正常运作而完成升级工作。</p>
</div>
<div class="paragraph">
<p>但是， 在大版本升级的过程中， 不按照前面所介绍的操作来进行升级时， 便很可能遇到一些问题。</p>
</div>
<div class="paragraph">
<p>此外， 还需要注意的是， 有些时候升级的过程中 (例如从 4.<em>X</em> 到 5.0) 可能会需要一些额外的步骤 (例如在 installworld 之前更名或删除一些文件)。 请仔细阅读 <span class="filename">/usr/src/UPDATING</span> 这个文件， 特别是它的结尾部分所介绍的推荐的升级操作顺序。</p>
</div>
<div class="paragraph">
<p>由于开发人员发现不可能完全避免一些不匹配方面的问题， 这个过程一直在演化过程中。 不过幸运的是， 目前推荐的这个升级步骤， 应该能够在很长一段时间内不需要做任何调整。</p>
</div>
<div class="paragraph">
<p>总结一下， 目前推荐的从源代码升级 FreeBSD 的方法是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span>
<span class="c"># make buildworld</span>
<span class="c"># make buildkernel</span>
<span class="c"># make installkernel</span>
<span class="c"># shutdown -r now</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>有时， 可能需要额外地执行一次 <code>mergemaster -p</code> 才能够完成 <code>buildworld</code> 步骤。 这些要求， 会在 <span class="filename">UPDATING</span> 中进行描述。 一般而言， 您可以简单地跳过这一步， 只要进行的不是大跨度的 FreeBSD 版本升级。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在 <code>installkernel</code> 成功完成之后， 您需要引导到单用户模式 (举例而言， 可以在加载器提示后输入 <code>boot -s</code>)。 接下来执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># adjkerntz -i</span>
<span class="c"># mount -a -t ufs</span>
<span class="c"># mergemaster -p</span>
<span class="c"># cd /usr/src</span>
<span class="c"># make installworld</span>
<span class="c"># mergemaster</span>
<span class="c"># reboot</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">阅读进一步的说明</div>
<div class="paragraph">
<p>前面所给出的， 只是帮助您开始工作的简要说明。 要清楚地理解每一步， 特别是如果打算自行定制内核配置， 就应阅读下面的内容。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="src-updating">7.2. 阅读 <span class="filename">/usr/src/UPDATING</span><a class="anchor" href="#src-updating"></a></h3>
<div class="paragraph">
<p>在您做其它事之前，请阅读 <span class="filename">/usr/src/UPDATING</span> (或在您的源码里的等效的文件)。 这个文件要包含有关于您可能遇到的问题的重要信息， 或指定了您可能使用到的命令的执行顺序。如果 <span class="filename">UPDATING</span> 与您这里读到相矛盾，那就先依据 <span class="filename">UPDATING</span>。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>正如先前所述，阅读 <span class="filename">UPDATING</span> 并不能替代订阅正确的邮件列表。两都是互补的，并不彼此排斥。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="make-conf">7.3. 检查 <span class="filename">/etc/make.conf</span><a class="anchor" href="#make-conf"></a></h3>
<div class="paragraph">
<p>检查 <span class="filename">/usr/shared/examples/etc/make.conf</span> 以及 <span class="filename">/etc/make.conf</span>。 第一个文件包含了一些默认的定义 - 它们中的绝大多数都注释掉了。 为了在重新编译系统时能够使用它们， 请把这些选项加入到 <span class="filename">/etc/make.conf</span>。 请注意在 <span class="filename">/etc/make.conf</span> 中的任何设置同时也会影响每次运行 <code>make</code> 的结果， 因此设置一些适合自己系统的选项是一个好习惯。</p>
</div>
<div class="paragraph">
<p>一般的用户通常会从 <span class="filename">/usr/shared/examples/etc/make.conf</span> 复制 <code>CFLAGS</code> 和 <code>NO_PROFILE</code> 这样的设置到 <span class="filename">/etc/make.conf</span> 中并令它们生效。</p>
</div>
<div class="paragraph">
<p>请考虑其他的一些选项 (例如 <code>COPTFLAGS</code>、 <code>NOPORTDOCS</code> 等等)， 看看是否合用。</p>
</div>
</div>
<div class="sect2">
<h3 id="updating-etc">7.4. 更新 <span class="filename">/etc</span> 里的文件<a class="anchor" href="#updating-etc"></a></h3>
<div class="paragraph">
<p><span class="filename">/etc</span> 目录包含有除了您的系统启动时执行的脚本外大部分的系统配置信息。 有些脚本随 FreeBSD 的版本而不同。</p>
</div>
<div class="paragraph">
<p>有些配置文件在天天运行的系统里也是要使用到的。尤其是 <span class="filename">/etc/group</span>。</p>
</div>
<div class="paragraph">
<p>偶尔， 作为安装过程的一部分， <code>make installworld</code> 会要求事先创建某些特定的用户或组。 在进行升级时， 它们可能并不存在。 这会给升级造成问题。 有时， <code>make buildworld</code> 会检查它们是否已经存在。</p>
</div>
<div class="paragraph">
<p>最近就有个这样的例子， 当时新增了 <code>smmsp</code> 用户。 当用户尝试完成安装操作时， 在 man:mtree[8] 尝试建立 <span class="filename">/var/spool/clientmqueue</span> 时失败了。</p>
</div>
<div class="paragraph">
<p>解决办法是通过使用 <code>-p</code> 选项以构建前 (pre-buildworld) 模式运行 man:mergemaster[8]。 这表示只对比那些对于成功执行 <code>buildworld</code> 或 <code>installworld</code> 起关键作用的文件。 在第一次这样做时， 如果使用的是早期的不支持 <code>-p</code> 的 <code>mergemaster</code> 版本的话， 使用源码中的新版本即可。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src/usr.sbin/mergemaster</span>
<span class="c"># ./mergemaster.sh -p</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果您是个偏执狂 (paranoid)， 您可以检查您的系统看看哪个文件属于您已更名或删除了的那个组。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># find / -group GID -print</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>将显示所有 <em>GID</em> 组 (可以是组名也可以是数字地组 ID)所有的文件。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="makeworld-singleuser">7.5. 改为单用户模式<a class="anchor" href="#makeworld-singleuser"></a></h3>
<div class="paragraph">
<p>您可能想在单用户模式下编译系统。 除了对更快处理事情显然有好处外， 重装系统将触及许多重要的系统文件， 包括所有标准系统二进制文件、库文件、包含 (include) 文件等等。 在正运行的系统 (尤其是在有活跃的用户的时候) 中更改这些文件是自寻烦恼。</p>
</div>
<div class="paragraph">
<p>另一种模式是在多用户模式下编译系统，然后转换到单用户模式下安装。 如果您喜欢这种方式，只需在建立 (build) 完成后才执行下边的步骤。 您推迟转换到单用户模式下直到您必须 <code>installkernel</code> 或 <code>installworld</code>。</p>
</div>
<div class="paragraph">
<p>从运行的系统里，以超级用户方式执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># shutdown now</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就会转换到单用户模式。</p>
</div>
<div class="paragraph">
<p>除此之外， 也可以重启系统， 并在启动菜单处选择 &#34;single user&#34;(单用户) 选项。 这样系统将以单用户模式启动。 接着， 在 shell 提示符处执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># fsck -p</span>
<span class="c"># mount -u /</span>
<span class="c"># mount -a -t ufs</span>
<span class="c"># swapon -a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会检查文件系统，重新将 <span class="filename">/</span> 以读/写模式挂接， 参考 <span class="filename">/etc/fstab</span> 挂接其它所有的 UFS 文件系统，然后启用交换区。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果您的 CMOS 时钟是设置为本地时间，而不是 GMT (如果 man:date[1] 命令输出不能显示正确的时间和地区也确有其事)， 您可能也需要执行下边的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># adjkerntz -i</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样可以确定您正确的本地时区设置-不这样做， 您以后可能会碰到一些问题。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="cleaning-usr-obj">7.6. 删除 <span class="filename">/usr/obj</span><a class="anchor" href="#cleaning-usr-obj"></a></h3>
<div class="paragraph">
<p>随着重新构建系统的进行， 编译结果会放到 (默认情况下) <span class="filename">/usr/obj</span> 下。 这些目录会映射到 <span class="filename">/usr/src</span>。</p>
</div>
<div class="paragraph">
<p>通过删除这个目录， 可以加速 <code>make buildworld</code> 的过程， 并避免相互依赖关系等复杂的问题。</p>
</div>
<div class="paragraph">
<p><span class="filename">/usr/obj</span> 中的某些文件可能设置了不可改标记 (详情参见 man:chflags[1])， 需要首先去掉这些标志。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/obj</span>
<span class="c"># chflags -R noschg *</span>
<span class="c"># rm -rf *</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-upgrading-compilebase">7.7. 重新编译基本系统<a class="anchor" href="#updating-upgrading-compilebase"></a></h3>
<div class="sect3">
<h4 id="_保存输出">7.7.1. 保存输出<a class="anchor" href="#_保存输出"></a></h4>
<div class="paragraph">
<p>建议把执行 man:make[1] 后得到的输出存成一个文件。 如果什么地方出了错，您就会有个错误信息的备份。 尽管这样不能帮您分析哪里出了错， 但如果您把您的问题贴到某个邮件列表里就能帮助其他的人。</p>
</div>
<div class="paragraph">
<p>这样做最简单的办法是使用 man:script[1] 命令，同是带上参数指定存放输出的文件名。 您应在重建系统之前立即这样做，然后在过程完成时输入 <code>exit</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># script /var/tmp/mw.out</span>
Script started, output file is /var/tmp/mw.out
<span class="c"># make TARGET</span>
… compile, compile, compile …
<span class="c"># exit</span>
Script <span class="k">done</span>, …</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您这样做，就 <em>不要</em> 把文件存到 <span class="filename">/tmp</span> 里边。下次启动时，这个目录就会被清除掉。 存放的最好地方是 <span class="filename">/var/tmp</span> (如上个实例)或 <code>root</code> 的主目录。</p>
</div>
</div>
<div class="sect3">
<h4 id="make-buildworld">7.7.2. 编译基本系统<a class="anchor" href="#make-buildworld"></a></h4>
<div class="paragraph">
<p>您必须在<span class="filename">/usr/src</span>目录里边：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(当然，除非您的源码是在其它地方，真是这样的话更换成那个目录就行了)。</p>
</div>
<div class="paragraph">
<p>使用 man:make[1] 命令重建系统。这个命令会从 <span class="filename">Makefile</span> (描述组成 FreeBSD 的程序应该怎样被重建， 以什么样的顺序建立等等) 里读取指令。</p>
</div>
<div class="paragraph">
<p>输入的一般命令格式如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -x -DVARIABLE target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个例子里，<code>-<em>x</em></code> 是会传递给 man:make[1] 的一个选项。查看 man:make[1] 手册有您可用的选项例子。</p>
</div>
<div class="paragraph">
<p><code>-D_VARIABLE_</code> 传递一个变量给 <span class="filename">Makefile</span>。这些变量控制了 <span class="filename">Makefile</span> 的行为。这些同 <span class="filename">/etc/make.conf</span> 设置的变量一样， 只是提供了另一种设置它们的方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -DNO_PROFILE target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>是另一种指定不被建立 (built) 的先定库 (profiled libraries) 的方式，协同 <span class="filename">/etc/make.conf</span> 里的</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>NO_PROFILE=    true 	#    避免编译性能分析库</pre>
</div>
</div>
<div class="paragraph">
<p>一起使用。</p>
</div>
<div class="paragraph">
<p><em>目标 (target)</em> 告诉 man:make[1] 什么该做。每个 <span class="filename">Makefile</span> 定义了一定数量不同的&#34;目标 (targets)&#34;， 然后您选择的目标就决定了什么会发生。</p>
</div>
<div class="paragraph">
<p>有些目标列在 <span class="filename">Makefile</span> 里的，但并不意味着您要执行。相反，建立过程 (build process) 利用它们把重建系统的一些必要的步骤分割成几个子步骤。</p>
</div>
<div class="paragraph">
<p>大部分的时间不需要向 man:make[1] 传递参数，因此您的命令看起来可能象这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make target</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此处 <em>target</em> 表示的是若干编译选项。 多数情况下， 第一个 target 都应该是 <code>buildworld</code>。</p>
</div>
<div class="paragraph">
<p>正如名字所暗示的，<code>buildworld</code> 在 <span class="filename">/usr/obj</span> 下边建立了一个全新的树， 然后使用另一个 target， <code>installworld</code> 在当前的机器里安装它。</p>
</div>
<div class="paragraph">
<p>将这些选项分开有两个优点。 首先， 它允许您安全地完成建立 (build)， 而不对正在运行的系统的组件产生影响。 构建过程是 &#34;自主的 (self hosted)&#34;。 因为这样， 您可以安全地在以多用户模式运行的机器里执行 <code>buildworld</code> ，而不用当心不良影响。 但是依然推荐您在单用户模式时运行 <code>installworld</code>。</p>
</div>
<div class="paragraph">
<p>第二，允许您使用 NFS 挂接 (NFS mounts) 升级您网络里的多台计算机。如果您有三台 <code>A</code>、<code>B</code> 和 <code>C</code> 想进行升级，在<code>A</code> 执行 <code>make buildworld</code> 和 <code>make installworld</code>。 然后将 <code>A</code> 上的 <span class="filename">/usr/src</span> 和 <span class="filename">/usr/obj</span> 通过 NFS 挂接到 <code>B</code> 和 <code>C</code> 上， 接下来， 只需在 <code>B</code> 和 <code>C</code> 上使用 <code>make installworld</code> 来安装构建的结果就可以了。</p>
</div>
<div class="paragraph">
<p>尽管 <code>world</code> target 仍然存在，强烈建议您不要用它。</p>
</div>
<div class="paragraph">
<p>运行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make buildworld</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>我们提供了一个试验性的功能， 可以在构建过程中为 <code>make</code> 指定 <code>-j</code> 参数， 令其在构建过程中同时启动多个并发的进程。 对于多 CPU 的机器而言， 这样做有助于发挥其性能。 不过， 由于编译过程中的瓶颈主要是在 IO 而不是 CPU 上， 因此它也会对单 CPU 的机器带来好处。</p>
</div>
<div class="paragraph">
<p>对典型的单 CPU 机器， 可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -j4 buildworld</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样， man:make[1] 会最多同时启动 4 个进程。 从发到邮件列表中的经验看， 这样做能带来最佳的性能。</p>
</div>
<div class="paragraph">
<p>如果您使用的机器有多颗 CPU， 并且配置了 SMP 的内核， 也可以试试看 6 到 10 的数值， 并观察是否能带来构建性能上的改善。</p>
</div>
</div>
<div class="sect3">
<h4 id="_耗时">7.7.3. 耗时<a class="anchor" href="#_耗时"></a></h4>
<div class="paragraph">
<p>联编基本系统所需的时间会受到很多因素的影响， 不过， 较新的机器应该都能在一两个小时之内完成 FreeBSD-STABLE 源代码的构建， 而无须任何技巧或捷径。 完成 FreeBSD-CURRENT 源代码的联编， 则通常需要更长一些的时间。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="new-kernel">7.8. 编译和安装新内核<a class="anchor" href="#new-kernel"></a></h3>
<div class="paragraph">
<p>要充分利用您的新系统，您应该重新编译内核。 这是很有必要的，因为特定的内存结构已经发生了改变，像 man:ps[1] 和 man:top[1] 这样的程序会不能工作， 除非内核同源码树的版本是一样的。</p>
</div>
<div class="paragraph">
<p>最简单、最安全的方式是 build 并安装一个基于 <span class="filename">GENERIC</span> 的内核。虽然 <span class="filename">GENERIC</span> 可能没有适合您的系统的所有必要的设备， 但它包括了启动您的系统到单用户模式所必需的内容。 这是个不错的检测新系统是否工作正常的测试。在从 <span class="filename">GENERIC</span> 启动、核实系统可以工作后， 您就可以建立 (build) 一个基于您的正常内核配置文件的新的内核了。</p>
</div>
<div class="paragraph">
<p>在 FreeBSD 中， 首先完成 <a href="#make-buildworld">build world</a> 然后再编译新内核非常重要。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果您想建立一个定制内核，而且已经有了配置文件， 只需象这样使用 <code>KERNCONF=MYKERNEL：</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span>
<span class="c"># make buildkernel KERNCONF=MYKERNEL</span>
<span class="c"># make installkernel KERNCONF=MYKERNEL</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>注意，如果您已把 <code>内核安全级别(kern.securelevel)</code> 调高到了 1 以上，而且还设置了 <code>noschg</code> 或相似的标识到了您的内核二进制里边，您可能会发现转换到单用户模式里使用 <code>installkernel</code> 是很有必要的。 如果您没有设置它， 则应该也能毫无问题地在多用户模式执行这两个命令。 请参考 man:init[8] 以了解更多关于 <code>内核安全级(kern.securelevel)</code> 的信息；查看 man:chflags[1] 了解更多关于不同文件标识的信息。</p>
</div>
</div>
<div class="sect2">
<h3 id="new-kernel-singleuser">7.9. 重启到单用户模式<a class="anchor" href="#new-kernel-singleuser"></a></h3>
<div class="paragraph">
<p>您应该单用户模式测试新内核。照<a href="#makeworld-singleuser">改为单用户模式</a>处的说明去做。</p>
</div>
</div>
<div class="sect2">
<h3 id="make-installworld">7.10. 安装编译好的新系统<a class="anchor" href="#make-installworld"></a></h3>
<div class="paragraph">
<p>您现在应使用 <code>installworld</code> 来安装新的系统二进制。</p>
</div>
<div class="paragraph">
<p>执行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span>
<span class="c"># make installworld</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果在 <code>make buildworld</code> 的命令行指定了变量，您就必须在 <code>make installworld</code> 命令行里指定同样的变量。 对于其它的选项并不是必需的，如，<code>-j</code> 就不能同 <code>installworld</code> 一起使用。</p>
</div>
<div class="paragraph">
<p>举例，您执行了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -DNO_PROFILE buildworld</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您就必须使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -DNO_PROFILE installworld</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>来安装结果，否则就要试着安装先定 (profiled) 的在 <code>make buildworld</code> 阶段没有建立 (built) 的二进制文件。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="post-installworld-updates">7.11. 不是由 <code>make installworld</code> 更新的更新文件<a class="anchor" href="#post-installworld-updates"></a></h3>
<div class="paragraph">
<p>重新编译整个系统不会使用新的或改过的配置文件更新某些目录 (尤其像 <span class="filename">/etc</span>、<span class="filename">/var</span> 和 <span class="filename">/usr</span>)</p>
</div>
<div class="paragraph">
<p>更新这些文件最简单的方式就是使用 man:mergemaster[8]，手工去做也是可以的，只要您愿意。 不管您选择哪一种，一定记得备份 <span class="filename">/etc</span> 以防出错。</p>
</div>
<div class="sect3">
<h4 id="mergemaster">7.11.1. <code>mergemaster</code><a class="anchor" href="#mergemaster"></a></h4>
<div class="paragraph">
<p>man:mergemaster[8] 工具是个 Bourne 脚本，用于检测 <span class="filename">/etc</span> 和 <span class="filename">/usr/src/etc</span> 源码树里边的配置文件的不同点。 这是保持系统配置文件同源码树里的一起更新的推荐方式。</p>
</div>
<div class="paragraph">
<p>在提示符里简单地输入 <code>mergemaster</code> 就可以开始，并观看它的开始过程。<code>mergemaster</code> 会建立一个临时的根(root)环境，在 <span class="filename">/</span> 下， 放置各种系统配置文件。这些文件然后同当前安装到您系统里的进行比较。 此时，不同的文件会以 man:diff[1] 格式进行显示，使用 <code>+</code> 符号标识增加或修改的行，<code>-</code> 标识将完全删除的行或将被替换成新行。查看 man:diff[1] 手册可以得到更多关于 man:diff[1] 语法和文件不同点怎样显示的信息。</p>
</div>
<div class="paragraph">
<p>man:mergemaster[8] 会给您显示每个文件的不同处， 这样您就可以选择是删除新文件 (相对临时文件)， 是以未改状态安装临时文件，是以当前安装的文件合并临时文件， 还是再看一次 man:diff[1] 结果。</p>
</div>
<div class="paragraph">
<p>&#34;选择删除临时文件&#34;将使 man:mergemaster[8] 知道我们希望保留我们当前的文件不改，并删除新的。 并不推荐这个选择，除非您没有更改当前文件的理由。任何时候在 man:mergemaster[8] 提示符里输入 <kbd>?</kbd>，您就会得到帮助。 如果选择跳过文件，将在其它文件处理完后再次进行。</p>
</div>
<div class="paragraph">
<p>&#34;选择安装未修改临时文件&#34;将会使新文件替换当前的。 对大部分未改的文件，这是个最好的选择。</p>
</div>
<div class="paragraph">
<p>&#34;选择合并文件&#34;将为您打开一个文本编辑器， 里边是两个文件的内容。您现在就可以一边合并它们， 一边在屏幕里查看，同时从两者中选取部分生成最终文件。 当两个文件一起比较时，<kbd>l</kbd> 键会选择左边的内容， <kbd>r</kbd> 会选择右边的。最终的输出是由两个部分组成的一个文件， 用它就可以安装了。这个选项通常用于用户修改了设置的文件。</p>
</div>
<div class="paragraph">
<p>&#34;选择再次查看 man:diff[1] 结果&#34;将会在提供给选择之前， 显示文件的不同处，就象 man:mergemaster[8] 所做的一样。</p>
</div>
<div class="paragraph">
<p>在 man:mergemaster[8] 完成了对系统文件的处理后， 您会得到其它的选项。man:mergemaster[8] 可能会问您是否要重建密码文件， 并在最后提示您是否要删除余下的临时文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_手动更新">7.11.2. 手动更新<a class="anchor" href="#_手动更新"></a></h4>
<div class="paragraph">
<p>如果想要手工更新，但不要只是从 <span class="filename">/usr/src/etc</span> 把文件复制到 <span class="filename">/etc</span> 就了事。有些文件是必须先&#34;安装&#34;的。 这是因为 <span class="filename">/usr/src/etc</span> 目录并 <em>不是</em> 想像的那样是 <span class="filename">/etc</span> 目录的一个复制。事实上，有些是文件是 <span class="filename">/etc</span> 有的，而 <span class="filename">/usr/src/etc</span> 里边没有。</p>
</div>
<div class="paragraph">
<p>如果您使用 man:mergemaster[8] (作为推荐)，您可以向前跳到 <a href="#updating-upgrading-rebooting">下一节</a>。</p>
</div>
<div class="paragraph">
<p>手工做最简单的方式是安装这些文件到一个新的目录，完成后再来查找不同处。</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">备份您已有的 <span class="filename">/etc</span></div>
<div class="paragraph">
<p>虽然，理论上，没有什么会自动访问这个目录， 事情还是做稳操胜当一点。复制已有 <span class="filename">/etc</span> 到一个安全的地方，如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cp -Rp /etc /etc.old</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-R</code> 完成递归复制 (译者注：即可以复制目录以下的所有内容)，<code>-p</code> 保留文件的时间、所属等等。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>您需要建立一个虚目录 (a dummy set of directories) 来安装新的 <span class="filename">/etc</span> 和其它文件。 <span class="filename">/var/tmp/root</span> 是个不错的选择， 除此之外，还有一些子目录是需要的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /var/tmp/root</span>
<span class="c"># cd /usr/src/etc</span>
<span class="c"># make DESTDIR=/var/tmp/root distrib-dirs distribution</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就建好了需要的目录结构，然后安装文件。在 <span class="filename">/var/tmp/root</span> 下建立的大部分子目录是空的， 而且要删除掉。最简单的方式是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /var/tmp/root</span>
<span class="c"># find -d . -type d | xargs rmdir 2&gt;/dev/null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样会删除所有的空目录。(标准的错误信息被重定向到了 <span class="filename">/dev/null</span>，以防止关于非空目录的警告。)</p>
</div>
<div class="paragraph">
<p><span class="filename">/var/tmp/root</span> 现在包含了应放在 <span class="filename">/</span> 下某个位置的所有文件。 您现在必须仔细检查每一个文件，检测它们与您已有的文件有多大不同。</p>
</div>
<div class="paragraph">
<p>注意，有些已经安装在 <span class="filename">/var/tmp/root</span> 下的文件有个&#34;.&#34;在开头。在写的时候，像这样唯一的文件是 <span class="filename">/var/tmp/root/</span> 和 <span class="filename">/var/tmp/root/root/</span> 里 shell 启动文件，尽管可能有其它的(依赖于您什么时候读取这个)。 确信使用 <code>ls -a</code> 可以看到它们。</p>
</div>
<div class="paragraph">
<p>最简单的方式是使用 man:diff[1] 去比较两个文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># diff /etc/shells /var/tmp/root/etc/shells</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会显示出 <span class="filename">/etc/shells</span> 文件和新的 <span class="filename">/var/tmp/root/etc/shells</span> 文件的不同处。 用这些来决定是合并您已做的变化还是复制您的旧文件过来。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">使用日戳 (Time Stamp) 命名新的 Root(根)目录(<span class="filename">/var/tmp/root</span>)，这样您可以轻松地比较两个版本的不同</div>
<div class="paragraph">
<p>频繁重建系统意味着必须频繁更新 <span class="filename">/etc</span>，而这可能会有点烦琐。</p>
</div>
<div class="paragraph">
<p>在合并到 <span class="filename">/etc</span> 的文件里， 最新更改的您可以做个复制，由此加快这个(指更新)过程。 下边就给出了一个怎样做的主意。</p>
</div>
<div class="exampleblock procedure">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>像平常一样建立系统 (Make the world)。当您想更新 <span class="filename">/etc</span> 和其它目录里， 给目标目录一个含有当前日期的名字。假如您是 1998 年 2 月 14 日做的，您可以执行下边的：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /var/tmp/root-19980214</span>
<span class="c"># cd /usr/src/etc</span>
<span class="c"># make DESTDIR=/var/tmp/root-19980214 \</span>
    distrib-dirs distribution</code></pre>
</div>
</div>
</li>
<li>
<p>如上边列出的，从这个目录合并变化。</p>
<div class="paragraph">
<p>在您完成后，<em>不要</em> 删除 <span class="filename">/var/tmp/root-19980214</span> 目录。</p>
</div>
</li>
<li>
<p>在您下载了最新版的源码并改过后，执行第一步。 这样将得到一个新的目录，可能叫做 <span class="filename">/var/tmp/root-19980221</span> (如果等了一周做的升级)。</p>
</li>
<li>
<p>您现在能看到两个目录间的不同了---在隔周的时间里使用 man:diff[1] 建立递归 diff 产生的不同：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /var/tmp</span>
<span class="c"># diff -r root-19980214 root-19980221</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>一般情况下，这两种间的不同处比 <span class="filename">/var/tmp/root-19980221/etc</span> 和 <span class="filename">/etc</span> 之间的不同要小很多。 因为不同点更小，也就更容易把这些变化移到您的 <span class="filename">/etc</span> 目录里边。</p>
</div>
</li>
<li>
<p>您现在可以删除早先的两个 <span class="filename">/var/tmp/root-*</span> 目录：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># rm -rf /var/tmp/root-19980214</span></code></pre>
</div>
</div>
</li>
<li>
<p>每次您需要合并这些变化到 <span class="filename">/etc</span> 里，就重复这个流程。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>您可以使用 man:date[1] 自动产生目录的名称：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /var/tmp/root-`date &#34;+%Y%m%d&#34;`</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-upgrading-rebooting">7.12. 重启<a class="anchor" href="#updating-upgrading-rebooting"></a></h3>
<div class="paragraph">
<p>现在完成了。在您检查所有内容都放置正确后， 您可以重启系统了。只是简单的 man:shutdown[8] 可以这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># shutdown -r now</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_结束">7.13. 结束<a class="anchor" href="#_结束"></a></h3>
<div class="paragraph">
<p>恭喜！您现在成功升级了您的 FreeBSD 系统。</p>
</div>
<div class="paragraph">
<p>如果还有轻微的错误，可以轻易地重建系统的选定部分。 例如，在部分升级或合并 <span class="filename">/etc</span> 时，您不小心删除了 <span class="filename">/etc/magic</span>，man:file[1] 命令就会停止工作。这种情况下，执行下边进行修复：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src/usr.bin/file</span>
<span class="c"># make all install</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-questions">7.14. 问题<a class="anchor" href="#updating-questions"></a></h3>
<div class="sect3">
<h4 id="_每个变化您都须要重建系统吗">7.14.1. 每个变化您都须要重建系统吗？<a class="anchor" href="#_每个变化您都须要重建系统吗"></a></h4>
<div class="paragraph">
<p>这个不好说，因为要看变化的情况。如，如果您刚运行了 CVSup，并得到下边更新的文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">src/games/cribbage/instr.c
src/games/sail/pl_main.c
src/release/sysinstall/config.c
src/release/sysinstall/media.c
src/shared/mk/bsd.port.mk</code></pre>
</div>
</div>
<div class="paragraph">
<p>这就不必重建整个系统。您只需到相关的子目录里执行 <code>make all install</code>，仅此而已。 但是，如果有重大变化，如 <span class="filename">src/lib/libc/stdlib</span>， 那么您就要重建系统或至少静态连接的那些部分 (除了您增加的部分都是静态连接的)。</p>
</div>
<div class="paragraph">
<p>在这天后，就是您的事了。要是说每两个星期重建一下系统的话， 您可能会高兴。或者您可能只想重做改变过的部分， 确信您能找出所有依赖关系。</p>
</div>
<div class="paragraph">
<p>当然，所有这些依赖于您想升级的频率，和您是否想跟踪 FreeBSD-STABLE 或 FreeBSD-CURRENT。</p>
</div>
</div>
<div class="sect3">
<h4 id="_我的编译失败并伴随有许多_11信号_11_或其它的数字信息_号错误是怎么回事呀">7.14.2. 我的编译失败，并伴随有许多 11信号 11 (或其它的数字信息) 号错误。是怎么回事呀？<a class="anchor" href="#_我的编译失败并伴随有许多_11信号_11_或其它的数字信息_号错误是怎么回事呀"></a></h4>
<div class="paragraph">
<p>这个通常表示硬件错误。 (重)建系统是个强压测试系统硬件的有效地方式， 并且常常产生内存错误。 这些正好表示它们自已做为编译器离奇地死于收到的奇怪信息。</p>
</div>
<div class="paragraph">
<p>一个确信的指示器是如果重新开始 make，并且整个过程中会死在不同的点上。</p>
</div>
<div class="paragraph">
<p>对于这种情况，您没有什么可做的，除了更换机器里的部件，看是哪一个坏了。</p>
</div>
</div>
<div class="sect3">
<h4 id="_我完成后可以删除_usrobj_吗">7.14.3. 我完成后可以删除 /usr/obj 吗？<a class="anchor" href="#_我完成后可以删除_usrobj_吗"></a></h4>
<div class="paragraph">
<p>简短地说，可以。</p>
</div>
<div class="paragraph">
<p><span class="filename">/usr/obj</span> 包含了所有在编译阶段生成的目标文件。通常， 在 <code>make buildworld</code> 过程中第一步之一就是删除这个目录重新开始。 这种情况下，在您完成后，保留 <span class="filename">/usr/obj</span> 没有多大意义，还可释放一大堆磁盘空间(目前是 2 GB 左右)。</p>
</div>
<div class="paragraph">
<p>不过， 如果您很了解整个过程， 也可以让 <code>make buildworld</code> 跳过这一步。 这会让后续的联编过程执行得更快， 因为大部分的源码都不必再进行编译了。 这样做的负面效果是它可能会触发一些由于敏感的依赖关系导致的问题， 这些问题会导致联编以奇怪的方式出错并失败。 这在 FreeBSD 邮件列表里经常引起沸腾， 当有人抱怨他们 build 失败时，并没意识到这是因为自已是想抄近路。</p>
</div>
</div>
<div class="sect3">
<h4 id="_中断的_build_可以被恢复吗">7.14.4. 中断的 build 可以被恢复吗？<a class="anchor" href="#_中断的_build_可以被恢复吗"></a></h4>
<div class="paragraph">
<p>依赖于您在您找到问题之前整个过程进行了多远。</p>
</div>
<div class="paragraph">
<p><em>一般而言</em> (当然这并不是硬性规定)， <code>make buildworld</code> 的过程中将会首先构建新版的基本构建工具 (例如 man:gcc[1]， 以及 man:make[1]) 和系统库。 随后会安装这些工具和库。 这些新版本的工具和库在随后将被用于重新编译和连接它们本身。 整个系统 (现在包括了常规的用户程序， 例如 man:ls[1] 或 man:grep[1]) 会同新版的系统文件一起被重新构建。</p>
</div>
<div class="paragraph">
<p>如果您正处于最后一个阶段， 并且了解它 (因为您已经看过了所保存的输出) 则可以 (相当安全地) 做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">… 问题修复 …
<span class="c"># cd /usr/src</span>
<span class="c"># make -DNO_CLEAN all</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这样就不会取消先前的 <code>make buildworld</code> 所做的工作了。</p>
</div>
<div class="paragraph">
<p>在&#34;make buildworld&#34;的输出中如果看到如下信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nt">--------------------------------------------------------------</span>
Building everything..
<span class="nt">--------------------------------------------------------------</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>出现在 <code>make buildworld</code> 的输出中， 则这样做应该不会有什么问题。</p>
</div>
<div class="paragraph">
<p>如果没有看到这样的信息， 或者您不确定， 则从头开始构建将是万无一失的做法。</p>
</div>
</div>
<div class="sect3">
<h4 id="_我怎样加快建立系统的速度">7.14.5. 我怎样加快建立系统的速度？<a class="anchor" href="#_我怎样加快建立系统的速度"></a></h4>
<div class="ulist">
<ul>
<li>
<p>以单用户模式运行</p>
</li>
<li>
<p>把 <span class="filename">/usr/src</span> 和 <span class="filename">/usr/obj</span> 目录放到不同磁盘里的独立文件系统里。如果可能，这些磁盘在不同的磁盘控制器里。</p>
</li>
<li>
<p>更好的，是把这些文件系统放置到多个使用 man:ccd[4] (连接磁盘驱动器—​concatenated disk driver)设备的磁盘里。</p>
</li>
<li>
<p>关掉 profiling (在 <span class="filename">/etc/make.conf</span> 里设置 &#34;NO_PROFILE=true&#34;)。您差不多用不了它。</p>
</li>
<li>
<p>在 <span class="filename">/etc/make.conf</span> 里也为 <code>CFLAGS</code> 设置上 <code>-O -pipe</code>。 最佳优化 <code>-O2</code> 会更慢，而且 <code>-O</code> 和 <code>-O2</code> 之间的优化差别基本上可以忽略。 <code>-pipe</code> 让编译器使用管道而不用临时文件进行通信， 这样可以减少磁盘存取 (以内存作为代价)。</p>
</li>
<li>
<p>传递 <code>-j<em>n</em></code> 选项给 man:make[1] 以便并发运行多个进程。 这样就不会考虑您的是否是单个或多个处理器机器。</p>
</li>
<li>
<p>存放 <span class="filename">/usr/src</span> 的文件系统可以使用 <code>noatime</code> 选项来挂接 (或重新挂接)。 这样会防止文件系统记录文件的存取时间。 您可能并不需要这些信息。</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount -u -o noatime /usr/src</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这个例子里假定 <span class="filename">/usr/src</span> 是在它自已的文件系统里。如果不是 (例如假设它是 <span class="filename">/usr</span> 的部分)，那么您就需要那个文件系统挂接点， 而不是 <span class="filename">/usr/src</span>。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>存放 <span class="filename">/usr/obj</span> 的文件系统可以使用 <code>async</code> 选项被挂接 (或重新挂接)。 这样做将启用异步写盘。 换句话说， 对应用程序而言写会立即完成， 而数据则延迟几秒才会写到盘里。 这样做能够成批地写下数据， 从而极大地改善性能。</p>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>注意， 这个选项会使您的文件系统变得脆弱。 使用这个选项会提高在电源断掉或机器非正常重启时， 文件系统进入不可恢复状态的概率。</p>
</div>
<div class="paragraph">
<p>如果在这个文件系统里 <span class="filename">/usr/obj</span> 是很关键的，这不是问题。如果您有其它有价值的数据在同一个文件系统， 那么在您使用这个选项这前，确认备份一下。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount -u -o async /usr/obj</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>同上，如果 <span class="filename">/usr/obj</span> 不在自已的文件系统里，使用相关挂接点的名字把它从例子里边替换掉。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_如果出现了错误我该怎么办">7.15. 如果出现了错误我该怎么办？<a class="anchor" href="#_如果出现了错误我该怎么办"></a></h3>
<div class="paragraph">
<p>绝对确信您的环境没有先前 build 留下的残余。这点够简单。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chflags -R noschg /usr/obj/usr</span>
<span class="c"># rm -rf /usr/obj/usr</span>
<span class="c"># cd /usr/src</span>
<span class="c"># make cleandir</span>
<span class="c"># make cleandir</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>不错，<code>make cleandir</code> 真的要执行两次。</p>
</div>
<div class="paragraph">
<p>然后重新开始整个过程，使用 <code>make buildworld</code> 开始。</p>
</div>
<div class="paragraph">
<p>如果您还有问题，就把错误和 <code>uname -a</code> 的输出发送到 <a href="https://lists.FreeBSD.org/subscription/freebsd-questions">FreeBSD 一般问题邮件列表</a> 邮件列表。准备回答其它关于您的设置的问题！</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="make-delete-old">8. 删除过时的文件、 目录和函数库<a class="anchor" href="#make-delete-old"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 FreeBSD 的开发过程中， 随时可能会出现一些文件或其内容过时的情况。 这种情况有可能是由于其功能在其它地方实现了， 函数库的版本号增加， 或完全从基本系统中删去， 等等。 一般的联编和更新过程并不会删去这些旧的文件、 函数库或目录， 在更新系统之后， 应及时予以清理。 清理的好处是这些文件不会再继续占用存储 (以及备份) 空间， 另外， 如果旧的函数库或文件中存在安全或可靠性问题， 您也应更新到新的函数库， 以避免安全隐患或崩溃情形的发生。 过时的文件、 目录和函数库会列在 <span class="filename">/usr/src/ObsoleteFiles.inc</span> 中。 接下来将介绍在系统更新过程中如何删去这些过时的文件。</p>
</div>
<div class="paragraph">
<p>我们假定您已经按照 <a href="#canonical-build">更新系统的规范方法</a> 介绍的步骤完成了更新操作。 在 <code>make installworld</code> 和 <code>mergemaster</code> 命令完成之后， 您应使用下面的命令检查系统中是否存在过时的文件或库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /usr/src</span>
<span class="c"># make check-old</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果有过时的文件， 则可以用下面的命令来删除：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make delete-old</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>参阅 <span class="filename">/usr/src/Makefile</span> 可以了解其他 target 的功用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在删除文件时， 系统会针对每个文件都给出提示。 您可以跳过这些提示， 并让系统自动完成删除操作， 方法是使用 make 变量 <code>BATCH_DELETE_OLD_FILES</code>， 具体做法如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make -DBATCH_DELETE_OLD_FILES delete-old</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您也可以用 <code>yes</code> 命令和管道来达到类似的目的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># yes|make delete-old</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>删去过时的文件， 有可能会破坏现有的依赖这些文件的应用程序。 对于旧的函数库来说， 这种问题出现的可能性更大。 绝大多数情况下， 您应重新联编使用旧库的所有的程序、 port 或函数库之后再执行 <code>make delete-old-libs</code>。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>在 Ports Collection 中提供了一些检测动态连接库依赖关系的工具， 例如 package:sysutils/libchk[] 和 package:sysutils/bsdadminscripts[]。</p>
</div>
<div class="paragraph">
<p>过时的动态连接库可能会与新库冲突， 导致类似这样的警告消息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">/usr/bin/ld: warning: libz.so.4, needed by /usr/local/lib/libtiff.so, may conflict with libz.so.5
/usr/bin/ld: warning: librpcsvc.so.4, needed by /usr/local/lib/libXext.so, may conflict with librpcsvc.so.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>要解决这样的问题， 需要确认安装这个库的 port：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg_info -W  /usr/local/lib/libtiff.so</span>
/usr/local/lib/libtiff.so was installed by package tiff-3.9.4
<span class="c"># pkg_info -W /usr/local/lib/libXext.so</span>
/usr/local/lib/libXext.so was installed by package libXext-1.1.1,1</code></pre>
</div>
</div>
<div class="paragraph">
<p>接着卸载、 重新联编并安装 port。 您可以使用 package:ports-mgmt/portmaster[] 或 package:ports-mgmt/portupgrade[] 工具来自动完成这些操作。 在确认所有的 port 都重新联编， 并且不再使用旧库以后， 您就可以用下面的命令来删除它们了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># make delete-old-libs</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="small-lan">9. 跟踪多台机器<a class="anchor" href="#small-lan"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果您有多台机器想跟踪同样的源码树， 那么让它们都下载源码并重建所有东西，看起有点浪费资源： 磁盘空间、网络带宽以及 CPU 周期。 解决的办法是让一台机器处理大部分的工作，而其它的机器通过 NFS 挂接 (mount) 这些工作。这部分列举了一种这样做的方法。</p>
</div>
<div class="sect2">
<h3 id="small-lan-preliminaries">9.1. 准备<a class="anchor" href="#small-lan-preliminaries"></a></h3>
<div class="paragraph">
<p>首先，确定一批机器，运行的二进制代码是同一套---我们称作 <em>构建集群 (build set)</em>。 每台机器可以使用不同的定制内核， 但它们运行的是相同的用户区二进制文件(userland binaries)。 从这批机器中选择一台机器做为 <em>构建机器(build machine)</em>。 这将是用于构建(build)系统和内核的机器。想像一下，它应该是一台快速的机器， 有足够的空余的 CPU 来执行<code>make buildworld</code>。 您也想要选一台机器做为 <em>测试机器(test machine)</em>， 这个将用于软件的更新生成产品之前对他们进行测试。这个 <em>必须</em> 是一台您能提供的平时也可使用的机器。 它可以是&#34;构建机器&#34;，但没这个必要。</p>
</div>
<div class="paragraph">
<p>在这个&#34;构建集群&#34;里的所有机器需要从同一台机器、 同一个点上挂接 <span class="filename">/usr/obj</span> 和 <span class="filename">/usr/src</span>。理想地， 它们在&#34;构建机器&#34;上的两个不同的驱动器里， 但是在那台机器上可以进行 NFS 挂接。如果您有多个&#34;构建集群&#34;， <span class="filename">/usr/src</span> 应该在某个&#34;构建机器&#34;上， 而在其它机器上进行 NFS 挂接。</p>
</div>
<div class="paragraph">
<p>最后，确认&#34;构建集群&#34;里所有机器上的 <span class="filename">/etc/make.conf</span> 和 <span class="filename">/etc/src.conf</span> 与&#34;构建机器&#34;里的相同。 这意味着&#34;构建机器&#34;必须构建部分基本系统用于 &#34;构建集群&#34;里所有机器的安装。同样， 每台&#34;构建机器&#34;要有它自已的内核名字，使用 <span class="filename">/etc/make.conf</span> 里的 <code>KERNCONF</code> 进行设置，并且每台&#34;构建机器&#34;应该把它们列在 <code>KERNCONF</code> 里，同时把自已的内核列在最前。 &#34;构建机器&#34;的 <span class="filename">/usr/src/sys/arch/conf</span> 里一定要有每台机器的内核配置文件，如果它想构建它们的内核的话。</p>
</div>
</div>
<div class="sect2">
<h3 id="small-lan-base-system">9.2. 基本系统<a class="anchor" href="#small-lan-base-system"></a></h3>
<div class="paragraph">
<p>既然所有的妥当了，就准备构建所有的东西。如<a href="#make-buildworld">编译基本系统</a>中描述的一样在&#34;构建机器&#34;上构建内核和系统， 但是什么也不安装。在构建结束后，转到&#34;测试机器&#34;上， 安装您刚构建的内核。如果这台机器通过 NFS 挂接了 <span class="filename">/usr/src</span> 和 <span class="filename">/usr/obj</span>， 在您重启到单用户模式里，您需要启动网络然后挂接他们。 最简单的方式是启动到多用户模式下，然后执行 <code>shutdown now</code> 转到单用户模式。一旦进入，您就可以安装新的内核和系统，并执行 <code>mergemaster</code>，就像平常一样。完成后， 重启返回到一般多用户模式操作这台机器。</p>
</div>
<div class="paragraph">
<p>在您确信所有在 &#34;测试机&#34;里都工作正常后， 就使用相同的过程在 &#34;构建集群&#34;里的其它机器里安装新的软件。</p>
</div>
</div>
<div class="sect2">
<h3 id="small-lan-ports">9.3. Ports<a class="anchor" href="#small-lan-ports"></a></h3>
<div class="paragraph">
<p>类似的想法是使用 ports 树。 第一个关键的步骤是从同一台计算机上挂接 <span class="filename">/usr/ports</span> 到 &#34;构建集群&#34; 里的全部计算机。 然后正确设置 <span class="filename">/etc/make.conf</span> 共享 distfiles。您应把 <code>DISTDIR</code> 设置到一个共享的目录里， 那里可以被任何一个 <code>root</code> 用户写入， 并且是由您的 NFS 挂接映射的。 设置每一台机器的 <code>WRKDIRPREFIX</code> 到一个本地构建 (build) 目录。最后，如果您要构建和发布包 (packages)，那么您应该设置 <code>PACKAGES</code> 到一个类似于 <code>DISTDIR</code> 的目录。</p>
</div>
</div>
</div>
</div>

    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=http://127.0.0.1:5500/zh-cn/books/handbook/l10n class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=http://127.0.0.1:5500/zh-cn/books/handbook/dtrace  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#updating-upgrading-synopsis">1. 概述</a></li>
    <li><a href="#updating-upgrading-freebsdupdate">2. FreeBSD 更新</a></li>
    <li><a href="#updating-upgrading-portsnap">3. Portsnap： 一个 Ports Collection 更新工具</a></li>
    <li><a href="#updating-upgrading-documentation">4. 更新系统附带的文档</a></li>
    <li><a href="#current-stable">5. 追踪开发分支</a></li>
    <li><a href="#synching">6. 同步您的源码</a></li>
    <li><a href="#makeworld">7. 重新编译 &#34;world&#34;</a></li>
    <li><a href="#make-delete-old">8. 删除过时的文件、 目录和函数库</a></li>
    <li><a href="#small-lan">9. 跟踪多台机器</a></li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="http://127.0.0.1:5500/zh-cn/languages">
                
                <img src="/images/language.png" class="language-image" alt="Choose language">
                <span>简体中文</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2023 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
