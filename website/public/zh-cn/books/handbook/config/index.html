<!DOCTYPE html>
<html class="theme-light" lang="zh-cn">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=""/>
  <meta name="keywords" content=""/>
  <meta name="copyright" content="1995-2023 The FreeBSD Foundation" />
  <link rel="canonical" href="http://127.0.0.1:5500/zh-cn/books/handbook/config/" />

  <title>第 12 章 设置和调整 |  FreeBSD Documentation Portal</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>

  
  
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.FreeBSD.org"/>
    <meta name="twitter:site" content="@freebsd"/>
    <meta name="twitter:url" content="https://twitter.com/freebsd"/>
    <meta property="og:title" content="第 12 章 设置和调整" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="http://127.0.0.1:5500favicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="zh-cn" />
    <meta property="og:url" content="http://127.0.0.1:5500/zh-cn/books/handbook/config/" />
    <meta property="og:site_name" content="FreeBSD Documentation Portal" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "http:\/\/127.0.0.1:5500\/zh-cn\/books\/handbook\/config\/",
        "name": "FreeBSD Documentation Portal",
        "headline": "FreeBSD Documentation Portal",
        "description": "FreeBSD Documentation Portal"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="http://127.0.0.1:5500" class="logo">
        <img src="/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="Search" aria-label="Search" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/">
              前言
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-audience">预期的读者</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes-from3">相对于第三版的改动</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes-from2">相对于第二版的改动 (2004)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-changes">相对于第一版的改变 (2001)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-overview">本手册的组织</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-conv">本书中使用的一些约定</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/preface/#preface-acknowledgements">致谢</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/parti/">
              部分 I. 起步
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/">
              第 1 章 介绍
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#introduction-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#nutshell">2. 欢迎来到 FreeBSD 的世界!</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/introduction/#history">3. 关于 FreeBSD 项目</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6655173739803bf0920b92a7fe8a363d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6655173739803bf0920b92a7fe8a363d"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/">
              第 2 章 安装 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-hardware">2. 硬件需求</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-pre">3. 安装前的准备工作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-start">4. 开始安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#using-sysinstall">5. 介绍 Sysinstall</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-steps">6. 分配磁盘空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-choosing">7. 选择要安装的软件包</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-media">8. 选择您要使用的安装介质</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-final-warning">9. 安装确认</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-post">10. 安装后的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-trouble">11. 常见问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-advanced">12. 高级安装指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/install/#install-diff-media">13. 准备您自己的安装介质</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/">
              第 3 章 安装 FreeBSD（适用于 9.x 及以后版本）
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-hardware">2. 硬件需求</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-pre">3. 安装前的准备工作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-start">4. 开始安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#using-bsdinstall">5. 介绍 bsdinstall</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-netinstall">6. 通过网络安装</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-partitioning">7. 分配磁盘空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-final-warning">8. 安装确认</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-post">9. 安装后的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bsdinstall/#bsdinstall-install-trouble">10. 故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/">
              第 4 章 UNIX 基础
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#consoles">2. 虚拟控制台和终端</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#permissions">3. 权限</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#dirstructure">4. 目录架构</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#disk-organization">5. 磁盘组织</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#mount-unmount">6. 文件系统的挂接和卸下</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-processes">7. 进程</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-daemons">8. 守护进程，信号和杀死进程</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#shells">9. Shells</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#editors">10. 文本编辑器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-devices">11. 设备和设备节点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#binary-formats">12. 二进制文件格式</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/basics/#basics-more-information">13. 取得更多的资讯</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/">
              第 5 章 安装应用程序: Packages 和 Ports
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-overview">2. 软件安装预览</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-finding-applications">3. 寻找您要的应用程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#packages-using">4. 使用 Package 系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-using">5. 使用Ports Collection</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-nextsteps">6. 安装之后还要做点什么？</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ports/#ports-broken">7. 如何处理坏掉的 Ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/">
              第 6 章 X Window 系统
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x11-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-understanding">2. 理解 X</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-install">3. 安装 X11</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-config">4. 配置 X11</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-fonts">5. 在 X11 中使用字体</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x-xdm">6. X 显示管理器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/x11/#x11-wm">7. 桌面环境</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partii/">
              部分 II. 常见的任务
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/">
              第 7 章 桌面应用
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-browsers">2. 浏览器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-productivity">3. 办公、图象处理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-viewers">4. 文档查看器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-finance">5. 财务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/desktop/#desktop-summary">6. 总结</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/">
              第 8 章 多媒体
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#multimedia-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#sound-setup">2. 安装声卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#sound-mp3">3. MP3音频</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#video-playback">4. 视频回放</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#tvcard">5. 安装电视卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/multimedia/#scanners">6. 图象扫描仪</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/">
              第 9 章 配置FreeBSD的内核
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-custom-kernel">2. 为什么需要建立定制的内核?</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-devices">3. 发现系统硬件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-modules">4. 内核驱动，子系统和模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-building">5. 建立并安装一个定制的内核</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-config">6. 配置文件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/kernelconfig/#kernelconfig-trouble">7. 如果出现问题怎么办</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/">
              第 10 章 打印
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-intro-spooler">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-intro-setup">3. 基本设置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-advanced">4. 高级设置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-using">5. 使用打印机</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-lpd-alternatives">6. 替换标准后台打印</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/printing/#printing-troubleshooting">7. 疑难问题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/">
              第 11 章 Linux® 二进制兼容模式
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-lbc-install">2. 配置 Linux® 二进制兼容模式</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/linuxemu/#linuxemu-advanced">3. 高级主题</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partiii/">
              部分 III. 系统管理
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/">
              第 12 章 设置和调整
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#config-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-initial">2. 初步配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-core-configuration">3. 核心配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-appconfig">4. 应用程序配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-starting-services">5. 启动服务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-cron">6. 配置 <code>cron</code></a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-rcd">7. 在 FreeBSD 中使用 rc</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#config-network-setup">8. 设置网卡</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-virtual-hosts">9. 虚拟主机</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-configfiles">10. 配置文件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-sysctl">11. 用 sysctl 进行调整</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-disk">12. 调整磁盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#configtuning-kernel-limits">13. 调整内核限制</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#adding-swap-space">14. 添加交换空间</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#acpi-overview">15. 电源和资源管理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/config/#ACPI-debug">16. 使用和调试 FreeBSD ACPI</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/">
              第 13 章 FreeBSD 引导过程
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-introduction">2. 引导问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-blocks">3. 引导管理器和各引导阶段</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-kernel">4. 内核在引导时的交互</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#device-hints">5. Device Hints</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-init">6. Init：进程控制及初始化</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/boot/#boot-shutdown">7. 关机 (shutdown) 过程</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-17a53b356b407d9ed656b7babd2efa34" class="toggle"  />
          <label  class="icon cursor"  for="chapter-17a53b356b407d9ed656b7babd2efa34"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/">
              第 14 章 用户和基本的帐户管理
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-introduction">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-superuser">3. 超级用户帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-system">4. 系统帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-user">5. 用户帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-modifying">6. 修改帐户</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-limiting">7. 限制用户使用系统资源</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/users/#users-groups">8. 组</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/">
              第 15 章 安全
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-intro">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#securing-freebsd">3. 确保 FreeBSD 的安全</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#crypt">4. DES、 Blowfish、 MD5， 以及 Crypt</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#one-time-passwords">5. 一次性口令</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#tcpwrappers">6. TCP Wrappers</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#kerberos5">7. Kerberos5</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#openssl">8. OpenSSL</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#ipsec">9. IPsec 上的 VPN</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#openssh">10. OpenSSH</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#fs-acl">11. 文件系统访问控制表</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-portaudit">12. 监视第三方安全问题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-advisories">13. FreeBSD 安全公告</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/security/#security-accounting">14. 进程记帐</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/">
              第 16 章 Jails
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-terms">2. 与 Jail 相关的一些术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-intro">3. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-build">4. 建立和控制 jail</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-tuning">5. 微调和管理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/jails/#jails-application">6. Jail 的应用</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/">
              第 17 章 强制访问控制
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-synopsis">1. 概要</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-inline-glossary">2. 本章出现的重要术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-initial">3. 关于 MAC 的说明</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-understandlabel">4. 理解 MAC 标签</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-planning">5. 规划安全配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-modules">6. 模块配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-seeotheruids">7. MAC seeotheruids 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-bsdextended">8. MAC bsdextended 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-ifoff">9. MAC ifoff 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-portacl">10. MAC portacl 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-partition">11. MAC partition (分区) 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-mls">12. MAC 多级 (Multi-Level) 安全模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-biba">13. MAC Biba 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-lomac">14. MAC LOMAC 模块</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-implementing">15. MAC Jail 中的 Nagios</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-userlocked">16. User Lock Down</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mac/#mac-troubleshoot">17. MAC 框架的故障排除</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/">
              第 18 章 安全事件审计
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-inline-glossary">2. 本章中的一些关键术语</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-install">3. 安装审计支持</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-config">4. 对审计进行配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/audit/#audit-administration">5. 管理审计子系统</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/">
              第 19 章 存储
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-naming">2. 设备命名</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-adding">3. 添加磁盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#raid">4. RAID</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#usb-disks">5. USB 存储设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#creating-cds">6. 创建和使用光学介质(CD)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#creating-dvds">7. 创建和使用光学介质(DVD)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#floppies">8. 创建和使用软盘</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backups-tapebackups">9. 用磁带机备份</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backups-floppybackups">10. 用软盘备份</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backup-strategies">11. 备份策略</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#backup-basics">12. 备份程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-virtual">13. 网络、内存和 和以及映像文件为介质的虚拟文件系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#snapshots">14. 文件系统快照</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#quotas">15. 文件系统配额</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-encrypting">16. 加密磁盘分区</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#swap-encrypting">17. 对交换区进行加密</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/disks/#disks-hast">18. 高可用性存储 (HAST)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/">
              第 20 章 GEOM: 模块化磁盘变换框架
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-intro">2. GEOM 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-striping">3. RAID0 - 条带</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-mirror">4. RAID1 - 镜像</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#GEOM-raid3">5. RAID3 - 使用专用校验设备的字节级条带</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-ggate">6. GEOM Gate 网络设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-glabel">7. 为磁盘设备添加卷标</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/geom/#geom-gjournal">8. 通过 GEOM 实现 UFS 日志</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/">
              第 21 章 文件系统 Support
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/#filesystems-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/filesystems/#filesystems-zfs">2. Z 文件系统 (ZFS)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-11d260f2685c0b17137e64887e1b1989" class="toggle"  />
          <label  class="icon cursor"  for="chapter-11d260f2685c0b17137e64887e1b1989"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/">
              第 22 章 Vinum 卷管理程序
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-intro">2. 磁盘容量太小</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-access-bottlenecks">3. 访问瓶颈</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-data-integrity">4. 数据的完整性</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-objects">5. Vinum 目标</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-examples">6. 一些例子</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-object-naming">7. 对象命名</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-config">8. 配置 Vinum</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/vinum/#vinum-root">9. 使用 Vinum 作为根文件系统</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/">
              第 23 章 虚拟化
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-guest">2. 作为客户 OS 的 FreeBSD</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/virtualization/#virtualization-host">3. 作为宿主 OS 的 FreeBSD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/">
              第 24 章 本地化－I18N/L10N使用和设置
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-basics">2. 基础知识</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#using-localization">3. 使用本地化语言</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#l10n-compiling">4. 编译I18N程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/l10n/#lang-setup">5. 本地化FreeBSD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/">
              第 25 章 更新与升级 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">2. FreeBSD 更新</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-portsnap">3. Portsnap： 一个 Ports Collection 更新工具</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#updating-upgrading-documentation">4. 更新系统附带的文档</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#current-stable">5. 追踪开发分支</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#synching">6. 同步您的源码</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#makeworld">7. 重新编译 "world"</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#make-delete-old">8. 删除过时的文件、 目录和函数库</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/cutting-edge/#small-lan">9. 跟踪多台机器</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/">
              第 26 章 DTrace
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-implementation">2. 实现上的差异</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-enable">3. 启用 DTrace 支持</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-using">4. 使用 DTrace</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/dtrace/#dtrace-language">5. D 语言</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partiv/">
              部分 IV. 网络通讯
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/">
              第 27 章 串口通讯
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serial-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serial">2. 介绍</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#term">3. 终端</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#dialup">4. 拨入服务</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#dialout">5. 拨出设备</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/serialcomms/#serialconsole-setup">6. 设置串口控制台</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/">
              第 28 章 PPP 和 SLIP
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#userppp">2. 使用用户级 PPP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp">3. 使用内核级PPP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#ppp-troubleshoot">4. PPP 连接故障排除</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#pppoe">5. 使用基于以太网的PPP(PPPoE)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#pppoa">6. 使用 ATM 上的 PPP (PPPoA)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/ppp-and-slip/#slip">7. 使用SLIP</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/">
              第 29 章 电子邮件
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-using">2. 使用电子邮件</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#sendmail">3. sendmail 配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-changingmta">4. 改变您的邮件传输代理程序</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-trouble">5. 疑难解答</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-advanced">6. 高级主题</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-UUCP">7. SMTP 与 UUCP</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#outgoing-only">8. 只发送邮件的配置</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-dialup">9. 拨号连接时使用邮件传送</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#SMTP-Auth">10. SMTP 验证</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-agents">11. 邮件用户代理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-fetchmail">12. 使用 fetchmail</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mail/#mail-procmail">13. 使用 procmail</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/">
              第 30 章 网络服务器
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-servers-synopsis">1. 概要</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-inetd">2. inetd"超级服务器"</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-nfs">3. 网络文件系统（NFS）</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-nis">4. 网络信息服务 (NIS/YP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-dhcp">5. 网络自动配置 (DHCP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-dns">6. 域名系统 (DNS)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-apache">7. Apache HTTP 服务器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-ftp">8. 文件传输协议 (FTP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-samba">9. 为 Microsoft® Windows® 客户机提供文件和打印服务 (Samba)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-ntp">10. 通过 NTP 进行时钟同步</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/network-servers/#network-syslogd">11. 使用 <code>syslogd</code> 记录远程主机的日志</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/">
              第 31 章 防火墙
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-intro">1. 入门</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-concepts">2. 防火墙的概念</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-apps">3. 防火墙软件包</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-pf">4. OpenBSD Packet Filter (PF) 和 ALTQ</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-ipf">5. IPFILTER (IPF) 防火墙</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/firewalls/#firewalls-ipfw">6. IPFW</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/">
              第 32 章 高级网络
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#advanced-networking-synopsis">1. 概述</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-routing">2. 网关和路由</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-wireless">3. 无线网络</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-bluetooth">4. 蓝牙</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-bridging">5. 桥接</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-aggregation">6. 链路聚合与故障转移</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-diskless">7. 无盘操作</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-pxe-nfs">8. 从 PXE 启动一个 NFS 根文件系统</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-isdn">9. ISDN</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-natd">10. 网络地址转换</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-plip">11. 并口电缆 IP (PLIP)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-ipv6">12. IPv6</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#network-atm">13. 异步传输模式 (ATM)</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/advanced-networking/#carp">14. Common Address Redundancy Protocol (CARP， 共用地址冗余协议)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/partv/">
              部分 V. 附录
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/">
              附录 A. 获取 FreeBSD
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-cdrom">1. CDROM 和 DVD 发行商</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-ftp">2. FTP 站点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#anoncvs">3. 匿名 CVS</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#ctm">4. 使用 CTM</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#cvsup">5. 使用 CVSup</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#cvs-tags">6. CVS 标签</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-afs">7. AFS 站点</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/mirrors/#mirrors-rsync">8. rsync 站点</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/">
              附录 B. 参考文献
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-freebsd">1. 关于 FreeBSD 的专业书籍与杂志</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-userguides">2. 用户指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-adminguides">3. 管理员指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-programmers">4. 开发指南</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-osinternals">5. 操作系统原理</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-security">6. 安全方面的参考文献</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-hardware">7. 硬件参考</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-history">8. UNIX® 历史</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/bibliography/#bibliography-journals">9. 各种期刊</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/">
              附录 C. Internet上的资源
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-mail">1. 邮件列表</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-news">2. Usenet新闻组</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-web">3. World Wide Web服务器</a></li>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/eresources/#eresources-email">4. Email地址</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="http://127.0.0.1:5500/zh-cn/books/handbook/pgpkeys/">
              附录 D. PGP公钥
            </a>
            
            
  <ul>
    <li><a href="http://127.0.0.1:5500/zh-cn/books/handbook/pgpkeys/#pgpkeys-officers">1. Officers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">第 12 章 设置和调整</h1>
    
    
      <div class="admonitionblock note">
        <p>
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          This translation may be out of date. To help with the translations please access the <a href="https://translate-dev.freebsd.org/" target="_blank">FreeBSD translations instance</a>.
        </p>
      </div>
    
    
    
    <div class="toc-mobile">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#config-synopsis">1. 概述</a></li>
    <li><a href="#configtuning-initial">2. 初步配置</a></li>
    <li><a href="#configtuning-core-configuration">3. 核心配置</a></li>
    <li><a href="#configtuning-appconfig">4. 应用程序配置</a></li>
    <li><a href="#configtuning-starting-services">5. 启动服务</a></li>
    <li><a href="#configtuning-cron">6. 配置 <code>cron</code></a></li>
    <li><a href="#configtuning-rcd">7. 在 FreeBSD 中使用 rc</a></li>
    <li><a href="#config-network-setup">8. 设置网卡</a></li>
    <li><a href="#configtuning-virtual-hosts">9. 虚拟主机</a></li>
    <li><a href="#configtuning-configfiles">10. 配置文件</a></li>
    <li><a href="#configtuning-sysctl">11. 用 sysctl 进行调整</a></li>
    <li><a href="#configtuning-disk">12. 调整磁盘</a></li>
    <li><a href="#configtuning-kernel-limits">13. 调整内核限制</a></li>
    <li><a href="#adding-swap-space">14. 添加交换空间</a></li>
    <li><a href="#acpi-overview">15. 电源和资源管理</a></li>
    <li><a href="#ACPI-debug">16. 使用和调试 FreeBSD ACPI</a></li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="config-synopsis">1. 概述<a class="anchor" href="#config-synopsis"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用 FreeBSD 的一个重要问题是系统配置。 正确地配置系统能充分地减少以后维护和升级系统所需的工作量。 这章将解释一些 FreeBSD 的配置过程，包括一些可以调整的 FreeBSD 系统的一些参数。</p>
</div>
<div class="paragraph">
<p>读完本章， 您将了解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如何有效地利用文件系统和交换分区。</p>
</li>
<li>
<p><span class="filename">rc.conf</span> 的基本设置以及 <span class="filename">/usr/local/etc/rc.d</span> 启动体系。</p>
</li>
<li>
<p>如何设置和测试网卡。</p>
</li>
<li>
<p>如何在您的网络设备上配置虚拟主机。</p>
</li>
<li>
<p>如何使用 <span class="filename">/etc</span> 下的各配置文件。</p>
</li>
<li>
<p>如何通过 <code>sysctl</code> 变量来对 FreeBSD 系统进行调优。</p>
</li>
<li>
<p>怎样调整磁盘性能和修改内核限制。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在阅读本章之前，您应该了解：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>了解 UNIX® 和 FreeBSD 的基础知识 (crossref:basics[basics,UNIX 基础])。</p>
</li>
<li>
<p>熟悉内核配置编译的基础知识 (crossref:kernelconfig[kernelconfig,配置FreeBSD的内核])。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-initial">2. 初步配置<a class="anchor" href="#configtuning-initial"></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_分区规划">2.1. 分区规划<a class="anchor" href="#_分区规划"></a></h3>
<div class="sect3">
<h4 id="_基本分区">2.1.1. 基本分区<a class="anchor" href="#_基本分区"></a></h4>
<div class="paragraph">
<p>当使用 man:bsdlabel[8] 或者 man:sysinstall[8] 来分割您的文件系统的时候， 要记住硬盘驱动器外磁道传输数据要比从内磁道传输数据快。 因此应该将小的和经常访问的文件系统放在驱动器靠外的位置， 一些大的分区比如 <span class="filename">/usr</span> 应该放在磁盘比较靠里的位置。 以类似这样的顺序建立分区是一个不错的主意：root，swap， <span class="filename">/var</span>， <span class="filename">/usr</span>。</p>
</div>
<div class="paragraph">
<p><span class="filename">/var</span> 分区的大小能反映您的机器使用情况。 <span class="filename">/var</span> 文件系统用来存储邮件， 日志文件和打印队列缓存， 特别是邮箱和日志文件可能会达到无法预料的大小， 这主要取决于在您的系统上有多少用户和您的日志文件可以保存多长时间。 大多数用户很少需要 <span class="filename">/var</span> 有 1GB 以上的闲置空间。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>有时候 <span class="filename">/var/tmp</span> 需要很多的磁盘空间。 在使用 man:pkg_add[1] 安装新的软件时，包管理工具会在 <span class="filename">/var/tmp</span> 中解压出一份临时拷贝。 大的软件包，像 Firefox， OpenOffice 或者 LibreOffice 在安装时如果 <span class="filename">/var/tmp</span> 中没有足够的空间就可能需要一些技巧了。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><span class="filename">/usr</span> 分区存储很多用来系统运行所需要的文件例如 man:ports[7] (建议这样做) 和源代码 (可选的)。 ports 和基本系统的源代码在安装时都是可选的， 但我们建议给这个分区至少保留 2GB 的可用空间。</p>
</div>
<div class="paragraph">
<p>当选择分区大小的时候，记住保留一些空间。 用完了一个分区的空间而在另一个分区上还有很多， 可能会导致出现一些错误。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>一些用户会发现 man:sysinstall[8] 的 <code>Auto-defaults</code> 自动分区有时会分配给 <span class="filename">/var</span> 和 <span class="filename">/</span> 较小的分区空间。 分区应该精确一些并且大一些。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="swap-design">2.1.2. 交换分区<a class="anchor" href="#swap-design"></a></h4>
<div class="paragraph">
<p>一般来讲，交换分区应该大约是系统内存 (RAM) 的两倍。 例如，如果机器有 128M 内存，交换文件应该是 256M。 较小内存的系统可以通过多一点地交换分区来提升性能。 不建议小于 256 兆的交换分区，并且扩充您的内存应该被考虑一下。 当交换分区最少是主内存的两倍的时候，内核的 VM (虚拟内存) 页面调度算法可以将性能调整到最好。如果您给机器添加更多内存， 配置太小的交换分区会导致 VM 页面扫描的代码效率低下。</p>
</div>
<div class="paragraph">
<p>在使用多块SCSI磁盘(或者不同控制器上的IDE磁盘)的大系统上， 建议在每个驱动器上建立交换分区(直到四个驱动器)。 交换分区应该大约一样大小。内核可以使用任意大小， 但内部数据结构则是最大交换分区的 4 倍。保持交换分区同样的大小， 可以允许内核最佳地调度交换空间来访问磁盘。 即使不太使用，分配大的交换分区也是好的， 在被迫重启之前它可以让您更容易的从一个失败的程序中恢复过来。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为什么要分区">2.1.3. 为什么要分区？<a class="anchor" href="#_为什么要分区"></a></h4>
<div class="paragraph">
<p>一些用户认为一个单独的大分区将会很好， 但是有很多原因会证明为什么这是个坏主意。首先， 每个分区有不同的分区特性，因此分开可以让文件系统调整它们。 例如，根系统和 <span class="filename">/usr</span> 一般只是读取，写入很少。 很多读写频繁的被放在 <span class="filename">/var</span> 和 <span class="filename">/var/tmp</span>中。</p>
</div>
<div class="paragraph">
<p>适当的划分一个系统， 在其中使用较小的分区， 这样， 那些以写为主的分区将不会比以读为主的分区付出更高的代价。 将以写为主的分区放在靠近磁盘的边缘， 例如放在实际的大硬盘的前面代替放在分区表的后面，将会提高您需要的分区的 I/O 性能。现在可能也需要在比较大的分区上有很好的 I/O 性能， 把他们移动到磁盘外围不会带来多大的性能提升，反而把 <span class="filename">/var</span> 移到外面会有很好的效果。最后涉及到安全问题。 一个主要是只读的小的、整洁的根分区可以提高从一个严重的系统崩溃中恢复过来的机会。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-core-configuration">3. 核心配置<a class="anchor" href="#configtuning-core-configuration"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>系统的配置信息主要位于 <span class="filename">/etc/rc.conf</span>。 这个文件包含了配置信息很大的一部分，主要在系统启动的时候来配置系统， 这个名字直接说明了这点；它也是 <span class="filename">rc*</span> 文件的配置信息。</p>
</div>
<div class="paragraph">
<p>系统管理员应该在 <span class="filename">rc.conf</span> 文件中建立记录来覆盖 <span class="filename">/etc/defaults/rc.conf</span> 中的默认设置。 这个默认文件不应该被逐字的复制到 <span class="filename">/etc</span> ―― 它包含的是默认值而不是一个例子。 所有特定的改变应该在 <span class="filename">rc.conf</span> 中。</p>
</div>
<div class="paragraph">
<p>在集群应用中，为了降低管理成本， 可以采用多种策略把涉及全站范围的设置从特定于系统的设置中分离出来。 推荐的方法是把系统范围的配置放到 <span class="filename">/etc/rc.conf.local</span> 文件中。 例如：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="filename">/etc/rc.conf</span>:</p>
<div class="literalblock programlisting">
<div class="content">
<pre>sshd_enable=&#34;YES&#34;
keyrate=&#34;fast&#34;
defaultrouter=&#34;10.1.1.254&#34;</pre>
</div>
</div>
</li>
<li>
<p><span class="filename">/etc/rc.conf.local</span>:</p>
<div class="literalblock programlisting">
<div class="content">
<pre>hostname=&#34;node1.example.org&#34;
ifconfig_fxp0=&#34;inet 10.1.1.1/8&#34;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="filename">rc.conf</span> 文件可以通过 <code>rsync</code> 或类似的程序来分发到所有的机器上， 而各自的 <span class="filename">rc.conf.local</span> 文件则保持不变。</p>
</div>
<div class="paragraph">
<p>使用 man:sysinstall[8] 或者 <code>make world</code> 来升级系统不会覆盖 <span class="filename">rc.conf</span> 文件， 所以系统配置信息不会丢失。</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>配置文件 <span class="filename">/etc/rc.conf</span> 是通过 man:sh[1] 解析的。 这使得系统管理员可以在其中添加一些逻辑， 从而创建能够适应非常复杂的场景的配置。 请参阅联机手册 man:rc.conf[5] 来了解关于这一话题的进一步信息。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-appconfig">4. 应用程序配置<a class="anchor" href="#configtuning-appconfig"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>典型的，被安装的应用程序有他自己的配置文件、语法等等。 从基本系统中分开他们是很重要的以至于他们可以容易的被 package 管理工具定位和管理</p>
</div>
<div class="paragraph">
<p>一般来说，这些文件被安装在 <span class="filename">/usr/local/etc</span>。这个例子中， 一个应用程序有很多配置文件并且创建了一个子目录来存放他们。</p>
</div>
<div class="paragraph">
<p>通常，当一个 port 或者 package 被安装的时候， 配置文件示例也同样被安装了。它们通常用 <span class="filename">.default</span> 的后缀来标识。如果不存在这个应用程序的配置文件， 它们会通过复制 <span class="filename">.default</span> 文件来创建。</p>
</div>
<div class="paragraph">
<p>例如，看一下这个目下的内容 <span class="filename">/usr/local/etc/apache</span>：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf
-rw-r--r--  1 root  wheel   2184 May 20  1998 access.conf.default
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf
-rw-r--r--  1 root  wheel   9555 May 20  1998 httpd.conf.default
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic
-rw-r--r--  1 root  wheel  12205 May 20  1998 magic.default
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types
-rw-r--r--  1 root  wheel   2700 May 20  1998 mime.types.default
-rw-r--r--  1 root  wheel   7980 May 20  1998 srm.conf
-rw-r--r--  1 root  wheel   7933 May 20  1998 srm.conf.default</pre>
</div>
</div>
<div class="paragraph">
<p>文件大小显示了只有 <span class="filename">srm.conf</span> 改变了。以后 Apache 的升级就不会改变这个文件。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-starting-services">5. 启动服务<a class="anchor" href="#configtuning-starting-services"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>许多用户会选择使用 Ports Collection 来在 FreeBSD 上安装第三方软件。 很多情况下这可能需要进行一些配置以便让这些软件能够在系统初始化的过程中启动。 服务， 例如 package:mail/postfix[] 或 package:www/apache13[] 就是这些需要在系统初始化时启动的软件包中的两个典型代表。 这一节解释了启动第三方软件所需要的步骤。</p>
</div>
<div class="paragraph">
<p>FreeBSD 包含的大多数服务，例如 man:cron[8]， 就是通过系统启动脚本启动的。 这些脚本也许会有些不同， 这取决于 FreeBSD 版本。 但是不管怎样， 需要考虑的一个重要方面是他们的启动配置文件要能被基本启动脚本识别捕获。</p>
</div>
<div class="sect2">
<h3 id="_扩展应用程序配置">5.1. 扩展应用程序配置<a class="anchor" href="#_扩展应用程序配置"></a></h3>
<div class="paragraph">
<p>现在 FreeBSD 提供了 <span class="filename">rc.d</span>， 这使得对应用软件的启动进行配置变得更加方便， 并提供了更多的其他功能。 例如， 使用在 <a href="#configtuning-rcd">rc.d</a> 一节中所介绍的关键字， 应用程序就可以设置在某些其他服务， 例如 DNS 之后启动； 除此之外， 还可以通过 <span class="filename">rc.conf</span> 来指定一些额外的启动参数， 而不再需要将它们硬编码到启动脚本中。 基本的启动脚本如下所示：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#!/bin/sh
#
# PROVIDE: utility
# REQUIRE: DAEMON
# KEYWORD: shutdown

. /etc/rc.subr

name=utility
rcvar=utility_enable

command=&#34;/usr/local/sbin/utility&#34;

load_rc_config $name

#
# DO NOT CHANGE THESE DEFAULT VALUES HERE
# SET THEM IN THE /etc/rc.conf FILE
#
utility_enable=${utility_enable-&#34;NO&#34;}
pidfile=${utility_pidfile-&#34;/var/run/utility.pid&#34;}

run_rc_command &#34;$1&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>这个脚本将保证 utility 能够在 <code>DAEMON</code> 服务之后启动。 它同时也提供了设置和跟踪 PID， 也就是进程 ID 文件的方法。</p>
</div>
<div class="paragraph">
<p>可以在 <span class="filename">/etc/rc.conf</span> 中加入：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>utility_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>这个方法也使得命令行参数、包含 <span class="filename">/etc/rc.subr</span> 中所提供的功能， 兼容 man:rcorder[8] 工具并提供更简单的通过 <span class="filename">rc.conf</span> 文件来配置的方法。</p>
</div>
</div>
<div class="sect2">
<h3 id="_用服务来启动服务">5.2. 用服务来启动服务<a class="anchor" href="#_用服务来启动服务"></a></h3>
<div class="paragraph">
<p>其他服务， 例如 POP3 服务器， IMAP， 等等， 也可以通过 man:inetd[8] 来启动。 这一过程包括从 Ports Collection 安装相应的应用程序， 并把配置加入到 <span class="filename">/etc/inetd.conf</span> 文件， 或去掉当前配置中的某些注释。 如何使用和配置 inetd 在 crossref:network-servers[network-inetd,inetd] 一节中进行了更为深入的阐述。</p>
</div>
<div class="paragraph">
<p>一些情况下， 通过 man:cron[8] 来启动系统服务也是一种可行的选择。 这种方法有很多好处， 因为 <code>cron</code> 会以 <span class="filename">crontab</span> 的文件属主身份执行那些进程。 这使得普通用户也能够执行他们的应用。</p>
</div>
<div class="paragraph">
<p><code>cron</code> 工具提供了一个独有的功能， 以 <code>@reboot</code> 来指定时间。 这样的设置将在 man:cron[8] 启动时运行， 通常这也是系统初始化的时候。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-cron">6. 配置 <code>cron</code><a class="anchor" href="#configtuning-cron"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD 最有用的软件包(utilities)中的一个是 man:cron[8]。 <code>cron</code> 软件在后台运行并且经常检查 <span class="filename">/etc/crontab</span> 文件。<code>cron</code> 软件也检查 <span class="filename">/var/cron/tabs</span> 目录，搜索新的 <span class="filename">crontab</span> 文件。这些 <span class="filename">crontab</span> 文件存储一些 <code>cron</code> 在特定时间执行任务的信息。</p>
</div>
<div class="paragraph">
<p><code>cron</code> 程序使用两种不同类型的配置文件， 即系统 crontab 和用户 crontabs。 两种格式的唯一区别是第六个字段。 在系统 crontab 中，第六个字段是用于执行命令的用户名。 这给予了系统 crontab 以任意用户身份执行命令的能力。 在用户 crontab 中， 第六个字段是要执行的命令， 所有的命令都会以这个用户自己的身份执行； 这是一项重要的安全功能。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>同其他用户一样， <code>root</code> 用户也可以有自己的 crontab。 它不同于 <span class="filename">/etc/crontab</span> (也就是系统 crontab)。 由于有系统 crontab 的存在， 通常并不需要给 <code>root</code> 建立单独的用户 crontab。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>让我们来看一下 <span class="filename">/etc/crontab</span> 文件：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># /etc/crontab - root&#39;s crontab for FreeBSD
#
# $FreeBSD: src/etc/crontab,v 1.32 2002/11/22 16:13:39 tom Exp $
#<i class="conum" data-value="1"></i><b>(1)</b>
#
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin <i class="conum" data-value="2"></i><b>(2)</b>
HOME=/var/log
#
#
#minute	hour	mday	month	wday	who	command <i class="conum" data-value="3"></i><b>(3)</b>
#
#
*/5	*	*	*	*	root	/usr/libexec/atrun <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>像大多数 FreeBSD 配置文件一样，<code>#</code> 字符是注释。 这样， 就可以编写注释来说明要执行什么操作， 以及这样做的原因。 需要注意的是， 注释应该另起一行， 而不能跟命令放在同一行上， 否则它们会被看成命令的一部分。 这个文件中的空行会被忽略。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>首先应该定义环境变量。等号 (<code>=</code>) 字符用来定义任何环境变量，像这个例子用到了 <code>SHELL</code>，<code>PATH</code> 和 <code>HOME</code> 变量。如果 shell 行被忽略掉，<code>cron</code> 将会用默认值 <code>sh</code>。如果 <code>PATH</code> 变量被忽略， 那么就没有默认值并且需要指定文件绝对位置。如果 <code>HOME</code> 被忽略，<code>cron</code> 将用用执行者的 home 目录。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>这一行定义了七个字段。它们是 <code>minute</code>、 <code>hour</code>、<code>mday</code>、 <code>month</code>、<code>wday</code>、 <code>who</code> 和 <code>command</code>。 它们差不多已经说明了各自的用处。Minute 是命令要运行时的分钟，Hour 跟 minute 差不多，只是用小时来表示。Mday 是每个月的天。Month 跟 hour 还有 minute 都差不多，用月份来表示。wday 字段表示星期几。 所有这些字段的值必须是数字并且用24小时制来表示。&#34;who&#34; 字段是特别的，并且只在 <span class="filename">/etc/crontab</span> 文件中存在。 这个字段指定了命令应该以哪个用户的身份来运行。当一个用户添加了他(她)的 <span class="filename">crontab</span> 文件的时候，他们就会没有这个字段选项。最后，是 <code>command</code> 字段。这是最后的一个字段， 所以自然就是它指定要运行的程序。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>最后一行定义了上面所说的值。注意这里我们有一个 <code><strong>/5</strong></code><strong> 列表，紧跟着是一些 <code></code></strong> 字符。<code>*</code> 字符代表&#34;开始到最后&#34;， 也可以被解释成 <em>每次</em>。所以，根据这行， 显然表明了无论在何时每隔 5 分钟以 <code>root</code> 身份来运行 <code>atrun</code> 命令。查看 man:atrun[8] 手册页以获得 <code>atrun</code> 的更多信息。命令可以有任意多个传递给它们的标志。无论怎样， 扩展到多行的命令应该用反斜线(&#34;\&#34;)来续行。</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这是每个 <span class="filename">crontab</span> 文件的基本设置， 虽然它们有一个不同。第六行我们指定的用户名只存在于系统 <span class="filename">/etc/crontab</span> 文件。这个字段在普通用户的 <span class="filename">crontab</span> 文件中应该被忽略。</p>
</div>
<div class="sect2">
<h3 id="configtuning-installcrontab">6.1. 安装 Crontab<a class="anchor" href="#configtuning-installcrontab"></a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>绝对不要用这种方法来编辑/安装系统 crontab。 您需要做的只是使用自己喜欢的编辑器： <code>cron</code> 程序会注意到文件发生了变化， 并立即开始使用新的版本。参见 extref:https://docs.freebsd.org/en/books/faq/[这个 FAQ 项目, ROOT-NOT-FOUND-CRON-ERRORS] 以了解进一步的情况。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>要安装刚写好的用户 <span class="filename">crontab</span>， 首先使用最习惯的编辑器来创建一个符合要求格式的文件，然后用 <code>crontab</code> 程序来完成。最常见的用法是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% crontab crontab-file</code></pre>
</div>
</div>
<div class="paragraph">
<p>在前面的例子中， <span class="filename">crontab-file</span> 是一个事先写好的 <span class="filename">crontab</span>。</p>
</div>
<div class="paragraph">
<p>还有一个选项用来列出安装的 <span class="filename">crontab</span> 文件： 只要传递 <code>-l</code> 选项给 <code>crontab</code> 然后看一下输出。</p>
</div>
<div class="paragraph">
<p>用户想不用模板(已经存在的文件)而直接安装他的 crontab 文件，用 <code>crontab -e</code> 选项也是可以的。 它将会启动一个编辑器并且创建一个新文件，当这个文件被保存的时候， 它会自动的用 <code>crontab</code> 来安装这个文件。</p>
</div>
<div class="paragraph">
<p>如果您稍后想要彻底删除自己的用户 <span class="filename">crontab</span> 可以使用 <code>crontab</code> 的 <code>-r</code> 选项。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-rcd">7. 在 FreeBSD 中使用 rc<a class="anchor" href="#configtuning-rcd"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 2002 年， FreeBSD 整合了来自 NetBSD 的 <span class="filename">rc.d</span> 系统， 并通过它来完成系统的初始化工作。 用户要注意在 <span class="filename">/etc/rc.d</span> 目录下的文件。 这里面的许多文件是用来管理基础服务的， 它们可以通过 <code>start</code>、 <code>stop</code>， 以及 <code>restart</code> 选项来控制。 举例来说， man:sshd[8] 可以通过下面的命令来重启：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/sshd restart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>对其它服务的操作与此类似。 当然， 这些服务通常是在启动时根据 man:rc.conf[5] 自动启动的。 例如， 要配置使系统启动时启动网络地址转换服务， 可以简单地通过在 <span class="filename">/etc/rc.conf</span> 中加入如下设置来完成：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>natd_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>如果 <code>natd_enable=&#34;NO&#34;</code> 行已经存在， 只要简单的把 <code>NO</code> 改成 <code>YES</code> 即可。 rc 脚本在下次重新启动的时候会自动的装载所需要的服务， 像下面所描述的那样。</p>
</div>
<div class="paragraph">
<p>由于 <span class="filename">rc.d</span> 系统在系统启动/关闭时首先启动/停止服务，如果设置了适当的 <span class="filename">/etc/rc.conf</span> 变量，标准的 <code>start</code>、<code>stop</code> 和 <code>restart</code> 选项将会执行他们的动作。例如 <code>sshd restart</code> 命令只在 <span class="filename">/etc/rc.conf</span> 中的 <code>sshd_enable</code> 设置成 <code>YES</code> 的时候工作。不管是否在 <span class="filename">/etc/rc.conf</span> 中设置了，要 <code>start</code>、<code>stop</code> 或者 <code>restart</code> 一个服务，命令前可以加上一个&#34;one&#34;前缀。例如要不顾当前 <span class="filename">/etc/rc.conf</span> 的设置重新启动 <code>sshd</code>，执行下面的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/sshd onerestart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>用选项 <code>rcvar</code> 可以简单来的检查 <span class="filename">/etc/rc.conf</span> 中用适当的 <span class="filename">rc.d</span> 脚本启动的服务是否被启用。从而管理员可以运行这样的程序来检查 <code>sshd</code> 是否真的在 <span class="filename">/etc/rc.conf</span> 中被启动了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/sshd rcvar</span>
<span class="c"># sshd</span>
<span class="nv">$sshd_enable</span><span class="o">=</span>YES</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>第二行 (<code># sshd</code>) 是从 <code>sshd</code> 命令中输出的，而不是 <code>root</code> 控制台。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>为了确定一个服务是否真的在运行，可以用 <code>status</code> 选项。例如验证 <code>sshd</code> 是否真的启动了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/sshd status</span>
sshd is running as pid 433.</code></pre>
</div>
</div>
<div class="paragraph">
<p>有些时候也可以 <code>reload</code> 服务。 这一操作实际上是向服务发送一个信号， 来强制其重新加载配置。 多数情况下， 发给服务的会是 <code>SIGHUP</code> 信号。 并非所有服务都支持这一功能。</p>
</div>
<div class="paragraph">
<p><span class="filename">rc.d</span> 系统不仅用于网络服务， 它也为系统初始化中的多数过程提供支持。 比如 <span class="filename">bgfsck</span> 文件， 当它被执行时， 将会给出下述信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">Starting background file system checks <span class="k">in </span>60 seconds.</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个文件用做后台文件系统检查，系统初始化的时候完成。</p>
</div>
<div class="paragraph">
<p>很多系统服务依赖其他服务提供的相应功能。例如，NIS 和其他基于 RPC 的服务启动可能在 <code>rpcbind</code> 服务启动之前失败。 要解决这个问题，依赖关系信息和其他头信息当作注释被包含在每个启动脚本文件的前面。 程序在系统初始化时分析这些注释以决定调用其他系统服务来满足依赖关系。</p>
</div>
<div class="paragraph">
<p>下面的字句必须被包含在所有的启动脚本文件里， （他们都是 man:rc.subr[8] 用来 &#34;enable&#34; 启动脚本必需的）:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PROVIDE</code>: 指定此文件所提供的服务的名字。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下的字句可以被包含在启动文件的顶部。严格来说他们不是必需的， 但作为对于 man:rcorder[8] 有一定的提示作用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>REQUIRE</code>: 列出此服务启动之前所需要的其他服务。 此脚本提供的服务会在指定的那些服务 <em>之后</em> 启动。</p>
</li>
<li>
<p><code>BEFORE</code>: 列出依赖此服务的其他服务。 此脚本提供的服务将在指定的那些服务 <em>之前</em> 启动。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过在启动脚本中仔细设定这些关键字， 系统管理员可以很有条理的控制脚本的启动顺序， 进而避免使用像其他 UNIX® 操作系统那样混乱的 &#34;runlevels&#34;。</p>
</div>
<div class="paragraph">
<p>更多关于 <span class="filename">rc.d</span> 系统的信息， 可以在 man:rc[8] 和 man:rc.subr[8] 联机手册中找到。 如果您有意撰写自己的 <span class="filename">rc.d</span> 脚本， 或对现有的脚本进行一些改进， 也可以参考 extref:https://docs.freebsd.org/zh-cn/articles/rc-scripting/[这篇文章]。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-network-setup">8. 设置网卡<a class="anchor" href="#config-network-setup"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>现在我们不可想象一台计算机没有网络连接的情况。 添加和配置一块网卡是任何 FreeBSD 系统管理员的一项基本任务。</p>
</div>
<div class="sect2">
<h3 id="_查找正确的驱动程序">8.1. 查找正确的驱动程序<a class="anchor" href="#_查找正确的驱动程序"></a></h3>
<div class="paragraph">
<p>在开始之前，您应该知道您的网卡类型，它用的芯片和它是 PCI 还是 ISA 网卡。FreeBSD 支持很多种 PCI 和 ISA 网卡。 可以查看您的版本硬件兼容性列表以确定您的网卡被支持。</p>
</div>
<div class="paragraph">
<p>确认系统能够支持您的网卡之后， 您还需要为它选择合适的驱动程序。 <span class="filename">/usr/src/sys/conf/NOTES</span> 和 <span class="filename">/usr/src/sys/arch/conf/NOTES</span> 将为您提供所支持的一些网卡和芯片组的信息。 如果您怀疑驱动程序是否使所要找的那一个， 请参考驱动程序的联机手册。 联机手册将提供关于所支持的硬件更详细的信息， 甚至还包括可能发生的问题。</p>
</div>
<div class="paragraph">
<p>如果您的网卡很常见的话， 大多数时候您不需要为驱动浪费精力。 常用的网卡在 <span class="filename">GENERIC</span> 内核中已经支持了， 所以您的网卡在启动时就会显示出来，像是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">dc0: &lt;82c169 PNIC 10/100BaseTX&gt; port 0xa000-0xa0ff mem 0xd3800000-0xd38
000ff irq 15 at device 11.0 on pci0
miibus0: &lt;MII bus&gt; on dc0
bmtphy0: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus0
bmtphy0:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc0: Ethernet address: 00:a0:cc:da:da:da
dc0: <span class="o">[</span>ITHREAD]
dc1: &lt;82c169 PNIC 10/100BaseTX&gt; port 0x9800-0x98ff mem 0xd3000000-0xd30
000ff irq 11 at device 12.0 on pci0
miibus1: &lt;MII bus&gt; on dc1
bmtphy1: &lt;BCM5201 10/100baseTX PHY&gt; PHY 1 on miibus1
bmtphy1:  10baseT, 10baseT-FDX, 100baseTX, 100baseTX-FDX, auto
dc1: Ethernet address: 00:a0:cc:da:da:db
dc1: <span class="o">[</span>ITHREAD]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，我们看到有两块使用 man:dc[4] 驱动的网卡在系统中。</p>
</div>
<div class="paragraph">
<p>如果您的网卡没有出现在 <span class="filename">GENERIC</span> 中， 则需要手工加载合适的驱动程序。 要完成这项工作可以使用下面两种方法之一：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最简单的办法是用 man:kldload[8] 加载网卡对应的内核模块。 除此之外， 通过在 <span class="filename">/boot/loader.conf</span> 文件中加入适当的设置， 也可以让系统在引导时自动加载这些模块。 不过， 并不是所有的网卡都能够通过这种方法提供支持； ISA 网卡是比较典型的例子。</p>
</li>
<li>
<p>另外， 您也可以将网卡的支持静态联编进内核。 察看 <span class="filename">/usr/src/sys/conf/NOTES</span>， <span class="filename">/usr/src/sys/arch/conf/NOTES</span> 以及驱动程序的联机手册以了解需要在您的内核配置文件中加一些什么。 要了解关于重新编译内核的进一步细节， 请参见 crossref:kernelconfig[kernelconfig,配置FreeBSD的内核]。 如果您的卡在引导时可以被内核 (<span class="filename">GENERIC</span>) 识别， 您应该不需要编译新的内核。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="config-network-ndis">8.1.1. 使用 Windows® NDIS 驱动程序<a class="anchor" href="#config-network-ndis"></a></h4>
<div class="paragraph">
<p>不幸的是， 许多厂商由于认为驱动程序会涉及许多敏感的商业机密， 至今仍不愿意将把驱动程序作为开放源代码形式发布列入他们的时间表。 因此， FreeBSD 和其他操作系统的开发者就只剩下了两种选择： 要么经历长时间的痛苦过程来对驱动进行逆向工程， 要么使用现存的为 Microsoft® Windows® 平台提供的预编译版本的驱动程序。 包括参与 FreeBSD 开发的绝大多数开发人员， 都选择了后一种方法。</p>
</div>
<div class="paragraph">
<p>得益于 Bill Paul (wpaul) 的工作， 已经可以 &#34;直接地&#34; 支持 网络驱动接口标准 (NDIS, Network Driver Interface Specification) 了。 FreeBSD NDISulator (也被称为 Project Evil) 可以支持二进制形式的 Windows® 驱动程序， 并让它相信正在运行的是 Windows®。 由于 man:ndis[4] 驱动使用的是用于 Windows® 的二进制形式的驱动， 因此它只能在 i386™ 和 amd64 系统上使用。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>man:ndis[4] 驱动在设计时主要提供了 PCI、 CardBus 和 PCMCIA 设备的支持， 而 USB 设备目前则没有提供支持。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>要使用 NDISulator， 您需要三件东西：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>内核的源代码</p>
</li>
<li>
<p>二进制形式的 Windows® XP 驱动程序 (扩展名为 <span class="filename">.SYS</span>)</p>
</li>
<li>
<p>Windows® XP 驱动程序配置文件 (扩展名为 <span class="filename">.INF</span>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>您需要找到用于您的卡的这些文件。 一般而言， 这些文件可以在随卡附送的 CD 或制造商的网站上找到。 在下面的例子中， 我们用 <span class="filename">W32DRIVER.SYS</span> 和 <span class="filename">W32DRIVER.INF</span> 来表示这些文件。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>不能在 FreeBSD/amd64 上使用 Windows®/i386 驱动程序。 必须使用 Windows®/amd64 驱动才能在其上正常工作。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>接下来的步骤是将二进制形式的驱动程序组装成内核模块。 要完成这一任务， 需要以 <code>root</code> 用户的身份执行 man:ndisgen[8]：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ndisgen /path/to/W32DRIVER.INF /path/to/W32DRIVER.SYS</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>man:ndisgen[8] 是一个交互式的程序， 它会提示您输入所需的一些其他的额外信息； 这些工作完成之后， 它会在当前目录生成一个内核模块文件， 这个文件可以通过下述命令来加载：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload ./W32DRIVER_SYS.ko</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>除了刚刚生成的内核模块之外， 还必须加载 <span class="filename">ndis.ko</span> 和 <span class="filename">if_ndis.ko</span> 这两个内核模块， 在您加载需要 man:ndis[4] 的模块时， 通常系统会自动完成这一操作。 如果希望手工加载它们， 则可以使用下列命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload ndis</span>
<span class="c"># kldload if_ndis</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个命令会加载 NDIS 袖珍端口驱动封装模块， 而第二条命令则加载实际的网络接口。</p>
</div>
<div class="paragraph">
<p>现在请查看 man:dmesg[8] 来了解是否发生了错误。 如果一切正常， 您会看到类似下面的输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">ndis0: &lt;Wireless-G PCI Adapter&gt; mem 0xf4100000-0xf4101fff irq 3 at device 8.0 on pci1
ndis0: NDIS API version: 5.0
ndis0: Ethernet address: 0a:b1:2c:d3:4e:f5
ndis0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
ndis0: 11g rates: 6Mbps 9Mbps 12Mbps 18Mbps 36Mbps 48Mbps 54Mbps</code></pre>
</div>
</div>
<div class="paragraph">
<p>这之后， 就可以像使用其它网络接口 (例如 <span class="filename">dc0</span>) 一样来使用 <span class="filename">ndis0</span> 设备了。</p>
</div>
<div class="paragraph">
<p>与任何其它模块一样， 您也可以配置系统， 令其在启动时自动加载 NDIS 模块。 首先， 将生成的模块 <span class="filename">W32DRIVER_SYS.ko</span> 复制到 <span class="filename">/boot/modules</span> 目录中。 接下来， 在 <span class="filename">/boot/loader.conf</span> 中加入：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>W32DRIVER_SYS_load=&#34;YES&#34;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置网卡">8.2. 配置网卡<a class="anchor" href="#_配置网卡"></a></h3>
<div class="paragraph">
<p>现在正确的网卡驱动程序已经装载，那么就应该配置它了。 跟其他配置一样，网卡可以在安装时用  sysinstall  来配置。</p>
</div>
<div class="paragraph">
<p>要显示您系统上的网络接口的配置，输入下列命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% ifconfig
dc0: <span class="nv">flags</span><span class="o">=</span>8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class="nv">options</span><span class="o">=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
        media: Ethernet autoselect <span class="o">(</span>100baseTX &lt;full-duplex&gt;<span class="o">)</span>
        status: active
dc1: <span class="nv">flags</span><span class="o">=</span>8802&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class="nv">options</span><span class="o">=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:db
        inet 10.0.0.1 netmask 0xffffff00 broadcast 10.0.0.255
        media: Ethernet 10baseT/UTP
        status: no carrier
plip0: <span class="nv">flags</span><span class="o">=</span>8810&lt;POINTOPOINT,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
lo0: <span class="nv">flags</span><span class="o">=</span>8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; metric 0 mtu 16384
        <span class="nv">options</span><span class="o">=</span>3&lt;RXCSUM,TXCSUM&gt;
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
        inet6 ::1 prefixlen 128
        inet 127.0.0.1 netmask 0xff000000
        nd6 <span class="nv">options</span><span class="o">=</span>3&lt;PERFORMNUD,ACCEPT_RTADV&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，显示出了下列设备：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="filename">dc0</span>: 第一个以太网接口</p>
</li>
<li>
<p><span class="filename">dc1</span>: 第二个以太网接口</p>
</li>
<li>
<p><span class="filename">plip0</span>： 并口 (如果系统中有并口的话)</p>
</li>
<li>
<p><span class="filename">lo0</span>: 回环设备</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FreeBSD 使用内核引导时检测到的网卡驱动顺序来命名网卡。例如 <span class="filename">sis2</span> 是系统中使用 man:sis[4] 驱动的第三块网卡。</p>
</div>
<div class="paragraph">
<p>在这个例子中，<span class="filename">dc0</span> 设备启用了。主要表现在：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>UP</code> 表示这块网卡已经配置完成准备工作。</p>
</li>
<li>
<p>这块网卡有一个 Internet (<code>inet</code>) 地址 (这个例子中是 <code>192.168.1.3</code>)。</p>
</li>
<li>
<p>它有一个有效的子网掩码 (<code>netmask</code>； <code>0xffffff00</code> 等同于 <code>255.255.255.0</code>)。</p>
</li>
<li>
<p>它有一个有效的广播地址 (这个例子中是 <code>192.168.1.255</code>)。</p>
</li>
<li>
<p>网卡的 MAC (<code>ether</code>) 地址是 <code>00:a0:cc:da:da:da</code></p>
</li>
<li>
<p>物理传输媒介模式处于自动选择状态 (<code>media: Ethernet autoselect (100baseTX &lt;full-duplex&gt;)</code>)。我们看到 <span class="filename">dc1</span> 被配置成运行在 <code>10baseT/UTP</code> 模式下。 要了解驱动媒介类型的更多信息， 请查阅它们的使用手册。</p>
</li>
<li>
<p>连接状态 (<code>status</code>)是 <code>active</code>，也就是说连接信号被检测到了。对于 <span class="filename">dc1</span>，我们看到 <code>status: no carrier</code>。 这通常是网线没有插好。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果 man:ifconfig[8] 的输出显示了类似于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">dc0: <span class="nv">flags</span><span class="o">=</span>8843&lt;BROADCAST,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500
        <span class="nv">options</span><span class="o">=</span>80008&lt;VLAN_MTU,LINKSTATE&gt;
        ether 00:a0:cc:da:da:da
        media: Ethernet autoselect <span class="o">(</span>100baseTX &lt;full-duplex&gt;<span class="o">)</span>
        status: active</code></pre>
</div>
</div>
<div class="paragraph">
<p>的信息，那么就是还没有配置网卡。</p>
</div>
<div class="paragraph">
<p>要配置网卡，您需要 <code>root</code> 权限。 网卡配置可以通过使用 man:ifconfig[8] 命令行方式来完成， 但是这样每次启动都要做一遍。放置网卡配置信息的文件是 <span class="filename">/etc/rc.conf</span>。</p>
</div>
<div class="paragraph">
<p>用您自己喜欢的编辑器打开 <span class="filename">/etc/rc.conf</span>。 并且您需要为每一块系统中存在的网卡添加一行， 在我们的例子中，添加如下几行：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ifconfig_dc0=&#34;inet 192.168.1.3 netmask 255.255.255.0&#34;
ifconfig_dc1=&#34;inet 10.0.0.1 netmask 255.255.255.0 media 10baseT/UTP&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>用自己正确的设备名和地址来替换例子中的 <span class="filename">dc0</span>，<span class="filename">dc1</span> 等内容。您应该应该查阅网卡驱动和 man:ifconfig[8] 的手册页来了解各选项，也要查看一下 man:rc.conf[5] 帮助页来了解 <span class="filename">/etc/rc.conf</span> 的语法。</p>
</div>
<div class="paragraph">
<p>如果在安装的时候配置了网络，关于网卡的一些行可能已经存在了。 所以在添加新行前仔细检查一下 <span class="filename">/etc/rc.conf</span>。</p>
</div>
<div class="paragraph">
<p>您也可能需要编辑 <span class="filename">/etc/hosts</span> 来添加局域网中不同的机器名称和 IP 地址， 如果它们不在那里的话。 请查看联机手册 man:hosts[5] 和 <span class="filename">/usr/shared/examples/etc/hosts</span> 以了解更多信息。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果计划通过这台机器访问 Internet， 您还需要手工配置默认网关和域名解析服务器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># echo &#39;defaultrouter=&#34;your_default_router&#34;&#39; &gt;&gt; /etc/rc.conf</span>
<span class="c"># echo &#39;nameserver your_DNS_server&#39; &gt;&gt; /etc/resolv.conf</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_测试和调试">8.3. 测试和调试<a class="anchor" href="#_测试和调试"></a></h3>
<div class="paragraph">
<p>对 <span class="filename">/etc/rc.conf</span> 做了必要的修改之后应该重启系统以应用对接口的修改， 并且确认系统重启后没有任何配置错误。 另外您也可以重启网络系统：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/netif restart</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果在 <span class="filename">/etc/rc.conf</span> 中配置了默认网关， 还需要运行下面的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /etc/rc.d/routing restart</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>网络系统重启之后， 应测试网络接口。</p>
</div>
<div class="sect3">
<h4 id="_测试以太网卡">8.3.1. 测试以太网卡<a class="anchor" href="#_测试以太网卡"></a></h4>
<div class="paragraph">
<p>为了确认网卡被正确的配置了，在这里我们要做两件事情。首先， ping 自己的网络接口，接着 ping 局域网内的其他机器。</p>
</div>
<div class="paragraph">
<p>首先测试本地接口：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% ping <span class="nt">-c5</span> 192.168.1.3
PING 192.168.1.3 <span class="o">(</span>192.168.1.3<span class="o">)</span>: 56 data bytes
64 bytes from 192.168.1.3: <span class="nv">icmp_seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.082 ms
64 bytes from 192.168.1.3: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.074 ms
64 bytes from 192.168.1.3: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.076 ms
64 bytes from 192.168.1.3: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.108 ms
64 bytes from 192.168.1.3: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.076 ms

<span class="nt">---</span> 192.168.1.3 ping statistics <span class="nt">---</span>
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max/stddev <span class="o">=</span> 0.074/0.083/0.108/0.013 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在我们应该 ping 局域网内的其他机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% ping <span class="nt">-c5</span> 192.168.1.2
PING 192.168.1.2 <span class="o">(</span>192.168.1.2<span class="o">)</span>: 56 data bytes
64 bytes from 192.168.1.2: <span class="nv">icmp_seq</span><span class="o">=</span>0 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.726 ms
64 bytes from 192.168.1.2: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.766 ms
64 bytes from 192.168.1.2: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.700 ms
64 bytes from 192.168.1.2: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.747 ms
64 bytes from 192.168.1.2: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.704 ms

<span class="nt">---</span> 192.168.1.2 ping statistics <span class="nt">---</span>
5 packets transmitted, 5 packets received, 0 packet loss
round-trip min/avg/max/stddev <span class="o">=</span> 0.700/0.729/0.766/0.025 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>您如果您设置了 <span class="filename">/etc/hosts</span> 文件，也可以用机器名来替换 <code>192.168.1.2</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_调试">8.3.2. 调试<a class="anchor" href="#_调试"></a></h4>
<div class="paragraph">
<p>调试硬件和软件配置一直是一件头痛的事情， 从最简单的开始可以减轻一些痛苦。 例如网线是否插好了？是否配置好了网络服务？防火墙配置正确吗？ 是否使用了被 FreeBSD 支持的网卡？ 在发送错误报告之前您应该查看一下硬件说明， 升级 FreeBSD 到最新的 STABLE 版本， 看一下邮件列表或者在 Internet 上搜索一下。</p>
</div>
<div class="paragraph">
<p>如果网卡工作了， 但性能低下，应该好好阅读一下 man:tuning[7] 联机手册。 您也可以检查一下网络配置， 不正确的设置会导致慢速的网络连接。</p>
</div>
<div class="paragraph">
<p>一些用户可能会在一些网卡上经历一到两次 <code>device timeouts</code>， 这通常是正常现象。 如果经常这样甚至引起麻烦， 则应确定一下它跟其他设备没有冲突。 仔细检查网线连接， 或者换一块网卡。</p>
</div>
<div class="paragraph">
<p>有时用户会看到少量 <code>watchdog timeout</code> 错误。 这种情况要做的第一件事就是检查线缆连接。 一些网卡需要支持总线控制的 PCI 插槽。 在一些老的主板上，只有一个 PCI 插槽支持 (一般是 slot 0)。 检查网卡和主板说明书来确定是不是这个问题。</p>
</div>
<div class="paragraph">
<p><code>No route to host</code> 通常发生在如果系统不能发送一个路由到目的主机的包的时候。 这在没有指定默认路由或者网线没有插上时会发生。 检查 <code>netstat -rn</code> 的输出并确认有一个有效的路由能到达相应的主机。 如果没有，请查阅 crossref:advanced-networking[advanced-networking,高级网络应用]。</p>
</div>
<div class="paragraph">
<p><code>ping: sendto: Permission denied</code> 错误信息经常由防火墙的配置错误引起。 如果 <code>ipfw</code> 在内核中启用了但是没有定义规则， 那么默认的规则就是拒绝所有通讯，甚至 ping 请求！ 查阅 crossref:firewalls[firewalls,防火墙] 以了解更多信息。</p>
</div>
<div class="paragraph">
<p>有时网卡性能低下或者低于平均水平， 这种情况最好把传输媒介模式从 <code>autoselect</code> 改变为正确的传输介质模式。 这通常对大多数硬件有用， 但可能不会解决所有人的问题。 接着，检查所有网络设置，并且阅读 man:tuning[7] 手册页。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-virtual-hosts">9. 虚拟主机<a class="anchor" href="#configtuning-virtual-hosts"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD 的一个很普通的用途是虚拟主机站点， 一个服务器虚拟成很多服务器一样提供网络服务。 这通过在一个接口上绑定多个网络地址来实现。</p>
</div>
<div class="paragraph">
<p>一个特定的网络接口有一个&#34;真实&#34;的地址， 也可能有一些&#34;别名&#34;地址。这些别名通常用 <span class="filename">/etc/rc.conf</span> 中的记录来添加。</p>
</div>
<div class="paragraph">
<p>一个 <span class="filename">fxp0</span> 的别名记录类似于：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ifconfig_fxp0_alias0=&#34;inet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>记住别名记录必须从 <code>alias0</code> 开始并且按顺序递增(例如 <code>_alias1</code>、 <code>_alias2</code>)。 配置程序将会停止在第一个缺少的数字的地方。</p>
</div>
<div class="paragraph">
<p>f计算别名的子网掩码是很重要的，幸运的是它很简单。 对于一个接口来说，必须有一个描述子网掩码的地址。 任何在这个网段下的地址必须有一个全是 <code>1</code> 的子网掩码(通常表示为 <code>255.255.255.255</code> 或 <code>0xffffffff</code>。</p>
</div>
<div class="paragraph">
<p>举例来说， 假设使用 <span class="filename">fxp0</span> 连接到两个网络， 分别是 <code>10.1.1.0</code>， 其子网掩码为 <code>255.255.255.0</code>， 以及 <code>202.0.75.16</code>， 其子网掩码为 <code>255.255.255.240</code>。 我们希望从 <code>10.1.1.1</code> 到 <code>10.1.1.5</code> 以及从 <code>202.0.75.17</code> 到 <code>202.0.75.20</code> 的地址能够互相访问。 如前所述， 只有两个网段中的第一个地址 (本例中， <code>10.0.1.1</code> 和 <code>202.0.75.17</code>) 应使用真实的子网掩码； 其余的 (<code>10.1.1.2</code> 到 <code>10.1.1.5</code> 以及 <code>202.0.75.18</code> 到 <code>202.0.75.20</code>) 则必须配置为使用 <code>255.255.255.255</code> 作为子网掩码。</p>
</div>
<div class="paragraph">
<p>下面是根据上述描述所进行的 <span class="filename">/etc/rc.conf</span> 配置：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>ifconfig_fxp0=&#34;inet 10.1.1.1 netmask 255.255.255.0&#34;
ifconfig_fxp0_alias0=&#34;inet 10.1.1.2 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias1=&#34;inet 10.1.1.3 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias2=&#34;inet 10.1.1.4 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias3=&#34;inet 10.1.1.5 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias4=&#34;inet 202.0.75.17 netmask 255.255.255.240&#34;
ifconfig_fxp0_alias5=&#34;inet 202.0.75.18 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias6=&#34;inet 202.0.75.19 netmask 255.255.255.255&#34;
ifconfig_fxp0_alias7=&#34;inet 202.0.75.20 netmask 255.255.255.255&#34;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-configfiles">10. 配置文件<a class="anchor" href="#configtuning-configfiles"></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_etc_布局">10.1. <span class="filename">/etc</span> 布局<a class="anchor" href="#_etc_布局"></a></h3>
<div class="paragraph">
<p>在配置信息中有很多的目录，这些包括：</p>
</div>
<table class="tableblock frame-none grid-all stretch informaltable">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/etc</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一般的系统配置信息。这儿的数据是与特定系统相关的。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/etc/defaults</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">系统配置文件的默认版本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/etc/mail</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">额外的 man:sendmail[8] 配置信息，其他 MTA 配置文件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/etc/ppp</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于用户级和内核级 ppp 程序的配置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/etc/namedb</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">man:named[8] 数据的默认位置。通常 <span class="filename">named.conf</span> 和区域文件存放在这里。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/usr/local/etc</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">被安装的应用程序配置文件。可以参考每个应用程序的子目录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/usr/local/etc/rc.d</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">被安装程序的 启动/停止 脚本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="filename">/var/db</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">特定系统自动产生的数据库文件，像 package 数据库，位置数据库等等。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_主机名">10.2. 主机名<a class="anchor" href="#_主机名"></a></h3>
<div class="sect3">
<h4 id="_etcresolv_conf">10.2.1. <span class="filename">/etc/resolv.conf</span><a class="anchor" href="#_etcresolv_conf"></a></h4>
<div class="paragraph">
<p><span class="filename">/etc/resolv.conf</span> 指示了 FreeBSD 如何访问域名系统(DNS)。</p>
</div>
<div class="paragraph">
<p><span class="filename">resolv.conf</span> 中最常见的记录是：</p>
</div>
<table class="tableblock frame-none grid-all stretch informaltable">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nameserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">按顺序要查询的名字服务器的 IP 地址，最多三个。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>search</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">搜索机器名的列表。这通常由本地机器名的域决定。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本地域名。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>一个典型的 <span class="filename">resolv.conf</span> 文件：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>search example.com
nameserver 147.11.1.11
nameserver 147.11.100.30</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>只能使用一个 <code>search</code> 和 <code>domain</code> 选项。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果您在使用 DHCP，man:dhclient[8] 经常使用从 DHCP 服务器接受来的信息重写 <span class="filename">resolv.conf</span>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_etchosts">10.2.2. <span class="filename">/etc/hosts</span><a class="anchor" href="#_etchosts"></a></h4>
<div class="paragraph">
<p><span class="filename">/etc/hosts</span> 是 Internet 早期使用的一个简单文本数据库。 它结合 DNS 和 NIS 提供名字到 IP 地址的映射。 通过局域网连接的机器可以用这个简单的命名方案来替代设置一个 man:named[8] 服务器。另外，<span class="filename">/etc/hosts</span> 也可以提供一个 Internet 名称的本地纪录以减轻需要从外部查询带来的负担。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># $FreeBSD$
#
#
# Host Database
#
# This file should contain the addresses and aliases for local hosts that
# share this file.  Replace &#39;my.domain&#39; below with the domainname of your
# machine.
#
# In the presence of the domain name service or NIS, this file may
# not be consulted at all; see /etc/nsswitch.conf for the resolution order.
#
#
::1			localhost localhost.my.domain
127.0.0.1		localhost localhost.my.domain
#
# Imaginary network.
#10.0.0.2		myname.my.domain myname
#10.0.0.3		myfriend.my.domain myfriend
#
# According to RFC 1918, you can use the following IP networks for
# private nets which will never be connected to the Internet:
#
#	10.0.0.0	-   10.255.255.255
#	172.16.0.0	-   172.31.255.255
#	192.168.0.0	-   192.168.255.255
#
# In case you want to be able to connect to the Internet, you need
# real official assigned numbers.  Do not try to invent your own network
# numbers but instead get one from your network provider (if any) or
# from your regional registry (ARIN, APNIC, LACNIC, RIPE NCC, or AfriNIC.)
#</pre>
</div>
</div>
<div class="paragraph">
<p><span class="filename">/etc/hosts</span> 用简单的格式：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[Internet address] [official hostname] [alias1] [alias2] ...</pre>
</div>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>10.0.0.1 myRealHostname.example.com myRealHostname foobar1 foobar2</pre>
</div>
</div>
<div class="paragraph">
<p>参考 man:hosts[5] 以获得更多信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_日志文件配置">10.3. 日志文件配置<a class="anchor" href="#_日志文件配置"></a></h3>
<div class="sect3">
<h4 id="_syslog_conf">10.3.1. <span class="filename">syslog.conf</span><a class="anchor" href="#_syslog_conf"></a></h4>
<div class="paragraph">
<p><span class="filename">syslog.conf</span> 是 man:syslogd[8] 程序的配置文件。 它指出了的 <code>syslog</code> 哪种信息类型被存储在特定的日志文件中。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># $FreeBSD$
#
#       Spaces ARE valid field separators in this file. However,
#       other *nix-like systems still insist on using tabs as field
#       separators. If you are sharing this file between systems, you
#       may want to use only tabs as field separators here.
#       Consult the syslog.conf(5) manual page.
*.err;kern.debug;auth.notice;mail.crit          /dev/console
*.notice;kern.debug;lpr.info;mail.crit;news.err /var/log/messages
security.*                                      /var/log/security
mail.info                                       /var/log/maillog
lpr.info                                        /var/log/lpd-errs
cron.*                                          /var/log/cron
*.err                                           root
*.notice;news.err                               root
*.alert                                         root
*.emerg                                         *
# uncomment this to log all writes to /dev/console to /var/log/console.log
#console.info                                   /var/log/console.log
# uncomment this to enable logging of all log messages to /var/log/all.log
#*.*                                            /var/log/all.log
# uncomment this to enable logging to a remote log host named loghost
#*.*                                            @loghost
# uncomment these if you&#39;re running inn
# news.crit                                     /var/log/news/news.crit
# news.err                                      /var/log/news/news.err
# news.notice                                   /var/log/news/news.notice
!startslip
*.*                                             /var/log/slip.log
!ppp
*.*                                             /var/log/ppp.log</pre>
</div>
</div>
<div class="paragraph">
<p>参考 man:syslog.conf[5] 手册页以获得更多信息</p>
</div>
</div>
<div class="sect3">
<h4 id="_newsyslog_conf">10.3.2. <span class="filename">newsyslog.conf</span><a class="anchor" href="#_newsyslog_conf"></a></h4>
<div class="paragraph">
<p><span class="filename">newsyslog.conf</span> 是一个通常用 man:cron[8] 计划运行的 man:newsyslog[8] 程序的配置文件。 man:newsyslog[8] 指出了什么时候日志文件需要打包或者重新整理。 比如 <span class="filename">logfile</span> 被移动到 <span class="filename">logfile.0</span>，<span class="filename">logfile.0</span> 被移动到 <span class="filename">logfile.1</span> 等等。另外，日志文件可以用 man:gzip[1] 来压缩，它们是这样的命名格式： <span class="filename">logfile.0.gz</span>，<span class="filename">logfile.1.gz</span> 等等。</p>
</div>
<div class="paragraph">
<p><span class="filename">newsyslog.conf</span> 指出了哪个日志文件要被管理，要保留多少和它们什么时候被创建。 日志文件可以在它们达到一定大小或者在特定的日期被重新整理。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># configuration file for newsyslog
# $FreeBSD$
#
# filename          [owner:group]    mode count size when [ZB] [/pid_file] [sig_num]
/var/log/cron                           600  3     100  *     Z
/var/log/amd.log                        644  7     100  *     Z
/var/log/kerberos.log                   644  7     100  *     Z
/var/log/lpd-errs                       644  7     100  *     Z
/var/log/maillog                        644  7     *    @T00  Z
/var/log/sendmail.st                    644  10    *    168   B
/var/log/messages                       644  5     100  *     Z
/var/log/all.log                        600  7     *    @T00  Z
/var/log/slip.log                       600  3     100  *     Z
/var/log/ppp.log                        600  3     100  *     Z
/var/log/security                       600  10    100  *     Z
/var/log/wtmp                           644  3     *    @01T05 B
/var/log/daily.log                      640  7     *    @T00  Z
/var/log/weekly.log                     640  5     1    $W6D0 Z
/var/log/monthly.log                    640  12    *    $M1D0 Z
/var/log/console.log                    640  5     100  *     Z</pre>
</div>
</div>
<div class="paragraph">
<p>参考 man:newsyslog[8] 手册页以获得更多信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configtuning-sysctlconf">10.4. <span class="filename">sysctl.conf</span><a class="anchor" href="#configtuning-sysctlconf"></a></h3>
<div class="paragraph">
<p><span class="filename">sysctl.conf</span> 和 <span class="filename">rc.conf</span> 这两个文件的风格很接近。 其中的配置均为 <code>变量=值</code> 这样的形式。 在这个文件中配置的值， 均会在系统进入多用户模式之后进行实际的修改操作。 需要注意的是， 并不是所有的变量都能够在多用户模式下修改。</p>
</div>
<div class="paragraph">
<p>如果希望关闭对收到致命的信号退出的进程进行记录， 并阻止普通用户看到其他用户的进程， 可以在 <span class="filename">sysctl.conf</span> 中进行下列配置：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># 不记录由于致命信号导致的进程退出 (例如信号 11，访问越界)
kern.logsigexit=0

# 阻止用户看到以其他用户 UID 身份执行的进程。
security.bsd.see_other_uids=0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-sysctl">11. 用 sysctl 进行调整<a class="anchor" href="#configtuning-sysctl"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>man:sysctl[8] 是一个允许您改变正在运行中的 FreeBSD 系统的接口。它包含一些 TCP/IP 堆栈和虚拟内存系统的高级选项， 这可以让有经验的管理员提高引人注目的系统性能。用 man:sysctl[8] 可以读取设置超过五百个系统变量。</p>
</div>
<div class="paragraph">
<p>基于这点，man:sysctl[8] 提供两个功能：读取和修改系统设置。</p>
</div>
<div class="paragraph">
<p>查看所有可读变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% sysctl <span class="nt">-a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>读一个指定的变量，例如 <code>kern.maxproc</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">% sysctl kern.maxproc
kern.maxproc: 1044</code></pre>
</div>
</div>
<div class="paragraph">
<p>要设置一个指定的变量，直接用 <em>variable</em>=<em>value</em> 这样的语法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl kern.maxfiles=5000</span>
kern.maxfiles: 2088 -&gt; 5000</code></pre>
</div>
</div>
<div class="paragraph">
<p>sysctl 变量的设置通常是字符串、数字或者布尔型。 (布尔型用 <code>1</code> 来表示’yes&#39;，用 <code>0</code> 来表示’no&#39;)。</p>
</div>
<div class="paragraph">
<p>如果你想在每次机器启动时自动设置某些变量， 可将它们加入到文件 <span class="filename">/etc/sysctl.conf</span> 之中。更多信息，请参阅手册页 man:sysctl.conf[5] 及 <a href="#configtuning-sysctlconf"><span class="filename">sysctl.conf</span></a>。</p>
</div>
<div class="sect2">
<h3 id="sysctl-readonly">11.1. 只读的 man:sysctl[8]<a class="anchor" href="#sysctl-readonly"></a></h3>
<div class="paragraph">
<p>有时可能会需要修改某些只读的 man:sysctl[8] 的值。 尽管有时不得不这样做， 但只有通过(重新)启动才能达到这样的目的。</p>
</div>
<div class="paragraph">
<p>例如一些膝上型电脑的 man:cardbus[4] 设备不会探测内存范围，并且产生看似于这样的错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">cbb0: Could not map register memory
device_probe_and_attach: cbb0 attach returned 12</code></pre>
</div>
</div>
<div class="paragraph">
<p>像上面的错误通常需要修改一些只读的 man:sysctl[8] 默认设置。要实现这点，用户可以在本地的 <span class="filename">/boot/loader.conf.local</span> 里面放一个 man:sysctl[8] &#34;OIDs&#34;。那些设置定位在 <span class="filename">/boot/defaults/loader.conf</span> 文件中。</p>
</div>
<div class="paragraph">
<p>修复上面的问题用户需要在刚才所说的文件中设置 <code>hw.pci.allow_unsupported_io_range=1</code>。现在 man:cardbus[4] 就会正常的工作了。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-disk">12. 调整磁盘<a class="anchor" href="#configtuning-disk"></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_sysctl_变量">12.1. Sysctl 变量<a class="anchor" href="#_sysctl_变量"></a></h3>
<div class="sect3">
<h4 id="_vfs_vmiodirenable">12.1.1. <code>vfs.vmiodirenable</code><a class="anchor" href="#_vfs_vmiodirenable"></a></h4>
<div class="paragraph">
<p><code>vfs.vmiodirenable</code> sysctl 变量可以设置成0(关)或者1(开)；默认是1。 这个变量控制目录是否被系统缓存。大多数目录是小的， 在系统中只使用单个片断(典型的是1K)并且在缓存中使用的更小 (典型的是512字节)。当这个变量设置为关闭 (<code>0</code>) 时， 缓存器仅仅缓存固定数量的目录，即使您有很大的内存。 而将其开启 (设置为1) 时， 则允许缓存器用 VM 页面缓存来缓存这些目录，让所有可用内存来缓存目录。 不利的是最小的用来缓存目录的核心内存是大于 512 字节的物理页面大小(通常是 4k)。 我们建议如果您在运行任何操作大量文件的程序时保持这个选项打开的默认值。 这些服务包括 web 缓存，大容量邮件系统和新闻系统。 尽管可能会浪费一些内存，但打开这个选项通常不会降低性能。 但还是应该检验一下。</p>
</div>
</div>
<div class="sect3">
<h4 id="_vfs_write_behind">12.1.2. <code>vfs.write_behind</code><a class="anchor" href="#_vfs_write_behind"></a></h4>
<div class="paragraph">
<p><code>vfs.write_behind</code> sysctl 变量默认是 <code>1</code> (打开)。 它告诉文件系统簇被收集满的时候把内容写进介质， 典型的是在写入大的连续的文件时。 主要的想法是， 如果可能对 I/O 性能会产生负面影响时， 应尽量避免让缓冲缓存被未同步缓冲区充满。 然而它可能降低处理速度并且在某些情况下您可能想要关闭它。</p>
</div>
</div>
<div class="sect3">
<h4 id="_vfs_hirunningspace">12.1.3. <code>vfs.hirunningspace</code><a class="anchor" href="#_vfs_hirunningspace"></a></h4>
<div class="paragraph">
<p><code>vfs.hirunningspace</code> sysctl 变量决定了在任何给定情况下， 有多少写 I/O 被排进队列以给系统的磁盘控制器。 默认值一般是足够的，但是对有很多磁盘的机器来说您可能需要把它设置成 4M 或 5M。注意这个设置成很高的值(超过缓存器的写极限)会导致坏的性能。 不要盲目的把它设置太高！高的数值会导致同时发生的读操作的迟延。</p>
</div>
<div class="paragraph">
<p>sysctl 中还有许多与 buffer cache 和 VM页面 cache 有关的值， 一般不推荐修改它们。 虚拟内存系统已经能够很好地进行自动调整了。</p>
</div>
</div>
<div class="sect3">
<h4 id="_vm_swap_idle_enabled">12.1.4. <code>vm.swap_idle_enabled</code><a class="anchor" href="#_vm_swap_idle_enabled"></a></h4>
<div class="paragraph">
<p><code>vm.swap_idle_enabled</code> sysctl 变量在有很多用户进入、离开系统和有很多空闲进程的大的多用户系统中很有用。 这些系统注重在空闲的内存中间产生连续压力的处理。通过 <code>vm.swap_idle_threshold1</code> 和 <code>vm.swap_idle_threshold2</code> 打开这个特性并且调整交换滞后 (在空闲时)允许您降低内存页中空闲进程的优先权，从而比正常的出页 (pageout)算法更快。这给出页守护进程带来了帮助。 除非您需要否则不要把这个选项打开，因为您所权衡的是更快地进入内存， 因而它会吃掉更多的交换和磁盘带宽。在小的系统上它会有决定性的效果， 但是在大的系统上它已经做了合适的页面调度这个选项允许 VM 系统容易的让全部的进程进出内存。</p>
</div>
</div>
<div class="sect3">
<h4 id="_hw_ata_wc">12.1.5. <code>hw.ata.wc</code><a class="anchor" href="#_hw_ata_wc"></a></h4>
<div class="paragraph">
<p>FreeBSD 4.3 中默认将 IDE 的写缓存关掉了。 这会降低到 IDE 磁盘用于写入操作的带宽， 但我们认为这有助于避免硬盘厂商所引入的， 可能引致严重的数据不一致问题。 这类问题实际上是由于 IDE 硬盘就写操作完成这件事的不诚实导致的。 当启用了 IDE 写入缓存时， IDE 硬盘驱动器不但不会按顺序将数据写到盘上， 而且当磁盘承受重载时， 它甚至会自作主张地对推迟某些块的实际写操作。 这样一来， 在系统发生崩溃或掉电时， 就会导致严重的文件系统损坏。 基于这些考虑， 我们将 FreeBSD 的默认配置改成了更为安全的禁用 IDE 写入缓存。 然而不幸的是， 这样做导致了性能的大幅降低， 因此在后来的发行版中这个配置又改为默认启用了。 您可以通过观察 <code>hw.ata.wc</code> sysctl 变量， 来确认您的系统中所采用的默认值。 如果 IDE 写缓存被禁用， 您可以通过将内核变量设置为 1 来启用它。 这一操作必须在启动时通过 boot loader 来完成。 在内核启动之后尝试这么做是没有任何作用的。</p>
</div>
<div class="paragraph">
<p>要了解更多的信息，请查阅 man:ata[4]。</p>
</div>
</div>
<div class="sect3">
<h4 id="_scsi_delay_kern_cam_scsi_delay">12.1.6. <code>SCSI_DELAY</code> (<code>kern.cam.scsi_delay</code>)<a class="anchor" href="#_scsi_delay_kern_cam_scsi_delay"></a></h4>
<div class="paragraph">
<p><code>SCSI_DELAY</code> 内核配置会缩短系统启动时间。 默认值在系统启动过程中有 <code>15</code> 秒的迟延时间， 这是一个足够多且可靠的值。把它减少到 <code>5</code> 通常也能工作(特别是现代的驱动器)。 您可以在系统引导时调整引导加载器变量 <code>kern.cam.scsi_delay</code> 来改变它。 需要注意的是， 此处使用的单位是 <em>毫秒</em> 而 <em>不</em> 是 <em>秒</em> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="soft-updates">12.2. Soft Updates<a class="anchor" href="#soft-updates"></a></h3>
<div class="paragraph">
<p>man:tunefs[8] 程序能够用来很好的调整文件系统。 这个程序有很多不同的选项，但是现在只介绍 Soft Updates 的打开和关闭，这样做：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tunefs -n enable /filesystem</span>
<span class="c"># tunefs -n disable /filesystem</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在文件系统被挂载之后不能用 man:tunefs[8] 来修改。打开 Soft Updates 的最佳时机是在单用户模式下任何分区被挂载前。</p>
</div>
<div class="paragraph">
<p>Soft Updates 极大地改善了元数据修改的性能， 主要是文件创建和删除，通过内存缓存。我们建议您在所有的文件系统上使用 Soft Updates。应该知道 Soft Updates 的两点：首先， Soft Updates 保证了崩溃后的文件系统完整性，但是很可能有几秒钟 (甚至一分钟！) 之前的数据没有写到物理磁盘。如果您的系统崩溃了您可能会丢失很多工作。 第二，SoftUpdates 推迟文件系统块的释放时间。如果在文件系统 (例如根文件系统)快满了的情况下对系统进行大规模的升级比如 <code>make installworld</code>， 可能会引起磁盘空间不足从而造成升级失败。</p>
</div>
<div class="sect3">
<h4 id="_soft_updates_的详细资料">12.2.1. Soft Updates 的详细资料<a class="anchor" href="#_soft_updates_的详细资料"></a></h4>
<div class="paragraph">
<p>有两种传统的方法来把文件系统的元数据 (meta-data) 写入磁盘。 (Meta-data更新是更新类似 inodes 或者目录这些没有内容的数据)</p>
</div>
<div class="paragraph">
<p>从前，默认方法是同步更新这些元数据(meta-data)。 如果一个目录改变了，系统在真正写到磁盘之前一直等待。 文件数据缓存(文件内容)在这之后以非同步形式写入。 这么做有利的一点是操作安全。如果更新时发生错误，元数据(meta-data) 一直处于完整状态。文件要不就被完整的创建要不根本就不创建。 如果崩溃时找不到文件的数据块，man:fsck[8] 可以找到并且依靠把文件大小设置为 0 来修复文件系统。 另外，这么做既清楚又简单。缺点是元数据(meta-data)更新很慢。例如 <code>rm -r</code> 命令，依次触及目录下的所有文件， 但是每个目录的改变(删除一个文件)都要同步写入磁盘。 这包含它自己更新目录，inode 表和可能对文件分散的块的更新。 同样问题出现大的文件操作上(比如 <code>tar -x</code>)。</p>
</div>
<div class="paragraph">
<p>第二种方法是非同步元数据更新。这是 Linux/ext2fs 和 *BSD ufs 的 <code>mount -o async</code> 默认的方法。所有元数据更新也是通过缓存。 也就是它们会混合在文件内容数据更新中。 这个方法的优点是不需要等待每个元数据更新都写到磁盘上， 所以所有引起元数据更新大的操作比同步方式更快。同样， 这个方法也是清楚且简单的，所以代码中的漏洞风险很小。 缺点是不能保证文件系统的状态一致性。如果更新大量元数据时失败 (例如掉电或者按了重启按钮)，文件系统会处在不可预知的状态。 系统再启动时没有机会检查文件系统的状态；inode 表更新的时候可能文件的数据块已经写入磁盘了但是相关联的目录没有，却不能用 <code>fsck</code> 命令来清理(因为磁盘上没有所需要的信息)。 如果文件系统修复后损坏了，唯一的选择是使用 man:newfs[8] 并且从备份中恢复它。</p>
</div>
<div class="paragraph">
<p>这个问题通常的解决办法是使用 <em>dirty region logging</em> 或者 <em>journaling</em> 尽管它不是一贯的被使用并且有时候应用到其他的事务纪录中更好。 这种方法元数据更新依然同步写入，但是只写到磁盘的一个小区域。 过后他们将会被移动到正确的位置。因为纪录区很小， 磁盘上接近的区域磁头不需要移动很长的距离，所以这些比写同步快一些。 另外这个方法的复杂性有限，所以出现错误的机会也很少。缺点是元数据要写两次 (一次写到纪录区域，一次写到正确的区域)。正常情况下， 悲观的性能可能会发生。从另一方面来讲， 崩溃的时候所有未发生的元数据操作可以很快的在系统启动之后从记录中恢复过来。</p>
</div>
<div class="paragraph">
<p>Kirk McKusick，伯克利 FFS 的开发者，用 Soft Updates 解决了这个问题：元数据更新保存在内存中并且按照排列的顺序写入到磁盘 (&#34;有序的元数据更新&#34;)。这样的结果是，在繁重的元数据操作中， 如果先前的更新还在内存中没有被写进磁盘，后来的更新就会捕捉到。 所以所有的目录操作在写进磁盘的时候首先在内存中执行 (数据块按照它们的位置来排列，所以它们不会在元数据前被写入)。 如果系统崩溃了这将导致一个固定的 &#34;日志回朔&#34;： 所有不知如何写入磁盘的操作都像没有发生过一样。文件系统的一致性保持在 30 到 60 秒之前。它保证了所有正在使用的资源被标记例如块和 inodes。崩溃之后， 唯一的资源分配错误是一个实际是&#34;空闲&#34;的资源的资源被标记为&#34;使用&#34;。 man:fsck[8] 可以认出这种情况并且释放不再使用的资源。它对于忽略崩溃后用 <code>mount -f</code> 强制挂上的文件系统的错误状态是安全的。 为了释放可能没有使用的资源，man:fsck[8] 需要在过后的时间运行。一个主意是用 <em>后台 fsck</em>：系统启动的时候只有一个文件系统的 <em>快照</em> 被记录下来。<code>fsck</code> 可以在过后运行。所有文件系统可以在&#34;有错误&#34;的时候被挂接， 所以系统可以在多用户模式下启动。接着，后台 <code>fsck</code> 可以在所有文件系统需要的时候启动来释放可能没有使用的资源。 (尽管这样，不用 Soft Updates 的文件系统依然需要通常的 <code>fsck</code>。)</p>
</div>
<div class="paragraph">
<p>f它的优点是元数据操作几乎跟非同步一样快 (也就是比需要两次元数据写操作的 <em>logging</em> 更快)。缺点是代码的复杂性(意味着对于丢失用户敏感数据有更多的风险) 和高的内存使用量。另外它有些特点需要知道。崩溃之后， 文件系统状态会&#34;落后&#34;一些。同步的方法用 <code>fsck</code> 后在一些地方可能产生一些零字节的文件， 这些文件在用 Soft Updates 文件系统之后不会存在， 因为元数据和文件内容根本没有写进磁盘(可能发生在运行 <code>rm</code> 之后)。这可能在文件系统上安装大量数据时候引发问题， 没有足够的剩余空间来两次存储所有文件。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configtuning-kernel-limits">13. 调整内核限制<a class="anchor" href="#configtuning-kernel-limits"></a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="file-process-limits">13.1. 文件/进程限制<a class="anchor" href="#file-process-limits"></a></h3>
<div class="sect3">
<h4 id="kern-maxfiles">13.1.1. <code>kern.maxfiles</code><a class="anchor" href="#kern-maxfiles"></a></h4>
<div class="paragraph">
<p><code>kern.maxfiles</code> 可以根据系统的需要适当增减。 这个变量用于指定在系统中允许的文件描述符的最大数量。 当文件描述符表满的时候， <code>file: table is full</code> 会在系统消息缓冲区中反复出现， 您可以使用 <code>dmesg</code> 命令来观察这一现象。</p>
</div>
<div class="paragraph">
<p>每个打开的文件、 套接字和管道， 都会占用一个文件描述符。 在大型生产服务器上， 可能会轻易地用掉数千个文件描述符， 具体用量取决于服务的类型和并行启动的服务数量。</p>
</div>
<div class="paragraph">
<p>在早期版本的 FreeBSD 中， <code>kern.maxfiles</code> 的默认值， 是根据您内核配置文件中的 <code>maxusers</code> 选项计算的。 <code>kern.maxfiles</code> 这个数值， 会随 <code>maxusers</code> 成比例地增减。 当编译定制的内核时， 按照您系统的用途来修改这个值是个好主意。 这个数字同时还决定内核的许多预设的限制值。 有时， 尽管并不会真的有 256 个用户同时连接一台生产服务器， 但对于高负载的 web 服务器而言， 却可能需要与之类似的资源。</p>
</div>
<div class="paragraph">
<p>变量 <code>kern.maxusers</code> 会在系统启动时， 根据可用内存的尺寸进行计算， 在内核开始运行之后， 可以通过只读的 <code>kern.maxusers</code> sysctl 变量值来进行观察。 有些情况下， 可能会希望使用更大或更小一些的 <code>kern.maxusers</code>， 它可以以加载器变量的形式进行配置； 类似 64、 128 和 256 这样的值都并不罕见。 我们不推荐使用超过 256 的值， 除非您需要巨量的文件描述符； 根据 <code>kern.maxusers</code> 推算默认值的那些变量， 一般都可以在引导甚至运行时通过 <span class="filename">/boot/loader.conf</span> (请参见 man:loader.conf[5] 联机手册或 <span class="filename">/boot/defaults/loader.conf</span> 文件来获得相关的指导) 或这篇文档的其余部分所介绍的方式来调整。</p>
</div>
<div class="paragraph">
<p>在较早的版本中， 如果您明确地将 <code>maxusers</code> 设置为 <code>0</code>， 则系统会自动地根据硬件配置来确定这个值。。 在 FreeBSD 5.X 和更高版本中， <code>maxusers</code> 如果不指定的话， 就会取默认值 <code>0</code>。 如果希望自行管理 <code>maxusers</code>， 则应配置一个不低于 4 的值， 特别是使用 X Window System 或编译软件的时候。 这样做的原因是， <code>maxusers</code> 所决定的一个最为重要的表的尺寸会影响最大进程数， 这个数值将是 <code>20 + 16 * maxusers</code>。 因此如果将 <code>maxusers</code> 设置为 1， 您就只能同时运行 36 个进程， 这还包括了 18 个左右的系统引导时启动的进程， 以及 15 个左右的， 在您启动 X Window System 时所引发的进程。 即使是简单的任务， 如阅读联机手册， 也需要启动多至九个的进程， 用以过滤、 解压缩， 并显示它。 将 <code>maxusers</code> 设为 64 将允许您同时执行最多 1044 个进程， 这几乎足以满足任何需要了。 不过， 如果您看在启动其它程序， 或运行用以支持大量用户的服务 (例如 <code>ftp.FreeBSD.org</code>) 时， 看到令人担忧的  错误， 就应该提高这一数值， 并重新联编内核。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>maxusers</code> 并 <em>不能</em> 限制实际能够登录到您系统上来的用户的数量。 它的主要作用是根据您可能支持的用户数量来为一系列系统数据表设置合理的尺寸， 以便提供支持他们所需运行的进程资源。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_kern_ipc_somaxconn">13.1.2. <code>kern.ipc.somaxconn</code><a class="anchor" href="#_kern_ipc_somaxconn"></a></h4>
<div class="paragraph">
<p><code>kern.ipc.somaxconn</code> sysctl 变量 限制了接收新 TCP 连接侦听队列的大小。对于一个经常处理新连接的高负载 web服务环境来说，默认的 <code>128</code> 太小了。 大多数环境这个值建议增加到 <code>1024</code> 或者更多。 服务进程会自己限制侦听队列的大小(例如 man:sendmail[8] 或者 Apache)， 常常在它们的配置文件中有设置队列大小的选项。 大的侦听队列对防止拒绝服务  攻击也会有所帮助。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nmbclusters">13.2. 网络限制<a class="anchor" href="#nmbclusters"></a></h3>
<div class="paragraph">
<p><code>NMBCLUSTERS</code> 内核配置选项指出了系统可用的网络Mbuf的数量。 一个高流量的服务器使用一个小数目的网络缓存会影响 FreeBSD 的性能。 每个 cluster 可能需要2K内存，所以一个1024的值需要在内核中给网络缓存保留2M内存。 可以用简单的方法计算出来需要多少网络缓存。 如果您有一个同时发生1000个以上连接的web服务器， 并且每个连接用掉16K接收和发送缓存， 就需要大概32M网络缓存来确保web服务器的工作。 一个好的简单计算方法是乘以2，所以2x32Mb/2Kb=64MB/2kb=32768。 我们建议在有大量内存的机器上把这个值设置在4096到32768之间。 没有必要把它设置成任意太高的值，它会在启动时引起崩溃。 man:netstat[1] 的 <code>-m</code> 选项可以用来观察网络cluster使用情况。</p>
</div>
<div class="paragraph">
<p><code>kern.ipc.nmbclusters</code> 可以用来在启动时刻调节这个。 仅仅在旧版本的 FreeBSD 需要使用 <code>NMBCLUSTERS</code> man:config[8] 选项。</p>
</div>
<div class="paragraph">
<p>经常使用 man:sendfile[2] 系统调用的繁忙的服务器， 有必要通过 <code>NSFBUFS</code> 内核选项或者在 <span class="filename">/boot/loader.conf</span> (查看 man:loader[8] 以获得更多细节) 中设置它的值来调节 man:sendfile[2] 缓存数量。 这个参数需要调节的普通原因是在进程中看到 <code>sfbufa</code> 状态。sysctl <code>kern.ipc.nsfbufs</code> 变量在内核配置变量中是只读的。 这个参数是由 <code>kern.maxusers</code> 决定的，然而它可能有必要因此而调整。</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>即使一个套接字被标记成非阻塞，在这个非阻塞的套接字上呼叫 man:sendfile[2] 可能导致 man:sendfile[2] 呼叫阻塞直到有足够的 <code>struct sf_buf</code> 可用。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_net_inet_ip_portrange">13.2.1. <code>net.inet.ip.portrange.*</code><a class="anchor" href="#_net_inet_ip_portrange"></a></h4>
<div class="paragraph">
<p><code>net.inet.ip.portrange.*</code> sysctl 变量自动的控制绑定在 TCP 和 UDP 套接字上的端口范围。 这里有三个范围：一个低端范围，一个默认范围和一个高端范围。 大多数网络程序分别使用由 <code>net.inet.ip.portrange.first</code> 和 <code>net.inet.ip.portrange.last</code> 控制的从 1024 到 5000 的默认范围。端口范围用作对外连接，并且某些情况可能用完系统的端口， 这经常发生在运行一个高负荷 web 代理服务器的时候。 这个端口范围不是用来限制主要的例如 web 服务器进入连接或者有固定端口例如邮件传递对外连接的。 有时您可能用完了端口，那就建议适当的增加 <code>net.inet.ip.portrange.last</code>。 <code>10000</code>、<code>20000</code> 或者 <code>30000</code> 可能是适当的值。 更改端口范围的时候也要考虑到防火墙。 一些防火墙会阻止端口的大部分范围 (通常是低范围的端口)并且用高端口进行对外连接(-)。 基于这个问题建议不要把 <code>net.inet.ip.portrange.first</code> 设的太小。</p>
</div>
</div>
<div class="sect3">
<h4 id="_tcp_带宽迟延bandwidth_delay_product">13.2.2. TCP 带宽迟延(Bandwidth Delay Product)<a class="anchor" href="#_tcp_带宽迟延bandwidth_delay_product"></a></h4>
<div class="paragraph">
<p>限制 TCP 带宽延迟积和 NetBSD 的 TCP/Vegas 类似。 它可以通过将 sysctl 变量 <code>net.inet.tcp.inflight.enable</code> 设置成 <code>1</code> 来启用。 系统将尝试计算每一个连接的带宽延迟积， 并将排队的数据量限制在恰好能保持最优吞吐量的水平上。</p>
</div>
<div class="paragraph">
<p>这一特性在您的服务器同时向使用普通调制解调器， 千兆以太网， 乃至更高速度的光与网络连接 (或其他带宽延迟积很大的连接) 的时候尤为重要， 特别是当您同时使用滑动窗缩放， 或使用了大的发送窗口的时候。 如果启用了这个选项， 您还应该把 <code>net.inet.tcp.inflight.debug</code> 设置为 <code>0</code> (禁用调试)， 对于生产环境而言， 将 <code>net.inet.tcp.inflight.min</code> 设置成至少 <code>6144</code> 会很有好处。 然而， 需要注意的是， 这个值设置过大事实上相当于禁用了连接带宽延迟积限制功能。 这个限制特性减少了在路由和交换包队列的堵塞数据数量， 也减少了在本地主机接口队列阻塞的数据的数量。在少数的等候队列中、 交互式连接，尤其是通过慢速的调制解调器，也能用低的 <em>往返时间</em>操作。但是，注意这只影响到数据发送 (上载/服务端)。对数据接收(下载)没有效果。</p>
</div>
<div class="paragraph">
<p>调整 <code>net.inet.tcp.inflight.stab</code> 是 <em>不</em> 推荐的。 这个参数的默认值是 20， 表示把 2 个最大包加入到带宽延迟积窗口的计算中。 额外的窗口似的算法更为稳定， 并改善对于多变网络环境的相应能力， 但也会导致慢速连接下的 ping 时间增长 (尽管还是会比没有使用 inflight 算法低许多)。 对于这些情形， 您可能会希望把这个参数减少到 15， 10， 或 5； 并可能因此而不得不减少 <code>net.inet.tcp.inflight.min</code> (比如说， 3500) 来得到希望的效果。 减少这些参数的值， 只应作为最后不得已时的手段来使用。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_虚拟内存">13.3. 虚拟内存<a class="anchor" href="#_虚拟内存"></a></h3>
<div class="sect3">
<h4 id="_kern_maxvnodes">13.3.1. <code>kern.maxvnodes</code><a class="anchor" href="#_kern_maxvnodes"></a></h4>
<div class="paragraph">
<p>vnode 是对文件或目录的一种内部表达。 因此， 增加可以被操作系统利用的 vnode 数量将降低磁盘的 I/O。 一般而言， 这是由操作系统自行完成的， 也不需要加以修改。 但在某些时候磁盘 I/O 会成为瓶颈， 而系统的 vnode 不足， 则这一配置应被增加。 此时需要考虑是非活跃和空闲内存的数量。</p>
</div>
<div class="paragraph">
<p>要查看当前在用的 vnode 数量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl vfs.numvnodes</span>
vfs.numvnodes: 91349</code></pre>
</div>
</div>
<div class="paragraph">
<p>要查看最大可用的 vnode 数量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl kern.maxvnodes</span>
kern.maxvnodes: 100000</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果当前的 vnode 用量接近最大值， 则将 <code>kern.maxvnodes</code> 值增大 1,000 可能是个好主意。 您应继续查看 <code>vfs.numvnodes</code> 的数值， 如果它再次攀升到接近最大值的程度， 仍需继续提高 <code>kern.maxvnodes</code>。 在 man:top[1] 中显示的内存用量应有显著变化， 更多内存会处于活跃 (active) 状态。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-swap-space">14. 添加交换空间<a class="anchor" href="#adding-swap-space"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>不管您计划得如何好，有时候系统并不像您所期待的那样运行。 如果您发现需要更多的交换空间，添加它很简单。 有三种方法增加交换空间：添加一块新的硬盘驱动器、通过 NFS 使用交换空间和在一个现有的分区上创建一个交换文件。</p>
</div>
<div class="paragraph">
<p>要了解关于如何加密交换区， 相关配置， 以及为什么要这样做， 请参阅手册的 crossref:disks[swap-encrypting,对交换区进行加密]。</p>
</div>
<div class="sect2">
<h3 id="new-drive-swap">14.1. 在新的硬盘驱动器上使用交换空间<a class="anchor" href="#new-drive-swap"></a></h3>
<div class="paragraph">
<p>这是添加交换空间最好的方法， 当然为了达到这个目的需要添加一块硬盘。 毕竟您总是可以使用另一块磁盘。如果能这么做， 重新阅读一下手册中关于交换空间的 <a href="#configtuning-initial">初步配置</a> 来了解如何最优地安排交换空间。</p>
</div>
</div>
<div class="sect2">
<h3 id="nfs-swap">14.2. 通过 NFS 交换<a class="anchor" href="#nfs-swap"></a></h3>
<div class="paragraph">
<p>除非没有可以用作交换空间的本地硬盘时， 否则不推荐您使用 NFS 来作为交换空间使用。 NFS 交换会受到可用网络带宽限制并且增加 NFS 服务器的负担。</p>
</div>
</div>
<div class="sect2">
<h3 id="create-swapfile">14.3. 交换文件<a class="anchor" href="#create-swapfile"></a></h3>
<div class="paragraph">
<p>您可以创建一个指定大小的文件用来当作交换文件。 在我们的例子中我们将会使用叫做 <span class="filename">/usr/swap0</span> 的 64MB 大小的文件。当然您也可以使用任何您所希望的名字。</p>
</div>
<div class="exampleblock">
<div class="title">例 1. 在 FreeBSD 中创建交换文件</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>确认您的内核配置包含虚拟磁盘(Memory disk)驱动 (man:md[4])。它在 <span class="filename">GENERIC</span> 内核中是默认的。</p>
<div class="literalblock programlisting">
<div class="content">
<pre>device   md   # Memory &#34;disks&#34;</pre>
</div>
</div>
</li>
<li>
<p>创建一个交换文件(<span class="filename">/usr/swap0</span>)：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/zero of=/usr/swap0 bs=1024k count=64</span></code></pre>
</div>
</div>
</li>
<li>
<p>赋予它(<span class="filename">/usr/swap0</span>)一个适当的权限：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># chmod 0600 /usr/swap0</span></code></pre>
</div>
</div>
</li>
<li>
<p>在 <span class="filename">/etc/rc.conf</span> 中启用交换文件：</p>
<div class="literalblock programlisting">
<div class="content">
<pre>swapfile=&#34;/usr/swap0&#34;   # Set to name of swapfile if aux swapfile desired.</pre>
</div>
</div>
</li>
<li>
<p>通过重新启动机器或下面的命令使交换文件立刻生效：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -a -t vnode -f /usr/swap0 -u 0 &amp;&amp; swapon /dev/md0</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acpi-overview">15. 电源和资源管理<a class="anchor" href="#acpi-overview"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>BIOS 接口管理，例如<em>可插拔 BIOS (PNPBIOS)</em>或者<em>高级电源管理(APM)</em> 等等。电源和资源管理是现代操作系统的关键组成部分。 例如您可能当系统温度过高的时候让您的操作系统能监视到 (并且可能提醒您)。</p>
</div>
<div class="paragraph">
<p>以有效的方式利用硬件资源是非常重要的。 在引入 ACPI 之前， 管理电源使用和系统散热对操作系统是很困难的。 硬件由 BIOS 进行管理， 因而用户对电源管理配置的控制和查看都比较困难。 一些系统通过 <em>高级电源管理 (APM)</em> 提供了有限的配置能力。 电源和资源管理是现代操作系统的一个关键组件。 例如， 您可能希望操作系统监视系统的一些限制， 例如系统的温度是否超出了预期的增长速度 (并在需要时发出警告)。</p>
</div>
<div class="paragraph">
<p>在 FreeBSD 使用手册的这一章节，我们将提供 ACPI 全面的信息。 参考资料会在末尾给出。</p>
</div>
<div class="sect2">
<h3 id="acpi-intro">15.1. 什么是 ACPI？<a class="anchor" href="#acpi-intro"></a></h3>
<div class="paragraph">
<p>高级配置和电源接口 (ACPI) 是一个业界标准的硬件资源和电源管理接口 (因此而得名) 。它是 <em>操作系统控制的配置和电源管理(Operating System-directed configuration and Power Management)</em>，也就是说， 它给操作系统(OS)提供了更多的控制和弹性。 在引入 ACPI 之前， 现代操作系统使得目前即插即用接口的局限性更加 &#34;凸现&#34; 出来。 ACPI 是 APM(高级电源管理) 的直接继承者。</p>
</div>
</div>
<div class="sect2">
<h3 id="acpi-old-spec">15.2. 高级电源管理 (APM) 的缺点<a class="anchor" href="#acpi-old-spec"></a></h3>
<div class="paragraph">
<p><em>高级电源管理 (APM)</em> 是一种基于系统目前的活动控制其电源使用的机制。 APM BIOS 由 (系统的) 制造商提供， 并且是硬件平台专属的。 在 OS 中的 APM 驱动作为中介来访问 <em>APM 软件接口</em>， 从而实现对电源使用的管理。 在 2000 年或更早的时期生产的计算机系统， 仍需要使用 APM。</p>
</div>
<div class="paragraph">
<p>APM 有四个主要的问题。 首先， 电源管理是通过 (制造商专属的) BIOS 实现的， 而 OS 则完全不了解其细节。 例如， 用户在 APM BIOS 中设置了硬盘驱动器的空闲等待数值， 当超过这一空闲时间的限制时， 它 (BIOS) 将会减慢硬盘驱动器的速度， 而不会征求 OS 的同意。 第二， APM 逻辑是嵌入 BIOS 的， 因此它是在 OS 的控制之外运转的。 这意味着用户只能通过通过刷新他们 ROM 中的 APM BIOS 才能够解决某些问题； 而这是一个很危险的操作， 因为它可能使系统进入一个无法恢复的状态。 第三， APM 是一种制造商专属的技术， 也就是说有很多第三方的 (重复的工作) 以及 bugs， 如果在一个制造商的 BIOS 中有， 也未必会在其他的产品中解决。 最后但绝不是最小的问题， APM BIOS 没有为实现复杂的电源策略提供足够的余地， 也无法实现能够非常适合具体机器的策略。</p>
</div>
<div class="paragraph">
<p><em>即插即用 BIOS (PNPBIOS)</em> 在很多时候都是不可靠的。 PNPBIOS 是 16-位 的技术， 因此 OS 不得不使用 16-位 模拟才能够与 PNPBIOS 的方法 &#34;接口&#34;。</p>
</div>
<div class="paragraph">
<p>FreeBSD APM 驱动在 man:apm[4] 手册页中有描述。</p>
</div>
</div>
<div class="sect2">
<h3 id="acpi-config">15.3. 配置 ACPI<a class="anchor" href="#acpi-config"></a></h3>
<div class="paragraph">
<p>默认情况下， <span class="filename">acpi.ko</span> 驱动， 会在系统引导时由 man:loader[8] 加载， 而 <em>不应</em> 直接联编进内核。 这样做的原因是模块操作起来更方便， 例如， 无需重新联编内核就可以切换到另一个 <span class="filename">acpi.ko</span> 版本。 这样可以让测试变得更简单一些。 另一个原因是， 许多时候在启动已经启动之后再启动 ACPI 可能会有些问题。 如果您遇到了问题， 可以全面禁用 ACPI。 这个驱动不应， 目前也无法卸载， 因为系统总线通过它与许多不同的硬件进行交互。 ACPI 可以通过在 <span class="filename">/boot/loader.conf</span> 中配置或在 man:loader[8] 提示符处配置 <code>hint.acpi.0.disabled=&#34;1&#34;</code> 来禁用。</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ACPI 和 APM 不能共存， 相反， 它们应分开使用。 后加载的驱动如果发现系统中已经执行了其中的一个， 便会停止执行。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>ACPI 可以用来让系统进入休眠模式， 方法是使用 man:acpiconf[8] 的 <code>-s</code> 参数， 加上一个 <code>1-5</code> 的数字。 多数用户会希望使用 <code>1</code> 或 <code>3</code> (挂起到 RAM)。 而 <code>5</code> 则会让系统执行与下列命令效果类似的软关机：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># halt -p</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>除此之外， 还有一些通过 man:sysctl[8] 提供的选项。 请参见联机手册 man:acpi[4] 和 man:acpiconf[8] 以获得更多信息。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ACPI-debug">16. 使用和调试 FreeBSD ACPI<a class="anchor" href="#ACPI-debug"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>ACPI 是一种全新的发现设备、 管理电源使用、 以及提供过去由 BIOS 管理的访问不同硬件的标准化方法。 让 ACPI 在各种系统上都能正确使用的工作一直在进行， 但许多主板的 <em>ACPI 机器语言</em> (AML) 字节代码中的 bug， FreeBSD 的内核中子系统设计的不完善， 以及 Intel® ACPI-CA 解释器中的 bug 仍然不时会出现。</p>
</div>
<div class="paragraph">
<p>这份文档期望能够帮助您协助 FreeBSD ACPI 的维护人员来找到您所观察到的问题的根源， 并通过调试找到其解决方法。 感谢您阅读这份文档， 我们也希望能够解决您的系统上的问题。</p>
</div>
<div class="sect2">
<h3 id="ACPI-submitdebug">16.1. 提交调试信息<a class="anchor" href="#ACPI-submitdebug"></a></h3>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在提交问题之前， 请确认您已经在运行最新的 BIOS 版本， 此外， 也包括嵌入式控制器的固件版本。</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>如果您希望提交一个问题， 请确保将下述信息发到 <a href="mailto:freebsd-acpi@FreeBSD.org">freebsd-acpi@FreeBSD.org</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>问题行为的描述， 包括系统类型、型号，以及任何触发问题的相关信息。 另外， 请注意尽可能准确地描述这一问题是否对您是陌生的。</p>
</li>
<li>
<p>在 &#34;boot -v&#34; 之后得到的 man:dmesg[8] 输出， 以及任何在重现 bug 时出现的错误信息。</p>
</li>
<li>
<p>在禁用了 ACPI 之后的 &#34;boot -v&#34; 的 man:dmesg[8] 输出， 如果您发现禁用 ACPI 能够帮助消除问题。</p>
</li>
<li>
<p>来自 <code>fsysctl hw.acpi</code>的输出。 这也是找到您的系统所提供的功能的一种好办法。</p>
</li>
<li>
<p>能够得到您的 <em>ACPI Source Language</em> (ASL) 的 URL。 <em>不要</em> 把 ASL 直接发到邮件列表中， 因为它们可能非常大。 为了得到 ASL 您可以运行这个命令：</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># acpidump -dt &gt; name-system.asl</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(把 <em>name</em> 改为您的登录名， 并把 <em>system</em> 改为您的硬件制造商及其型号。 例如： <span class="filename">njl-FooCo6000.asl</span>)</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>许多开发者也会订阅 <a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a> 但还是请发到 <a href="https://lists.FreeBSD.org/subscription/freebsd-acpi">FreeBSD ACPI 邮件列表</a> 这样它会被更多人看到。 请耐心等待， 因为我们都有全职的其他工作。 如果您的 bug 不是显而易见的， 我们可能会要求您通过 man:send-pr[1] 来提交一个 PR。 在输入 PR 时，请将同样的信息包含进去。 这将帮助我们来追踪和解决问题。 不要在给 <a href="https://lists.FreeBSD.org/subscription/freebsd-acpi">FreeBSD ACPI 邮件列表</a> 写信之前发送 PR 因为我们把它当作已知文体的备忘录而不是报告机制。 您的问题很可能已经被其他人报告过了。</p>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-background">16.2. 背景<a class="anchor" href="#ACPI-background"></a></h3>
<div class="paragraph">
<p>ACPI 存在于采用 ia32 (x86)、 ia64 (安腾)、 以及 amd64 (AMD) 架构的所有现代计算机上。 完整的标准具有大量的各式功能， 包括 CPU 性能管理、 电源控制、 温度监控、 电池系统、 嵌入式控制器以及总线枚举。 绝大多数系统实现比完整标准的功能要少一些。 例如， 桌面系统通常只实现总线枚举部分， 而笔记本则通常支持降温和电源管理功能。 笔记本通常还提供休眠和唤醒支持， 并提供与此适应的复杂功能。</p>
</div>
<div class="paragraph">
<p>符合 ACPI 的系统中有许多组件。 BIOS 和芯片组制造商提供一些固定的表 (例如， FADT) 在存储器中， 以提供类似 APIC 映射 (用于 SMP)、 配置寄存器、 以及简单的配置值等等。 另外， 一个字节代码 (bytecode) 表 (<em>系统区别描述表</em>DSDT) 则提供了通过树状命名空间来指定设备及其功能的方法。</p>
</div>
<div class="paragraph">
<p>ACPI 驱动必须要处理固定表， 实现字节码解释器， 并修改驱动程序和内核， 以接受来自 ACPI 子系统的信息。 对于 FreeBSD， Intel® 提供了一个解释器 (ACPI-CA)， 它在 Linux 和 NetBSD 也可以使用。 ACPI-CA 源代码可以在 <span class="filename">src/sys/contrib/dev/acpica</span> 找到。 用于在 FreeBSD 中允许 ACPI-CA 正确运转的代码则在 <span class="filename">src/sys/dev/acpica/Osd</span>。 最后， 用于实现 ACPI 设备的驱动可以在 <span class="filename">src/sys/dev/acpica</span> 找到。</p>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-comprob">16.3. 常见问题<a class="anchor" href="#ACPI-comprob"></a></h3>
<div class="paragraph">
<p>要让 ACPI 正常工作， 它的每一部分都必须工作正常。 下面是一些常见的问题， 按照出新的频繁程度排序， 并给出了一些绕过或修正它们的方法。</p>
</div>
<div class="sect3">
<h4 id="_鼠标问题">16.3.1. 鼠标问题<a class="anchor" href="#_鼠标问题"></a></h4>
<div class="paragraph">
<p>某些时候， 唤醒操作会导致鼠标不再正常工作。 已知的绕过这一问题的方法， 是在 <span class="filename">/boot/loader.conf</span> 文件中添加 <code>hint.psm.0.flags=&#34;0x3000&#34;</code> 设置。 如果这样做不能解决问题， 请考虑按前面介绍的方法提交问题报告。</p>
</div>
</div>
<div class="sect3">
<h4 id="_休眠唤醒">16.3.2. 休眠/唤醒<a class="anchor" href="#_休眠唤醒"></a></h4>
<div class="paragraph">
<p>ACPI 提供了三种休眠到 RAM (STR) 的状态， <code>S1</code>-<code>S3</code>， 以及一个休眠到磁盘的状态 (<code>STD</code>)， 称作 <code>S4</code>。 <code>S5</code> 是 &#34;软关机&#34; 同时也是系统接好电源但没有开机时的正常状态。 <code>S4</code> 实际上可以用两种不同的方法来实现。 <code>S4</code>BIOS 是一种由 BIOS 辅助的挂起到磁盘方法， 而 <code>S4</code>OS 则是完全由操作系统实现的。</p>
</div>
<div class="paragraph">
<p>可以使用 <code>sysctl hw.acpi</code> 来查看与休眠有关的项目。 这里是我的 Thinkpad 上得到的结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">hw.acpi.supported_sleep_state: S3 S4 S5
hw.acpi.s4bios: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>这表示我可以使用 <code>acpiconf -s</code> 来测试 <code>S3</code>， <code>S4</code>OS， 以及 <code>S5</code>。 如果 <code>s4bios</code> 是一 (<code>1</code>)， 则可以使用 <code>S4</code>BIOS 来代替 <code>S4</code>OS。</p>
</div>
<div class="paragraph">
<p>当测试休眠/唤醒时， 从 <code>S1</code> 开始， 如果它被支持的话。 这个状态是最可能正常工作的状态， 因为它不需要太多的驱动支持。 没有人实现 <code>S2</code> 但如果您有它的支持， 则应该和 <code>S1</code> 类似。 下一件值得尝试的是 <code>S3</code>。 这是最深的 STR 状态， 并需要一系列驱动的支持才能够正常地重新初始化您的硬件。 如果您在唤醒系统时遇到问题， 请不要吝惜发邮件给 <a href="https://lists.FreeBSD.org/subscription/freebsd-acpi">FreeBSD ACPI 邮件列表</a> 邮件列表， 尽管不要指望问题一定会很快解决， 因为有许多驱动程序/硬件需要进行更多的测试和改进。</p>
</div>
<div class="paragraph">
<p>休眠和唤醒操作最常见的问题是某些设备驱动程序不会保存、 恢复或正确地重新初始化其固件、 寄存器或设备内存。 尝试调试这些问题时， 首先可以尝试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl debug.bootverbose=1</span>
<span class="c"># sysctl debug.acpi.suspend_bounce=1</span>
<span class="c"># acpiconf -s 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这个测试会模拟休眠和恢复过程而不真的进入 <code>S3</code> 状态。 有时， 您会用这种方式很容易地抓住问题 (例如， 丢失固件状态、 设备 watchdog 超时， 以及一直重试等)。 注意系统不会真的进入 <code>S3</code> 状态， 这意味着这些设备可能不会掉电， 而许多设备在完全不提供休眠和恢复方法时仍可正常工作， 而不像使用真的 <code>S3</code> 状态那样。</p>
</div>
<div class="paragraph">
<p>较难的情况则需要更多的硬件， 例如用于串口控制台的串口/线， 以及用于 man:dcons[4] 的火线口/线和内核调试技能。</p>
</div>
<div class="paragraph">
<p>为了帮助隔离问题， 请在内核中删去尽可能多的驱动。 如果这样做能够解决问题， 请尝试逐个加载驱动直到问题再次出现。 通常预编译的驱动程序如 <span class="filename">nvidia.ko</span>、 X11 显示驱动， 以及 USB 的问题最多， 而以太网卡的驱动则通常工作的很好。 如果您能够通过加载和卸载驱动使系统正常工作， 您可以通过将适当的命令放到 <span class="filename">/etc/rc.suspend</span> 和 <span class="filename">/etc/rc.resume</span> 来将这个过程自动化。 在这两个文件中有一个注释掉的卸载和加载驱动程序的例子供您参考。 另外您还可以将 <code>hw.acpi.reset_video</code> 设置为零 (<code>0</code>)， 如果您的显示在唤醒之后显得很混乱。 此外您还可以尝试更长或更短的 <code>hw.acpi.sleep_delay</code> 值看看是否有所助益。</p>
</div>
<div class="paragraph">
<p>另一件值得一试的事情是使用一个比较新的包含 ACPI 支持的 Linux 发行版来试试看他们的 休眠/唤醒 功能是否在同样的硬件上能够正常工作。 如果在 Linux 下正常， 则很可能是 FreeBSD 驱动程序的问题， 而隔离问题并找到存在问题的驱动有助于解决它。 需要注意的是 ACPI 的维护人员通常并不维护其他驱动 (例如 声音、 ATA， 等等) 因此如果最终发现是驱动的问题最好还是发到 <a href="https://lists.FreeBSD.org/subscription/freebsd-current">FreeBSD-CURRENT 邮件列表</a> 邮件列表并发给驱动程序的维护者。 如果您喜欢冒险， 则可以加一些 man:printf[3] 到有问题的驱动中， 以找到它的恢复功能发生问题的位置。</p>
</div>
<div class="paragraph">
<p>最后， 试试看禁用 ACPI 并代之以启用 APM。 如果 休眠/唤醒 能够在 APM 下正常工作， 使用 APM 可能会更好， 特别是对于较老的硬件 (2000年以前)。 硬件制造商需要一些时间来让老硬件的 ACPI 工作正常， 而 ACPI 的问题十之八九是 BIOS 中的毛病引发的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_系统停止响应_暂时或永久性地">16.3.3. 系统停止响应 (暂时或永久性地)<a class="anchor" href="#_系统停止响应_暂时或永久性地"></a></h4>
<div class="paragraph">
<p>绝大多数系统停止响应是由于未能及时响应中断或发生了中断风暴导致的。 芯片组有很多问题最终会溯源到 BIOS 如何在引导系统之前配置中断， APIC (MADT) 表的正确性， 以及 <em>系统控制中断</em> (SCI) 如何路由。</p>
</div>
<div class="paragraph">
<p>通过察看 <code>vmstat -i</code> 的输出中包括 <code>acpi0</code> 的那一行可以区分中断风暴和未能及时响应中断。 如果每秒计数器增长的速度多于一两个， 则您是遇到了中断风暴。 如果系统停止了响应， 您可以尝试停止内核并进入 DDB (在控制台上按 <span class="keyseq"><kbd>CTRL</kbd>+<kbd>ALT</kbd>+<kbd>ESC</kbd></span>) 并输入 <code>show interrupts</code>。</p>
</div>
<div class="paragraph">
<p>处理中断问题的救命稻草是尝试禁用 APIC 支持， 这是通过在 <span class="filename">loader.conf</span> 中加入 <code>hint.apic.0.disabled=&#34;1&#34;</code> 完成的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_崩溃">16.3.4. 崩溃<a class="anchor" href="#_崩溃"></a></h4>
<div class="paragraph">
<p>崩溃对于 ACPI 是比较罕见的情况， 如果发现， 我们将会非常重视并很快修复它。 您要做的第一件事是设法隔离出能够重现崩溃 (如果可能的话) 的操作并获取一份调用堆栈。 请启用 <code>options DDB</code> 并设置串行控制台 (参见 crossref:serialcomms[serialconsole-ddb,通过串口线进入DDB调试器]) 或配置一个 man:dump[8] 分区。 您将在 DDB 中通过 <code>tr</code> 得到调用堆栈。 如果您只能用手抄的方法记录它， 一定要记下头五 (5) 行和最后五 (5) 行。</p>
</div>
<div class="paragraph">
<p>然后， 尝试通过在启动时禁用 ACPI 来隔离故障。 如果这样做能够正常工作， 请通过设置 <code>debug.acpi.disable</code> 的那组数值来隔离具体是哪个 ACPI 子系统的问题。 请参见 man:acpi[4] 联机手册中给出的那些例子。</p>
</div>
</div>
<div class="sect3">
<h4 id="_系统在休眠或关机之后又启动了">16.3.5. 系统在休眠或关机之后又启动了<a class="anchor" href="#_系统在休眠或关机之后又启动了"></a></h4>
<div class="paragraph">
<p>首先请尝试在 man:loader.conf[5] 中设置 <code>hw.acpi.disable_on_poweroff=</code>&#34;0&#34;。 这将让 ACPI 不再在关机过程中禁用一些事件。 基于同样的原因， 一些系统需要把这个值设置为 &#34;1&#34; (这是默认值)。 这通常能够修复在休眠或关机时立即再次启动的问题。</p>
</div>
</div>
<div class="sect3">
<h4 id="_其他问题">16.3.6. 其他问题<a class="anchor" href="#_其他问题"></a></h4>
<div class="paragraph">
<p>如果您有 ACPI 的其他问题 (同 docking station 协同工作、 无法检测设备， 等等)， 请把描述发给邮件列表； 不过， 这些问题也有可能和 ACPI 中尚未完成的部分有关， 它们可能需要时间才能被实现。 请给点耐心， 并准备测试我们可能会发给您的补丁。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-aslanddump">16.4. ASL、<code>acpidump</code>， 以及 IASL<a class="anchor" href="#ACPI-aslanddump"></a></h3>
<div class="paragraph">
<p>最常见的问题是 BIOS 制造商提供的不正确 (甚至完全错误的!) 字节代码。 这通常会以类似下面这样的内核消息显示在控制台上：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">ACPI-1287: <span class="k">***</span> Error: Method execution failed <span class="o">[</span><span class="se">\\</span>_SB_.PCI0.LPC0.FIGD._STA] <span class="se">\\</span>
<span class="o">(</span>Node 0xc3f6d160<span class="o">)</span>, AE_NOT_FOUND</code></pre>
</div>
</div>
<div class="paragraph">
<p>许多时候， 您可以通过将 BIOS 升级到最新版本来解决此类问题。 绝大多数控制台消息是无害的， 但如果您有其他问题例如电池工作不正常， 则从 AML 开始查找问题将是一条捷径。 字节代码， 或常说的 AML， 是从一种叫做 ASL 的语言写成的源代码进行编译得到的结果。 AML 一般存放在 DSDT 表中。 要得到您系统的 ASL， 需要使用 man:acpidump[8]。 需要同时指定 <code>-t</code> (显示固定标的内容) 和 <code>-d</code> (将 AML 反编译成 ASL) 两个选项。 请参见 <a href="#ACPI-submitdebug">如何提交调试信息</a> 一节了解如何使用它。</p>
</div>
<div class="paragraph">
<p>最方便的初步检查是尝试重新编译 ASL 来看看是否有错误。 通常可以忽略这一过程中产生的警告， 但错误一般就都是 bug， 它们通常就是导致 ACPI 无法正常工作的原因。 要重新编译您的 ASL， 可以使用下面的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># iasl your.asl</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-fixasl">16.5. 修复 ASL<a class="anchor" href="#ACPI-fixasl"></a></h3>
<div class="paragraph">
<p>我们的长期目标是让每一个人都能够在不需要任何用户干预的情况下使用 ACPI。 然而， 目前我们仍然在开发绕过 BIOS 制造商常见错误的方法。 Microsoft® 解释器 (<span class="filename">acpi.sys</span> 和 <span class="filename">acpiec.sys</span>) 并不会严格地检查是否遵守了标准， 因此许多只在 Windows® 中测试 ACPI 的 BIOS 制造商很可能永远不会修正他们的 ASL。 我们希望不断地找出并用文档说明 Microsoft® 的解释器到底允许那些不标准的行为， 并在 FreeBSD 进行对应的修改使它能够正常工作而不需要用户修正 ASL。 作为一项临时缓解问题的方法， 并帮助我们确认其行为， 您可以手工修正 ASL。 如果这样能够解决问题， 请把新旧 ASL 的 man:diff[1] 发给我们， 这样我们就有可能绕过 ACPI-CA 中的错误行为， 从而不再需要您来手工修正。</p>
</div>
<div class="paragraph">
<p>下面是一些常见的错误信息， 它们的原因， 以及如何修正。</p>
</div>
<div class="sect3">
<h4 id="_os_dependencies_os_依赖">16.5.1. _OS dependencies (_OS 依赖)<a class="anchor" href="#_os_dependencies_os_依赖"></a></h4>
<div class="paragraph">
<p>某些 AML 假定世界是由不同版本的 Windows® 组成的。 您可以让 FreeBSD 声称自己是任意 OS 来看一看是否能够修正问题。 比较简单的办法是设置 <code>hw.acpi.osname</code>=&#34;Windows 2001&#34; 到 <span class="filename">/boot/loader.conf</span> 中， 或使用您在 ASL 中找到的其他字符串。</p>
</div>
</div>
<div class="sect3">
<h4 id="_missing_return_statements_缺少返回语句">16.5.2. Missing Return statements (缺少返回语句)<a class="anchor" href="#_missing_return_statements_缺少返回语句"></a></h4>
<div class="paragraph">
<p>一些方法可能没按照标准要求的那样显式地返回值。 尽管 ACPI-CA 无法处理它， 但 FreeBSD 提供了一个绕过它并允许其暗含地返回值的方法。 您也可以增加一个显式的 Return 语句， 如果您知道那里需要返回一个值的话。 要强制 <code>iasl</code> 编译 ASL， 需要使用 <code>-f</code> 标志。</p>
</div>
</div>
<div class="sect3">
<h4 id="_替换默认的_aml">16.5.3. 替换默认的 AML<a class="anchor" href="#_替换默认的_aml"></a></h4>
<div class="paragraph">
<p>在定制 <span class="filename">your.asl</span> 之后， 您可以通过下面的命令编译它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># iasl your.asl</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>-f</code> 标志来强制创建 AML， 即使在编译过程中发生了错误。 请注意某些错误 (例如， 缺少 Return 语句) 会自动被解释器忽略掉。</p>
</div>
<div class="paragraph">
<p><span class="filename">DSDT.aml</span> 是 <code>iasl</code> 命令的默认输出文件名。 可以加载它来取代您 BIOS 中存在问题的副本 (它仍然存在于闪存中)， 其方法是按下面的说明编辑 <span class="filename">/boot/loader.conf</span>：</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>acpi_dsdt_load=&#34;YES&#34;
acpi_dsdt_name=&#34;/boot/DSDT.aml&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>一定要把您的 <span class="filename">DSDT.aml</span> 复制到 <span class="filename">/boot</span> 目录中。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-debugoutput">16.6. 从 ACPI 中获取调试输出信息<a class="anchor" href="#ACPI-debugoutput"></a></h3>
<div class="paragraph">
<p>ACPI 驱动程序提供了非常灵活的调试机制。 这允许您指定一组子系统， 以及所需要的详细信息。 需要调试的子系统可以按 &#34;layers(层)&#34; 来指定， 并分为 ACPI-CA 组件 (ACPI_ALL_COMPONENTS) 和 ACPI 硬件支持 (ACPI_ALL_DRIVERS)。 调试输出的详细程度可以通过 &#34;level(详细度)&#34; 来指定， 其范围是 ACPI_LV_ERROR (只报告错误) 到 ACPI_LV_VERBOSE (显示所有)。 &#34;level&#34; 是一个位掩码因此可以一次设置多个选项， 中间用空格分开。 实际使用中您应该考虑使用串行控制台来记录输出， 如果它太长以至于冲掉了控制台消息缓冲的话。 不同的层和输出详细度的完整列表可以在 man:acpi[4] 联机手册中找到。</p>
</div>
<div class="paragraph">
<p>调试输出默认并不开启。 要起用它， 您需要在内核设置中添加 <code>options ACPI_DEBUG</code>， 如果您的内核中编入了 ACPI 的话。 您还可以在 <span class="filename">/etc/make.conf</span> 中加入 <code>ACPI_DEBUG=1</code> 来在全局起用它。 如果它只是模块， 您可以用下面的方法来重新编译 <span class="filename">acpi.ko</span>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cd /sys/modules/acpi/acpi</span>
<span class="o">&amp;&amp;</span> make clean <span class="o">&amp;&amp;</span>
make <span class="nv">ACPI_DEBUG</span><span class="o">=</span>1</code></pre>
</div>
</div>
<div class="paragraph">
<p>安装 <span class="filename">acpi.ko</span> 到 <span class="filename">/boot/kernel</span> and add your 并把所需的详细度和层在 <span class="filename">loader.conf</span> 中指定。 这个例子将启用所有 ACPI-CA 组件以及所有 ACPI 硬件驱动 (CPU、 LID， 等等) 的消息。 只输出错误信息， 也就是最低的详细度。</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>debug.acpi.layer=&#34;ACPI_ALL_COMPONENTS ACPI_ALL_DRIVERS&#34;
debug.acpi.level=&#34;ACPI_LV_ERROR&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>如果您需要的信息是由某个特定的事件触发的 (比如说， 休眠之后的唤醒)， 您可以不修改 <span class="filename">loader.conf</span> 而转而使用 <code>sysctl</code> 来在启动和为那个事件准备系统之后再指定层和详细度。 这些 <code>sysctl</code> 的名字和 <span class="filename">loader.conf</span> 中的一致。</p>
</div>
</div>
<div class="sect2">
<h3 id="ACPI-References">16.7. 参考文献<a class="anchor" href="#ACPI-References"></a></h3>
<div class="paragraph">
<p>关于 ACPI 的更多信息可以从下面这些地方找到：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://lists.FreeBSD.org/subscription/freebsd-acpi">FreeBSD ACPI 邮件列表</a></p>
</li>
<li>
<p>ACPI 邮件列表存档 <a href="http://lists.freebsd.org/pipermail/freebsd-acpi/">http://lists.freebsd.org/pipermail/freebsd-acpi/</a></p>
</li>
<li>
<p>旧的 ACPI 邮件列表存档 <a href="http://home.jp.FreeBSD.org/mail-list/acpi-jp/">http://home.jp.FreeBSD.org/mail-list/acpi-jp/</a></p>
</li>
<li>
<p>The <a href="https://uefi.org/specifications#ACPI">ACPI 标准</a></p>
</li>
<li>
<p>FreeBSD 手册页: man:acpi[4], man:acpi_thermal[4], man:acpidump[8], man:iasl[8], man:acpidb[8]</p>
</li>
<li>
<p><a href="http://www.cpqlinux.com/acpi-howto.html#fix_broken_dsdt">DSDT 调试资源</a>. (使用 Compaq 作为例子但通常情况下都很有用。)</p>
</li>
</ul>
</div>
</div>
</div>
</div>

    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=http://127.0.0.1:5500/zh-cn/books/handbook/partiii class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=http://127.0.0.1:5500/zh-cn/books/handbook/boot  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#config-synopsis">1. 概述</a></li>
    <li><a href="#configtuning-initial">2. 初步配置</a></li>
    <li><a href="#configtuning-core-configuration">3. 核心配置</a></li>
    <li><a href="#configtuning-appconfig">4. 应用程序配置</a></li>
    <li><a href="#configtuning-starting-services">5. 启动服务</a></li>
    <li><a href="#configtuning-cron">6. 配置 <code>cron</code></a></li>
    <li><a href="#configtuning-rcd">7. 在 FreeBSD 中使用 rc</a></li>
    <li><a href="#config-network-setup">8. 设置网卡</a></li>
    <li><a href="#configtuning-virtual-hosts">9. 虚拟主机</a></li>
    <li><a href="#configtuning-configfiles">10. 配置文件</a></li>
    <li><a href="#configtuning-sysctl">11. 用 sysctl 进行调整</a></li>
    <li><a href="#configtuning-disk">12. 调整磁盘</a></li>
    <li><a href="#configtuning-kernel-limits">13. 调整内核限制</a></li>
    <li><a href="#adding-swap-space">14. 添加交换空间</a></li>
    <li><a href="#acpi-overview">15. 电源和资源管理</a></li>
    <li><a href="#ACPI-debug">16. 使用和调试 FreeBSD ACPI</a></li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="http://127.0.0.1:5500/zh-cn/languages">
                
                <img src="/images/language.png" class="language-image" alt="Choose language">
                <span>简体中文</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2023 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
