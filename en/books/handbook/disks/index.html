<!DOCTYPE html>
<html class="theme-light" lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This chapter covers the use of disks and storage media in FreeBSD. This includes SCSI and IDE disks, CD and DVD media, memory-backed disks, and USB storage devices."/>
  <meta name="keywords" content="storage, disks, gpart, mount, quotas, encrypt, GPT, cdrecord, NTFS, quotas, swap, HAST, CD, DVD, resizing, growing"/>
  <meta name="copyright" content="1995-2023 The FreeBSD Foundation" />
  <link rel="canonical" href="https://free.bsd-doc.org/en/books/handbook/disks/" />

  <title>Chapter 20. Storage |  FreeBSD Documentation Portal</title>

  <meta name="theme-color" content="#790000">
  <meta name="color-scheme" content="system light dark high-contrast">

    <link rel="shortcut icon" href="https://free.bsd-doc.org/favicon.ico">
    <link rel="stylesheet" href="/styles/main.min.css">
    <link rel="stylesheet" href="https://free.bsd-doc.org/css/font-awesome-min.css">
    <script defer src="/js/theme-chooser.min.js"></script>
    <script defer src="/js/copy-clipboard.min.js"></script>
    <script defer src="/js/search.min.js"></script>

  
  
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:domain" content="docs.FreeBSD.org"/>
    <meta name="twitter:site" content="@freebsd"/>
    <meta name="twitter:url" content="https://twitter.com/freebsd"/>
    <meta property="og:title" content="Chapter 20. Storage" />
    <meta property="og:description" content="This chapter covers the use of disks and storage media in FreeBSD. This includes SCSI and IDE disks, CD and DVD media, memory-backed disks, and USB storage devices." />
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://free.bsd-doc.orgfavicon.ico"/>
    <meta property="og:image:alt" content="FreeBSD Logo">
    <meta property="og:locale" content="en" />
    <meta property="og:url" content="https://free.bsd-doc.org/en/books/handbook/disks/" />
    <meta property="og:site_name" content="FreeBSD Documentation Portal" />
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "Article",
        "url": "https:\/\/free.bsd-doc.org\/en\/books\/handbook\/disks\/",
        "name": "FreeBSD Documentation Portal",
        "headline": "FreeBSD Documentation Portal",
        "description": "FreeBSD Documentation Portal"
      }
    </script>
    

  
</head>


  <body>
    <header>
  <div class="header-container">
    <div class="logo-menu-bars-container">
      <a href="https://free.bsd-doc.org" class="logo">
        <img src="https://free.bsd-doc.org/images/FreeBSD-monochromatic.svg" width="160" height="50" alt="FreeBSD logo" />
      </a>
      <label class="menu-bars" for="menu-bars">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </div>
    <input id="menu-bars" type="checkbox" />
    
    <div class="search-donate-container">
      
      <div class="donate">
        <a href="https://github.com/fierceX/freebsd-doc-cn" target="_blank">
          <span class="heart">♥</span>
          GitHub
        </a>
      </div>
    </div>
  </div>
</header>

    
<input type="checkbox" class="hidden toggle" id="menu-control">
<main class="main-wrapper-book">
  <a id="top"></a>
  
  <aside class="book-menu">
    <div class="book-menu-content">
      <input id="search-book" type="text" placeholder="Search" aria-label="Search" maxlength="128" />
      <nav id="MenuContents">
        
  <ul>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ada319c45e780947f82b569049480cc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-8ada319c45e780947f82b569049480cc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/preface/">
              Preface
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-audience">Intended Audience</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-changes-from4">Fourth Edition</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-changes-from3">Third Edition</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-changes-from2">Second Edition (2004)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-changes">First Edition (2001)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-overview">Organization of This Book</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-conv">Conventions used in this book</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/preface/#preface-acknowledgements">Acknowledgments</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-32a83d18a326852a8d9ae2582360bbc8" class="toggle"  />
          <label  for="chapter-32a83d18a326852a8d9ae2582360bbc8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/parti/">
              Part I. Getting Started
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a4909db05d872d16d5be86a57cbc2dc7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a4909db05d872d16d5be86a57cbc2dc7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/introduction/">
              Chapter 1. Introduction
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/introduction/#introduction-synopsis">1.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/introduction/#nutshell">1.2. Welcome to FreeBSD!</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/introduction/#history">1.3. About the FreeBSD Project</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3c2455cadf89eadd3f6e77461085d5e9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3c2455cadf89eadd3f6e77461085d5e9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/">
              Chapter 2. Installing FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-synopsis">2.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-hardware">2.2. Minimum Hardware Requirements</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-pre">2.3. Pre-Installation Tasks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-start">2.4. Starting the Installation</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#using-bsdinstall">2.5. Using bsdinstall</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-partitioning">2.6. Allocating Disk Space</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-fetching-distribution">2.7. Fetching Distribution Files</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-post">2.8. Network Interfaces, Accounts, Time Zone, Services and Hardening</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#bsdinstall-install-trouble">2.9. Troubleshooting</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bsdinstall/#using-live-cd">2.10. Using the Live CD</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-709481b75d22ad36960f7ac166b3306c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-709481b75d22ad36960f7ac166b3306c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/basics/">
              Chapter 3. FreeBSD Basics
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#basics-synopsis">3.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#consoles">3.2. Virtual Consoles and Terminals</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#users-synopsis">3.3. Users and Basic Account Management</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#permissions">3.4. Permissions</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#dirstructure">3.5. Directory Structure</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#disk-organization">3.6. Disk Organization</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#mount-unmount">3.7. Mounting and Unmounting File Systems</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#basics-processes">3.8. Processes and Daemons</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#shells">3.9. Shells</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#editors">3.10. Text Editors</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#basics-devices">3.11. Devices and Device Nodes</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/basics/#basics-more-information">3.12. Manual Pages</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-58c050d31a1fbecd859248dacefeb567" class="toggle"  />
          <label  class="icon cursor"  for="chapter-58c050d31a1fbecd859248dacefeb567"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/ports/">
              Chapter 4. Installing Applications: Packages and Ports
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-synopsis">4.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-overview">4.2. Overview of Software Installation</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-finding-applications">4.3. Finding Software</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#pkgng-intro">4.4. Using pkg for Binary Package Management</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-using">4.5. Using the Ports Collection</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-poudriere">4.6. Building Packages with poudriere</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-nextsteps">4.7. Post-Installation Considerations</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ports/#ports-broken">4.8. Dealing with Broken Ports</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e5a000ce7f50680a180e2c1b83c121bc" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e5a000ce7f50680a180e2c1b83c121bc"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/x11/">
              Chapter 5. The X Window System
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/x11/#x11-synopsis">5.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/x11/#x-install">5.2. Installing Xorg</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/x11/#x-graphic-card-drivers">5.3. Graphic card drivers</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/x11/#x-config">5.4. Xorg Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/x11/#x-fonts">5.5. Using Fonts in Xorg</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-235af08fb87fd7a58003348706d2111d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-235af08fb87fd7a58003348706d2111d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/wayland/">
              Chapter 6. Wayland
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-synopsis">6.1. Wayland Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-wayfire">6.2. The Wayfire Compositor</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-hikari">6.3. The Hikari Compositor</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-sway">6.4. The Sway Compositor</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-xwayland">6.5. Using Xwayland</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-remotedesktop">6.6. Remote Desktop Using VNC</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-ly">6.7. Wayland Login Manager</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wayland/#wayland-utilities">6.8. Useful Utilities</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4de18483dde20bf9ed0024176afd09da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4de18483dde20bf9ed0024176afd09da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/network/">
              Chapter 7. Network
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#network-synopsis">7.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#config-network-setup">7.2. Setting up the Network</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#config-network-connection">7.3. Wired Networks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#network-wireless">7.4. Wireless Networks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#hostname">7.5. Hostname</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#dns">7.6. DNS</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network/#troubleshooting">7.7. Troubleshooting</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-5eb30759c3a2873e716dc31d7760054c" class="toggle"  />
          <label  for="chapter-5eb30759c3a2873e716dc31d7760054c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/partii/">
              Part II. Common Tasks
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-c96504f017c56f4bc7f71548cccf5382" class="toggle"  />
          <label  class="icon cursor"  for="chapter-c96504f017c56f4bc7f71548cccf5382"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/desktop/">
              Chapter 8. Desktop Environments
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-synopsis">8.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-environments">8.2. Desktop Environments</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-browsers">8.3. Browsers</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-development">8.4. Development tools</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-productivity">8.5. Desktop office productivity</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-viewers">8.6. Document Viewers</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/desktop/#desktop-finance">8.7. Finance</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-e1898af36aaacc168e13b673d25b908f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-e1898af36aaacc168e13b673d25b908f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/multimedia/">
              Chapter 9. Multimedia
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#multimedia-synopsis">9.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#sound-setup">9.2. Setting Up the Sound Card</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#audio-ports">9.3. Audio players</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#video-ports">9.4. Video players</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#conferencing-meetings">9.5. Conferencing and Meetings</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/multimedia/#scanners">9.6. Image Scanners</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6926664836e63c5cae4b2fa60855f91d" class="toggle"  />
          <label  class="icon cursor"  for="chapter-6926664836e63c5cae4b2fa60855f91d"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/">
              Chapter 10. Configuring the FreeBSD Kernel
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-synopsis">10.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-custom-kernel">10.2. Why Build a Custom Kernel?</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-devices">10.3. Finding the System Hardware</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-config">10.4. The Configuration File</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-building">10.5. Building and Installing a Custom Kernel</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/kernelconfig/#kernelconfig-trouble">10.6. If Something Goes Wrong</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-19d36bd70a320268f0ea1f66e4f3e224" class="toggle"  />
          <label  class="icon cursor"  for="chapter-19d36bd70a320268f0ea1f66e4f3e224"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/printing/">
              Chapter 11. Printing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-quick-start">11.1. Quick Start</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-connections">11.2. Printer Connections</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-pdls">11.3. Common Page Description Languages</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-direct">11.4. Direct Printing</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-lpd">11.5. LPD (Line Printer Daemon)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/printing/#printing-other">11.6. Other Printing Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79" class="toggle"  />
          <label  class="icon cursor"  for="chapter-a07f539e6c18f2db4da5dbb2b5bb1e79"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/linuxemu/">
              Chapter 12. Linux Binary Compatibility
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/linuxemu/#linuxemu-synopsis">12.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/linuxemu/#linuxemu-lbc-install">12.2. Configuring Linux Binary Compatibility</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/linuxemu/#linux-userlands">12.3. Linux userlands</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/linuxemu/#linuxemu-advanced">12.4. Advanced Topics</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-af234c193ce95c480af0ff5ec3f32f5c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-af234c193ce95c480af0ff5ec3f32f5c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/wine/">
              Chapter 13. WINE
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#wine-synopsis">13.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#wine-overview-concepts">13.2. WINE Overview & Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#installing-wine-on-freebsd">13.3. Installing WINE on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#running-first-wine-program">13.4. Running a First WINE Program on FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#configuring-wine-installation">13.5. Configuring WINE Installation</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#wine-management-guis">13.6. WINE Management GUIs</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#wine-in-multi-user-os-installations">13.7. WINE in Multi-User FreeBSD Installations</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/wine/#wine-on-os-faq">13.8. WINE on FreeBSD FAQ</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-51416fdea9d5a1dfa1c2718cd825213a" class="toggle"  />
          <label  for="chapter-51416fdea9d5a1dfa1c2718cd825213a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/partiii/">
              Part III. System Administration
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-532d0380ba66d66e033765a0b6930ee7" class="toggle"  />
          <label  class="icon cursor"  for="chapter-532d0380ba66d66e033765a0b6930ee7"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/config/">
              Chapter 14. Configuration, Services, Logging and Power Management
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#config-synopsis">14.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#configtuning-configfiles">14.2. Configuration Files</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#configtuning-rcd">14.3. Managing Services in FreeBSD</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#cron-periodic">14.4. Cron and Periodic</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#configtuning-syslog">14.5. Configuring System Logging</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#acpi-overview">14.6. Power and Resource Management</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/config/#adding-swap-space">14.7. Adding Swap Space</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-d05f41680fb7e3d68b354ae03de368b1" class="toggle"  />
          <label  class="icon cursor"  for="chapter-d05f41680fb7e3d68b354ae03de368b1"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/boot/">
              Chapter 15. The FreeBSD Booting Process
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/boot/#boot-synopsis">15.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/boot/#boot-introduction">15.2. FreeBSD Boot Process</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/boot/#device-hints">15.3. Device Hints</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/boot/#boot-shutdown">15.4. Shutdown Sequence</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-513e8e407c57354df334059688e9b60a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-513e8e407c57354df334059688e9b60a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/security/">
              Chapter 16. Security
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-synopsis">16.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-intro">16.2. Introduction</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#sec-accounts">16.3. Securing Accounts</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-ids">16.4. Intrusion Detection System (IDS)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-secure-levels">16.5. Secure levels</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-file-flags">16.6. File flags</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#openssh">16.7. OpenSSH</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#openssl">16.8. OpenSSL</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#kerberos5">16.9. Kerberos</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#tcpwrappers">16.10. TCP Wrappers</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#fs-acl">16.11. Access Control Lists</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#capsicum">16.12. Capsicum</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-accounting">16.13. Process Accounting</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-resourcelimits">16.14. Resource Limits</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-pkg">16.15. Monitoring Third Party Security Issues</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/security/#security-advisories">16.16. FreeBSD Security Advisories</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0f7d2858504c83a029928c048d394e2a" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0f7d2858504c83a029928c048d394e2a"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/jails/">
              Chapter 17. Jails and Containers
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jails-synopsis">17.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jail-types">17.2. Jail Types</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#host-configuration">17.3. Host Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#classic-jail">17.4. Classic Jail (Thick Jail)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#thin-jail">17.5. Thin Jails</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jail-management">17.6. Jail Management</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jail-upgrading">17.7. Jail Upgrading</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jail-resource-limits">17.8. Jail Resource Limits</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/jails/#jail-managers-and-containers">17.9. Jail Managers and Containers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-15be125ce5997f51c5499e3a0dee6c2c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-15be125ce5997f51c5499e3a0dee6c2c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/mac/">
              Chapter 18. Mandatory Access Control
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-synopsis">18.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-inline-glossary">18.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-understandlabel">18.3. Understanding MAC Labels</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-planning">18.4. Planning the Security Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-policies">18.5. Available MAC Policies</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-userlocked">18.6. User Lock Down</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-implementing">18.7. Nagios in a MAC Jail</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mac/#mac-troubleshoot">18.8. Troubleshooting the MAC Framework</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3f7e8d763b17c7d0c44c60505cf0feea" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3f7e8d763b17c7d0c44c60505cf0feea"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/audit/">
              Chapter 19. Security Event Auditing
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/audit/#audit-synopsis">19.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/audit/#audit-inline-glossary">19.2. Key Terms</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/audit/#audit-config">19.3. Audit Configuration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/audit/#audit-administration">19.4. Working with Audit Trails</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7bb1cb2287cd08a3672cc878e604f0d0" class="toggle"  checked  />
          <label  class="icon cursor"  for="chapter-7bb1cb2287cd08a3672cc878e604f0d0"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/disks/">
              Chapter 20. Storage
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-synopsis">20.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-adding">20.2. Adding Disks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-growing">20.3. Resizing and Growing Disks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#usb-disks">20.4. USB Storage Devices</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#creating-cds">20.5. Creating and Using CD Media</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#creating-dvds">20.6. Creating and Using DVD Media</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#floppies">20.7. Creating and Using Floppy Disks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#using-ntfs">20.8. Using NTFS Disks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#backup-basics">20.9. Backup Basics</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-virtual">20.10. Memory Disks</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#snapshots">20.11. File System Snapshots</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#quotas">20.12. Disk Quotas</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-encrypting">20.13. Encrypting Disk Partitions</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#swap-encrypting">20.14. Encrypting Swap</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/disks/#disks-hast">20.15. Highly Available Storage (HAST)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-dec5fc4f0100e5030db0fb188d8d4b2f" class="toggle"  />
          <label  class="icon cursor"  for="chapter-dec5fc4f0100e5030db0fb188d8d4b2f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/geom/">
              Chapter 21. GEOM: Modular Disk Transformation Framework
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-synopsis">21.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-striping">21.2. RAID0 - Striping</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-mirror">21.3. RAID1 - Mirroring</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-raid3">21.4. RAID3 - Byte-level Striping with Dedicated Parity</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-graid">21.5. Software RAID Devices</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-ggate">21.6. GEOM Gate Network</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-glabel">21.7. Labeling Disk Devices</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/geom/#geom-gjournal">21.8. UFS Journaling Through GEOM</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f1657a05627dd16bad31d4c7f675604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f1657a05627dd16bad31d4c7f675604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/zfs/">
              Chapter 22. The Z File System (ZFS)
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-differences">22.1. What Makes ZFS Different</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-quickstart">22.2. Quick Start Guide</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-zpool">22.3. <code>zpool</code> Administration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-zfs">22.4. <code>zfs</code> Administration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-zfs-allow">22.5. Delegated Administration</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-advanced">22.6. Advanced Topics</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-links">22.7. Further Resources</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/zfs/#zfs-term">22.8. ZFS Features and Terminology</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-4c6bf6828e601b79edb2813329ac6604" class="toggle"  />
          <label  class="icon cursor"  for="chapter-4c6bf6828e601b79edb2813329ac6604"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/filesystems/">
              Chapter 23. Other File Systems
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/filesystems/#filesystems-synopsis">23.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/filesystems/#filesystems-linux">23.2. Linux® File Systems</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-ae23289d4b6415f3f878893f9d3ef9b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-ae23289d4b6415f3f878893f9d3ef9b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/virtualization/">
              Chapter 24. Virtualization
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-synopsis">24.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-guest-parallelsdesktop">24.2. FreeBSD as a Guest on Parallels Desktop for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-guest-vmware">24.3. FreeBSD as a Guest on VMware Fusion for macOS®</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-guest-virtualbox">24.4. FreeBSD as a Guest on VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-host-virtualbox">24.5. FreeBSD as a Host with VirtualBox™</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-host-bhyve">24.6. FreeBSD as a Host with bhyve</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/virtualization/#virtualization-host-xen">24.7. FreeBSD as a Xen™-Host</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-b279d2b738963a45a059268d2fae00d5" class="toggle"  />
          <label  class="icon cursor"  for="chapter-b279d2b738963a45a059268d2fae00d5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/l10n/">
              Chapter 25. Localization - i18n/L10n Usage and Setup
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/l10n/#l10n-synopsis">25.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/l10n/#using-localization">25.2. Using Localization</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/l10n/#l10n-compiling">25.3. Finding i18n Applications</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/l10n/#lang-setup">25.4. Locale Configuration for Specific Languages</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9e3f99bd76c861ab2e9a5f31ac421842" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9e3f99bd76c861ab2e9a5f31ac421842"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/">
              Chapter 26. Updating and Upgrading FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#updating-upgrading-synopsis">26.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#updating-upgrading-freebsdupdate">26.2. FreeBSD Update</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#updating-bootcode">26.3. Updating Bootcode</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#updating-upgrading-documentation">26.4. Updating the Documentation Set</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#current-stable">26.5. Tracking a Development Branch</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#makeworld">26.6. Updating FreeBSD from Source</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#small-lan">26.7. Tracking for Multiple Machines</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/cutting-edge/#building-on-non-freebsd-hosts">26.8. Building on non-FreeBSD Hosts</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-3ba999091575eb04ae88235cd0fb1afa" class="toggle"  />
          <label  class="icon cursor"  for="chapter-3ba999091575eb04ae88235cd0fb1afa"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/dtrace/">
              Chapter 27. DTrace
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/dtrace/#dtrace-synopsis">27.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/dtrace/#dtrace-implementation">27.2. Implementation Differences</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/dtrace/#dtrace-enable">27.3. Enabling DTrace Support</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/dtrace/#dtrace-using">27.4. Using DTrace</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bdb217202a0a3eef4571dd1fcd50863c" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bdb217202a0a3eef4571dd1fcd50863c"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/usb-device-mode/">
              Chapter 28. USB Device Mode / USB OTG
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/usb-device-mode/#usb-device-mode-synopsis">28.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/usb-device-mode/#usb-device-mode-terminals">28.2. USB Virtual Serial Ports</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/usb-device-mode/#usb-device-mode-network">28.3. USB Device Mode Network Interfaces</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/usb-device-mode/#usb-device-mode-storage">28.4. USB Virtual Storage Device</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-6d4439926bb106ac084ecc88cfd3cfa4" class="toggle"  />
          <label  for="chapter-6d4439926bb106ac084ecc88cfd3cfa4"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/partiv/">
              Part IV. Network Communication
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-05a353fcb61d8e035f7c43e14725766e" class="toggle"  />
          <label  class="icon cursor"  for="chapter-05a353fcb61d8e035f7c43e14725766e"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/">
              Chapter 29. Serial Communications
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#serial-synopsis">29.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#serial">29.2. Serial Terminology and Hardware</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#term">29.3. Terminals</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#dialup">29.4. Dial-in Service</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#dialout">29.5. Dial-out Service</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/serialcomms/#serialconsole-setup">29.6. Setting Up the Serial Console</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8" class="toggle"  />
          <label  class="icon cursor"  for="chapter-7f0cbcbf6701b86eba3bbd6fc829f1b8"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/">
              Chapter 30. PPP
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/#ppp-and-slip-synopsis">30.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/#userppp">30.2. Configuring PPP</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/#ppp-troubleshoot">30.3. Troubleshooting PPP Connections</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/#pppoe">30.4. Using PPP over Ethernet (PPPoE)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/ppp-and-slip/#pppoa">30.5. Using PPP over ATM (PPPoA)</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9d023b545804f197d195dd9412749943" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9d023b545804f197d195dd9412749943"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/mail/">
              Chapter 31. Electronic Mail
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#mail-synopsis">31.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#mail-using">31.2. Mail Components</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#dragonFly-mail-agent">31.3. DragonFly Mail Agent (DMA)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#sendmail">31.4. Sendmail</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#mail-changingmta">31.5. Changing the Mail Transfer Agent</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#mail-agents">31.6. Mail User Agents</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mail/#mail-advanced">31.7. Advanced Topics</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-42b19e05d30c4135c74b9878818747a9" class="toggle"  />
          <label  class="icon cursor"  for="chapter-42b19e05d30c4135c74b9878818747a9"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/network-servers/">
              Chapter 32. Network Servers
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-servers-synopsis">32.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-inetd">32.2. The inetd Super-Server</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-nfs">32.3. Network File System (NFS)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-nis">32.4. Network Information System (NIS)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-ldap">32.5. Lightweight Directory Access Protocol (LDAP)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-dhcp">32.6. Dynamic Host Configuration Protocol (DHCP)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-dns">32.7. Domain Name System (DNS)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-apache">32.8. Apache HTTP Server</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-ftp">32.9. File Transfer Protocol (FTP)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-samba">32.10. File and Print Services for Microsoft® Windows® Clients (Samba)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-ntp">32.11. Clock Synchronization with NTP</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/network-servers/#network-iscsi">32.12. iSCSI Initiator and Target Configuration</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9554a5177d00d0e87ada408809a1fc67" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9554a5177d00d0e87ada408809a1fc67"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/firewalls/">
              Chapter 33. Firewalls
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-intro">33.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-concepts">33.2. Firewall Concepts</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-pf">33.3. PF</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-ipfw">33.4. IPFW</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-ipf">33.5. IPFILTER (IPF)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/firewalls/#firewalls-blacklistd">33.6. Blacklistd</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-9903a1d844ed803a436595e93ec33572" class="toggle"  />
          <label  class="icon cursor"  for="chapter-9903a1d844ed803a436595e93ec33572"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/">
              Chapter 34. Advanced Networking
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#advanced-networking-synopsis">34.1. Synopsis</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-routing">34.2. Gateways and Routes</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#configtuning-virtual-hosts">34.3. Virtual Hosts</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-advanced-wireless">34.4. Wireless Advanced Authentication</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#wireless-ad-hoc-mode">34.5. Wireless Ad-hoc Mode</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-usb-tethering">34.6. USB Tethering</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-bluetooth">34.7. Bluetooth</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-bridging">34.8. Bridging</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-aggregation">34.9. Link Aggregation and Failover</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-diskless">34.10. Diskless Operation with PXE</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#carp">34.11. Common Address Redundancy Protocol (CARP)</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/advanced-networking/#network-vlan">34.12. VLANs</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-8ca29f99c249993ee9234cb4632af7a5" class="toggle"  />
          <label  for="chapter-8ca29f99c249993ee9234cb4632af7a5"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/partv/">
              Part V. Appendices
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-0229d553ebf23ffeb945be6f32836221" class="toggle"  />
          <label  class="icon cursor"  for="chapter-0229d553ebf23ffeb945be6f32836221"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/mirrors/">
              Appendix A. Obtaining FreeBSD
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mirrors/#mirrors">A.1. Mirrors</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mirrors/#git">A.2. Using Git</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mirrors/#svn">A.3. Using Subversion</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/mirrors/#mirrors-cdrom">A.4. CD and DVD Sets</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-743c99fa278b8138914ff018e40c9231" class="toggle"  />
          <label  class="icon cursor"  for="chapter-743c99fa278b8138914ff018e40c9231"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/bibliography/">
              Appendix B. Bibliography
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bibliography/#bibliography-freebsd">B.1. FreeBSD Bibliography</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bibliography/#bibliography-security">B.2. Security Reference</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bibliography/#bibliography-history">B.3. UNIX® History</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/bibliography/#bibliography-journals">B.4. Periodicals, Journals, and Magazines</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-de7eade4b8b64f298c0cbac44c2278da" class="toggle"  />
          <label  class="icon cursor"  for="chapter-de7eade4b8b64f298c0cbac44c2278da"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/eresources/">
              Appendix C. Resources on the Internet
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/eresources/#eresources-www">C.1. Websites</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/eresources/#eresources-mail">C.2. Mailing Lists</a></li>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/eresources/#eresources-news">C.3. Usenet Newsgroups</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26" class="toggle"  />
          <label  class="icon cursor"  for="chapter-bfb0d4e71c3c1a18a8b75e03f4b48e26"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/pgpkeys/">
              Appendix D. OpenPGP Keys
            </a>
            
            
  <ul>
    <li><a href="https://free.bsd-doc.org/en/books/handbook/pgpkeys/#pgpkeys-officers">D.1. Officers</a></li>
  </ul>

          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-2a8deedf14429128049622ec007c9d3f" class="toggle"  />
          <label  for="chapter-2a8deedf14429128049622ec007c9d3f"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/glossary/">
              FreeBSD Glossary
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-110dbb242491bf200e51e76db171f670" class="toggle"  />
          <label  for="chapter-110dbb242491bf200e51e76db171f670"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/colophon/">
              Colophon
            </a>
            
            
          

        
      </li>
    
      <li>
        

          
          
          

          <input type="checkbox" id="chapter-caffbcba74982e4b26b9263ac0232bc3" class="toggle"  />
          <label  for="chapter-caffbcba74982e4b26b9263ac0232bc3"><a role="button"></a></label>

          
            
            <a href="https://free.bsd-doc.org/en/books/handbook/introduction/">
              
            </a>
            
            
          

        
      </li>
    
      <li>
        
      </li>
    
  </ul>


      </nav>
    </div>
  </aside>
  
  <div class="book">
    
    <div class="book-menu-mobile">
      <label for="menu-control">
        <span class="menu-control-button">
          <i class="fa fa-list" aria-hidden="true" title="Book menu"></i>
          Book menu
        </span>
      </label>
    </div>
    
    <h1 class="title">Chapter 20. Storage</h1>
    
    
    
    
    <div class="toc-mobile">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#disks-synopsis">20.1. Synopsis</a></li>
    <li><a href="#disks-adding">20.2. Adding Disks</a></li>
    <li><a href="#disks-growing">20.3. Resizing and Growing Disks</a></li>
    <li><a href="#usb-disks">20.4. USB Storage Devices</a></li>
    <li><a href="#creating-cds">20.5. Creating and Using CD Media</a></li>
    <li><a href="#creating-dvds">20.6. Creating and Using DVD Media</a></li>
    <li><a href="#floppies">20.7. Creating and Using Floppy Disks</a></li>
    <li><a href="#using-ntfs">20.8. Using NTFS Disks</a></li>
    <li><a href="#backup-basics">20.9. Backup Basics</a></li>
    <li><a href="#disks-virtual">20.10. Memory Disks</a></li>
    <li><a href="#snapshots">20.11. File System Snapshots</a></li>
    <li><a href="#quotas">20.12. Disk Quotas</a></li>
    <li><a href="#disks-encrypting">20.13. Encrypting Disk Partitions</a></li>
    <li><a href="#swap-encrypting">20.14. Encrypting Swap</a></li>
    <li><a href="#disks-hast">20.15. Highly Available Storage (HAST)</a></li>
  </ul>
</nav>
    </div>
    
      
      
    
    <div class="book-content">
      <div id="preamble">
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="disks-synopsis">20.1. Synopsis<a class="anchor" href="#disks-synopsis"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers the use of disks and storage media in FreeBSD.
This includes SCSI and IDE disks, CD and DVD media, memory-backed disks, and USB storage devices.</p>
</div>
<div class="paragraph">
<p>After reading this chapter, you will know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to add additional hard disks to a FreeBSD system.</p>
</li>
<li>
<p>How to grow the size of a disk’s partition on FreeBSD.</p>
</li>
<li>
<p>How to configure FreeBSD to use USB storage devices.</p>
</li>
<li>
<p>How to use CD and DVD media on a FreeBSD system.</p>
</li>
<li>
<p>How to use the backup programs available under FreeBSD.</p>
</li>
<li>
<p>How to set up memory disks.</p>
</li>
<li>
<p>What file system snapshots are and how to use them efficiently.</p>
</li>
<li>
<p>How to use quotas to limit disk space usage.</p>
</li>
<li>
<p>How to encrypt disks and swap to secure them against attackers.</p>
</li>
<li>
<p>How to configure a highly available storage network.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before reading this chapter, you should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Know how to <a href="../kernelconfig/#kernelconfig">configure and install a new FreeBSD kernel</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disks-adding">20.2. Adding Disks<a class="anchor" href="#disks-adding"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to add a new SATA disk to a machine that currently only has a single drive.
First, turn off the computer and install the drive in the computer following the instructions of the computer, controller, and drive manufacturers.
Reboot the system and become <code>root</code>.</p>
</div>
<div class="paragraph">
<p>Inspect <span class="filename">/var/run/dmesg.boot</span> to ensure the new disk was found.
In this example, the newly added SATA drive will appear as <span class="filename">ada1</span>.</p>
</div>
<div class="paragraph">
<p>For this example, a single large partition will be created on the new disk.
The <a href="http://en.wikipedia.org/wiki/GUID_Partition_Table">GPT</a> partitioning scheme will be used in preference to the older and less versatile MBR scheme.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the disk to be added is not blank, old partition information can be removed with <code>gpart delete</code>.
See <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> for details.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The partition scheme is created, and then a single partition is added.
To improve performance on newer disks with larger hardware block sizes, the partition is aligned to one megabyte boundaries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart create -s GPT ada1</span>
<span class="c"># gpart add -t freebsd-ufs -a 1M ada1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on use, several smaller partitions may be desired.
See <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a> for options to create partitions smaller than a whole disk.</p>
</div>
<div class="paragraph">
<p>The disk partition information can be viewed with <code>gpart show</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>gpart show ada1
<span class="gp">=&gt;        </span>34  1465146988  ada1  GPT  <span class="o">(</span>699G<span class="o">)</span>
          34        2014        - free -  <span class="o">(</span>1.0M<span class="o">)</span>
        2048  1465143296     1  freebsd-ufs  <span class="o">(</span>699G<span class="o">)</span>
  1465145344        1678        - free -  <span class="o">(</span>839K<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A file system is created in the new partition on the new disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># newfs -U /dev/ada1p1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An empty directory is created as a <em>mountpoint</em>, a location for mounting the new disk in the original disk’s file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /newdisk</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, an entry is added to <span class="filename">/etc/fstab</span> so the new disk will be mounted automatically at startup:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/dev/ada1p1	/newdisk	ufs	rw	2	2</pre>
</div>
</div>
<div class="paragraph">
<p>The new disk can be mounted manually, without restarting the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount /newdisk</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disks-growing">20.3. Resizing and Growing Disks<a class="anchor" href="#disks-growing"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A disk’s capacity can increase without any changes to the data already present.
This happens commonly with virtual machines, when the virtual disk turns out to be too small and is enlarged.
Sometimes a disk image is written to a USB memory stick, but does not use the full capacity.
Here we describe how to resize or <em>grow</em> disk contents to take advantage of increased capacity.</p>
</div>
<div class="paragraph">
<p>Determine the device name of the disk to be resized by inspecting <span class="filename">/var/run/dmesg.boot</span>.
In this example, there is only one SATA disk in the system, so the drive will appear as <span class="filename">ada0</span>.</p>
</div>
<div class="paragraph">
<p>List the partitions on the disk to see the current configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart show ada0</span>
<span class="gp">=&gt;      </span>34  83886013  ada0  GPT  <span class="o">(</span>48G<span class="o">)</span> <span class="o">[</span>CORRUPT]
        34       128     1  freebsd-boot  <span class="o">(</span>64k<span class="o">)</span>
       162  79691648     2  freebsd-ufs  <span class="o">(</span>38G<span class="o">)</span>
  79691810   4194236     3  freebsd-swap  <span class="o">(</span>2G<span class="o">)</span>
  83886046         1        - free -  <span class="o">(</span>512B<span class="o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the disk was formatted with the <a href="http://en.wikipedia.org/wiki/GUID_Partition_Table">GPT</a> partitioning scheme, it may show as &#34;corrupted&#34; because the GPT backup partition table is no longer at the end of the drive.
Fix the backup partition table with <code>gpart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart recover ada0</span>
ada0 recovered</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now the additional space on the disk is available for use by a new partition, or an existing partition can be expanded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart show ada0</span>
<span class="gp">=&gt;       </span>34  102399933  ada0  GPT  <span class="o">(</span>48G<span class="o">)</span>
         34        128     1  freebsd-boot  <span class="o">(</span>64k<span class="o">)</span>
        162   79691648     2  freebsd-ufs  <span class="o">(</span>38G<span class="o">)</span>
   79691810    4194236     3  freebsd-swap  <span class="o">(</span>2G<span class="o">)</span>
   83886046   18513921        - free -  <span class="o">(</span>8.8G<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Partitions can only be resized into contiguous free space.
Here, the last partition on the disk is the swap partition, but the second partition is the one that needs to be resized.
Swap partitions only contain temporary data, so it can safely be unmounted, deleted, and then recreate the third partition after resizing the second partition.</p>
</div>
<div class="paragraph">
<p>Disable the swap partition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># swapoff /dev/ada0p3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Delete the third partition, specified by the <code>-i</code> flag, from the disk <em>ada0</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart delete -i 3 ada0</span>
ada0p3 deleted
<span class="c"># gpart show ada0</span>
<span class="gp">=&gt;       </span>34  102399933  ada0  GPT  <span class="o">(</span>48G<span class="o">)</span>
         34        128     1  freebsd-boot  <span class="o">(</span>64k<span class="o">)</span>
        162   79691648     2  freebsd-ufs  <span class="o">(</span>38G<span class="o">)</span>
   79691810   22708157        - free -  <span class="o">(</span>10G<span class="o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is risk of data loss when modifying the partition table of a mounted file system.
It is best to perform the following steps on an unmounted file system while running from a live CD-ROM or USB device.
However, if absolutely necessary, a mounted file system can be resized after disabling GEOM safety features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl kern.geom.debugflags=16</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Resize the partition, leaving room to recreate a swap partition of the desired size.
The partition to resize is specified with <code>-i</code>, and the new desired size with <code>-s</code>.
Optionally, alignment of the partition is controlled with <code>-a</code>.
This only modifies the size of the partition.
The file system in the partition will be expanded in a separate step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart resize -i 2 -s 47G -a 4k ada0</span>
ada0p2 resized
<span class="c"># gpart show ada0</span>
<span class="gp">=&gt;       </span>34  102399933  ada0  GPT  <span class="o">(</span>48G<span class="o">)</span>
         34        128     1  freebsd-boot  <span class="o">(</span>64k<span class="o">)</span>
        162   98566144     2  freebsd-ufs  <span class="o">(</span>47G<span class="o">)</span>
   98566306    3833661        - free -  <span class="o">(</span>1.8G<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Recreate the swap partition and activate it.
If no size is specified with <code>-s</code>, all remaining space is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart add -t freebsd-swap -a 4k ada0</span>
ada0p3 added
<span class="c"># gpart show ada0</span>
<span class="gp">=&gt;       </span>34  102399933  ada0  GPT  <span class="o">(</span>48G<span class="o">)</span>
         34        128     1  freebsd-boot  <span class="o">(</span>64k<span class="o">)</span>
        162   98566144     2  freebsd-ufs  <span class="o">(</span>47G<span class="o">)</span>
   98566306    3833661     3  freebsd-swap  <span class="o">(</span>1.8G<span class="o">)</span>
<span class="c"># swapon /dev/ada0p3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Grow the UFS file system to use the new capacity of the resized partition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growfs /dev/ada0p2</span>
Device is mounted <span class="nb">read</span>-write; resizing will result <span class="k">in </span>temporary write suspension <span class="k">for</span> /.
It<span class="s1">&#39;s strongly recommended to make a backup before growing the file system.
OK to grow file system on /dev/ada0p2, mounted on /, from 38GB to 47GB? [Yes/No] Yes
super-block backups (for fsck -b #) at:
 80781312, 82063552, 83345792, 84628032, 85910272, 87192512, 88474752,
 89756992, 91039232, 92321472, 93603712, 94885952, 96168192, 97450432</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the file system is ZFS, the resize is triggered by running the <code>online</code> subcommand with <code>-e</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># zpool online -e zroot /dev/ada0p2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both the partition and the file system on it have now been resized to use the newly-available disk space.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usb-disks">20.4. USB Storage Devices<a class="anchor" href="#usb-disks"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many external storage solutions, such as hard drives, USB thumbdrives, and CD and DVD burners, use the Universal Serial Bus (USB).
FreeBSD provides support for USB 1.x, 2.0, and 3.0 devices.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>USB 3.0 support is not compatible with some hardware, including Haswell (Lynx point) chipsets.
If FreeBSD boots with a <code>failed with error 19</code> message, disable xHCI/USB3 in the system BIOS.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Support for USB storage devices is built into the <span class="filename">GENERIC</span> kernel.
For a custom kernel, be sure that the following lines are present in the kernel configuration file:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da
device cd	# needed for CD and DVD burners</pre>
</div>
</div>
<div class="paragraph">
<p>FreeBSD uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=umass&amp;sektion=4&amp;format=html">umass(4)</a> driver which uses the SCSI subsystem to access USB storage devices.
Since any USB device will be seen as a SCSI device by the system, if the USB device is a CD or DVD burner, do <em>not</em> include <code>device atapicam</code> in a custom kernel configuration file.</p>
</div>
<div class="paragraph">
<p>The rest of this section demonstrates how to verify that a USB storage device is recognized by FreeBSD and how to configure the device so that it can be used.</p>
</div>
<div class="sect2">
<h3 id="_device_configuration">20.4.1. Device Configuration<a class="anchor" href="#_device_configuration"></a></h3>
<div class="paragraph">
<p>To test the USB configuration, plug in the USB device.
Use <code>dmesg</code> to confirm that the drive appears in the system message buffer.
It should look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">umass0: &lt;STECH Simple Drive, class 0/0, rev 2.00/1.04, addr 3&gt; on usbus0
umass0:  SCSI over Bulk-Only; quirks <span class="o">=</span> 0x0100
umass0:4:0:-1: Attached to scbus4
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; Fixed Direct Access SCSI-4 device
da0: Serial Number WD-WXE508CAN263
da0: 40.000MB/s transfers
da0: 152627MB <span class="o">(</span>312581808 512 byte sectors: 255H 63S/T 19457C<span class="o">)</span>
da0: <span class="nv">quirks</span><span class="o">=</span>0x2&lt;NO_6_BYTE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The brand, device node (<span class="filename">da0</span>), speed, and size will differ according to the device.</p>
</div>
<div class="paragraph">
<p>Since the USB device is seen as a SCSI one, <code>camcontrol</code> can be used to list the USB storage devices attached to the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># camcontrol devlist</span>
&lt;STECH Simple Drive 1.04&gt;          at scbus4 target 0 lun 0 <span class="o">(</span>pass3,da0<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, <code>usbconfig</code> can be used to list the device.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=usbconfig&amp;sektion=8&amp;format=html">usbconfig(8)</a> for more information about this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># usbconfig</span>
ugen0.3: &lt;Simple Drive STECH&gt; at usbus0, <span class="nv">cfg</span><span class="o">=</span>0 <span class="nv">md</span><span class="o">=</span>HOST <span class="nv">spd</span><span class="o">=</span>HIGH <span class="o">(</span>480Mbps<span class="o">)</span> <span class="nv">pwr</span><span class="o">=</span>ON <span class="o">(</span>2mA<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the device has not been formatted, refer to <a href="#disks-adding">Adding Disks</a> for instructions on how to format and create partitions on the USB drive.
If the drive comes with a file system, it can be mounted by <code>root</code> using the instructions in <a href="../basics/#mount-unmount">“Mounting and Unmounting File Systems”</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Allowing untrusted users to mount arbitrary media, by enabling <code>vfs.usermount</code> as described below, should not be considered safe from a security point of view.
Most file systems were not built to safeguard against malicious devices.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To make the device mountable as a normal user, one solution is to make all users of the device a member of the <code>operator</code> group using <a href="https://man.freebsd.org/cgi/man.cgi?query=pw&amp;sektion=8&amp;format=html">pw(8)</a>.
Next, ensure that <code>operator</code> is able to read and write the device by adding these lines to <span class="filename">/etc/devfs.rules</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>[localrules=5]
add path &#39;da*&#39; mode 0660 group operator</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If internal SCSI disks are also installed in the system, change the second line as follows:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>add path &#39;da[3-9]*&#39; mode 0660 group operator</pre>
</div>
</div>
<div class="paragraph">
<p>This will exclude the first three SCSI disks (<span class="filename">da0</span> to <span class="filename">da2</span>) from belonging to the <code>operator</code> group.
Replace <em>3</em> with the number of internal SCSI disks.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devfs.rules&amp;sektion=5&amp;format=html">devfs.rules(5)</a> for more information about this file.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Next, enable the ruleset in <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>devfs_system_ruleset=&#34;localrules&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Then, instruct the system to allow regular users to mount file systems by adding the following line to <span class="filename">/etc/sysctl.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>vfs.usermount=1</pre>
</div>
</div>
<div class="paragraph">
<p>Since this only takes effect after the next reboot, use <code>sysctl</code> to set this variable now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysctl vfs.usermount=1</span>
vfs.usermount: 0 -&gt; 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final step is to create a directory where the file system is to be mounted.
This directory needs to be owned by the user that is to mount the file system.
One way to do that is for <code>root</code> to create a subdirectory owned by that user as <span class="filename">/mnt/username</span>.
In the following example, replace <em>username</em> with the login name of the user and <em>usergroup</em> with the user’s primary group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /mnt/username</span>
<span class="c"># chown username:usergroup /mnt/username</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose a USB thumbdrive is plugged in, and a device <span class="filename">/dev/da0s1</span> appears.
If the device is formatted with a FAT file system, the user can mount it using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>mount -t msdosfs -o -m<span class="o">=</span>644,-M<span class="o">=</span>755 /dev/da0s1 /mnt/username</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before the device can be unplugged, it <em>must</em> be unmounted first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>umount /mnt/username</code></pre>
</div>
</div>
<div class="paragraph">
<p>After device removal, the system message buffer will show messages similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">umass0: at uhub3, port 2, addr 3 <span class="o">(</span>disconnected<span class="o">)</span>
da0 at umass-sim0 bus 0 scbus4 target 0 lun 0
da0: &lt;STECH Simple Drive 1.04&gt; s/n WD-WXE508CAN263          detached
<span class="o">(</span>da0:umass-sim0:0:0:0<span class="o">)</span>: Periph destroyed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automounting_removable_media">20.4.2. Automounting Removable Media<a class="anchor" href="#_automounting_removable_media"></a></h3>
<div class="paragraph">
<p>USB devices can be automatically mounted by uncommenting this line in <span class="filename">/etc/auto_master</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">/media		-media		-nosuid</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add these lines to <span class="filename">/etc/devd.conf</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">notify 100 <span class="o">{</span>
	match <span class="s2">&#34;system&#34;</span> <span class="s2">&#34;GEOM&#34;</span>;
	match <span class="s2">&#34;subsystem&#34;</span> <span class="s2">&#34;DEV&#34;</span>;
	action <span class="s2">&#34;/usr/sbin/automount -c&#34;</span>;
<span class="o">}</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reload the configuration if <a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> are already running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service automount restart</span>
<span class="c"># service devd restart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> can be set to start at boot by adding this line to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>autofs_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://man.freebsd.org/cgi/man.cgi?query=autofs&amp;sektion=5&amp;format=html">autofs(5)</a> requires <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> to be enabled, as it is by default.</p>
</div>
<div class="paragraph">
<p>Start the services immediately with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service automount start</span>
<span class="c"># service automountd start</span>
<span class="c"># service autounmountd start</span>
<span class="c"># service devd start</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each file system that can be automatically mounted appears as a directory in <span class="filename">/media/</span>.
The directory is named after the file system label.
If the label is missing, the directory is named after the device node.</p>
</div>
<div class="paragraph">
<p>The file system is transparently mounted on the first access, and unmounted after a period of inactivity.
Automounted drives can also be unmounted manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># automount -fu</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mechanism is typically used for memory cards and USB memory sticks.
It can be used with any block device, including optical drives or iSCSILUNs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-cds">20.5. Creating and Using CD Media<a class="anchor" href="#creating-cds"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Compact Disc (CD) media provide a number of features that differentiate them from conventional disks.
They are designed so that they can be read continuously without delays to move the head between tracks.
While CD media do have tracks, these refer to a section of data to be read continuously, and not a physical property of the disk.
The ISO 9660 file system was designed to deal with these differences.</p>
</div>
<div class="paragraph">
<p>The FreeBSD Ports Collection provides several utilities for burning and duplicating audio and data CDs.
This chapter demonstrates the use of several command line utilities.
For CD burning software with a graphical utility, consider installing the <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/xcdroast/">sysutils/xcdroast</a> or <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/k3b/">sysutils/k3b</a> packages or ports.</p>
</div>
<div class="sect2">
<h3 id="atapicam">20.5.1. Supported Devices<a class="anchor" href="#atapicam"></a></h3>
<div class="paragraph">
<p>The <span class="filename">GENERIC</span> kernel provides support for SCSI, USB, and ATAPICD readers and burners.
If a custom kernel is used, the options that need to be present in the kernel configuration file vary by the type of device.</p>
</div>
<div class="paragraph">
<p>For a SCSI burner, make sure these options are present:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre>
</div>
</div>
<div class="paragraph">
<p>For a USB burner, make sure these options are present:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device scbus	# SCSI bus (required for ATA/SCSI)
device da	# Direct Access (disks)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners
device uhci	# provides USB 1.x support
device ohci	# provides USB 1.x support
device ehci	# provides USB 2.0 support
device xhci	# provides USB 3.0 support
device usb	# USB Bus (required)
device umass	# Disks/Mass storage - Requires scbus and da</pre>
</div>
</div>
<div class="paragraph">
<p>For an ATAPI burner, make sure these options are present:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device ata	# Legacy ATA/SATA controllers
device scbus	# SCSI bus (required for ATA/SCSI)
device pass	# Passthrough device (direct ATA/SCSI access)
device cd	# needed for CD and DVD burners</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On FreeBSD versions prior to 10.x, this line is also needed in the kernel configuration file if the burner is an ATAPI device:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device atapicam</pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, this driver can be loaded at boot time by adding the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>atapicam_load=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>This will require a reboot of the system as this driver can only be loaded at boot time.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To verify that FreeBSD recognizes the device, run <code>dmesg</code> and look for an entry for the device.
On systems prior to 10.x, the device name in the first line of the output will be <span class="filename">acd0</span> instead of <span class="filename">cd0</span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>dmesg | grep <span class="nb">cd
</span>cd0 at ahcich1 bus 0 scbus1 target 0 lun 0
cd0: &lt;HL-DT-ST DVDRAM GU70N LT20&gt; Removable CD-ROM SCSI-0 device
cd0: Serial Number M3OD3S34152
cd0: 150.000MB/s transfers <span class="o">(</span>SATA 1.x, UDMA6, ATAPI 12bytes, PIO 8192bytes<span class="o">)</span>
cd0: Attempt to query device size failed: NOT READY, Medium not present - tray closed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cdrecord">20.5.2. Burning a CD<a class="anchor" href="#cdrecord"></a></h3>
<div class="paragraph">
<p>In FreeBSD, <code>cdrecord</code> can be used to burn CDs.
This command is installed with the <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/">sysutils/cdrtools</a> package or port.</p>
</div>
<div class="paragraph">
<p>While <code>cdrecord</code> has many options, basic usage is simple.
Specify the name of the ISO file to burn and, if the system has multiple burner devices, specify the name of the device to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cdrecord dev=device imagefile.iso</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To determine the device name of the burner, use <code>-scanbus</code> which might produce results like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cdrecord -scanbus</span>
ProDVD-ProBD-Clone 3.00 <span class="o">(</span>amd64-unknown-freebsd10.0<span class="o">)</span> Copyright <span class="o">(</span>C<span class="o">)</span> 1995-2010 Jörg Schilling
Using libscg version <span class="s1">&#39;schily-0.9&#39;</span>
scsibus0:
        0,0,0     0<span class="o">)</span> <span class="s1">&#39;SEAGATE &#39;</span> <span class="s1">&#39;ST39236LW       &#39;</span> <span class="s1">&#39;0004&#39;</span> Disk
        0,1,0     1<span class="o">)</span> <span class="s1">&#39;SEAGATE &#39;</span> <span class="s1">&#39;ST39173W        &#39;</span> <span class="s1">&#39;5958&#39;</span> Disk
        0,2,0     2<span class="o">)</span> <span class="k">*</span>
        0,3,0     3<span class="o">)</span> <span class="s1">&#39;iomega  &#39;</span> <span class="s1">&#39;jaz 1GB         &#39;</span> <span class="s1">&#39;J.86&#39;</span> Removable Disk
        0,4,0     4<span class="o">)</span> <span class="s1">&#39;NEC     &#39;</span> <span class="s1">&#39;CD-ROM DRIVE:466&#39;</span> <span class="s1">&#39;1.26&#39;</span> Removable CD-ROM
        0,5,0     5<span class="o">)</span> <span class="k">*</span>
        0,6,0     6<span class="o">)</span> <span class="k">*</span>
        0,7,0     7<span class="o">)</span> <span class="k">*</span>
scsibus1:
        1,0,0   100<span class="o">)</span> <span class="k">*</span>
        1,1,0   101<span class="o">)</span> <span class="k">*</span>
        1,2,0   102<span class="o">)</span> <span class="k">*</span>
        1,3,0   103<span class="o">)</span> <span class="k">*</span>
        1,4,0   104<span class="o">)</span> <span class="k">*</span>
        1,5,0   105<span class="o">)</span> <span class="s1">&#39;YAMAHA  &#39;</span> <span class="s1">&#39;CRW4260         &#39;</span> <span class="s1">&#39;1.0q&#39;</span> Removable CD-ROM
        1,6,0   106<span class="o">)</span> <span class="s1">&#39;ARTEC   &#39;</span> <span class="s1">&#39;AM12S           &#39;</span> <span class="s1">&#39;1.06&#39;</span> Scanner
        1,7,0   107<span class="o">)</span> <span class="k">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Locate the entry for the CD burner and use the three numbers separated by commas as the value for <code>dev</code>.
In this case, the Yamaha burner device is <code>1,5,0</code>, so the appropriate input to specify that device is <code>dev=1,5,0</code>.
Refer to the manual page for <code>cdrecord</code> for other ways to specify this value and for information on writing audio tracks and controlling the write speed.</p>
</div>
<div class="paragraph">
<p>Alternately, run the following command to get the device address of the burner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># camcontrol devlist</span>
&lt;MATSHITA CDRW/DVD UJDA740 1.00&gt;   at scbus1 target 0 lun 0 <span class="o">(</span>cd0,pass0<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the numeric values for <code>scbus</code>, <code>target</code>, and <code>lun</code>.
For this example, <code>1,0,0</code> is the device name to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="mkisofs">20.5.3. Writing Data to an ISO File System<a class="anchor" href="#mkisofs"></a></h3>
<div class="paragraph">
<p>In order to produce a data CD, the data files that are going to make up the tracks on the CD must be prepared before they can be burned to the CD.
In FreeBSD, <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/">sysutils/cdrtools</a> installs <code>mkisofs</code>, which can be used to produce an ISO 9660 file system that is an image of a directory tree within a UNIX® file system.
The simplest usage is to specify the name of the ISO file to create and the path to the files to place into the ISO 9660 file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkisofs -o imagefile.iso /path/to/tree</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command maps the file names in the specified path to names that fit the limitations of the standard ISO 9660 file system, and will exclude files that do not meet the standard for ISO file systems.</p>
</div>
<div class="paragraph">
<p>A number of options are available to overcome the restrictions imposed by the standard.
In particular, <code>-R</code> enables the Rock Ridge extensions common to UNIX® systems and <code>-J</code> enables Joliet extensions used by Microsoft® systems.</p>
</div>
<div class="paragraph">
<p>For CDs that are going to be used only on FreeBSD systems, <code>-U</code> can be used to disable all filename restrictions.
When used with <code>-R</code>, it produces a file system image that is identical to the specified FreeBSD tree, even if it violates the ISO 9660 standard.</p>
</div>
<div class="paragraph">
<p>The last option of general use is <code>-b</code>.
This is used to specify the location of a boot image for use in producing an &#34;El Torito&#34; bootable CD.
This option takes an argument which is the path to a boot image from the top of the tree being written to the CD.
By default, <code>mkisofs</code> creates an ISO image in &#34;floppy disk emulation&#34; mode, and thus expects the boot image to be exactly 1200, 1440 or 2880 KB in size.
Some boot loaders, like the one used by the FreeBSD distribution media, do not use emulation mode.
In this case, <code>-no-emul-boot</code> should be used.
So, if <span class="filename">/tmp/myboot</span> holds a bootable FreeBSD system with the boot image in <span class="filename">/tmp/myboot/boot/cdboot</span>, this command would produce <span class="filename">/tmp/bootable.iso</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkisofs -R -no-emul-boot -b boot/cdboot -o /tmp/bootable.iso /tmp/myboot</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting ISO image can be mounted as a memory disk with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -a -t vnode -f /tmp/bootable.iso -u 0</span>
<span class="c"># mount -t cd9660 /dev/md0 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One can then verify that <span class="filename">/mnt</span> and <span class="filename">/tmp/myboot</span> are identical.</p>
</div>
<div class="paragraph">
<p>There are many other options available for <code>mkisofs</code> to fine-tune its behavior.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to copy a data CD to an image file that is functionally equivalent to the image file created with <code>mkisofs</code>.
To do so, use <span class="filename">dd</span> with the device name as the input file and the name of the ISO to create as the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/cd0 of=file.iso bs=2048</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting image file can be burned to CD as described in <a href="#cdrecord">Burning a CD</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="mounting-cd">20.5.4. Using Data CDs<a class="anchor" href="#mounting-cd"></a></h3>
<div class="paragraph">
<p>Once an ISO has been burned to a CD, it can be mounted by specifying the file system type, the name of the device containing the CD, and an existing mount point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount -t cd9660 /dev/cd0 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>mount</code> assumes that a file system is of type <code>ufs</code>, an <code>Incorrect super block</code> error will occur if <code>-t cd9660</code> is not included when mounting a data CD.</p>
</div>
<div class="paragraph">
<p>While any data CD can be mounted this way, disks with certain ISO 9660 extensions might behave oddly.
For example, Joliet disks store all filenames in two-byte Unicode characters.
If some non-English characters show up as question marks, specify the local charset with <code>-C</code>.
For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_cd9660&amp;sektion=8&amp;format=html">mount_cd9660(8)</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to do this character conversion with the help of <code>-C</code>, the kernel requires the <span class="filename">cd9660_iconv.ko</span> module to be loaded.
This can be done either by adding this line to <span class="filename">loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>cd9660_iconv_load=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>and then rebooting the machine, or by directly loading the module with <code>kldload</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Occasionally, <code>Device not configured</code> will be displayed when trying to mount a data CD.
This usually means that the CD drive has not detected a disk in the tray, or that the drive is not visible on the bus.
It can take a couple of seconds for a CD drive to detect media, so be patient.</p>
</div>
<div class="paragraph">
<p>Sometimes, a SCSICD drive may be missed because it did not have enough time to answer the bus reset.
To resolve this, a custom kernel can be created which increases the default SCSI delay.
Add the following option to the custom kernel configuration file and rebuild the kernel using the instructions in <a href="../kernelconfig/#kernelconfig-building">“Building and Installing a Custom Kernel”</a>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options SCSI_DELAY=15000</pre>
</div>
</div>
<div class="paragraph">
<p>This tells the SCSI bus to pause 15 seconds during boot, to give the CD drive every possible chance to answer the bus reset.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to burn a file directly to CD, without creating an ISO 9660 file system.
This is known as burning a raw data CD and some people do this for backup purposes.</p>
</div>
<div class="paragraph">
<p>This type of disk can not be mounted as a normal data CD.
In order to retrieve the data burned to such a CD, the data must be read from the raw device node.
For example, this command will extract a compressed tar file located on the second CD device into the current working directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tar xzvf /dev/cd1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to mount a data CD, the data must be written using <code>mkisofs</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="duplicating-audiocds">20.5.5. Duplicating Audio CDs<a class="anchor" href="#duplicating-audiocds"></a></h3>
<div class="paragraph">
<p>To duplicate an audio CD, extract the audio data from the CD to a series of files, then write these files to a blank CD.</p>
</div>
<div class="paragraph">
<p><a href="#using-cdrecord">Procedure: Duplicating an Audio CD</a> describes how to duplicate and burn an audio CD.
If the FreeBSD version is less than 10.0 and the device is ATAPI, the <code>atapicam</code> module must be first loaded using the instructions in <a href="#atapicam">Supported Devices</a>.</p>
</div>
<div id="using-cdrecord" class="olist arabic procedure">
<div class="title">Procedure: Duplicating an Audio CD</div>
<ol class="arabic">
<li>
<p>The <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/">sysutils/cdrtools</a> package or port installs <code>cdda2wav</code>. This command can be used to extract all of the audio tracks, with each track written to a separate WAV file in the current working directory:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>cdda2wav -vall -B -Owav</code></pre>
</div>
</div>
<div class="paragraph">
<p>A device name does not need to be specified if there is only one CD device on the system.
Refer to the <code>cdda2wav</code> manual page for instructions on how to specify a device and to learn more about the other options available for this command.</p>
</div>
</li>
<li>
<p>Use <code>cdrecord</code> to write the <span class="filename">.wav</span> files:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>cdrecord -v <span class="nv">dev</span><span class="o">=</span>2,0 -dao -useinfo  <span class="k">*</span>.wav</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure that <em>2,0</em> is set appropriately, as described in <a href="#cdrecord">Burning a CD</a>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-dvds">20.6. Creating and Using DVD Media<a class="anchor" href="#creating-dvds"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Compared to the CD, the DVD is the next generation of optical media storage technology.
The DVD can hold more data than any CD and is the standard for video publishing.</p>
</div>
<div class="paragraph">
<p>Five physical recordable formats can be defined for a recordable DVD:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DVD-R: This was the first DVD recordable format available. The DVD-R standard is defined by the <a href="http://www.dvdforum.org/forum.shtml">DVD Forum</a>. This format is write once.</p>
</li>
<li>
<p>DVD-RW: This is the rewritable version of the DVD-R standard. A DVD-RW can be rewritten about 1000 times.</p>
</li>
<li>
<p>DVD-RAM: This is a rewritable format which can be seen as a removable hard drive. However, this media is not compatible with most DVD-ROM drives and DVD-Video players as only a few DVD writers support the DVD-RAM format. Refer to <a href="#creating-dvd-ram">Using a DVD-RAM</a> for more information on DVD-RAM use.</p>
</li>
<li>
<p>DVD+RW: This is a rewritable format defined by the <a href="https://en.wikipedia.org/wiki/DVD%2BRW_Alliance">DVD+RW Alliance</a>. A DVD+RW can be rewritten about 1000 times.</p>
</li>
<li>
<p>DVD+R: This format is the write once variation of the DVD+RW format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A single layer recordable DVD can hold up to 4,700,000,000 bytes which is actually 4.38 GB or 4485 MB as 1 kilobyte is 1024 bytes.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A distinction must be made between the physical media and the application.
For example, a DVD-Video is a specific file layout that can be written on any recordable DVD physical media such as DVD-R, DVD+R, or DVD-RW.
Before choosing the type of media, ensure that both the burner and the DVD-Video player are compatible with the media under consideration.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_configuration">20.6.1. Configuration<a class="anchor" href="#_configuration"></a></h3>
<div class="paragraph">
<p>To perform DVD recording, use <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>.
This command is part of the <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/dvd+rw-tools/">sysutils/dvd+rw-tools</a> utilities which support all DVD media types.</p>
</div>
<div class="paragraph">
<p>These tools use the SCSI subsystem to access the devices, therefore <a href="#atapicam">ATAPI/CAM support</a> must be loaded or statically compiled into the kernel.
This support is not needed if the burner uses the USB interface.
Refer to <a href="#usb-disks">USB Storage Devices</a> for more details on USB device configuration.</p>
</div>
<div class="paragraph">
<p>DMA access must also be enabled for ATAPI devices, by adding the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>hw.ata.atapi_dma=&#34;1&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Before attempting to use dvd+rw-tools, consult the <a href="http://fy.chalmers.se/~appro/linux/DVD+RW/hcn.html">Hardware Compatibility Notes</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a graphical user interface, consider using <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/k3b/">sysutils/k3b</a> which provides a user friendly interface to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> and many other burning tools.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_burning_data_dvds">20.6.2. Burning Data DVDs<a class="anchor" href="#_burning_data_dvds"></a></h3>
<div class="paragraph">
<p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> is a front-end to <a href="#mkisofs">mkisofs</a>, it will invoke <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create the file system layout and perform the write on the DVD.
This means that an image of the data does not need to be created before the burning process.</p>
</div>
<div class="paragraph">
<p>To burn to a DVD+R or a DVD-R the data in <span class="filename">/path/to/data</span>, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -dvd-compat -Z /dev/cd0 -J -R /path/to/data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>-J -R</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to create an ISO 9660 file system with Joliet and Rock Ridge extensions.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> for more details.</p>
</div>
<div class="paragraph">
<p>For the initial session recording, <code>-Z</code> is used for both single and multiple sessions.
Replace <em>/dev/cd0</em>, with the name of the DVD device.
Using <code>-dvd-compat</code> indicates that the disk will be closed and that the recording will be unappendable.
This should also provide better media compatibility with DVD-ROM drives.</p>
</div>
<div class="paragraph">
<p>To burn a pre-mastered image, such as <em>imagefile.iso</em>, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -dvd-compat -Z /dev/cd0=imagefile.iso</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The write speed should be detected and automatically set according to the media and the drive being used.
To force the write speed, use <code>-speed=</code>. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> for example usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to support working files larger than 4.38GB, an UDF/ISO-9660 hybrid file system must be created by passing <code>-udf -iso-level 3</code> to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> and all related programs, such as <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>.
This is required only when creating an ISO image file or when writing files directly to a disk.
Since a disk created this way must be mounted as an UDF file system with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_udf&amp;sektion=8&amp;format=html">mount_udf(8)</a>, it will be usable only on an UDF aware operating system.
Otherwise it will look as if it contains corrupted files.</p>
</div>
<div class="paragraph">
<p>To create this type of ISO file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>mkisofs -R -J -udf -iso-level 3 -o imagefile.iso /path/to/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>To burn files directly to a disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -dvd-compat -udf -iso-level 3 -Z /dev/cd0 -J -R /path/to/data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When an ISO image already contains large files, no additional options are required for <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> to burn that image on a disk.</p>
</div>
<div class="paragraph">
<p>Be sure to use an up-to-date version of <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/cdrtools/">sysutils/cdrtools</a>, which contains <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>, as an older version may not contain large files support.
If the latest version does not work, install <a class="package" href="https://cgit.freebsd.org/ports/tree/sysutils/cdrtools-devel/">sysutils/cdrtools-devel</a> and read its <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_burning_a_dvd_video">20.6.3. Burning a DVD-Video<a class="anchor" href="#_burning_a_dvd_video"></a></h3>
<div class="paragraph">
<p>A DVD-Video is a specific file layout based on the ISO 9660 and micro-UDF (M-UDF) specifications.
Since DVD-Video presents a specific data structure hierarchy, a particular program such as <a class="package" href="https://cgit.freebsd.org/ports/tree/multimedia/dvdauthor/">multimedia/dvdauthor</a> is needed to author the DVD.</p>
</div>
<div class="paragraph">
<p>If an image of the DVD-Video file system already exists, it can be burned in the same way as any other image.
If <code>dvdauthor</code> was used to make the DVD and the result is in <span class="filename">/path/to/video</span>, the following command should be used to burn the DVD-Video:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -Z /dev/cd0 -dvd-video /path/to/video</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-dvd-video</code> is passed to <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> to instruct it to create a DVD-Video file system layout.
This option implies the <code>-dvd-compat</code> <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> option.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_dvdrw">20.6.4. Using a DVD+RW<a class="anchor" href="#_using_a_dvdrw"></a></h3>
<div class="paragraph">
<p>Unlike CD-RW, a virgin DVD+RW needs to be formatted before first use.
It is <em>recommended</em> to let <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> take care of this automatically whenever appropriate.
However, it is possible to use <code>dvd+rw-format</code> to format the DVD+RW:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dvd+rw-format /dev/cd0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only perform this operation once and keep in mind that only virgin DVD+RW medias need to be formatted.
Once formatted, the DVD+RW can be burned as usual.</p>
</div>
<div class="paragraph">
<p>To burn a totally new file system and not just append some data onto a DVD+RW, the media does not need to be blanked first.
Instead, write over the previous recording like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -Z /dev/cd0 -J -R /path/to/newdata</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DVD+RW format supports appending data to a previous recording.
This operation consists of merging a new session to the existing one as it is not considered to be multi-session writing.
<a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> will <em>grow</em> the ISO 9660 file system present on the media.</p>
</div>
<div class="paragraph">
<p>For example, to append data to a DVD+RW, use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same <a href="https://man.freebsd.org/cgi/man.cgi?query=mkisofs&amp;sektion=8&amp;format=html">mkisofs(8)</a> options used to burn the initial session should be used during next writes.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use <code>-dvd-compat</code> for better media compatibility with DVD-ROM drives.
When using DVD+RW, this option will not prevent the addition of data.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To blank the media, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -Z /dev/cd0=/dev/zero</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_dvd_rw">20.6.5. Using a DVD-RW<a class="anchor" href="#_using_a_dvd_rw"></a></h3>
<div class="paragraph">
<p>A DVD-RW accepts two disc formats: incremental sequential and restricted overwrite.
By default, DVD-RW discs are in sequential format.</p>
</div>
<div class="paragraph">
<p>A virgin DVD-RW can be directly written without being formatted.
However, a non-virgin DVD-RW in sequential format needs to be blanked before writing a new initial session.</p>
</div>
<div class="paragraph">
<p>To blank a DVD-RW in sequential mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dvd+rw-format -blank=full /dev/cd0</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A full blanking using <code>-blank=full</code> will take about one hour on a 1x media.
A fast blanking can be performed using <code>-blank</code>, if the DVD-RW will be recorded in Disk-At-Once (DAO) mode.
To burn the DVD-RW in DAO mode, use the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -use-the-force-luke=dao -Z /dev/cd0=imagefile.iso</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a> automatically attempts to detect fast blanked media and engage DAO write, <code>-use-the-force-luke=dao</code> should not be required.</p>
</div>
<div class="paragraph">
<p>One should instead use restricted overwrite mode with any DVD-RW as this format is more flexible than the default of incremental sequential.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To write data on a sequential DVD-RW, use the same instructions as for the other DVD formats:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -Z /dev/cd0 -J -R /path/to/data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To append some data to a previous recording, use <code>-M</code> with <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>.
However, if data is appended on a DVD-RW in incremental sequential mode, a new session will be created on the disc and the result will be a multi-session disc.</p>
</div>
<div class="paragraph">
<p>A DVD-RW in restricted overwrite format does not need to be blanked before a new initial session.
Instead, overwrite the disc with <code>-Z</code>.
It is also possible to grow an existing ISO 9660 file system written on the disc with <code>-M</code>.
The result will be a one-session DVD.</p>
</div>
<div class="paragraph">
<p>To put a DVD-RW in restricted overwrite format, the following command must be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dvd+rw-format /dev/cd0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To change back to sequential format, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dvd+rw-format -blank=full /dev/cd0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_session">20.6.6. Multi-Session<a class="anchor" href="#_multi_session"></a></h3>
<div class="paragraph">
<p>Few DVD-ROM drives support multi-session DVDs and most of the time only read the first session.
DVD+R, DVD-R and DVD-RW in sequential format can accept multiple sessions.
The notion of multiple sessions does not exist for the DVD+RW and the DVD-RW restricted overwrite formats.</p>
</div>
<div class="paragraph">
<p>Using the following command after an initial non-closed session on a DVD+R, DVD-R, or DVD-RW in sequential format, will add a new session to the disc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># growisofs -M /dev/cd0 -J -R /path/to/nextdata</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this command with a DVD+RW or a DVD-RW in restricted overwrite mode will append data while merging the new session to the existing one.
The result will be a single-session disc.
Use this method to add data after an initial write on these types of media.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since some space on the media is used between each session to mark the end and start of sessions, one should add sessions with a large amount of data to optimize media space.
The number of sessions is limited to 154 for a DVD+R, about 2000 for a DVD-R, and 127 for a DVD+R Double Layer.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_for_more_information">20.6.7. For More Information<a class="anchor" href="#_for_more_information"></a></h3>
<div class="paragraph">
<p>To obtain more information about a DVD, use <code>dvd+rw-mediainfo <em>/dev/cd0</em></code> while the disc in the specified drive.</p>
</div>
<div class="paragraph">
<p>More information about dvd+rw-tools can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=growisofs&amp;sektion=1&amp;format=html">growisofs(1)</a>, on the <a href="http://fy.chalmers.se/~appro/linux/DVD+RW/">dvd+rw-tools web site</a>, and in the <a href="http://lists.debian.org/cdwrite/">cdwrite mailing list</a> archives.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When creating a problem report related to the use of dvd+rw-tools, always include the output of <code>dvd+rw-mediainfo</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="creating-dvd-ram">20.6.8. Using a DVD-RAM<a class="anchor" href="#creating-dvd-ram"></a></h3>
<div class="paragraph">
<p>DVD-RAM writers can use either a SCSI or ATAPI interface.
For ATAPI devices, DMA access has to be enabled by adding the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>hw.ata.atapi_dma=&#34;1&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>A DVD-RAM can be seen as a removable hard drive.
Like any other hard drive, the DVD-RAM must be formatted before it can be used.
In this example, the whole disk space will be formatted with a standard UFS2 file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/zero of=/dev/acd0 bs=2k count=1</span>
<span class="c"># bsdlabel -Bw acd0</span>
<span class="c"># newfs /dev/acd0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DVD device, <span class="filename">acd0</span>, must be changed according to the configuration.</p>
</div>
<div class="paragraph">
<p>Once the DVD-RAM has been formatted, it can be mounted as a normal hard drive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount /dev/acd0 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once mounted, the DVD-RAM will be both readable and writeable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="floppies">20.7. Creating and Using Floppy Disks<a class="anchor" href="#floppies"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to format a 3.5 inch floppy disk in FreeBSD.</p>
</div>
<div class="exampleblock procedure">
<div class="content">
<div class="paragraph">
<p><strong>Procedure: Steps to Format a Floppy</strong></p>
</div>
<div class="paragraph">
<p>A floppy disk needs to be low-level formatted before it can be used.
This is usually done by the vendor, but formatting is a good way to check media integrity.
To low-level format the floppy disk on FreeBSD, use <a href="https://man.freebsd.org/cgi/man.cgi?query=fdformat&amp;sektion=1&amp;format=html">fdformat(1)</a>.
When using this utility, make note of any error messages, as these can help determine if the disk is good or bad.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To format the floppy, insert a new 3.5 inch floppy disk into the first floppy drive and issue:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /usr/sbin/fdformat -f 1440 /dev/fd0</span></code></pre>
</div>
</div>
</li>
<li>
<p>After low-level formatting the disk, create a disk label as it is needed by the system to determine the size of the disk and its geometry. The supported geometry values are listed in <span class="filename">/etc/disktab</span>.</p>
<div class="paragraph">
<p>To write the disk label, use <a href="https://man.freebsd.org/cgi/man.cgi?query=bsdlabel&amp;sektion=8&amp;format=html">bsdlabel(8)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /sbin/bsdlabel -B -w /dev/fd0 fd1440</span></code></pre>
</div>
</div>
</li>
<li>
<p>The floppy is now ready to be high-level formatted with a file system. The floppy’s file system can be either UFS or FAT, where FAT is generally a better choice for floppies.</p>
<div class="paragraph">
<p>To format the floppy with FAT, issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /sbin/newfs_msdos /dev/fd0</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>The disk is now ready for use.
To use the floppy, mount it with <a href="https://man.freebsd.org/cgi/man.cgi?query=mount_msdosfs&amp;sektion=8&amp;format=html">mount_msdosfs(8)</a>.
One can also install and use <a class="package" href="https://cgit.freebsd.org/ports/tree/emulators/mtools/">emulators/mtools</a> from the Ports Collection.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-ntfs">20.8. Using NTFS Disks<a class="anchor" href="#using-ntfs"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to mount NTFS disks in FreeBSD.</p>
</div>
<div class="paragraph">
<p>NTFS (New Technology File System) is a proprietary journaling file system developed by Microsoft®.
It has been the default file system in Microsoft Windows® for many years.
FreeBSD can mount NTFS volumes using a FUSE file system.
These file systems are implemented as user space programs which interact with the <a href="https://man.freebsd.org/cgi/man.cgi?query=fusefs&amp;sektion=5&amp;format=html">fusefs(5)</a> kernel module via a well defined interface.</p>
</div>
<div class="exampleblock procedure">
<div class="content">
<div class="paragraph">
<p><strong>Procedure: Steps to Mount a NTFS Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before using a FUSE file system we need to load the <a href="https://man.freebsd.org/cgi/man.cgi?query=fusefs&amp;sektion=5&amp;format=html">fusefs(5)</a> kernel
module:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload fusefs</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <a href="https://man.freebsd.org/cgi/man.cgi?query=sysrc&amp;sektion=8&amp;format=html">sysrc(8)</a> to load the module at startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># sysrc kld_list+=fusefs</span></code></pre>
</div>
</div>
</li>
<li>
<p>Install the actual NTFS file system from packages as in the example (see <a href="../ports/#pkgng-intro">Using pkg for Binary Package Management</a>) or from ports (see <a href="../ports/#ports-using">Using the Ports Collection</a>):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pkg install fusefs-ntfs</span></code></pre>
</div>
</div>
</li>
<li>
<p>Last we need to create a directory where the file system will be mounted:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /mnt/usb</span></code></pre>
</div>
</div>
</li>
<li>
<p>Suppose a USB disk is plugged in.  The disk partition information can be viewed with <a href="https://man.freebsd.org/cgi/man.cgi?query=gpart&amp;sektion=8&amp;format=html">gpart(8)</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gpart show da0</span>
<span class="o">=</span>&gt;	  63  1953525105  da0 MBR   <span class="o">(</span>932G<span class="o">)</span>
	  63  1953525105    1 ntfs  <span class="o">(</span>932G<span class="o">)</span></code></pre>
</div>
</div>
</li>
<li>
<p>We can mount the disk using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ntfs-3g /dev/da0s1 /mnt/usb/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The disk is now ready to use.</p>
</div>
</li>
<li>
<p>Additionally, an entry can be added to /etc/fstab:</p>
<div class="literalblock programlisting">
<div class="content">
<pre>/dev/da0s1  /mnt/usb	ntfs mountprog=/usr/local/bin/ntfs-3g,noauto,rw  0 0</pre>
</div>
</div>
<div class="paragraph">
<p>Now the disk can be now mounted with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount /mnt/usb</span></code></pre>
</div>
</div>
</li>
<li>
<p>The disk can be unmounted with:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># umount /mnt/usb/</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup-basics">20.9. Backup Basics<a class="anchor" href="#backup-basics"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Implementing a backup plan is essential in order to have the ability to recover from disk failure, accidental file deletion, random file corruption, or complete machine destruction, including destruction of on-site backups.</p>
</div>
<div class="paragraph">
<p>The backup type and schedule will vary, depending upon the importance of the data, the granularity needed for file restores, and the amount of acceptable downtime.
Some possible backup techniques include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Archives of the whole system, backed up onto permanent, off-site media. This provides protection against all of the problems listed above, but is slow and inconvenient to restore from, especially for non-privileged users.</p>
</li>
<li>
<p>File system snapshots, which are useful for restoring deleted files or previous versions of files.</p>
</li>
<li>
<p>Copies of whole file systems or disks which are synchronized with another system on the network using a scheduled <a class="package" href="https://cgit.freebsd.org/ports/tree/net/rsync/">net/rsync</a>.</p>
</li>
<li>
<p>Hardware or software RAID, which minimizes or avoids downtime when a disk fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typically, a mix of backup techniques is used.
For example, one could create a schedule to automate a weekly, full system backup that is stored off-site and to supplement this backup with hourly ZFS snapshots.
In addition, one could make a manual backup of individual directories or files before making file edits or deletions.</p>
</div>
<div class="paragraph">
<p>This section describes some of the utilities which can be used to create and manage backups on a FreeBSD system.</p>
</div>
<div class="sect2">
<h3 id="_file_system_backups">20.9.1. File System Backups<a class="anchor" href="#_file_system_backups"></a></h3>
<div class="paragraph">
<p>The traditional UNIX® programs for backing up a file system are <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a>, which creates the backup, and <a href="https://man.freebsd.org/cgi/man.cgi?query=restore&amp;sektion=8&amp;format=html">restore(8)</a>, which restores the backup.
These utilities work at the disk block level, below the abstractions of the files, links, and directories that are created by file systems.
Unlike other backup software, <code>dump</code> backs up an entire file system and is unable to backup only part of a file system or a directory tree that spans multiple file systems.
Instead of writing files and directories, <code>dump</code> writes the raw data blocks that comprise files and directories.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>dump</code> is used on the root directory, it will not back up <span class="filename">/home</span>, <span class="filename">/usr</span> or many other directories since these are typically mount points for other file systems or symbolic links into those file systems.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When used to restore data, <code>restore</code> stores temporary files in <span class="filename">/tmp/</span> by default.
When using a recovery disk with a small <span class="filename">/tmp</span>, set <code>TMPDIR</code> to a directory with more free space in order for the restore to succeed.</p>
</div>
<div class="paragraph">
<p>When using <code>dump</code>, be aware that some quirks remain from its early days in Version 6 of AT&amp;T UNIX®,circa 1975.
The default parameters assume a backup to a 9-track tape, rather than to another type of media or to the high-density tapes available today.
These defaults must be overridden on the command line.</p>
</div>
<div class="paragraph">
<p>It is possible to backup a file system across the network to a another system or to a tape drive attached to another computer.
While the <a href="https://man.freebsd.org/cgi/man.cgi?query=rdump&amp;sektion=8&amp;format=html">rdump(8)</a> and <a href="https://man.freebsd.org/cgi/man.cgi?query=rrestore&amp;sektion=8&amp;format=html">rrestore(8)</a> utilities can be used for this purpose, they are not considered to be secure.</p>
</div>
<div class="paragraph">
<p>Instead, one can use <code>dump</code> and <code>restore</code> in a more secure fashion over an SSH connection.
This example creates a full, compressed backup of <span class="filename">/usr</span> and sends the backup file to the specified host over a SSH connection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Using <code>dump</code> over ssh</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># /sbin/dump -0uan -f - /usr | gzip -2 | ssh -c blowfish \</span>
          targetuser@targetmachine.example.com dd <span class="nv">of</span><span class="o">=</span>/mybigfiles/dump-usr-l0.gz</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example sets <code>RSH</code> in order to write the backup to a tape drive on a remote system over a SSH connection:</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Using <code>dump</code> over ssh with <code>RSH</code> Set</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># env RSH=/usr/bin/ssh /sbin/dump -0uan -f targetuser@targetmachine.example.com:/dev/sa0 /usr</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directory_backups">20.9.2. Directory Backups<a class="anchor" href="#_directory_backups"></a></h3>
<div class="paragraph">
<p>Several built-in utilities are available for backing up and restoring specified files and directories as needed.</p>
</div>
<div class="paragraph">
<p>A good choice for making a backup of all of the files in a directory is <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>.
This utility dates back to Version 6 of AT&amp;T UNIX® and by default assumes a recursive backup to a local tape device.
Switches can be used to instead specify the name of a backup file.</p>
</div>
<div class="paragraph">
<p>This example creates a compressed backup of the current directory and saves it to <span class="filename">/tmp/mybackup.tgz</span>.
When creating a backup file, make sure that the backup is not saved to the same directory that is being backed up.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Backing Up the Current Directory with <code>tar</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tar czvf /tmp/mybackup.tgz .</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To restore the entire backup, <code>cd</code> into the directory to restore into and specify the name of the backup.
Note that this will overwrite any newer versions of files in the restore directory.
When in doubt, restore to a temporary directory or specify the name of the file within the backup to restore.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Restoring Up the Current Directory with <code>tar</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tar xzvf /tmp/mybackup.tgz</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are dozens of available switches which are described in <a href="https://man.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=1&amp;format=html">tar(1)</a>.
This utility also supports the use of exclude patterns to specify which files should not be included when backing up the specified directory or restoring files from a backup.</p>
</div>
<div class="paragraph">
<p>To create a backup using a specified list of files and directories, <a href="https://man.freebsd.org/cgi/man.cgi?query=cpio&amp;sektion=1&amp;format=html">cpio(1)</a> is a good choice.
Unlike <code>tar</code>, <code>cpio</code> does not know how to walk the directory tree and it must be provided the list of files to backup.</p>
</div>
<div class="paragraph">
<p>For example, a list of files can be created using <code>ls</code> or <code>find</code>.
This example creates a recursive listing of the current directory which is then piped to <code>cpio</code> in order to create an output backup file named <span class="filename">/tmp/mybackup.cpio</span>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Using <code>ls</code> and <code>cpio</code> to Make a Recursive Backup of the Current Directory</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ls -R | cpio -ovF /tmp/mybackup.cpio</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A backup utility which tries to bridge the features provided by <code>tar</code> and <code>cpio</code> is <a href="https://man.freebsd.org/cgi/man.cgi?query=pax&amp;sektion=1&amp;format=html">pax(1)</a>.
Over the years, the various versions of <code>tar</code> and <code>cpio</code> became slightly incompatible.
POSIX® created <code>pax</code> which attempts to read and write many of the various <code>cpio</code> and <code>tar</code> formats, plus new formats of its own.</p>
</div>
<div class="paragraph">
<p>The <code>pax</code> equivalent to the previous examples would be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Backing Up the Current Directory with <code>pax</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># pax -wf /tmp/mybackup.pax .</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backups-tapebackups">20.9.3. Using Data Tapes for Backups<a class="anchor" href="#backups-tapebackups"></a></h3>
<div class="paragraph">
<p>While tape technology has continued to evolve, modern backup systems tend to combine off-site backups with local removable media.
FreeBSD supports any tape drive that uses SCSI, such as LTO or DAT.
There is limited support for SATA and USB tape drives.</p>
</div>
<div class="paragraph">
<p>For SCSI tape devices, FreeBSD uses the <a href="https://man.freebsd.org/cgi/man.cgi?query=sa&amp;sektion=4&amp;format=html">sa(4)</a> driver and the <span class="filename">/dev/sa0</span>, <span class="filename">/dev/nsa0</span>, and <span class="filename">/dev/esa0</span> devices.
The physical device name is <span class="filename">/dev/sa0</span>. When <span class="filename">/dev/nsa0</span> is used, the backup application will not rewind the tape after writing a file, which allows writing more than one file to a tape.
Using <span class="filename">/dev/esa0</span> ejects the tape after the device is closed.</p>
</div>
<div class="paragraph">
<p>In FreeBSD, <code>mt</code> is used to control operations of the tape drive, such as seeking through files on a tape or writing tape control marks to the tape.
For example, the first three files on a tape can be preserved by skipping past them before writing a new file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mt -f /dev/nsa0 fsf 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This utility supports many operations. Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mt&amp;sektion=1&amp;format=html">mt(1)</a> for details.</p>
</div>
<div class="paragraph">
<p>To write a single file to tape using <code>tar</code>, specify the name of the tape device and the file to backup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tar cvf /dev/sa0 file</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To recover files from a <code>tar</code> archive on tape into the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># tar xvf /dev/sa0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To backup a UFS file system, use <code>dump</code>.
This examples backs up <span class="filename">/usr</span> without rewinding the tape when finished:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dump -0aL -b64 -f /dev/nsa0 /usr</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To interactively restore files from a <code>dump</code> file on tape into the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># restore -i -f /dev/nsa0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backups-programs-amanda">20.9.4. Third-Party Backup Utilities<a class="anchor" href="#backups-programs-amanda"></a></h3>
<div class="paragraph">
<p>The FreeBSD Ports Collection provides many third-party utilities which can be used to schedule the creation of backups, simplify tape backup, and make backups easier and more convenient.
Many of these applications are client/server based and can be used to automate the backups of a single system or all of the computers in a network.</p>
</div>
<div class="paragraph">
<p>Popular utilities include Amanda, Bacula, rsync, and duplicity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_emergency_recovery">20.9.5. Emergency Recovery<a class="anchor" href="#_emergency_recovery"></a></h3>
<div class="paragraph">
<p>In addition to regular backups, it is recommended to perform the following steps as part of an emergency preparedness plan.</p>
</div>
<div class="paragraph">
<p>Create a print copy of the output of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gpart show</code></p>
</li>
<li>
<p><code>more /etc/fstab</code></p>
</li>
<li>
<p><code>dmesg</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Store this printout and a copy of the installation media in a secure location.
Should an emergency restore be needed, boot into the installation media and select <code>Live CD</code> to access a rescue shell.
This rescue mode can be used to view the current state of the system, and if needed, to reformat disks and restore data from backups.</p>
</div>
<div class="paragraph">
<p>Next, test the rescue shell and the backups.
Make notes of the procedure.
Store these notes with the media, the printouts, and the backups.
These notes may prevent the inadvertent destruction of the backups while under the stress of performing an emergency recovery.</p>
</div>
<div class="paragraph">
<p>For an added measure of security, store the latest backup at a remote location which is physically separated from the computers and disk drives by a significant distance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disks-virtual">20.10. Memory Disks<a class="anchor" href="#disks-virtual"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to physical disks, FreeBSD also supports the creation and use of memory disks.
One possible use for a memory disk is to access the contents of an ISO file system without the overhead of first burning it to a CD or DVD, then mounting the CD/DVD media.</p>
</div>
<div class="paragraph">
<p>In FreeBSD, the <a href="https://man.freebsd.org/cgi/man.cgi?query=md&amp;sektion=4&amp;format=html">md(4)</a> driver is used to provide support for memory disks.
The <span class="filename">GENERIC</span> kernel includes this driver.
When using a custom kernel configuration file, ensure it includes this line:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>device md</pre>
</div>
</div>
<div class="sect2">
<h3 id="disks-mdconfig">20.10.1. Attaching and Detaching Existing Images<a class="anchor" href="#disks-mdconfig"></a></h3>
<div class="paragraph">
<p>To mount an existing file system image, use <code>mdconfig</code> to specify the name of the ISO file and a free unit number.
Then, refer to that unit number to mount it on an existing mount point.
Once mounted, the files in the ISO will appear in the mount point.
This example attaches <em>diskimage.iso</em> to the memory device <span class="filename">/dev/md0</span> then mounts that memory device on <span class="filename">/mnt</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -f diskimage.iso -u 0</span>
<span class="c"># mount -t cd9660 /dev/md0 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>-t cd9660</code> was used to mount an ISO format.
If a unit number is not specified with <code>-u</code>, <code>mdconfig</code> will automatically allocate an unused memory device and output the name of the allocated unit, such as <span class="filename">md4</span>.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdconfig&amp;sektion=8&amp;format=html">mdconfig(8)</a> for more details about this command and its options.</p>
</div>
<div class="paragraph">
<p>When a memory disk is no longer in use, its resources should be released back to the system.
First, unmount the file system, then use <code>mdconfig</code> to detach the disk from the system and release its resources.
To continue this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># umount /mnt</span>
<span class="c"># mdconfig -d -u 0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To determine if any memory disks are still attached to the system, type <code>mdconfig -l</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="disks-md-freebsd5">20.10.2. Creating a File- or Memory-Backed Memory Disk<a class="anchor" href="#disks-md-freebsd5"></a></h3>
<div class="paragraph">
<p>FreeBSD also supports memory disks where the storage to use is allocated from either a hard disk or an area of memory.
The first method is commonly referred to as a file-backed file system and the second method as a memory-backed file system.
Both types can be created using <code>mdconfig</code>.</p>
</div>
<div class="paragraph">
<p>To create a new memory-backed file system, specify a type of <code>swap</code> and the size of the memory disk to create.
Then, format the memory disk with a file system and mount as usual.
This example creates a 5M memory disk on unit <code>1</code>.
That memory disk is then formatted with the UFS file system before it is mounted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -a -t swap -s 5m -u 1</span>
<span class="c"># newfs -U md1</span>
/dev/md1: 5.0MB <span class="o">(</span>10240 sectors<span class="o">)</span> block size 16384, fragment size 2048
        using 4 cylinder groups of 1.27MB, 81 blks, 192 inodes.
        with soft updates
super-block backups <span class="o">(</span><span class="k">for </span>fsck -b <span class="c">#) at:</span>
 160, 2752, 5344, 7936
<span class="c"># mount /dev/md1 /mnt</span>
<span class="c"># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md1        4718    4  4338     0%    /mnt</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a new file-backed memory disk, first allocate an area of disk to use.
This example creates an empty 5MB file named <span class="filename">newimage</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/zero of=newimage bs=1k count=5k</span>
5120+0 records <span class="k">in
</span>5120+0 records out</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, attach that file to a memory disk, label the memory disk and format it with the UFS file system, mount the memory disk, and verify the size of the file-backed disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -f newimage -u 0</span>
<span class="c"># bsdlabel -w md0 auto</span>
<span class="c"># newfs -U md0a</span>
/dev/md0a: 5.0MB <span class="o">(</span>10224 sectors<span class="o">)</span> block size 16384, fragment size 2048
        using 4 cylinder groups of 1.25MB, 80 blks, 192 inodes.
super-block backups <span class="o">(</span><span class="k">for </span>fsck -b <span class="c">#) at:</span>
 160, 2720, 5280, 7840
<span class="c"># mount /dev/md0a /mnt</span>
<span class="c"># df /mnt</span>
Filesystem 1K-blocks Used Avail Capacity  Mounted on
/dev/md0a       4710    4  4330     0%    /mnt</code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes several commands to create a file- or memory-backed file system using <code>mdconfig</code>.
FreeBSD also comes with <code>mdmfs</code> which automatically configures a memory disk, formats it with the UFS file system, and mounts it.
For example, after creating <em>newimage</em> with <code>dd</code>, this one command is equivalent to running the <code>bsdlabel</code>, <code>newfs</code>, and <code>mount</code> commands shown above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdmfs -F newimage -s 5m md0 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To instead create a new memory-based memory disk with <code>mdmfs</code>, use this one command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdmfs -s 5m md1 /mnt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the unit number is not specified, <code>mdmfs</code> will automatically select an unused memory device.
For more details about <code>mdmfs</code>, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=mdmfs&amp;sektion=8&amp;format=html">mdmfs(8)</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="snapshots">20.11. File System Snapshots<a class="anchor" href="#snapshots"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD offers a feature in conjunction with <a href="../config/#soft-updates">Soft Updates</a>: file system snapshots.</p>
</div>
<div class="paragraph">
<p>UFS snapshots allow a user to create images of specified file systems, and treat them as a file.
Snapshot files must be created in the file system that the action is performed on, and a user may create no more than 20 snapshots per file system.
Active snapshots are recorded in the superblock so they are persistent across unmount and remount operations along with system reboots.
When a snapshot is no longer required, it can be removed using <a href="https://man.freebsd.org/cgi/man.cgi?query=rm&amp;sektion=1&amp;format=html">rm(1)</a>.
While snapshots may be removed in any order, all the used space may not be acquired because another snapshot will possibly claim some of the released blocks.</p>
</div>
<div class="paragraph">
<p>The un-alterable <code>snapshot</code> file flag is set by <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> after initial creation of a snapshot file.
<a href="https://man.freebsd.org/cgi/man.cgi?query=unlink&amp;sektion=1&amp;format=html">unlink(1)</a> makes an exception for snapshot files since it allows them to be removed.</p>
</div>
<div class="paragraph">
<p>Snapshots are created using <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a>.
To place a snapshot of <span class="filename">/var</span> in the file <span class="filename">/var/snapshot/snap</span>, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mount -u -o snapshot /var/snapshot/snap /var</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use <a href="https://man.freebsd.org/cgi/man.cgi?query=mksnap_ffs&amp;sektion=8&amp;format=html">mksnap_ffs(8)</a> to create the snapshot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mksnap_ffs /var /var/snapshot/snap</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One can find snapshot files on a file system, such as <span class="filename">/var</span>, using <a href="https://man.freebsd.org/cgi/man.cgi?query=find&amp;sektion=1&amp;format=html">find(1)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># find /var -flags snapshot</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once a snapshot has been created, it has several uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some administrators will use a snapshot file for backup purposes, because the snapshot can be transferred to CDs or tape.</p>
</li>
<li>
<p>The file system integrity checker, <a href="https://man.freebsd.org/cgi/man.cgi?query=fsck&amp;sektion=8&amp;format=html">fsck(8)</a>, may be run on the snapshot. Assuming that the file system was clean when it was mounted, this should always provide a clean and unchanging result.</p>
</li>
<li>
<p>Running <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> on the snapshot will produce a dump file that is consistent with the file system and the timestamp of the snapshot. <a href="https://man.freebsd.org/cgi/man.cgi?query=dump&amp;sektion=8&amp;format=html">dump(8)</a> can also take a snapshot, create a dump image, and then remove the snapshot in one command by using <code>-L</code>.</p>
</li>
<li>
<p>The snapshot can be mounted as a frozen image of the file system. To <a href="https://man.freebsd.org/cgi/man.cgi?query=mount&amp;sektion=8&amp;format=html">mount(8)</a> the snapshot <span class="filename">/var/snapshot/snap</span> run:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mdconfig -a -t vnode -o readonly -f /var/snapshot/snap -u 4</span>
<span class="c"># mount -r /dev/md4 /mnt</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The frozen <span class="filename">/var</span> is now available through <span class="filename">/mnt</span>.
Everything will initially be in the same state it was during the snapshot creation time.
The only exception is that any earlier snapshots will appear as zero length files.
To unmount the snapshot, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># umount /mnt</span>
<span class="c"># mdconfig -d -u 4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about <code>softupdates</code> and file system snapshots, including technical papers, visit Marshall Kirk McKusick’s website at <a href="http://www.mckusick.com/">http://www.mckusick.com/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quotas">20.12. Disk Quotas<a class="anchor" href="#quotas"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disk quotas can be used to limit the amount of disk space or the number of files a user or members of a group may allocate on a per-file system basis.
This prevents one user or group of users from consuming all of the available disk space.</p>
</div>
<div class="paragraph">
<p>This section describes how to configure disk quotas for the UFS file system.
To configure quotas on the ZFS file system, refer to <a href="../zfs/#zfs-zfs-quota">Dataset, User, and Group Quotas</a></p>
</div>
<div class="sect2">
<h3 id="_enabling_disk_quotas">20.12.1. Enabling Disk Quotas<a class="anchor" href="#_enabling_disk_quotas"></a></h3>
<div class="paragraph">
<p>To determine if the FreeBSD kernel provides support for disk quotas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>sysctl kern.features.ufs_quota
kern.features.ufs_quota: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>1</code> indicates quota support.
If the value is instead <code>0</code>, add the following line to a custom kernel configuration file and rebuild the kernel using the instructions in <a href="../kernelconfig/#kernelconfig">Configuring the FreeBSD Kernel</a>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options QUOTA</pre>
</div>
</div>
<div class="paragraph">
<p>Next, enable disk quotas in <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>quota_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Normally on bootup, the quota integrity of each file system is checked by <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a>.
This program insures that the data in the quota database properly reflects the data on the file system.
This is a time consuming process that will significantly affect the time the system takes to boot.
To skip this step, add this variable to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>check_quotas=&#34;NO&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, edit <span class="filename">/etc/fstab</span> to enable disk quotas on a per-file system basis.
To enable per-user quotas on a file system, add <code>userquota</code> to the options field in the <span class="filename">/etc/fstab</span> entry for the file system to enable quotas on.
For example:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/dev/da1s2g   /home    ufs rw,userquota 1 2</pre>
</div>
</div>
<div class="paragraph">
<p>To enable group quotas, use <code>groupquota</code> instead.
To enable both user and group quotas, separate the options with a comma:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/dev/da1s2g    /home    ufs rw,userquota,groupquota 1 2</pre>
</div>
</div>
<div class="paragraph">
<p>By default, quota files are stored in the root directory of the file system as <span class="filename">quota.user</span> and <span class="filename">quota.group</span>.
Refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=fstab&amp;sektion=5&amp;format=html">fstab(5)</a> for more information.
Specifying an alternate location for the quota files is not recommended.</p>
</div>
<div class="paragraph">
<p>Once the configuration is complete, reboot the system and <span class="filename">/etc/rc</span> will automatically run the appropriate commands to create the initial quota files for all of the quotas enabled in <span class="filename">/etc/fstab</span>.</p>
</div>
<div class="paragraph">
<p>In the normal course of operations, there should be no need to manually run <a href="https://man.freebsd.org/cgi/man.cgi?query=quotacheck&amp;sektion=8&amp;format=html">quotacheck(8)</a>, <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaon&amp;sektion=8&amp;format=html">quotaon(8)</a>, or <a href="https://man.freebsd.org/cgi/man.cgi?query=quotaoff&amp;sektion=8&amp;format=html">quotaoff(8)</a>.
However, one should read these manual pages to be familiar with their operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_quota_limits">20.12.2. Setting Quota Limits<a class="anchor" href="#_setting_quota_limits"></a></h3>
<div class="paragraph">
<p>To verify that quotas are enabled, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># quota -v</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be a one line summary of disk usage and current quota limits for each file system that quotas are enabled on.</p>
</div>
<div class="paragraph">
<p>The system is now ready to be assigned quota limits with <code>edquota</code>.</p>
</div>
<div class="paragraph">
<p>Several options are available to enforce limits on the amount of disk space a user or group may allocate, and how many files they may create.
Allocations can be limited based on disk space (block quotas), number of files (inode quotas), or a combination of both.
Each limit is further broken down into two categories: hard and soft limits.</p>
</div>
<div class="paragraph">
<p>A hard limit may not be exceeded.
Once a user reaches a hard limit, no further allocations can be made on that file system by that user.
For example, if the user has a hard limit of 500 kbytes on a file system and is currently using 490 kbytes, the user can only allocate an additional 10 kbytes.
Attempting to allocate an additional 11 kbytes will fail.</p>
</div>
<div class="paragraph">
<p>Soft limits can be exceeded for a limited amount of time, known as the grace period, which is one week by default.
If a user stays over their limit longer than the grace period, the soft limit turns into a hard limit and no further allocations are allowed.
When the user drops back below the soft limit, the grace period is reset.</p>
</div>
<div class="paragraph">
<p>In the following example, the quota for the <code>test</code> account is being edited.
When <code>edquota</code> is invoked, the editor specified by <code>EDITOR</code> is opened in order to edit the quota limits.
The default editor is set to vi.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># edquota -u test</span>
Quotas <span class="k">for </span>user <span class="nb">test</span>:
/usr: kbytes <span class="k">in </span>use: 65, limits <span class="o">(</span>soft <span class="o">=</span> 50, hard <span class="o">=</span> 75<span class="o">)</span>
        inodes <span class="k">in </span>use: 7, limits <span class="o">(</span>soft <span class="o">=</span> 50, hard <span class="o">=</span> 60<span class="o">)</span>
/usr/var: kbytes <span class="k">in </span>use: 0, limits <span class="o">(</span>soft <span class="o">=</span> 50, hard <span class="o">=</span> 75<span class="o">)</span>
        inodes <span class="k">in </span>use: 0, limits <span class="o">(</span>soft <span class="o">=</span> 50, hard <span class="o">=</span> 60<span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are normally two lines for each file system that has quotas enabled.
One line represents the block limits and the other represents the inode limits.
Change the value to modify the quota limit.
For example, to raise the block limit on <span class="filename">/usr</span> to a soft limit of <code>500</code> and a hard limit of <code>600</code>, change the values in that line as follows:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>/usr: kbytes in use: 65, limits (soft = 500, hard = 600)</pre>
</div>
</div>
<div class="paragraph">
<p>The new quota limits take effect upon exiting the editor.</p>
</div>
<div class="paragraph">
<p>Sometimes it is desirable to set quota limits on a range of users.
This can be done by first assigning the desired quota limit to a user.
Then, use <code>-p</code> to duplicate that quota to a specified range of user IDs (UIDs).
The following command will duplicate those quota limits for UIDs <code>10,000</code> through <code>19,999</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># edquota -p test 10000-19999</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=edquota&amp;sektion=8&amp;format=html">edquota(8)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_checking_quota_limits_and_disk_usage">20.12.3. Checking Quota Limits and Disk Usage<a class="anchor" href="#_checking_quota_limits_and_disk_usage"></a></h3>
<div class="paragraph">
<p>To check individual user or group quotas and disk usage, use <a href="https://man.freebsd.org/cgi/man.cgi?query=quota&amp;sektion=1&amp;format=html">quota(1)</a>.
A user may only examine their own quota and the quota of a group they are a member of.
Only the superuser may view all user and group quotas.
To get a summary of all quotas and disk usage for file systems with quotas enabled, use <a href="https://man.freebsd.org/cgi/man.cgi?query=repquota&amp;sektion=8&amp;format=html">repquota(8)</a>.</p>
</div>
<div class="paragraph">
<p>Normally, file systems that the user is not using any disk space on will not show in the output of <code>quota</code>, even if the user has a quota limit assigned for that file system.
Use <code>-v</code> to display those file systems.
The following is sample output from <code>quota -v</code> for a user that has quota limits on two file systems.</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>Disk quotas for user test (uid 1002):
     Filesystem  usage    quota   limit   grace   files   quota   limit   grace
           /usr      65*     50      75   5days       7      50      60
       /usr/var       0      50      75               0      50      60</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the user is currently 15 kbytes over the soft limit of 50 kbytes on <span class="filename">/usr</span> and has 5 days of grace period left.
The asterisk <code>*</code> indicates that the user is currently over the quota limit.</p>
</div>
</div>
<div class="sect2">
<h3 id="_quotas_over_nfs">20.12.4. Quotas over NFS<a class="anchor" href="#_quotas_over_nfs"></a></h3>
<div class="paragraph">
<p>Quotas are enforced by the quota subsystem on the NFS server.
The <a href="https://man.freebsd.org/cgi/man.cgi?query=rpc.rquotad&amp;sektion=8&amp;format=html">rpc.rquotad(8)</a> daemon makes quota information available to <code>quota</code> on NFS clients, allowing users on those machines to see their quota statistics.</p>
</div>
<div class="paragraph">
<p>On the NFS server, enable <code>rpc.rquotad</code> by removing the <code>#</code> from this line in <strong class="filename">/etc/inetd.conf</strong>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>rquotad/1      dgram rpc/udp wait root /usr/libexec/rpc.rquotad rpc.rquotad</pre>
</div>
</div>
<div class="paragraph">
<p>Then, restart <code>inetd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service inetd restart</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disks-encrypting">20.13. Encrypting Disk Partitions<a class="anchor" href="#disks-encrypting"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>FreeBSD offers excellent online protections against unauthorized data access.
File permissions and <a href="../mac/#mac">Mandatory Access Control</a> (MAC) help prevent unauthorized users from accessing data while the operating system is active and the computer is powered up.
However, the permissions enforced by the operating system are irrelevant if an attacker has physical access to a computer and can move the computer’s hard drive to another system to copy and analyze the data.</p>
</div>
<div class="paragraph">
<p>Regardless of how an attacker may have come into possession of a hard drive or powered-down computer, the GEOM-based cryptographic subsystems built into FreeBSD are able to protect the data on the computer’s file systems against even highly-motivated attackers with significant resources.
Unlike encryption methods that encrypt individual files, the built-in <code>gbde</code> and <code>geli</code> utilities can be used to transparently encrypt entire file systems.
No cleartext ever touches the hard drive’s platter.</p>
</div>
<div class="paragraph">
<p>This chapter demonstrates how to create an encrypted file system on FreeBSD.
It first demonstrates the process using <code>gbde</code> and then demonstrates the same example using <code>geli</code>.</p>
</div>
<div class="sect2">
<h3 id="_disk_encryption_with_gbde">20.13.1. Disk Encryption with gbde<a class="anchor" href="#_disk_encryption_with_gbde"></a></h3>
<div class="paragraph">
<p>The objective of the <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a> facility is to provide a formidable challenge for an attacker to gain access to the contents of a <em>cold</em> storage device.
However, if the computer is compromised while up and running and the storage device is actively attached, or the attacker has access to a valid passphrase, it offers no protection to the contents of the storage device.
Thus, it is important to provide physical security while the system is running and to protect the passphrase used by the encryption mechanism.</p>
</div>
<div class="paragraph">
<p>This facility provides several barriers to protect the data stored in each disk sector.
It encrypts the contents of a disk sector using 128-bit AES in CBC mode.
Each sector on the disk is encrypted with a different AES key.
For more information on the cryptographic design, including how the sector keys are derived from the user-supplied passphrase, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=4&amp;format=html">gbde(4)</a>.</p>
</div>
<div class="paragraph">
<p>FreeBSD provides a kernel module for gbde which can be loaded with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload geom_bde</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If using a custom kernel configuration file, ensure it contains this line:</p>
</div>
<div class="paragraph">
<p><code>options GEOM_BDE</code></p>
</div>
<div class="paragraph">
<p>The following example demonstrates adding a new hard drive to a system that will hold a single encrypted partition that will be mounted as <span class="filename">/private</span>.</p>
</div>
<div class="olist arabic procedure">
<div class="title">Procedure: Encrypting a Partition with gbde</div>
<ol class="arabic">
<li>
<p>Add the New Hard Drive</p>
<div class="paragraph">
<p>Install the new drive to the system as explained in <a href="#disks-adding">Adding Disks</a>.
For the purposes of this example, a new hard drive partition has been added as <span class="filename">/dev/ad4s1c</span> and <span class="filename">/dev/ad0s1*</span> represents the existing standard FreeBSD partitions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Directory to Hold <code>gbde</code> Lock Files</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /etc/gbde</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The gbde lock file contains information that gbde requires to access encrypted partitions.
Without access to the lock file, gbde will not be able to decrypt the data contained in the encrypted partition without significant manual intervention which is not supported by the software.
Each encrypted partition uses a separate lock file.</p>
</div>
</li>
<li>
<p>Initialize the <code>gbde</code> Partition</p>
<div class="paragraph">
<p>A gbde partition must be initialized before it can be used.
This initialization needs to be performed only once.
This command will open the default editor, in order to set various configuration options in a template.
For use with the UFS file system, set the sector_size to 2048:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gbde init /dev/ad4s1c -i -L /etc/gbde/ad4s1c.lock</span>
<span class="c"># $FreeBSD: src/sbin/gbde/template.txt,v 1.1.36.1 2009/08/03 08:13:06 kensmith Exp $</span>
<span class="c">#</span>
<span class="c"># Sector size is the smallest unit of data which can be read or written.</span>
<span class="c"># Making it too small decreases performance and decreases available space.</span>
<span class="c"># Making it too large may prevent filesystems from working.  512 is the</span>
<span class="c"># minimum and always safe.  For UFS, use the fragment size</span>
<span class="c">#</span>
sector_size	<span class="o">=</span>	2048
<span class="o">[</span>...]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the edit is saved, the user will be asked twice to type the passphrase used to secure the data.
The passphrase must be the same both times.
The ability of gbde to protect data depends entirely on the quality of the passphrase.
For tips on how to select a secure passphrase that is easy to remember, see <a href="http://world.std.com/~reinhold/diceware.html">http://world.std.com/~reinhold/diceware.htm</a>.</p>
</div>
<div class="paragraph">
<p>This initialization creates a lock file for the gbde partition.
In this example, it is stored as <span class="filename">/etc/gbde/ad4s1c.lock</span>.
Lock files must end in &#34;.lock&#34; in order to be correctly detected by the <span class="filename">/etc/rc.d/gbde</span> start up script.</p>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Lock files <em>must</em> be backed up together with the contents of any encrypted partitions.
Without the lock file, the legitimate owner will be unable to access the data on the encrypted partition.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Attach the Encrypted Partition to the Kernel</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gbde attach /dev/ad4s1c -l /etc/gbde/ad4s1c.lock</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will prompt to input the passphrase that was selected during the initialization of the encrypted partition.
The new encrypted device will appear in <span class="filename">/dev</span> as <span class="filename">/dev/device_name.bde</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ls /dev/ad*</span>
/dev/ad0        /dev/ad0s1b     /dev/ad0s1e     /dev/ad4s1
/dev/ad0s1      /dev/ad0s1c     /dev/ad0s1f     /dev/ad4s1c
/dev/ad0s1a     /dev/ad0s1d     /dev/ad4        /dev/ad4s1c.bde</code></pre>
</div>
</div>
</li>
<li>
<p>Create a File System on the Encrypted Device</p>
<div class="paragraph">
<p>Once the encrypted device has been attached to the kernel, a file system can be created on the device.
This example creates a UFS file system with soft updates enabled.
Be sure to specify the partition which has a <span class="filename">*.bde</span> extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># newfs -U /dev/ad4s1c.bde</span></code></pre>
</div>
</div>
</li>
<li>
<p>Mount the Encrypted Partition</p>
<div class="paragraph">
<p>Create a mount point and mount the encrypted file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># mkdir /private</span>
<span class="c"># mount /dev/ad4s1c.bde /private</span></code></pre>
</div>
</div>
</li>
<li>
<p>Verify That the Encrypted File System is Available</p>
<div class="paragraph">
<p>The encrypted file system should now be visible and available for use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>df -H
Filesystem        Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a      1037M    72M   883M     8%    /
/devfs            1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f       8.1G    55K   7.5G     0%    /home
/dev/ad0s1e      1037M   1.1M   953M     0%    /tmp
/dev/ad0s1d       6.1G   1.9G   3.7G    35%    /usr
/dev/ad4s1c.bde   150G   4.1K   138G     0%    /private</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After each boot, any encrypted file systems must be manually re-attached to the kernel, checked for errors, and mounted, before the file systems can be used.
To configure these steps, add the following lines to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>gbde_autoattach_all=&#34;YES&#34;
gbde_devices=&#34;ad4s1c&#34;
gbde_lockdir=&#34;/etc/gbde&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>This requires that the passphrase be entered at the console at boot time.
After typing the correct passphrase, the encrypted partition will be mounted automatically.
Additional gbde boot options are available and listed in <a href="https://man.freebsd.org/cgi/man.cgi?query=rc.conf&amp;sektion=5&amp;format=html">rc.conf(5)</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>sysinstall is incompatible with gbde-encrypted devices.
All <span class="filename">*.bde</span> devices must be detached from the kernel before starting sysinstall or it will crash during its initial probing for devices.
To detach the encrypted device used in the example, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># gbde detach /dev/ad4s1c</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="disks-encrypting-geli">20.13.2. Disk Encryption with <code>geli</code><a class="anchor" href="#disks-encrypting-geli"></a></h3>
<div class="paragraph">
<p>An alternative cryptographic GEOM class is available using <code>geli</code>.
This control utility adds some features and uses a different scheme for doing cryptographic work.
It provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizes the <a href="https://man.freebsd.org/cgi/man.cgi?query=crypto&amp;sektion=9&amp;format=html">crypto(9)</a> framework and automatically uses cryptographic hardware when it is available.</p>
</li>
<li>
<p>Supports multiple cryptographic algorithms such as AES, Blowfish, and 3DES.</p>
</li>
<li>
<p>Allows the root partition to be encrypted. The passphrase used to access the encrypted root partition will be requested during system boot.</p>
</li>
<li>
<p>Allows the use of two independent keys.</p>
</li>
<li>
<p>It is fast as it performs simple sector-to-sector encryption.</p>
</li>
<li>
<p>Allows backup and restore of master keys. If a user destroys their keys, it is still possible to get access to the data by restoring keys from the backup.</p>
</li>
<li>
<p>Allows a disk to attach with a random, one-time key which is useful for swap partitions and temporary file systems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More features and usage examples can be found in <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>.</p>
</div>
<div class="paragraph">
<p>The following example describes how to generate a key file which will be used as part of the master key for the encrypted provider mounted under <span class="filename">/private</span>.
The key file will provide some random data used to encrypt the master key.
The master key will also be protected by a passphrase.
The provider’s sector size will be 4kB.
The example describes how to attach to the <code>geli</code> provider, create a file system on it, mount it, work with it, and finally, how to detach it.</p>
</div>
<div class="olist arabic procedure">
<div class="title">Procedure: Encrypting a Partition with <code>geli</code></div>
<ol class="arabic">
<li>
<p>Load <code>geli</code> Support</p>
<div class="paragraph">
<p>Support for <code>geli</code> is available as a loadable kernel module. To configure the system to automatically load the module at boot time, add the following line to <span class="filename">/boot/loader.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>geom_eli_load=&#34;YES&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>To load the kernel module now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># kldload geom_eli</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a custom kernel, ensure the kernel configuration file contains these lines:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options GEOM_ELI
device crypto</pre>
</div>
</div>
</li>
<li>
<p>Generate the Master Key</p>
<div class="paragraph">
<p>The following commands generate a master key that all data will be encrypted with.
This key can never be changed.
Rather than using it directly, it is encrypted with one or more user keys.
The user keys are made up of an optional combination of random bytes from a file, <span class="filename">/root/da2.key</span>, and/or a passphrase.
In this case, the data source for the key file is <span class="filename">/dev/random</span>.
This command also configures the sector size of the provider (<span class="filename">/dev/da2.eli</span>) as 4kB, for better performance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/random of=/root/da2.key bs=64 count=1</span>
<span class="c"># geli init -K /root/da2.key -s 4096 /dev/da2</span>
Enter new passphrase:
Reenter new passphrase:</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is not mandatory to use both a passphrase and a key file as either method of securing the master key can be used in isolation.</p>
</div>
<div class="paragraph">
<p>If the key file is given as &#34;-&#34;, standard input will be used.
For example, this command generates three key files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># cat keyfile1 keyfile2 keyfile3 | geli init -K - /dev/da2</span></code></pre>
</div>
</div>
</li>
<li>
<p>Attach the Provider with the Generated Key</p>
<div class="paragraph">
<p>To attach the provider, specify the key file, the name of the disk, and the passphrase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># geli attach -k /root/da2.key /dev/da2</span>
Enter passphrase:</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new device with an <span class="filename">.eli</span> extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># ls /dev/da2*</span>
/dev/da2  /dev/da2.eli</code></pre>
</div>
</div>
</li>
<li>
<p>Create the New File System</p>
<div class="paragraph">
<p>Next, format the device with the UFS file system and mount it on an existing mount point:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/random of=/dev/da2.eli bs=1m</span>
<span class="c"># newfs /dev/da2.eli</span>
<span class="c"># mount /dev/da2.eli /private</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The encrypted file system should now be available for use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># df -H</span>
Filesystem     Size   Used  Avail Capacity  Mounted on
/dev/ad0s1a    248M    89M   139M    38%    /
/devfs         1.0K   1.0K     0B   100%    /dev
/dev/ad0s1f    7.7G   2.3G   4.9G    32%    /usr
/dev/ad0s1d    989M   1.5M   909M     0%    /tmp
/dev/ad0s1e    3.9G   1.3G   2.3G    35%    /var
/dev/da2.eli   150G   4.1K   138G     0%    /private</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once the work on the encrypted partition is done, and the <span class="filename">/private</span> partition is no longer needed, it is prudent to put the device into cold storage by unmounting and detaching the <code>geli</code> encrypted partition from the kernel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># umount /private</span>
<span class="c"># geli detach da2.eli</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An <span class="filename">rc.d</span> script is provided to simplify the mounting of <code>geli</code>-encrypted devices at boot time. For this example, add these lines to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>geli_devices=&#34;da2&#34;
geli_da2_flags=&#34;-k /root/da2.key&#34;</pre>
</div>
</div>
<div class="paragraph">
<p>This configures <span class="filename">/dev/da2</span> as a <code>geli</code> provider with a master key of <span class="filename">/root/da2.key</span>.
The system will automatically detach the provider from the kernel before the system shuts down.
During the startup process, the script will prompt for the passphrase before attaching the provider.
Other kernel messages might be shown before and after the password prompt.
If the boot process seems to stall, look carefully for the password prompt among the other messages.
Once the correct passphrase is entered, the provider is attached.
The file system is then mounted, typically by an entry in <span class="filename">/etc/fstab</span>.
Refer to <a href="../basics/#mount-unmount">“Mounting and Unmounting File Systems”</a> for instructions on how to configure a file system to mount at boot time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="swap-encrypting">20.14. Encrypting Swap<a class="anchor" href="#swap-encrypting"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like the encryption of disk partitions, encryption of swap space is used to protect sensitive information.
Consider an application that deals with passwords.
As long as these passwords stay in physical memory, they are not written to disk and will be cleared after a reboot.
However, if FreeBSD starts swapping out memory pages to free space, the passwords may be written to the disk unencrypted.
Encrypting swap space can be a solution for this scenario.</p>
</div>
<div class="paragraph">
<p>This section demonstrates how to configure an encrypted swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> or <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> encryption.
It assumes that <span class="filename">/dev/ada0s1b</span> is the swap partition.</p>
</div>
<div class="sect2">
<h3 id="_configuring_encrypted_swap">20.14.1. Configuring Encrypted Swap<a class="anchor" href="#_configuring_encrypted_swap"></a></h3>
<div class="paragraph">
<p>Swap partitions are not encrypted by default and should be cleared of any sensitive data before continuing.
To overwrite the current swap partition with random garbage, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># dd if=/dev/random of=/dev/ada0s1b bs=1m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a>, add the <code>.bde</code> suffix to the swap line in <span class="filename">/etc/fstab</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.bde	none		swap	sw		0	0</pre>
</div>
</div>
<div class="paragraph">
<p>To instead encrypt the swap partition using <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a>, use the <code>.eli</code> suffix:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Device		Mountpoint	FStype	Options		Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw		0	0</pre>
</div>
</div>
<div class="paragraph">
<p>By default, <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> uses the AES algorithm with a key length of 128 bits.
Normally the default settings will suffice.
If desired, these defaults can be altered in the options field in <span class="filename">/etc/fstab</span>. The possible flags are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">aalgo</dt>
<dd>
<p>Data integrity verification algorithm used to ensure that the encrypted data has not been tampered with.
See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p>
</dd>
<dt class="hdlist1">ealgo</dt>
<dd>
<p>Encryption algorithm used to protect the data.
See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for a list of supported algorithms.</p>
</dd>
<dt class="hdlist1">keylen</dt>
<dd>
<p>The length of the key used for the encryption algorithm.
See <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> for the key lengths that are supported by each encryption algorithm.</p>
</dd>
<dt class="hdlist1">sectorsize</dt>
<dd>
<p>The size of the blocks data is broken into before it is encrypted.
Larger sector sizes increase performance at the cost of higher storage overhead.
The recommended size is 4096 bytes.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This example configures an encrypted swap partition using the Blowfish algorithm with a key length of 128 bits and a sectorsize of 4 kilobytes:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre># Device		Mountpoint	FStype	Options				Dump	Pass#
/dev/ada0s1b.eli	none		swap	sw,ealgo=blowfish,keylen=128,sectorsize=4096	0	0</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encrypted_swap_verification">20.14.2. Encrypted Swap Verification<a class="anchor" href="#_encrypted_swap_verification"></a></h3>
<div class="paragraph">
<p>Once the system has rebooted, proper operation of the encrypted swap can be verified using <code>swapinfo</code>.</p>
</div>
<div class="paragraph">
<p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=gbde&amp;sektion=8&amp;format=html">gbde(8)</a> is being used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.bde   542720        0   542720     0</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <a href="https://man.freebsd.org/cgi/man.cgi?query=geli&amp;sektion=8&amp;format=html">geli(8)</a> is being used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="gp">% </span>swapinfo
Device          1K-blocks     Used    Avail Capacity
/dev/ada0s1b.eli   542720        0   542720     0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="disks-hast">20.15. Highly Available Storage (HAST)<a class="anchor" href="#disks-hast"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>High availability is one of the main requirements in serious business applications and highly-available storage is a key component in such environments.
In FreeBSD, the Highly Available STorage (HAST) framework allows transparent storage of the same data across several physically separated machines connected by a TCP/IP network.
HAST can be understood as a network-based RAID1 (mirror), and is similar to the DRBD® storage system used in the GNU/Linux® platform.
In combination with other high-availability features of FreeBSD like CARP, HAST makes it possible to build a highly-available storage cluster that is resistant to hardware failures.</p>
</div>
<div class="paragraph">
<p>The following are the main features of HAST:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Can be used to mask I/O errors on local hard drives.</p>
</li>
<li>
<p>File system agnostic as it works with any file system supported by FreeBSD.</p>
</li>
<li>
<p>Efficient and quick resynchronization as only the blocks that were modified during the downtime of a node are synchronized.</p>
</li>
<li>
<p>Can be used in an already deployed environment to add additional redundancy.</p>
</li>
<li>
<p>Together with CARP, Heartbeat, or other tools, it can be used to build a robust and durable storage system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After reading this section, you will know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What HAST is, how it works, and which features it provides.</p>
</li>
<li>
<p>How to set up and use HAST on FreeBSD.</p>
</li>
<li>
<p>How to integrate CARP and <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> to build a robust storage system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before reading this section, you should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Understand UNIX® and FreeBSD basics (<a href="../basics/#basics">FreeBSD Basics</a>).</p>
</li>
<li>
<p>Know how to configure network interfaces and other core FreeBSD subsystems (<a href="../config/#config-tuning">Configuration and Tuning</a>).</p>
</li>
<li>
<p>Have a good understanding of FreeBSD networking (<a href="../partiv/#network-communication">Network Communication</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The HAST project was sponsored by The FreeBSD Foundation with support from <a href="http://www.omc.net/">http://www.omc.net/</a> and <a href="http://www.transip.nl/">http://www.transip.nl/</a>.</p>
</div>
<div class="sect2">
<h3 id="_hast_operation">20.15.1. HAST Operation<a class="anchor" href="#_hast_operation"></a></h3>
<div class="paragraph">
<p>HAST provides synchronous block-level replication between two physical machines: the <em>primary</em> node and the <em>secondary</em> node.
These two machines together are referred to as a cluster.</p>
</div>
<div class="paragraph">
<p>Since HAST works in a primary-secondary configuration, it allows only one of the cluster nodes to be active at any given time.
The primary node, also called <em>active</em>, is the one which will handle all the I/O requests to HAST-managed devices.
The secondary node is automatically synchronized from the primary node.</p>
</div>
<div class="paragraph">
<p>The physical components of the HAST system are the local disk on primary node, and the disk on the remote, secondary node.</p>
</div>
<div class="paragraph">
<p>HAST operates synchronously on a block level, making it transparent to file systems and applications.
HAST provides regular GEOM providers in <span class="filename">/dev/hast/</span> for use by other tools or applications.
There is no difference between using HAST-provided devices and raw disks or partitions.</p>
</div>
<div class="paragraph">
<p>Each write, delete, or flush operation is sent to both the local disk and to the remote disk over TCP/IP.
Each read operation is served from the local disk, unless the local disk is not up-to-date or an I/O error occurs.
In such cases, the read operation is sent to the secondary node.</p>
</div>
<div class="paragraph">
<p>HAST tries to provide fast failure recovery.
For this reason, it is important to reduce synchronization time after a node’s outage.
To provide fast synchronization, HAST manages an on-disk bitmap of dirty extents and only synchronizes those during a regular synchronization, with an exception of the initial sync.</p>
</div>
<div class="paragraph">
<p>There are many ways to handle synchronization.
HAST implements several replication modes to handle different synchronization methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>memsync</em>: This mode reports a write operation as completed when the local write operation is finished and when the remote node acknowledges data arrival, but before actually storing the data. The data on the remote node will be stored directly after sending the acknowledgement. This mode is intended to reduce latency, but still provides good reliability. This mode is the default.</p>
</li>
<li>
<p><em>fullsync</em>: This mode reports a write operation as completed when both the local write and the remote write complete. This is the safest and the slowest replication mode.</p>
</li>
<li>
<p><em>async</em>: This mode reports a write operation as completed when the local write completes. This is the fastest and the most dangerous replication mode. It should only be used when replicating to a distant node where latency is too high for other modes.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_hast_configuration">20.15.2. HAST Configuration<a class="anchor" href="#_hast_configuration"></a></h3>
<div class="paragraph">
<p>The HAST framework consists of several components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> daemon which provides data synchronization. When this daemon is started, it will automatically load <code>geom_gate.ko</code>.</p>
</li>
<li>
<p>The userland management utility, <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>.</p>
</li>
<li>
<p>The <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a> configuration file. This file must exist before starting hastd.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users who prefer to statically build <code>GEOM_GATE</code> support into the kernel should add this line to the custom kernel configuration file, then rebuild the kernel using the instructions in <a href="../kernelconfig/#kernelconfig">Configuring the FreeBSD Kernel</a>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>options	GEOM_GATE</pre>
</div>
</div>
<div class="paragraph">
<p>The following example describes how to configure two nodes in primary-secondary operation using HAST to replicate the data between the two.
The nodes will be called <code>hasta</code>, with an IP address of <code>172.16.0.1</code>, and <code>hastb</code>, with an IP address of <code>172.16.0.2</code>.
Both nodes will have a dedicated hard drive <span class="filename">/dev/ad6</span> of the same size for HAST operation.
The HAST pool, sometimes referred to as a resource or the GEOM provider in <span class="filename">/dev/hast/</span>, will be called <code>test</code>.</p>
</div>
<div class="paragraph">
<p>Configuration of HAST is done using <span class="filename">/etc/hast.conf</span>.
This file should be identical on both nodes.
The simplest configuration is:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>resource test {
	on hasta {
		local /dev/ad6
		remote 172.16.0.2
	}
	on hastb {
		local /dev/ad6
		remote 172.16.0.1
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>For more advanced configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=hast.conf&amp;sektion=5&amp;format=html">hast.conf(5)</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to use host names in the <code>remote</code> statements if the hosts are resolvable and defined either in <span class="filename">/etc/hosts</span> or in the local DNS.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once the configuration exists on both nodes, the HAST pool can be created.
Run these commands on both nodes to place the initial metadata onto the local disk and to start <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># hastctl create test</span>
<span class="c"># service hastd onestart</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is <em>not</em> possible to use GEOM providers with an existing file system or to convert an existing storage to a HAST-managed pool.
This procedure needs to store some metadata on the provider and there will not be enough required space available on an existing provider.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A HAST node’s <code>primary</code> or <code>secondary</code> role is selected by an administrator, or software like Heartbeat, using <a href="https://man.freebsd.org/cgi/man.cgi?query=hastctl&amp;sektion=8&amp;format=html">hastctl(8)</a>.
On the primary node, <code>hasta</code>, issue this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># hastctl role primary test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run this command on the secondary node, <code>hastb</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># hastctl role secondary test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the result by running <code>hastctl</code> on each node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># hastctl status test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the <code>status</code> line in the output.
If it says <code>degraded</code>, something is wrong with the configuration file.
It should say <code>complete</code> on each node, meaning that the synchronization between the nodes has started.
The synchronization completes when <code>hastctl status</code> reports 0 bytes of <code>dirty</code> extents.</p>
</div>
<div class="paragraph">
<p>The next step is to create a file system on the GEOM provider and mount it.
This must be done on the <code>primary</code> node.
Creating the file system can take a few minutes, depending on the size of the hard drive.
This example creates a UFS file system on <span class="filename">/dev/hast/test</span>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># newfs -U /dev/hast/test</span>
<span class="c"># mkdir /hast/test</span>
<span class="c"># mount /dev/hast/test /hast/test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the HAST framework is configured properly, the final step is to make sure that HAST is started automatically during system boot.
Add this line to <span class="filename">/etc/rc.conf</span>:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>hastd_enable=&#34;YES&#34;</pre>
</div>
</div>
<div class="sect3">
<h4 id="_failover_configuration">20.15.2.1. Failover Configuration<a class="anchor" href="#_failover_configuration"></a></h4>
<div class="paragraph">
<p>The goal of this example is to build a robust storage system which is resistant to the failure of any given node.
If the primary node fails, the secondary node is there to take over seamlessly, check and mount the file system, and continue to work without missing a single bit of data.</p>
</div>
<div class="paragraph">
<p>To accomplish this task, the Common Address Redundancy Protocol (CARP) is used to provide for automatic failover at the IP layer.
CARP allows multiple hosts on the same network segment to share an IP address.
Set up CARP on both nodes of the cluster according to the documentation available in <a href="../advanced-networking/#carp">“Common Address Redundancy Protocol (CARP)”</a>.
In this example, each node will have its own management IP address and a shared IP address of <em>172.16.0.254</em>.
The primary HAST node of the cluster must be the primary CARP node.</p>
</div>
<div class="paragraph">
<p>The HAST pool created in the previous section is now ready to be exported to the other hosts on the network.
This can be accomplished by exporting it through NFS or Samba, using the shared IP address <em>172.16.0.254</em>.
The only problem which remains unresolved is an automatic failover should the primary node fail.</p>
</div>
<div class="paragraph">
<p>In the event of CARP interfaces going up or down, the FreeBSD operating system generates a <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> event, making it possible to watch for state changes on the CARP interfaces.
A state change on the CARP interface is an indication that one of the nodes failed or came back online.
These state change events make it possible to run a script which will automatically handle the HAST failover.</p>
</div>
<div class="paragraph">
<p>To catch state changes on the CARP interfaces, add this configuration to <span class="filename">/etc/devd.conf</span> on each node:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_UP&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch primary&#34;;
};

notify 30 {
	match &#34;system&#34; &#34;IFNET&#34;;
	match &#34;subsystem&#34; &#34;carp0&#34;;
	match &#34;type&#34; &#34;LINK_DOWN&#34;;
	action &#34;/usr/local/sbin/carp-hast-switch secondary&#34;;
};</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the systems are running FreeBSD 10 or higher, replace <span class="filename">carp0</span> with the name of the CARP-configured interface.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Restart <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> on both nodes to put the new configuration into effect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># service devd restart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the specified interface state changes by going up or down , the system generates a notification, allowing the <a href="https://man.freebsd.org/cgi/man.cgi?query=devd&amp;sektion=8&amp;format=html">devd(8)</a> subsystem to run the specified automatic failover script, <span class="filename">/usr/local/sbin/carp-hast-switch</span>.
For further clarification about this configuration, refer to <a href="https://man.freebsd.org/cgi/man.cgi?query=devd.conf&amp;sektion=5&amp;format=html">devd.conf(5)</a>.</p>
</div>
<div class="paragraph">
<p>Here is an example of an automated failover script:</p>
</div>
<div class="literalblock programlisting">
<div class="content">
<pre>#!/bin/sh

# Original script by Freddie Cash &lt;fjwcash@gmail.com&gt;
# Modified by Michael W. Lucas &lt;mwlucas@BlackHelicopters.org&gt;
# and Viktor Petersson &lt;vpetersson@wireload.net&gt;

# The names of the HAST resources, as listed in /etc/hast.conf
resources=&#34;test&#34;

# delay in mounting HAST resource after becoming primary
# make your best guess
delay=3

# logging
log=&#34;local0.debug&#34;
name=&#34;carp-hast&#34;

# end of user configurable stuff

case &#34;$1&#34; in
	primary)
		logger -p $log -t $name &#34;Switching to primary provider for ${resources}.&#34;
		sleep ${delay}

		# Wait for any &#34;hastd secondary&#34; processes to stop
		for disk in ${resources}; do
			while $( pgrep -lf &#34;hastd: ${disk} \(secondary\)&#34; &gt; /dev/null 2&gt;&amp;1 ); do
				sleep 1
			done

			# Switch role for each disk
			hastctl role primary ${disk}
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to change role to primary for resource ${disk}.&#34;
				exit 1
			fi
		done

		# Wait for the /dev/hast/* devices to appear
		for disk in ${resources}; do
			for I in $( jot 60 ); do
				[ -c &#34;/dev/hast/${disk}&#34; ] &amp;&amp; break
				sleep 0.5
			done

			if [ ! -c &#34;/dev/hast/${disk}&#34; ]; then
				logger -p $log -t $name &#34;GEOM provider /dev/hast/${disk} did not appear.&#34;
				exit 1
			fi
		done

		logger -p $log -t $name &#34;Role for HAST resources ${resources} switched to primary.&#34;

		logger -p $log -t $name &#34;Mounting disks.&#34;
		for disk in ${resources}; do
			mkdir -p /hast/${disk}
			fsck -p -y -t ufs /dev/hast/${disk}
			mount /dev/hast/${disk} /hast/${disk}
		done

	;;

	secondary)
		logger -p $log -t $name &#34;Switching to secondary provider for ${resources}.&#34;

		# Switch roles for the HAST resources
		for disk in ${resources}; do
			if ! mount | grep -q &#34;^/dev/hast/${disk} on &#34;
			then
			else
				umount -f /hast/${disk}
			fi
			sleep $delay
			hastctl role secondary ${disk} 2&gt;&amp;1
			if [ $? -ne 0 ]; then
				logger -p $log -t $name &#34;Unable to switch role to secondary for resource ${disk}.&#34;
				exit 1
			fi
			logger -p $log -t $name &#34;Role switched to secondary for resource ${disk}.&#34;
		done
	;;
esac</pre>
</div>
</div>
<div class="paragraph">
<p>In a nutshell, the script takes these actions when a node becomes primary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Promotes the HAST pool to primary on the other node.</p>
</li>
<li>
<p>Checks the file system under the HAST pool.</p>
</li>
<li>
<p>Mounts the pool.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a node becomes secondary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unmounts the HAST pool.</p>
</li>
<li>
<p>Degrades the HAST pool to secondary.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is just an example script which serves as a proof of concept.
It does not handle all the possible scenarios and can be extended or altered in any way, for example, to start or stop required services.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For this example, a standard UFS file system was used.
To reduce the time needed for recovery, a journal-enabled UFS or ZFS file system can be used instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>More detailed information with additional examples can be found at <a href="http://wiki.FreeBSD.org/HAST">http://wiki.FreeBSD.org/HAST</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting">20.15.3. Troubleshooting<a class="anchor" href="#_troubleshooting"></a></h3>
<div class="paragraph">
<p>HAST should generally work without issues.
However, as with any other software product, there may be times when it does not work as supposed.
The sources of the problems may be different, but the rule of thumb is to ensure that the time is synchronized between the nodes of the cluster.</p>
</div>
<div class="paragraph">
<p>When troubleshooting HAST, the debugging level of <a href="https://man.freebsd.org/cgi/man.cgi?query=hastd&amp;sektion=8&amp;format=html">hastd(8)</a> should be increased by starting <code>hastd</code> with <code>-d</code>.
This argument may be specified multiple times to further increase the debugging level.
Consider also using <code>-F</code>, which starts <code>hastd</code> in the foreground.</p>
</div>
<div class="sect3">
<h4 id="disks-hast-sb">20.15.3.1. Recovering from the Split-brain Condition<a class="anchor" href="#disks-hast-sb"></a></h4>
<div class="paragraph">
<p><em>Split-brain</em> occurs when the nodes of the cluster are unable to communicate with each other, and both are configured as primary.
This is a dangerous condition because it allows both nodes to make incompatible changes to the data.
This problem must be corrected manually by the system administrator.</p>
</div>
<div class="paragraph">
<p>The administrator must either decide which node has more important changes, or perform the merge manually.
Then, let HAST perform full synchronization of the node which has the broken data.
To do this, issue these commands on the node which needs to be resynchronized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="c"># hastctl role init test</span>
<span class="c"># hastctl create test</span>
<span class="c"># hastctl role secondary test</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

    </div>
    
    <hr />
    <div class="last-modified">
      <p><strong>Last modified on</strong>: December 22, 2023 by <a href="https://cgit.freebsd.org/doc/commit/?id=651fd92" target="_blank">fiercex</a></p>
    </div>
    
    <div class="buttons">
      
      <div class="prev">
        <i class="fa fa-angle-left" aria-hidden="true" title="Prev"></i>
        <div class="container">
          
            <a href=https://free.bsd-doc.org/en/books/handbook/audit class="direction">Prev</a>
          
        </div>
      </div>
      
      <div class="home">
        <i class="fa fa-home" aria-hidden="true" title="Home"></i>
        <div class="container">
          
            <a href="../" class="direction">Home</a>
          
        </div>
      </div>
      
      <div class="next">
        <div class="container">
          
            <a href=https://free.bsd-doc.org/en/books/handbook/geom  class="direction">Next</a>
          
        </div>
        <i class="fa fa-angle-right" aria-hidden="true" title="Next"></i>
      </div>
      
    </div>
    <label class="hidden book-menu-overlay" for="menu-control"></label>
  </div>
  <aside class="toc">
    <div class="toc-content">
      <h3>Table of Contents</h3>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#disks-synopsis">20.1. Synopsis</a></li>
    <li><a href="#disks-adding">20.2. Adding Disks</a></li>
    <li><a href="#disks-growing">20.3. Resizing and Growing Disks</a></li>
    <li><a href="#usb-disks">20.4. USB Storage Devices</a></li>
    <li><a href="#creating-cds">20.5. Creating and Using CD Media</a></li>
    <li><a href="#creating-dvds">20.6. Creating and Using DVD Media</a></li>
    <li><a href="#floppies">20.7. Creating and Using Floppy Disks</a></li>
    <li><a href="#using-ntfs">20.8. Using NTFS Disks</a></li>
    <li><a href="#backup-basics">20.9. Backup Basics</a></li>
    <li><a href="#disks-virtual">20.10. Memory Disks</a></li>
    <li><a href="#snapshots">20.11. File System Snapshots</a></li>
    <li><a href="#quotas">20.12. Disk Quotas</a></li>
    <li><a href="#disks-encrypting">20.13. Encrypting Disk Partitions</a></li>
    <li><a href="#swap-encrypting">20.14. Encrypting Swap</a></li>
    <li><a href="#disks-hast">20.15. Highly Available Storage (HAST)</a></li>
  </ul>
</nav>
      <hr />
      
    </div>
  </aside>
  <a class="to-top" href="#top">
    <i class="fa fa-arrow-circle-up" aria-hidden="true"></i>
  </a>
</main>

    <footer>
  <div class="footer-container">
    <section class="logo-column">
          <img src="https://free.bsd-doc.org/images/FreeBSD-colors.svg" width="160" height="50" alt="FreeBSD logo" />
        <div class="options-container">
          
            <div class="language-container">
              <a id="languages" href="https://free.bsd-doc.org/en/languages">
                
                <img src="https://free.bsd-doc.org/images/language.png" class="language-image" alt="Choose language">
                <span>English</span>
              </a>
            </div>
          
          <div class="theme-container">
            <select id="theme-chooser">
	      <option value="theme-system">System</option>
              <option value="theme-light">Light</option>
              <option value="theme-dark">Dark</option>
              <option value="theme-high-contrast">High contrast</option>
            </select>
          </div>
        </div>
      </section>
      
      <section class="copyright-column">
        <p>&copy; 1994-2023 The FreeBSD Project. All rights reserved</p>
        <span>Made with <span class="heart">♥</span> by the FreeBSD Community</span>
      </section>
  </div>
</footer>

  </body>
</html>
